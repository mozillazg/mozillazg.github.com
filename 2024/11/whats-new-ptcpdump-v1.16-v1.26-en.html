<!DOCTYPE html>
<html lang="en"  prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml" class="han-init">
<head>
    <title>Major Changes in ptcpdump versions 1.16 to 1.26 - mozillazg's Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- share.css -->
    <link rel="stylesheet" href="/theme/cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">


    <link href="https://mozillazg.com/favicon.ico" rel="icon">

<link rel="canonical" href="https://mozillazg.com/2024/11/whats-new-ptcpdump-v1.16-v1.26-en.html">

        <meta name="author" content="mozillazg" />
        <meta name="keywords" content="others,ptcpdump" />
    <meta name="description" content="Major Changes in ptcpdump versions 1.16 to 1.26 - Preface It has been several months since the last introduction of the ptcpdump project. Over these past months, I have been continuously developing this project. This article will introduce the major changes released from the previous v1.16 version to the latest v1.26 version in chronological order. Main changes Compatible with older versions of TencentOS/OpenCloudOS system Base on user feedback the older versions were not compatible with previous editions of TencentOS/OpenCloudOS. However, the current update now includes support for the following TencentOS/OpenCloudOS releases: OpenCloudOS 7/8/9 and TencentOS Server 2.4/2.6/3.1/3.2. Add parent process information to the output Old version: 13:44:41.529003 eth0 In IP (tos 0x4, ttl 45, id 45428, offset 0, flags [DF], proto TCP (6), length 52) 139.178.84.217.443 &gt; 172.19.0.2.42606: Flags [.], cksum 0x5284, seq 3173118145, ack 1385712707, win 118, options [nop,nop,TS val 134560683 ecr 1627716996], length 0 Process (pid 553587, cmd /usr/bin/wget, args wget kernel.org) Container (...) Pod (...) Latest update: 13:44:41.529003 eth0 In IP (tos 0x4, ttl 45, id 45428, offset 0, flags [DF], proto TCP (6), length 52) 139.178.84.217.443 &gt; 172.19.0.2.42606: Flags [.], cksum 0x5284, seq 3173118145, ack 1385712707, win 118, options [nop,nop,TS val 134560683 ecr 1627716996], length 0 Process (pid 553587, cmd /usr/bin/wget, args wget kernel.org) ParentProc (pid 553296, cmd /bin/sh, args sh) Container (...) Pod (...) Support using an older ..." />

    <style>
      .js-toc {
        margin-bottom: 20px;
      }
      .donate-modal {
        text-align: center;
      }
      #donate-modal-container .donate-image {
        max-height: 300px !important;
        min-height: inherit !important;
      }
    </style>

        <meta property="og:site_name" content="mozillazg's Blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Major Changes in ptcpdump versions 1.16 to 1.26"/>
        <meta property="og:url" content="https://mozillazg.com/2024/11/whats-new-ptcpdump-v1.16-v1.26-en.html"/>
        <meta property="og:description" content="Preface It has been several months since the last introduction of the ptcpdump project. Over these past months, I have been continuously developing this project. This article will introduce the major changes released from the previous v1.16 version to the latest v1.26 version in chronological order. Main changes Compatible with older versions of TencentOS/OpenCloudOS system Base on user feedback the older versions were not compatible with previous editions of TencentOS/OpenCloudOS. However, the current update now includes support for the following TencentOS/OpenCloudOS releases: OpenCloudOS 7/8/9 and TencentOS Server 2.4/2.6/3.1/3.2. Add parent process information to the output Old version: 13:44:41.529003 eth0 In IP (tos 0x4, ttl 45, id 45428, offset 0, flags [DF], proto TCP (6), length 52) 139.178.84.217.443 &gt; 172.19.0.2.42606: Flags [.], cksum 0x5284, seq 3173118145, ack 1385712707, win 118, options [nop,nop,TS val 134560683 ecr 1627716996], length 0 Process (pid 553587, cmd /usr/bin/wget, args wget kernel.org) Container (...) Pod (...) Latest update: 13:44:41.529003 eth0 In IP (tos 0x4, ttl 45, id 45428, offset 0, flags [DF], proto TCP (6), length 52) 139.178.84.217.443 &gt; 172.19.0.2.42606: Flags [.], cksum 0x5284, seq 3173118145, ack 1385712707, win 118, options [nop,nop,TS val 134560683 ecr 1627716996], length 0 Process (pid 553587, cmd /usr/bin/wget, args wget kernel.org) ParentProc (pid 553296, cmd /bin/sh, args sh) Container (...) Pod (...) Support using an older version of Kubernetes environment with Dockershim The earlier release couldn&#39;t gather Pod data in legacy Kubernetes setups running Dockershim (specifically CRI v1alpha2). The latest update is now compatible with such environments. Fix for filtering by Pod name containing periods In the past, when filtering by Pod name, names with periods were not supported. The latest version now allows names with periods to be filtered: --pod-name foo.bar.default Fix the scenario where filtering by Pod does not support Pods with multiple containers In previous versions, filtering by Pod did not support scenarios where Pods contain multiple containers. This issue has been resolved in the new version. Supporting the Concurrent Execution of Multiple ptcpdump Instances Previously, only one ptcpdump process could run at a time. Running multiple ptcpdump processes simultaneously would cause the old process to malfunction (capture no traffic). The latest version has resolved this issue. In the new version, multiple ptcpdump processes can run concurrently without interfering with each other or causing problems with packet capture for other processes. Support Filtering Multiple Process PID Simultaneously Now the --pid parameter supports filtering multiple PIDs simultaneously: --pid pid1 --pid pid2 New parameters --micro, --nano, --time-stamp-precision added to control the time format in the output New parameters --micro, --nano, --time-stamp-precision have been added to control the time format in the output, mirroring the functionality and usage of tcpdump. --micro, --time-stamp-precision=micro: 13:36:05.701978 IP 10.0.2.15.22 &gt; 10.0.2.2.59874: Flags [P.], seq 1370707216:1370707292, ack 4569736, win 62780, length 76 --nano, --time-stamp-precision=nano: 13:36:05.701978488 IP 10.0.2.15.22 &gt; 10.0.2.2.59874: Flags [P.], seq 1370707216:1370707292, ack 4569736, win 62780, length 76 Add parameters -A, -x, -xx, -X, -XX to control the output format of the data Add functionality and usage comparison of tcpdump flags -A, -x, -xx, -X, -XX. -A: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] E..nHL@.@... ..........P.G..vbbEP.......GET / HTTP/1.1 Host: qq.com User-Agent: curl/7.81.0 Accept: */* -x: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] 0x0000: 4500 006e 484c 4000 4006 1bc4 0a00 020f 0x0010: cbcd fe9d d0e6 0050 c447 8e98 7662 6245 0x0020: 5018 faf0 d6da 0000 4745 5420 2f20 4854 0x0030: 5450 2f31 2e31 0d0a 486f 7374 3a20 7171 0x0040: 2e63 6f6d 0d0a 5573 6572 2d41 6765 6e74 0x0050: 3a20 6375 726c 2f37 2e38 312e 300d 0a41 0x0060: 6363 6570 743a 202a 2f2a 0d0a 0d0a -xx: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] 0x0000: 0050 56eb bc4e 000c 298e 31f3 0800 4500 0x0010: 006e 484c 4000 4006 1bc4 0a00 020f cbcd 0x0020: fe9d d0e6 0050 c447 8e98 7662 6245 5018 0x0030: faf0 d6da 0000 4745 5420 2f20 4854 5450 0x0040: 2f31 2e31 0d0a 486f 7374 3a20 7171 2e63 0x0050: 6f6d 0d0a 5573 6572 2d41 6765 6e74 3a20 0x0060: 6375 726c 2f37 2e38 312e 300d 0a41 6363 0x0070: 6570 743a 202a 2f2a 0d0a 0d0a -X: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] 0x0000: 4500 006e 484c 4000 4006 1bc4 0a00 020f E..nHL@.@....... 0x0010: cbcd fe9d d0e6 0050 c447 8e98 7662 6245 .......P.G..vbbE 0x0020: 5018 faf0 d6da 0000 4745 5420 2f20 4854 P.......GET / HT 0x0030: 5450 2f31 2e31 0d0a 486f 7374 3a20 7171 TP/1.1..Host: qq 0x0040: 2e63 6f6d 0d0a 5573 6572 2d41 6765 6e74 .com..User-Agent 0x0050: 3a20 6375 726c 2f37 2e38 312e 300d 0a41 : curl/7.81.0..A 0x0060: 6363 6570 743a 202a 2f2a 0d0a 0d0a ccept: */*.... -XX: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] 0x0000: 0050 56eb bc4e 000c 298e 31f3 0800 4500 .PV..N..).1...E. 0x0010: 006e 484c 4000 4006 1bc4 0a00 020f cbcd .nHL@.@......... 0x0020: fe9d d0e6 0050 c447 8e98 7662 6245 5018 .....P.G..vbbEP. 0x0030: faf0 d6da 0000 4745 5420 2f20 4854 5450 ......GET / HTTP 0x0040: 2f31 2e31 0d0a 486f 7374 3a20 7171 2e63 /1.1..Host: qq.c 0x0050: 6f6d 0d0a 5573 6572 2d41 6765 6e74 3a20 om..User-Agent: 0x0060: 6375 726c 2f37 2e38 312e 300d 0a41 6363 curl/7.81.0..Acc 0x0070: 6570 743a 202a 2f2a 0d0a 0d0a ept: */*.... Create Docker Images for Compiling and Running ptcpdump Create a Docker image for compiling programs: quay.io/ptcpdump/develop:latest and a Docker image for running ptcpdump through Docker: quay.io/ptcpdump/ptcpdump:latest Compile eBPF programs and ptcpdump programs as needed using make build-bpf-via-docker and make build-via-docker. You can run ptcpdump through Docker using a command similar to the following: docker run --privileged --rm -t --net=host --pid=host \ -v /sys/fs/cgroup:/sys/fs/cgroup:ro \ quay.io/ptcpdump/ptcpdump:latest ptcpdump -i any -c 2 tcp Experimental New Feature: Generating Corresponding TLS Key Log File When Capturing Go Program&#39;s Network Traffic A new experimental feature has been implemented in the latest version: generating the corresponding TLS Key Log file when capturing Go program&#39;s network traffic. The TLS Key Log file, also known as SSLKEYLOGFILE , corresponds to the pre-master secret configuration in Wireshark. Third-party programs can decrypt captured TLS traffic using the information recorded in this file. Please note: This feature is experimental and is only supported by Go programs compiled with version 1.18 or above (supports stripped binary). It also requires running the target Go program via ptcpdump. You can try out this feature using the following two methods: Use the --write-keylog-file argument or the SSLKEYLOGFILE environment variable to specify the location where the SSLKEYLOGFILE file will be saved: sudo ptcpdump -i any --write-keylog-file /tmp/keylogfile.txt -w /tmp/go.pcapng -- ./gohttpapp By specifying the --embed-keylog-to-pcapng parameter, embed the contents of the SSLKEYLOGFILE into the saved data in the pcapng format file: sudo ptcpdump -i any --embed-keylog-to-pcapng -w /tmp/gotls.pcapng -- ./gohttpapp Later, you can decrypt the saved TLS data using the recorded SSLKEYLOGFILE content with Wireshark or tshark: $ sudo tshark -r /tmp/go.pcapng -o tls.keylog_file:/tmp/keylogfile.txt | grep HTTP -B 2 Running as user &#34;root&#34; and group &#34;root&#34;. This could be dangerous. 18 0.518380586 10.0.2.15 → 13.35.238.63 TLSv1.3 118 Change Cipher Spec, Finished 19 0.519208290 13.35.238.63 → 10.0.2.15 TCP 60 443 → 47606 [ACK] Seq=5508 Ack=340 Win=64240 Len=0 20 0.519914720 10.0.2.15 → 13.35.238.63 HTTP 179 GET /foo/bar HTTP/1.1 $ tshark -r /tmp/gotls.pcapng | grep HTTP -B 2 20 0.525662563 10.0.2.15 → 13.35.238.114 TLSv1.3 118 Change Cipher Spec, Finished 21 0.526138582 13.35.238.114 → 10.0.2.15 TCP 60 443 → 37618 [ACK] Seq=5987 Ack=340 Win=64240 Len=0 22 0.526977836 10.0.2.15 → 13.35.238.114 HTTP 179 GET /foo/bar HTTP/1.1 ptcpdump plans to eventually have built-in support for decrypting TLS data using SSLKEYLOGFILE and to automatically decrypt TLS data in real-time while capturing packets. Currently, this can only be achieved using third-party tools for decrypting TLS data. Output TCP options by default The new version will by default output TCP Options information: Old version: 14:09:54.324433 ens33 curl.26570 Out IP (..).43772 &gt; (..).443: Flags [S], seq 1674193846, win 64240, length 0, ParentProc [ptcpdump.26560] Latest version: 14:09:54.324433 ens33 curl.26570 Out IP (..).43772 &gt; (..).443: Flags [S], seq 1674193846, win 64240, options [mss 1460,sackOK,TS val 2107137325 ecr 0,nop,wscale 7], length 0, ParentProc [ptcpdump.26560] Moreover, the latest update includes support for TCP SACK (Selective Acknowledgment) and TFO (TCP Fast Open). SACK: 19:03:36.220872 IP6 dead:beef:2::2.35288 &gt; dead:beef:2::1.10029: Flags [.], seq 731670714, ack 2274465610, win 201, options [nop,nop,TS val 1253137130 ecr 837820024,nop,nop,sack 1 {2274467010:2274483378},mptcp 12 dss ack 16301812255838552430], length 0 TFO: 19:22:26.586851 IP6 dead:beef:1::2.54040 &gt; dead:beef:1::1.10056: Flags [S], seq 271661201, win 64800, options [mss 1440,sackOK,TS val 2947503028 ecr 0,nop,wscale 7,tfo cookiereq,nop,nop,mptcp 4 capable v1 flags [H]], length 0 19:22:26.591736 IP6 dead:beef:1::1.10056 &gt; dead:beef:1::2.54040: Flags [S.], seq 1229575956, ack 271661202, win 64260, options [mss 1440,nop,nop,sackOK,nop,wscale 7,tfo cookie 29b3cc66639d427d,nop,nop,mptcp 12 capable v1 flags [H] {0xc87438912bc26cb7}], length 0 Output the MPTCP information in the TCP Options According to the requirement from the MPTCP (MultiPath TCP) community, support for MPTCP should be added: 15:31:51.696224 IP 10.0.1.2.60958 &gt; 10.0.1.1.10004: Flags [S], seq 3019570341, win 64240, options [mss 1460,sackOK,TS val 1007819908 ecr 0,nop,wscale 7,mptcp 4 capable v1 flags [H]], length 0 15:31:51.696346 IP 10.0.1.1.10004 &gt; 10.0.1.2.60958: Flags [S.], seq 2367868313, ack 3019570342, win 65160, options [mss 1460,sackOK,TS val 162498895 ecr 1007819908,nop,wscale 7,mptcp 12 capable v1 flags [H] {0x8ea1df6e0d588003}], length 0 15:31:51.696587 IP 10.0.1.2.60958 &gt; 10.0.1.1.10004: Flags [.], seq 3019570342, ack 2367868314, win 502, options [nop,nop,TS val 1007819909 ecr 162498895,mptcp 20 capable v1 flags [H] {0x465bcd01b5d78120,0x8ea1df6e0d588003}], length 0 Add a new parameter --netns to support capturing network interfaces in other network namespaces The previous version only supported capturing network interfaces in the current network namespace. The new version now supports capturing network interfaces in other network namespaces by adding the --netns parameter: sudo ptcpdump -i lo --netns /run/netns/foobar sudo ptcpdump -i any --netns /run/netns/foobar sudo ptcpdump -i any --netns /proc/26/ns/net PcapNg format enhancement: reading/writing network interface names and Inbound/Outbound information In previous versions, using ptcpdump -r &lt;file.pcapng&gt; to read a pcapng file did not display the recorded network interface names and Inbound/Outbound information. This issue has been resolved in the new version: $ ptcpdump -r demo.pcapng 14:36:35.880947 ens33 curl.244103 Out IP 10.0.2.15.37668 &gt; 114.114.114.114.53: 44427+ A? qq.com. (24), ParentProc [ptcpdump.244094] 14:36:35.882099 ens33 curl.244103 Out IP 10.0.2.15.37668 &gt; 114.114.114.114.53: 31415+ AAAA? qq.com. (24), ParentProc [ptcpdump.244094] 14:36:35.954613 ens33 curl.244103 In IP 114.114.114.114.53 &gt; 10.0.2.15.37668: 44427 3/0/0 A 203.205.254.157, A 113.108.81.189, A 123.150.76.218 (72), ParentProc [ptcpdump.244094] When saving the captured traffic information as a PcapNg format file, the new version will automatically write Inbound/Outbound information (previous versions already wrote network interface information), thus supporting the epb_flags (Enhanced Packet Block Flags Word ) flag for the PcapNg format. If you have any additional improvements or new feature suggestions for ptcpdump, feel free to leave a comment in the comments section or project issues."/>
        <meta property="article:published_time" content="2024-11-02" />
            <meta property="article:section" content="others" />
            <meta property="article:tag" content="others" />
            <meta property="article:tag" content="ptcpdump" />
            <meta property="article:author" content="mozillazg" />
            <meta property="og:image"
                  content="https://mozillazg.com/static/avatar.jpeg"/>


    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@mozillazg">
        <meta name="twitter:creator" content="@mozillazg">
    <meta name="twitter:domain" content="https://mozillazg.com">
            <meta property="twitter:image"
                  content="https://mozillazg.com/static/avatar.jpeg"/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/cdn.jsdelivr.net/npm/bootstrap@3.3.4/dist/css/bootstrap.min.css" type="text/css"/>
    <link href="/theme/cdn.jsdelivr.net/npm/font-awesome@4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/cdn.jsdelivr.net/npm/pygments-css@1.0.0/github.css" rel="stylesheet">
    <link rel="stylesheet" href="https://mozillazg.com/theme/css/style.css" type="text/css"/>
            <link href="/static/han.min.css" rel="stylesheet">
            <link href="/static/yue.css" rel="stylesheet">
            <link href="/static/custom.css" rel="stylesheet">

        <link href="https://mozillazg.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="mozillazg's Blog ATOM Feed"/>

        <link href="https://mozillazg.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="mozillazg's Blog RSS Feed"/>


        <link href="https://mozillazg.com/feeds/others.atom.xml" type="application/atom+xml" rel="alternate"
              title="mozillazg's Blog others ATOM Feed"/>


    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "publisher": {
            "@type": "Person",
            "name": "mozillazg",
            "logo": "https://mozillazg.com/static/avatar.jpeg"
        },
        "author": {
            "@type": "Person",
            "name": "mozillazg",
            "image": "https://mozillazg.com/static/avatar.jpeg",
            "url": "https://mozillazg.com",
            "sameAs": []
        },
        "headline": "Major Changes in ptcpdump versions 1.16 to 1.26",
        "url": "https://mozillazg.com/2024/11/whats-new-ptcpdump-v1.16-v1.26-en.html",
        "image": [
            "https://mozillazg.com/static/avatar.jpeg"
         ],
        "keywords": "others, ptcpdump",
        "description": "Preface It has been several months since the last introduction of the ptcpdump project. Over these past months, I have been continuously developing this project. This article will introduce the major changes released from the previous v1.16 version to the latest v1.26 version in chronological order. Main changes Compatible with older versions of TencentOS/OpenCloudOS system Base on user feedback the older versions were not compatible with previous editions of TencentOS/OpenCloudOS. However, the current update now includes support for the following TencentOS/OpenCloudOS releases: OpenCloudOS 7/8/9 and TencentOS Server 2.4/2.6/3.1/3.2. Add parent process information to the output Old version: 13:44:41.529003 eth0 In IP (tos 0x4, ttl 45, id 45428, offset 0, flags [DF], proto TCP (6), length 52) 139.178.84.217.443 &gt; 172.19.0.2.42606: Flags [.], cksum 0x5284, seq 3173118145, ack 1385712707, win 118, options [nop,nop,TS val 134560683 ecr 1627716996], length 0 Process (pid 553587, cmd /usr/bin/wget, args wget kernel.org) Container (...) Pod (...) Latest update: 13:44:41.529003 eth0 In IP (tos 0x4, ttl 45, id 45428, offset 0, flags [DF], proto TCP (6), length 52) 139.178.84.217.443 &gt; 172.19.0.2.42606: Flags [.], cksum 0x5284, seq 3173118145, ack 1385712707, win 118, options [nop,nop,TS val 134560683 ecr 1627716996], length 0 Process (pid 553587, cmd /usr/bin/wget, args wget kernel.org) ParentProc (pid 553296, cmd /bin/sh, args sh) Container (...) Pod (...) Support using an older version of Kubernetes environment with Dockershim The earlier release couldn&#39;t gather Pod data in legacy Kubernetes setups running Dockershim (specifically CRI v1alpha2). The latest update is now compatible with such environments. Fix for filtering by Pod name containing periods In the past, when filtering by Pod name, names with periods were not supported. The latest version now allows names with periods to be filtered: --pod-name foo.bar.default Fix the scenario where filtering by Pod does not support Pods with multiple containers In previous versions, filtering by Pod did not support scenarios where Pods contain multiple containers. This issue has been resolved in the new version. Supporting the Concurrent Execution of Multiple ptcpdump Instances Previously, only one ptcpdump process could run at a time. Running multiple ptcpdump processes simultaneously would cause the old process to malfunction (capture no traffic). The latest version has resolved this issue. In the new version, multiple ptcpdump processes can run concurrently without interfering with each other or causing problems with packet capture for other processes. Support Filtering Multiple Process PID Simultaneously Now the --pid parameter supports filtering multiple PIDs simultaneously: --pid pid1 --pid pid2 New parameters --micro, --nano, --time-stamp-precision added to control the time format in the output New parameters --micro, --nano, --time-stamp-precision have been added to control the time format in the output, mirroring the functionality and usage of tcpdump. --micro, --time-stamp-precision=micro: 13:36:05.701978 IP 10.0.2.15.22 &gt; 10.0.2.2.59874: Flags [P.], seq 1370707216:1370707292, ack 4569736, win 62780, length 76 --nano, --time-stamp-precision=nano: 13:36:05.701978488 IP 10.0.2.15.22 &gt; 10.0.2.2.59874: Flags [P.], seq 1370707216:1370707292, ack 4569736, win 62780, length 76 Add parameters -A, -x, -xx, -X, -XX to control the output format of the data Add functionality and usage comparison of tcpdump flags -A, -x, -xx, -X, -XX. -A: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] E..nHL@.@... ..........P.G..vbbEP.......GET / HTTP/1.1 Host: qq.com User-Agent: curl/7.81.0 Accept: */* -x: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] 0x0000: 4500 006e 484c 4000 4006 1bc4 0a00 020f 0x0010: cbcd fe9d d0e6 0050 c447 8e98 7662 6245 0x0020: 5018 faf0 d6da 0000 4745 5420 2f20 4854 0x0030: 5450 2f31 2e31 0d0a 486f 7374 3a20 7171 0x0040: 2e63 6f6d 0d0a 5573 6572 2d41 6765 6e74 0x0050: 3a20 6375 726c 2f37 2e38 312e 300d 0a41 0x0060: 6363 6570 743a 202a 2f2a 0d0a 0d0a -xx: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] 0x0000: 0050 56eb bc4e 000c 298e 31f3 0800 4500 0x0010: 006e 484c 4000 4006 1bc4 0a00 020f cbcd 0x0020: fe9d d0e6 0050 c447 8e98 7662 6245 5018 0x0030: faf0 d6da 0000 4745 5420 2f20 4854 5450 0x0040: 2f31 2e31 0d0a 486f 7374 3a20 7171 2e63 0x0050: 6f6d 0d0a 5573 6572 2d41 6765 6e74 3a20 0x0060: 6375 726c 2f37 2e38 312e 300d 0a41 6363 0x0070: 6570 743a 202a 2f2a 0d0a 0d0a -X: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] 0x0000: 4500 006e 484c 4000 4006 1bc4 0a00 020f E..nHL@.@....... 0x0010: cbcd fe9d d0e6 0050 c447 8e98 7662 6245 .......P.G..vbbE 0x0020: 5018 faf0 d6da 0000 4745 5420 2f20 4854 P.......GET / HT 0x0030: 5450 2f31 2e31 0d0a 486f 7374 3a20 7171 TP/1.1..Host: qq 0x0040: 2e63 6f6d 0d0a 5573 6572 2d41 6765 6e74 .com..User-Agent 0x0050: 3a20 6375 726c 2f37 2e38 312e 300d 0a41 : curl/7.81.0..A 0x0060: 6363 6570 743a 202a 2f2a 0d0a 0d0a ccept: */*.... -XX: 14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094] 0x0000: 0050 56eb bc4e 000c 298e 31f3 0800 4500 .PV..N..).1...E. 0x0010: 006e 484c 4000 4006 1bc4 0a00 020f cbcd .nHL@.@......... 0x0020: fe9d d0e6 0050 c447 8e98 7662 6245 5018 .....P.G..vbbEP. 0x0030: faf0 d6da 0000 4745 5420 2f20 4854 5450 ......GET / HTTP 0x0040: 2f31 2e31 0d0a 486f 7374 3a20 7171 2e63 /1.1..Host: qq.c 0x0050: 6f6d 0d0a 5573 6572 2d41 6765 6e74 3a20 om..User-Agent: 0x0060: 6375 726c 2f37 2e38 312e 300d 0a41 6363 curl/7.81.0..Acc 0x0070: 6570 743a 202a 2f2a 0d0a 0d0a ept: */*.... Create Docker Images for Compiling and Running ptcpdump Create a Docker image for compiling programs: quay.io/ptcpdump/develop:latest and a Docker image for running ptcpdump through Docker: quay.io/ptcpdump/ptcpdump:latest Compile eBPF programs and ptcpdump programs as needed using make build-bpf-via-docker and make build-via-docker. You can run ptcpdump through Docker using a command similar to the following: docker run --privileged --rm -t --net=host --pid=host \\ -v /sys/fs/cgroup:/sys/fs/cgroup:ro \\ quay.io/ptcpdump/ptcpdump:latest ptcpdump -i any -c 2 tcp Experimental New Feature: Generating Corresponding TLS Key Log File When Capturing Go Program&#39;s Network Traffic A new experimental feature has been implemented in the latest version: generating the corresponding TLS Key Log file when capturing Go program&#39;s network traffic. The TLS Key Log file, also known as SSLKEYLOGFILE , corresponds to the pre-master secret configuration in Wireshark. Third-party programs can decrypt captured TLS traffic using the information recorded in this file. Please note: This feature is experimental and is only supported by Go programs compiled with version 1.18 or above (supports stripped binary). It also requires running the target Go program via ptcpdump. You can try out this feature using the following two methods: Use the --write-keylog-file argument or the SSLKEYLOGFILE environment variable to specify the location where the SSLKEYLOGFILE file will be saved: sudo ptcpdump -i any --write-keylog-file /tmp/keylogfile.txt -w /tmp/go.pcapng -- ./gohttpapp By specifying the --embed-keylog-to-pcapng parameter, embed the contents of the SSLKEYLOGFILE into the saved data in the pcapng format file: sudo ptcpdump -i any --embed-keylog-to-pcapng -w /tmp/gotls.pcapng -- ./gohttpapp Later, you can decrypt the saved TLS data using the recorded SSLKEYLOGFILE content with Wireshark or tshark: $ sudo tshark -r /tmp/go.pcapng -o tls.keylog_file:/tmp/keylogfile.txt | grep HTTP -B 2 Running as user &#34;root&#34; and group &#34;root&#34;. This could be dangerous. 18 0.518380586 10.0.2.15 → 13.35.238.63 TLSv1.3 118 Change Cipher Spec, Finished 19 0.519208290 13.35.238.63 → 10.0.2.15 TCP 60 443 → 47606 [ACK] Seq=5508 Ack=340 Win=64240 Len=0 20 0.519914720 10.0.2.15 → 13.35.238.63 HTTP 179 GET /foo/bar HTTP/1.1 $ tshark -r /tmp/gotls.pcapng | grep HTTP -B 2 20 0.525662563 10.0.2.15 → 13.35.238.114 TLSv1.3 118 Change Cipher Spec, Finished 21 0.526138582 13.35.238.114 → 10.0.2.15 TCP 60 443 → 37618 [ACK] Seq=5987 Ack=340 Win=64240 Len=0 22 0.526977836 10.0.2.15 → 13.35.238.114 HTTP 179 GET /foo/bar HTTP/1.1 ptcpdump plans to eventually have built-in support for decrypting TLS data using SSLKEYLOGFILE and to automatically decrypt TLS data in real-time while capturing packets. Currently, this can only be achieved using third-party tools for decrypting TLS data. Output TCP options by default The new version will by default output TCP Options information: Old version: 14:09:54.324433 ens33 curl.26570 Out IP (..).43772 &gt; (..).443: Flags [S], seq 1674193846, win 64240, length 0, ParentProc [ptcpdump.26560] Latest version: 14:09:54.324433 ens33 curl.26570 Out IP (..).43772 &gt; (..).443: Flags [S], seq 1674193846, win 64240, options [mss 1460,sackOK,TS val 2107137325 ecr 0,nop,wscale 7], length 0, ParentProc [ptcpdump.26560] Moreover, the latest update includes support for TCP SACK (Selective Acknowledgment) and TFO (TCP Fast Open). SACK: 19:03:36.220872 IP6 dead:beef:2::2.35288 &gt; dead:beef:2::1.10029: Flags [.], seq 731670714, ack 2274465610, win 201, options [nop,nop,TS val 1253137130 ecr 837820024,nop,nop,sack 1 {2274467010:2274483378},mptcp 12 dss ack 16301812255838552430], length 0 TFO: 19:22:26.586851 IP6 dead:beef:1::2.54040 &gt; dead:beef:1::1.10056: Flags [S], seq 271661201, win 64800, options [mss 1440,sackOK,TS val 2947503028 ecr 0,nop,wscale 7,tfo cookiereq,nop,nop,mptcp 4 capable v1 flags [H]], length 0 19:22:26.591736 IP6 dead:beef:1::1.10056 &gt; dead:beef:1::2.54040: Flags [S.], seq 1229575956, ack 271661202, win 64260, options [mss 1440,nop,nop,sackOK,nop,wscale 7,tfo cookie 29b3cc66639d427d,nop,nop,mptcp 12 capable v1 flags [H] {0xc87438912bc26cb7}], length 0 Output the MPTCP information in the TCP Options According to the requirement from the MPTCP (MultiPath TCP) community, support for MPTCP should be added: 15:31:51.696224 IP 10.0.1.2.60958 &gt; 10.0.1.1.10004: Flags [S], seq 3019570341, win 64240, options [mss 1460,sackOK,TS val 1007819908 ecr 0,nop,wscale 7,mptcp 4 capable v1 flags [H]], length 0 15:31:51.696346 IP 10.0.1.1.10004 &gt; 10.0.1.2.60958: Flags [S.], seq 2367868313, ack 3019570342, win 65160, options [mss 1460,sackOK,TS val 162498895 ecr 1007819908,nop,wscale 7,mptcp 12 capable v1 flags [H] {0x8ea1df6e0d588003}], length 0 15:31:51.696587 IP 10.0.1.2.60958 &gt; 10.0.1.1.10004: Flags [.], seq 3019570342, ack 2367868314, win 502, options [nop,nop,TS val 1007819909 ecr 162498895,mptcp 20 capable v1 flags [H] {0x465bcd01b5d78120,0x8ea1df6e0d588003}], length 0 Add a new parameter --netns to support capturing network interfaces in other network namespaces The previous version only supported capturing network interfaces in the current network namespace. The new version now supports capturing network interfaces in other network namespaces by adding the --netns parameter: sudo ptcpdump -i lo --netns /run/netns/foobar sudo ptcpdump -i any --netns /run/netns/foobar sudo ptcpdump -i any --netns /proc/26/ns/net PcapNg format enhancement: reading/writing network interface names and Inbound/Outbound information In previous versions, using ptcpdump -r &lt;file.pcapng&gt; to read a pcapng file did not display the recorded network interface names and Inbound/Outbound information. This issue has been resolved in the new version: $ ptcpdump -r demo.pcapng 14:36:35.880947 ens33 curl.244103 Out IP 10.0.2.15.37668 &gt; 114.114.114.114.53: 44427+ A? qq.com. (24), ParentProc [ptcpdump.244094] 14:36:35.882099 ens33 curl.244103 Out IP 10.0.2.15.37668 &gt; 114.114.114.114.53: 31415+ AAAA? qq.com. (24), ParentProc [ptcpdump.244094] 14:36:35.954613 ens33 curl.244103 In IP 114.114.114.114.53 &gt; 10.0.2.15.37668: 44427 3/0/0 A 203.205.254.157, A 113.108.81.189, A 123.150.76.218 (72), ParentProc [ptcpdump.244094] When saving the captured traffic information as a PcapNg format file, the new version will automatically write Inbound/Outbound information (previous versions already wrote network interface information), thus supporting the epb_flags (Enhanced Packet Block Flags Word ) flag for the PcapNg format. If you have any additional improvements or new feature suggestions for ptcpdump, feel free to leave a comment in the comments section or project issues.",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://mozillazg.com/2024/11/whats-new-ptcpdump-v1.16-v1.26-en.html"
        },
        "datePublished": "2024-11-02"
    }
    </script>

</head>
<body>

<div class="navbar" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://mozillazg.com/" class="navbar-brand">
mozillazg's Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="https://mozillazg.com/feeds/all.atom.xml">Feed</a></li>
                    <li><a href="/2014/10/pages/about-me.html">About</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://mozillazg.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content" class="yue">
        <article>
            <header class="text-center">
                <h1>
                    <a href="https://mozillazg.com/2024/11/whats-new-ptcpdump-v1.16-v1.26-en.html"
                       rel="bookmark"
                       title="Permalink to Major Changes in ptcpdump versions 1.16 to 1.26">
                        Major Changes in ptcpdump versions 1.16 to 1.26
                    </a>
                </h1>
                <p class="published">
                    <time datetime="2024-11-02T00:00:00+00:00">
                    2024-11-02
                    </time>
                </p>
            </header>
            <div class="entry-content">
                <div class="well-sm article-info">
<footer class="post-info">
        <a href="https://mozillazg.com/category/others.html">others</a>


<span class="label label-default hide">Tags</span>
	<a href="https://mozillazg.com/tag/ptcpdump.html">ptcpdump</a>
    <span class="label label-default">Lang</span>
	<a href="https://mozillazg.com/2024/11/whats-new-ptcpdump-v1.16-v1.26.html">zh</a>

</footer><!-- /.post-info -->                </div>
                <div class="js-toc"></div>
                <div>
                <div class="section" id="preface">
<h2 id="hidpreface">Preface<a class="headerlink" href="#hidpreface" title="Permalink to this headline">¶</a></h2>
<p>It has been several months since the
<a class="reference external" href="https://mozillazg.com/2024/07/ebpf-ptcpdump-capturing-the-network-traffic-of-a-process-or-container-or-pod.html">last introduction</a>
of the <a class="reference external" href="https://github.com/mozillazg/ptcpdump">ptcpdump</a> project.
Over these past months, I have been continuously developing this project.
This article will introduce the major changes released from the previous v1.16
version to the latest v1.26 version in chronological order.</p>
</div>
<div class="section" id="main-changes">
<h2 id="hidmain-changes">Main changes<a class="headerlink" href="#hidmain-changes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="compatible-with-older-versions-of-tencentos-opencloudos-system">
<h3 id="hidcompatible-with-older-versions-of-tencentos-opencloudos-system">Compatible with older versions of TencentOS/OpenCloudOS system<a class="headerlink" href="#hidcompatible-with-older-versions-of-tencentos-opencloudos-system" title="Permalink to this headline">¶</a></h3>
<p>Base on user <a class="reference external" href="https://github.com/mozillazg/ptcpdump/issues/89">feedback</a>
the older versions were not compatible with previous editions of TencentOS/OpenCloudOS.
However, the current update now includes support for the following TencentOS/OpenCloudOS
releases: OpenCloudOS 7/8/9 and TencentOS Server 2.4/2.6/3.1/3.2.</p>
</div>
<div class="section" id="add-parent-process-information-to-the-output">
<h3 id="hidadd-parent-process-information-to-the-output">Add parent process information to the output<a class="headerlink" href="#hidadd-parent-process-information-to-the-output" title="Permalink to this headline">¶</a></h3>
<p>Old version:</p>
<pre class="literal-block">
13:44:41.529003 eth0 In IP (tos 0x4, ttl 45, id 45428, offset 0, flags [DF], proto TCP (6), length 52)
    139.178.84.217.443 &gt; 172.19.0.2.42606: Flags [.], cksum 0x5284, seq 3173118145, ack 1385712707, win 118, options [nop,nop,TS val 134560683 ecr 1627716996], length 0
    Process (pid 553587, cmd /usr/bin/wget, args wget kernel.org)
    Container (...)
    Pod (...)
</pre>
<p>Latest update:</p>
<pre class="literal-block">
13:44:41.529003 eth0 In IP (tos 0x4, ttl 45, id 45428, offset 0, flags [DF], proto TCP (6), length 52)
    139.178.84.217.443 &gt; 172.19.0.2.42606: Flags [.], cksum 0x5284, seq 3173118145, ack 1385712707, win 118, options [nop,nop,TS val 134560683 ecr 1627716996], length 0
    Process (pid 553587, cmd /usr/bin/wget, args wget kernel.org)
    ParentProc (pid 553296, cmd /bin/sh, args sh)
    Container (...)
    Pod (...)
</pre>
</div>
<div class="section" id="support-using-an-older-version-of-kubernetes-environment-with-dockershim">
<h3 id="hidsupport-using-an-older-version-of-kubernetes-environment-with-dockershim">Support using an older version of Kubernetes environment with Dockershim<a class="headerlink" href="#hidsupport-using-an-older-version-of-kubernetes-environment-with-dockershim" title="Permalink to this headline">¶</a></h3>
<p>The earlier release couldn't gather Pod data in legacy Kubernetes setups running
Dockershim (specifically CRI v1alpha2). The latest update is now compatible with such environments.</p>
</div>
<div class="section" id="fix-for-filtering-by-pod-name-containing-periods">
<h3 id="hidfix-for-filtering-by-pod-name-containing-periods">Fix for filtering by Pod name containing periods<a class="headerlink" href="#hidfix-for-filtering-by-pod-name-containing-periods" title="Permalink to this headline">¶</a></h3>
<p>In the past, when filtering by Pod name, names with periods were not supported.
The latest version now allows names with periods to be filtered:</p>
<pre class="literal-block">
--pod-name foo.bar.default
</pre>
</div>
<div class="section" id="fix-the-scenario-where-filtering-by-pod-does-not-support-pods-with-multiple-containers">
<h3 id="hidfix-the-scenario-where-filtering-by-pod-does-not-support-pods-with-multiple-containers">Fix the scenario where filtering by Pod does not support Pods with multiple containers<a class="headerlink" href="#hidfix-the-scenario-where-filtering-by-pod-does-not-support-pods-with-multiple-containers" title="Permalink to this headline">¶</a></h3>
<p>In previous versions, filtering by Pod did not support scenarios where Pods contain multiple containers.
This issue has been resolved in the new version.</p>
</div>
<div class="section" id="supporting-the-concurrent-execution-of-multiple-ptcpdump-instances">
<h3 id="hidsupporting-the-concurrent-execution-of-multiple-ptcpdump-instances">Supporting the Concurrent Execution of Multiple ptcpdump Instances<a class="headerlink" href="#hidsupporting-the-concurrent-execution-of-multiple-ptcpdump-instances" title="Permalink to this headline">¶</a></h3>
<p>Previously, only one ptcpdump process could run at a time. Running multiple ptcpdump processes simultaneously
would cause the old process to malfunction (capture no traffic). The latest version has resolved this issue.
In the new version, multiple ptcpdump processes can run concurrently without interfering
with each other or causing problems with packet capture for other processes.</p>
</div>
<div class="section" id="support-filtering-multiple-process-pid-simultaneously">
<h3 id="hidsupport-filtering-multiple-process-pid-simultaneously">Support Filtering Multiple Process PID Simultaneously<a class="headerlink" href="#hidsupport-filtering-multiple-process-pid-simultaneously" title="Permalink to this headline">¶</a></h3>
<p>Now the <tt class="docutils literal"><span class="pre">--pid</span></tt> parameter supports filtering multiple PIDs simultaneously:</p>
<pre class="literal-block">
--pid pid1 --pid pid2
</pre>
</div>
<div class="section" id="new-parameters-micro-nano-time-stamp-precision-added-to-control-the-time-format-in-the-output">
<h3 id="hidnew-parameters-micro-nano-time-stamp-precision-added-to-control-the-time-format-in-the-output">New parameters --micro, --nano, --time-stamp-precision added to control the time format in the output<a class="headerlink" href="#hidnew-parameters-micro-nano-time-stamp-precision-added-to-control-the-time-format-in-the-output" title="Permalink to this headline">¶</a></h3>
<p>New parameters <tt class="docutils literal"><span class="pre">--micro</span></tt>, <tt class="docutils literal"><span class="pre">--nano</span></tt>, <tt class="docutils literal"><span class="pre">--time-stamp-precision</span></tt> have been added to control the
time format in the output, mirroring the functionality and usage of tcpdump.</p>
<p><tt class="docutils literal"><span class="pre">--micro</span></tt>, <tt class="docutils literal"><span class="pre">--time-stamp-precision=micro</span></tt>:</p>
<pre class="literal-block">
13:36:05.701978 IP 10.0.2.15.22 &gt; 10.0.2.2.59874: Flags [P.], seq 1370707216:1370707292, ack 4569736, win 62780, length 76
</pre>
<p><tt class="docutils literal"><span class="pre">--nano</span></tt>, <tt class="docutils literal"><span class="pre">--time-stamp-precision=nano</span></tt>:</p>
<pre class="literal-block">
13:36:05.701978488 IP 10.0.2.15.22 &gt; 10.0.2.2.59874: Flags [P.], seq 1370707216:1370707292, ack 4569736, win 62780, length 76
</pre>
</div>
<div class="section" id="add-parameters-a-x-xx-x-xx-to-control-the-output-format-of-the-data">
<h3 id="hidadd-parameters-a-x-xx-x-xx-to-control-the-output-format-of-the-data">Add parameters -A, -x, -xx, -X, -XX to control the output format of the data<a class="headerlink" href="#hidadd-parameters-a-x-xx-x-xx-to-control-the-output-format-of-the-data" title="Permalink to this headline">¶</a></h3>
<p>Add functionality and usage comparison of tcpdump flags <tt class="docutils literal"><span class="pre">-A</span></tt>, <tt class="docutils literal"><span class="pre">-x</span></tt>, <tt class="docutils literal"><span class="pre">-xx</span></tt>, <tt class="docutils literal"><span class="pre">-X</span></tt>, <tt class="docutils literal"><span class="pre">-XX</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">-A</span></tt>:</p>
<pre class="literal-block">
14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094]
E..nHL&#64;.&#64;...
..........P.G..vbbEP.......GET / HTTP/1.1
Host: qq.com
User-Agent: curl/7.81.0
Accept: */*
</pre>
<p><tt class="docutils literal"><span class="pre">-x</span></tt>:</p>
<pre class="literal-block">
14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094]
        0x0000:  4500 006e 484c 4000 4006 1bc4 0a00 020f
        0x0010:  cbcd fe9d d0e6 0050 c447 8e98 7662 6245
        0x0020:  5018 faf0 d6da 0000 4745 5420 2f20 4854
        0x0030:  5450 2f31 2e31 0d0a 486f 7374 3a20 7171
        0x0040:  2e63 6f6d 0d0a 5573 6572 2d41 6765 6e74
        0x0050:  3a20 6375 726c 2f37 2e38 312e 300d 0a41
        0x0060:  6363 6570 743a 202a 2f2a 0d0a 0d0a
</pre>
<p><tt class="docutils literal"><span class="pre">-xx</span></tt>:</p>
<pre class="literal-block">
14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094]
        0x0000:  0050 56eb bc4e 000c 298e 31f3 0800 4500
        0x0010:  006e 484c 4000 4006 1bc4 0a00 020f cbcd
        0x0020:  fe9d d0e6 0050 c447 8e98 7662 6245 5018
        0x0030:  faf0 d6da 0000 4745 5420 2f20 4854 5450
        0x0040:  2f31 2e31 0d0a 486f 7374 3a20 7171 2e63
        0x0050:  6f6d 0d0a 5573 6572 2d41 6765 6e74 3a20
        0x0060:  6375 726c 2f37 2e38 312e 300d 0a41 6363
        0x0070:  6570 743a 202a 2f2a 0d0a 0d0a
</pre>
<p><tt class="docutils literal"><span class="pre">-X</span></tt>:</p>
<pre class="literal-block">
14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094]
        0x0000:  4500 006e 484c 4000 4006 1bc4 0a00 020f  E..nHL&#64;.&#64;.......
        0x0010:  cbcd fe9d d0e6 0050 c447 8e98 7662 6245  .......P.G..vbbE
        0x0020:  5018 faf0 d6da 0000 4745 5420 2f20 4854  P.......GET / HT
        0x0030:  5450 2f31 2e31 0d0a 486f 7374 3a20 7171  TP/1.1..Host: qq
        0x0040:  2e63 6f6d 0d0a 5573 6572 2d41 6765 6e74  .com..User-Agent
        0x0050:  3a20 6375 726c 2f37 2e38 312e 300d 0a41  : curl/7.81.0..A
        0x0060:  6363 6570 743a 202a 2f2a 0d0a 0d0a       ccept: */*....
</pre>
<p><tt class="docutils literal"><span class="pre">-XX</span></tt>:</p>
<pre class="literal-block">
14:36:38.159559 ens33 curl.244103 Out IP 10.0.2.15.53478 &gt; 203.205.254.157.80: Flags [P.], seq 3293023896:3293023966, ack 1986159173, win 64240, length 70, ParentProc [ptcpdump.244094]
        0x0000:  0050 56eb bc4e 000c 298e 31f3 0800 4500  .PV..N..).1...E.
        0x0010:  006e 484c 4000 4006 1bc4 0a00 020f cbcd  .nHL&#64;.&#64;.........
        0x0020:  fe9d d0e6 0050 c447 8e98 7662 6245 5018  .....P.G..vbbEP.
        0x0030:  faf0 d6da 0000 4745 5420 2f20 4854 5450  ......GET / HTTP
        0x0040:  2f31 2e31 0d0a 486f 7374 3a20 7171 2e63  /1.1..Host: qq.c
        0x0050:  6f6d 0d0a 5573 6572 2d41 6765 6e74 3a20  om..User-Agent:
        0x0060:  6375 726c 2f37 2e38 312e 300d 0a41 6363  curl/7.81.0..Acc
        0x0070:  6570 743a 202a 2f2a 0d0a 0d0a            ept: */*....
</pre>
</div>
<div class="section" id="create-docker-images-for-compiling-and-running-ptcpdump">
<h3 id="hidcreate-docker-images-for-compiling-and-running-ptcpdump">Create Docker Images for Compiling and Running ptcpdump<a class="headerlink" href="#hidcreate-docker-images-for-compiling-and-running-ptcpdump" title="Permalink to this headline">¶</a></h3>
<p>Create a Docker image for compiling programs: <tt class="docutils literal">quay.io/ptcpdump/develop:latest</tt> and
a Docker image for running ptcpdump through Docker: <tt class="docutils literal">quay.io/ptcpdump/ptcpdump:latest</tt></p>
<ul>
<li><p class="first">Compile eBPF programs and ptcpdump programs as needed using <tt class="docutils literal">make <span class="pre">build-bpf-via-docker</span></tt> and <tt class="docutils literal">make <span class="pre">build-via-docker</span></tt>.</p>
</li>
<li><p class="first">You can run ptcpdump through Docker using a command similar to the following:</p>
<pre class="literal-block">
docker run --privileged --rm -t --net=host --pid=host \
  -v /sys/fs/cgroup:/sys/fs/cgroup:ro \
  quay.io/ptcpdump/ptcpdump:latest ptcpdump -i any -c 2 tcp
</pre>
</li>
</ul>
</div>
<div class="section" id="experimental-new-feature-generating-corresponding-tls-key-log-file-when-capturing-go-program-s-network-traffic">
<h3 id="hidexperimental-new-feature-generating-corresponding-tls-key-log-file-when-capturing-go-program-s-network-traffic">Experimental New Feature: Generating Corresponding TLS Key Log File When Capturing Go Program's Network Traffic<a class="headerlink" href="#hidexperimental-new-feature-generating-corresponding-tls-key-log-file-when-capturing-go-program-s-network-traffic" title="Permalink to this headline">¶</a></h3>
<p>A new experimental feature has been implemented in the latest version:
generating the corresponding TLS Key Log file when capturing Go program's network traffic.</p>
<p>The TLS Key Log file, also known as <a class="reference external" href="https://tlswg.org/sslkeylogfile/draft-ietf-tls-keylogfile.html">SSLKEYLOGFILE</a> ,
corresponds to the pre-master secret configuration in Wireshark.
Third-party programs can decrypt captured TLS traffic using the information recorded in this file.</p>
<p>Please note: This feature is experimental and is only supported by Go programs compiled with version 1.18 or above (supports stripped binary).
It also requires running the target Go program via ptcpdump.</p>
<p>You can try out this feature using the following two methods:</p>
<ul>
<li><p class="first">Use the <tt class="docutils literal"><span class="pre">--write-keylog-file</span></tt> argument or the <tt class="docutils literal">SSLKEYLOGFILE</tt> environment variable to specify the location
where the SSLKEYLOGFILE file will be saved:</p>
<pre class="literal-block">
sudo ptcpdump -i any --write-keylog-file /tmp/keylogfile.txt -w /tmp/go.pcapng -- ./gohttpapp
</pre>
</li>
<li><p class="first">By specifying the <tt class="docutils literal"><span class="pre">--embed-keylog-to-pcapng</span></tt> parameter, embed the contents of the SSLKEYLOGFILE into
the saved data in the pcapng format file:</p>
<pre class="literal-block">
sudo ptcpdump -i any --embed-keylog-to-pcapng -w /tmp/gotls.pcapng -- ./gohttpapp
</pre>
</li>
</ul>
<p>Later, you can decrypt the saved TLS data using the recorded SSLKEYLOGFILE content with Wireshark or tshark:</p>
<pre class="literal-block">
$ sudo tshark -r /tmp/go.pcapng -o tls.keylog_file:/tmp/keylogfile.txt | grep HTTP -B 2
Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.
   18 0.518380586    10.0.2.15 → 13.35.238.63 TLSv1.3 118 Change Cipher Spec, Finished
   19 0.519208290 13.35.238.63 → 10.0.2.15    TCP 60 443 → 47606 [ACK] Seq=5508 Ack=340 Win=64240 Len=0
   20 0.519914720    10.0.2.15 → 13.35.238.63 HTTP 179 GET /foo/bar HTTP/1.1


$ tshark -r /tmp/gotls.pcapng | grep HTTP -B 2
   20 0.525662563    10.0.2.15 → 13.35.238.114 TLSv1.3 118 Change Cipher Spec, Finished
   21 0.526138582 13.35.238.114 → 10.0.2.15    TCP 60 443 → 37618 [ACK] Seq=5987 Ack=340 Win=64240 Len=0
   22 0.526977836    10.0.2.15 → 13.35.238.114 HTTP 179 GET /foo/bar HTTP/1.1
</pre>
<p>ptcpdump plans to eventually have built-in support for decrypting TLS data using SSLKEYLOGFILE
and to automatically decrypt TLS data in real-time while capturing packets.
Currently, this can only be achieved using third-party tools for decrypting TLS data.</p>
</div>
<div class="section" id="output-tcp-options-by-default">
<h3 id="hidoutput-tcp-options-by-default">Output TCP options by default<a class="headerlink" href="#hidoutput-tcp-options-by-default" title="Permalink to this headline">¶</a></h3>
<p>The new version will by default output TCP Options information:</p>
<p>Old version:</p>
<pre class="literal-block">
14:09:54.324433 ens33 curl.26570 Out IP (..).43772 &gt; (..).443: Flags [S], seq 1674193846, win 64240, length 0, ParentProc [ptcpdump.26560]
</pre>
<p>Latest version:</p>
<pre class="literal-block">
14:09:54.324433 ens33 curl.26570 Out IP (..).43772 &gt; (..).443: Flags [S], seq 1674193846, win 64240, options [mss 1460,sackOK,TS val 2107137325 ecr 0,nop,wscale 7], length 0, ParentProc [ptcpdump.26560]
</pre>
<p>Moreover, the latest update includes support for TCP SACK (Selective Acknowledgment) and TFO (TCP Fast Open).</p>
<p>SACK:</p>
<pre class="literal-block">
19:03:36.220872 IP6 dead:beef:2::2.35288 &gt; dead:beef:2::1.10029: Flags [.], seq 731670714, ack 2274465610, win 201, options [nop,nop,TS val 1253137130 ecr 837820024,nop,nop,sack 1 {2274467010:2274483378},mptcp 12 dss ack 16301812255838552430], length 0
</pre>
<p>TFO:</p>
<pre class="literal-block">
19:22:26.586851 IP6 dead:beef:1::2.54040 &gt; dead:beef:1::1.10056: Flags [S], seq 271661201, win 64800, options [mss 1440,sackOK,TS val 2947503028 ecr 0,nop,wscale 7,tfo  cookiereq,nop,nop,mptcp 4 capable v1 flags [H]], length 0
19:22:26.591736 IP6 dead:beef:1::1.10056 &gt; dead:beef:1::2.54040: Flags [S.], seq 1229575956, ack 271661202, win 64260, options [mss 1440,nop,nop,sackOK,nop,wscale 7,tfo  cookie 29b3cc66639d427d,nop,nop,mptcp 12 capable v1 flags [H] {0xc87438912bc26cb7}], length 0
</pre>
</div>
<div class="section" id="output-the-mptcp-information-in-the-tcp-options">
<h3 id="hidoutput-the-mptcp-information-in-the-tcp-options">Output the MPTCP information in the TCP Options<a class="headerlink" href="#hidoutput-the-mptcp-information-in-the-tcp-options" title="Permalink to this headline">¶</a></h3>
<p>According to the <a class="reference external" href="https://github.com/mozillazg/ptcpdump/issues/148">requirement</a> from
the MPTCP (MultiPath TCP) community, support for MPTCP should be added:</p>
<pre class="literal-block">
15:31:51.696224 IP 10.0.1.2.60958 &gt; 10.0.1.1.10004: Flags [S], seq 3019570341, win 64240, options [mss 1460,sackOK,TS val 1007819908 ecr 0,nop,wscale 7,mptcp 4 capable v1 flags [H]], length 0
15:31:51.696346 IP 10.0.1.1.10004 &gt; 10.0.1.2.60958: Flags [S.], seq 2367868313, ack 3019570342, win 65160, options [mss 1460,sackOK,TS val 162498895 ecr 1007819908,nop,wscale 7,mptcp 12 capable v1 flags [H] {0x8ea1df6e0d588003}], length 0
15:31:51.696587 IP 10.0.1.2.60958 &gt; 10.0.1.1.10004: Flags [.], seq 3019570342, ack 2367868314, win 502, options [nop,nop,TS val 1007819909 ecr 162498895,mptcp 20 capable v1 flags [H] {0x465bcd01b5d78120,0x8ea1df6e0d588003}], length 0
</pre>
</div>
<div class="section" id="add-a-new-parameter-netns-to-support-capturing-network-interfaces-in-other-network-namespaces">
<h3 id="hidadd-a-new-parameter-netns-to-support-capturing-network-interfaces-in-other-network-namespaces">Add a new parameter --netns to support capturing network interfaces in other network namespaces<a class="headerlink" href="#hidadd-a-new-parameter-netns-to-support-capturing-network-interfaces-in-other-network-namespaces" title="Permalink to this headline">¶</a></h3>
<p>The previous version only supported capturing network interfaces in the current network namespace.
The new version now supports capturing network interfaces in other network namespaces
by adding the <tt class="docutils literal"><span class="pre">--netns</span></tt> parameter:</p>
<pre class="literal-block">
sudo ptcpdump -i lo --netns /run/netns/foobar
sudo ptcpdump -i any --netns /run/netns/foobar
sudo ptcpdump -i any --netns /proc/26/ns/net
</pre>
</div>
<div class="section" id="pcapng-format-enhancement-reading-writing-network-interface-names-and-inbound-outbound-information">
<h3 id="hidpcapng-format-enhancement-reading-writing-network-interface-names-and-inbound-outbound-information">PcapNg format enhancement: reading/writing network interface names and Inbound/Outbound information<a class="headerlink" href="#hidpcapng-format-enhancement-reading-writing-network-interface-names-and-inbound-outbound-information" title="Permalink to this headline">¶</a></h3>
<p>In previous versions, using <tt class="docutils literal">ptcpdump <span class="pre">-r</span> &lt;file.pcapng&gt;</tt> to read a pcapng file did not display
the recorded network interface names and Inbound/Outbound information.
This issue has been resolved in the new version:</p>
<pre class="literal-block">
$ ptcpdump -r demo.pcapng
14:36:35.880947 ens33 curl.244103 Out IP 10.0.2.15.37668 &gt; 114.114.114.114.53: 44427+ A? qq.com. (24), ParentProc [ptcpdump.244094]
14:36:35.882099 ens33 curl.244103 Out IP 10.0.2.15.37668 &gt; 114.114.114.114.53: 31415+ AAAA? qq.com. (24), ParentProc [ptcpdump.244094]
14:36:35.954613 ens33 curl.244103 In IP 114.114.114.114.53 &gt; 10.0.2.15.37668: 44427 3/0/0 A 203.205.254.157, A 113.108.81.189, A 123.150.76.218 (72), ParentProc [ptcpdump.244094]
</pre>
<p>When saving the captured traffic information as a PcapNg format file, the new version will automatically
write Inbound/Outbound information (previous versions already wrote network interface information),
thus supporting the epb_flags (<a class="reference external" href="https://www.ietf.org/archive/id/draft-tuexen-opsawg-pcapng-05.html#name-enhanced-packet-block-flags">Enhanced Packet Block Flags Word</a> )
flag for the PcapNg format.</p>
<p>If you have any additional improvements or new feature suggestions for ptcpdump,
feel free to leave a comment in the comments section or project issues.</p>
</div>
</div>

                </div>
            </div>
            <!-- /.entry-content -->
<section class="text-center">
  
<div id="donate"></div>

<div class="social-share"></div>
<div class="social-comment-note">
<p class="text-center">有任何建议和想法欢迎在下方评论区留言或者加我<a href="/static/wechat.png">微信</a>交流</p>
</div>

</section>
<section class="well" id="related-posts">
    <p>Related Posts:</p>
    <ul>
        <li><a href="https://mozillazg.com/2024/07/ebpf-ptcpdump-capturing-the-network-traffic-of-a-process-or-container-or-pod-en.html">ptcpdump: Capturing the Network Traffic of any Process, Container, or Pod</a></li>
        <li><a href="https://mozillazg.com/2024/11/whats-new-ptcpdump-v1.16-v1.26.html">ptcpdump v1.16 ~ v1.26 的主要变更内容</a></li>
        <li><a href="https://mozillazg.com/2024/07/ebpf-ptcpdump-capturing-the-network-traffic-of-a-process-or-container-or-pod.html">ptcpdump: 抓包时显示进程信息以及对任意进程、容器或 Pod 进行抓包</a></li>
    </ul>
</section>
<hr/>
<section class="comments" id="comments">
    <h2>Comments</h2>
    <script src="https://giscus.app/client.js"
            data-repo="mozillazg/mozillazg.github.com"
            data-repo-id="MDEwOlJlcG9zaXRvcnk3Njc4MTA2"
            data-category="Announcements"
            data-category-id="DIC_kwDOAHUoms4CckZl"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="preferred_color_scheme"
            data-description="<description>"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
    </script>
</section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2025 mozillazg
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
            &middot; <a href="/privacy-policy.html" target="_blank">Privacy</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/static/images/by-sa-80x15.png" /></a>
    &quot;<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">mozillazg's Blog</span>&quot; by <a xmlns:cc="http://creativecommons.org/ns#" href="https://mozillazg.com" property="cc:attributionName" rel="cc:attributionURL">mozillazg</a> is
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/cdn.jsdelivr.net/npm/jquery@2.1.1/dist/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/cdn.jsdelivr.net/npm/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->


<!-- share.js -->
<script src="/theme/cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>



<script src="/theme/cdn.jsdelivr.net/npm/tocbot@3.0.2/dist/tocbot.min.js"></script>
<script>
$(document).ready(function(){
  tocbot.init({
    // Where to render the table of contents.
    tocSelector: '.js-toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: '.entry-content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h2, h3, h4,h5',
    // Headings that match the ignoreSelector will be skipped.
    ignoreSelector: '.js-toc-ignore',
    // Main class to add to links.
    linkClass: 'toc-link',
    // Extra classes to add to links.
    extraLinkClasses: '',
    // Class to add to active links,
    // the link corresponding to the top most heading on the page.
    activeLinkClass: 'is-active-link',
    // Main class to add to lists.
    listClass: 'toc-list',
    // Extra classes to add to lists.
    extraListClasses: '',
    // Class that gets added when a list should be collapsed.
    isCollapsedClass: 'is-collapsed',
    // Class that gets added when a list should be able
    // to be collapsed but isn't necessarily collpased.
    collapsibleClass: 'is-collapsible',
    // Class to add to list items.
    listItemClass: 'toc-list-item',
    // How many heading levels should not be collpased.
    // For example, number 6 will show everything since
    // there are only 6 heading levels and number 0 will collpase them all.
    // The sections that are hidden will open
    // and close as you scroll to headings within them.
    collapseDepth: 6,
    // Smooth scrolling enabled.
    smoothScroll: true,
    // Smooth scroll duration.
    smoothScrollDuration: 420,
    // Callback for scroll end (requires: smoothScroll).
    scrollEndCallback: function (e) {},
    // Headings offset between the headings and the top of the document (this is meant for minor adjustments).
    headingsOffset: 0,
    // Timeout between events firing to make sure it's
    // not too rapid (for performance reasons).
    throttleTimeout: 50,
    // Element to add the positionFixedClass to.
    positionFixedSelector: null,
    // Fixed position class to add to make sidebar fixed after scrolling
    // down past the fixedSidebarOffset.
    positionFixedClass: 'is-position-fixed',
    // fixedSidebarOffset can be any number but by default is set
    // to auto which sets the fixedSidebarOffset to the sidebar
    // element's offsetTop from the top of the document on init.
    fixedSidebarOffset: 'auto',
    // includeHtml can be set to true to include the HTML markup from the
    // heading node instead of just including the textContent.
    includeHtml: false
  });
});
</script>
</body>
</html>