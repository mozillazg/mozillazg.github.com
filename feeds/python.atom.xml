<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Mozillazg's Blog</title><link href="https://mozillazg.com/" rel="alternate"></link><link href="https://mozillazg.com/feeds/python.atom.xml" rel="self"></link><id>https://mozillazg.com/</id><updated>2016-03-15T00:00:00+00:00</updated><entry><title>è®©æˆ‘ä»¬ä¸€èµ·æ¥æ„å»ºä¸€ä¸ªæ¨¡ç‰ˆå¼•æ“ï¼ˆä¸€ï¼‰</title><link href="https://mozillazg.com/2016/03/let-us-build-a-template-engine-part1.html" rel="alternate"></link><updated>2016-03-15T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-03-15:2016/03/let-us-build-a-template-engine-part1.html</id><summary type="html">&lt;p&gt;å‡è®¾æˆ‘ä»¬è¦ç”Ÿæˆä¸‹é¢è¿™æ ·çš„ html å­—ç¬¦ä¸²:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;div&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;p&amp;gt;&lt;/span&gt;welcome, Tom&lt;span class="nt"&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;ul&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;li&amp;gt;&lt;/span&gt;age: 20&lt;span class="nt"&gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;li&amp;gt;&lt;/span&gt;weight: 100&lt;span class="nt"&gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;li&amp;gt;&lt;/span&gt;height: 170&lt;span class="nt"&gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/ul&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¦æ±‚å§“åä»¥åŠ &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;&amp;lt;ul&amp;gt;&amp;lt;/ul&amp;gt;&lt;/span&gt;&lt;/tt&gt; ä¸­çš„å†…å®¹æ˜¯æ ¹æ®å˜é‡åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·çš„:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&amp;lt;div&amp;gt;
    &amp;lt;p&amp;gt;welcome, {name}&amp;lt;/p&amp;gt;
    &amp;lt;ul&amp;gt;
        {info}
    &amp;lt;/ul&amp;gt;
&amp;lt;/div&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ²¡æ¥è§¦è¿‡æ¨¡ç‰ˆçš„åŒå­¦å¯èƒ½ä¼šæƒ³åˆ°ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼åŒ–çš„æ–¹å¼æ¥å®ç°:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;HTML&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="s"&gt;&amp;lt;div&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;    &amp;lt;p&amp;gt;welcome, {name}&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;    &amp;lt;ul&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;        {info}&lt;/span&gt;
&lt;span class="s"&gt;    &amp;lt;/ul&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;gen_html&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;info_list&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;&amp;lt;li&amp;gt;{0}: {1}&amp;lt;/li&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;info&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;info&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;info_list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HTML&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™ç§æ–¹æ¡ˆæœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜é‚£å°±æ˜¯ï¼Œéœ€è¦æ‹¼æ¥ä¸¤ä¸ª html ç‰‡æ®µã€‚
ä½¿ç”¨è¿‡æ¨¡ç‰ˆæŠ€æœ¯çš„åŒå­¦åº”è¯¥å¾ˆå®¹æ˜“å°±æƒ³åˆ°ï¼Œåœ¨ Web å¼€å‘ä¸­ç”Ÿæˆ HTML çš„æ›´å¸¸ç”¨çš„åŠæ³•æ˜¯ä½¿ç”¨æ¨¡ç‰ˆ:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;HTML&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="s"&gt;&amp;lt;div&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;    &amp;lt;p&amp;gt;welcome, {{ person[&amp;#39;name&amp;#39;] }}&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;    &amp;lt;ul&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;        {&lt;/span&gt;&lt;span class="si"&gt;% f&lt;/span&gt;&lt;span class="s"&gt;or item, value in person[&amp;#39;info&amp;#39;].items() %}&lt;/span&gt;
&lt;span class="s"&gt;        &amp;lt;li&amp;gt;{{ item }}: {{ value }}&amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;        {&lt;/span&gt;&lt;span class="si"&gt;% e&lt;/span&gt;&lt;span class="s"&gt;ndfor %}&lt;/span&gt;
&lt;span class="s"&gt;    &amp;lt;/ul&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;gen_html&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HTML&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« è¦è®²çš„å°±æ˜¯å¦‚ä½•ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªè¿™æ ·çš„æ¨¡ç‰ˆå¼•æ“( &lt;tt class="docutils literal"&gt;Template&lt;/tt&gt; )ã€‚&lt;/p&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;ä½¿ç”¨æŠ€æœ¯&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨å°†æ¨¡ç‰ˆç¼–è¯‘ä¸º python ä»£ç çš„æ–¹å¼æ¥è§£æå’Œæ¸²æŸ“æ¨¡ç‰ˆã€‚
æ¯”å¦‚ä¸Šé¢çš„æ¨¡ç‰ˆå°†è¢«ç¼–è¯‘ä¸ºå¦‚ä¸‹ python ä»£ç :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;render_function&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

    &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extend&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;&amp;lt;div&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;&amp;lt;p&amp;gt;welcome, &amp;#39;&lt;/span&gt;
        &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]),&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;&amp;lt;/p&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;&amp;lt;ul&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;info&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extend&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;
            &lt;span class="s"&gt;&amp;#39;&amp;lt;li&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
            &lt;span class="s"&gt;&amp;#39;: &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="s"&gt;&amp;#39;&amp;lt;/li&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
        &lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extend&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;&amp;lt;/ul&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;&amp;lt;/div&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶åé€šè¿‡ &lt;tt class="docutils literal"&gt;exec&lt;/tt&gt; æ‰§è¡Œç”Ÿæˆçš„ä»£ç ï¼Œä¹‹åå†æ‰§è¡Œ &lt;tt class="docutils literal"&gt;render_function()&lt;/tt&gt; å°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ html å­—ç¬¦ä¸²äº†:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;namespace&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;person&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;person&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;render_function&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;render_function&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;html&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;render_function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ¨¡ç‰ˆå¼•æ“çš„æ ¸å¿ƒæŠ€æœ¯å°±æ˜¯è¿™äº›äº†ï¼Œä¸‹é¢è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„å®ç°å®ƒå§ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="codebuilder"&gt;
&lt;h2&gt;CodeBuilder&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ python ä»£ç æ˜¯é«˜åº¦ä¾èµ–ç¼©è¿›çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯¹è±¡ç”¨æ¥ä¿å­˜æˆ‘ä»¬ç”Ÿæˆä»£ç æ—¶çš„å½“å‰ç¼©è¿›æƒ…å†µï¼Œ
åŒæ—¶ä¹Ÿä¿å­˜å·²ç»ç”Ÿæˆçš„ä»£ç è¡Œï¼ˆå¯ä»¥ç›´æ¥åœ¨ github ä¸Šä¸‹è½½ &lt;a class="reference external" href="https://github.com/mozillazg/lsbate/raw/master/part1/template1a.py"&gt;template1a.py&lt;/a&gt; ï¼‰:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# -*- coding: utf-8 -*-&lt;/span&gt;
&lt;span class="c"&gt;# tested on Python 3.5.1&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CodeBuilder&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;INDENT_STEP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;     &lt;span class="c"&gt;# æ¯æ¬¡ç¼©è¿›çš„ç©ºæ ¼æ•°&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;indent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;indent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;indent&lt;/span&gt;    &lt;span class="c"&gt;# å½“å‰ç¼©è¿›&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lines&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;         &lt;span class="c"&gt;# ä¿å­˜ä¸€è¡Œä¸€è¡Œç”Ÿæˆçš„ä»£ç &lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;forward&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;ç¼©è¿›å‰è¿›ä¸€æ­¥&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;indent&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;INDENT_STEP&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;backward&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;ç¼©è¿›åé€€ä¸€æ­¥&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;indent&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;INDENT_STEP&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;add_line&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;indent&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__str__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;æ‹¼æ¥æ‰€æœ‰ä»£ç è¡Œåçš„æºç &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__repr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;æ–¹ä¾¿è°ƒè¯•&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;forward&lt;/tt&gt; å’Œ &lt;tt class="docutils literal"&gt;backward&lt;/tt&gt; æ–¹æ³•å¯ä»¥ç”¨æ¥æ§åˆ¶ç¼©è¿›å‰è¿›æˆ–åé€€ä¸€æ­¥ï¼Œæ¯”å¦‚åœ¨ç”Ÿæˆ &lt;tt class="docutils literal"&gt;if&lt;/tt&gt; è¯­å¥çš„æ—¶å€™:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
if age &amp;gt; 13:      # ç”Ÿæˆå®Œè¿™ä¸€è¡Œä»¥åï¼Œéœ€è¦åˆ‡æ¢ç¼©è¿›äº† ``forward()``
    ...
    ...           # é€€å‡º if è¯­å¥ä¸»ä½“çš„æ—¶å€™ï¼ŒåŒæ ·éœ€è¦åˆ‡æ¢ä¸€æ¬¡ç¼©è¿› ``backward()``
...
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="template"&gt;
&lt;h2&gt;Template&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªæ¨¡ç‰ˆå¼•æ“çš„æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯ä¸€ä¸ª &lt;tt class="docutils literal"&gt;Template&lt;/tt&gt; ç±»ï¼Œç”¨æ³•:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# å®ä¾‹åŒ–ä¸€ä¸ª Template å¯¹è±¡&lt;/span&gt;
&lt;span class="n"&gt;template&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="s"&gt;&amp;lt;h1&amp;gt;hello, {{ name }}&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;{&lt;/span&gt;&lt;span class="si"&gt;% f&lt;/span&gt;&lt;span class="s"&gt;or skill in skills %}&lt;/span&gt;
&lt;span class="s"&gt;    &amp;lt;p&amp;gt;you are good at {{ skill }}.&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;{&lt;/span&gt;&lt;span class="si"&gt;% e&lt;/span&gt;&lt;span class="s"&gt;ndfor %}&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# ç„¶åï¼Œä½¿ç”¨ä¸€äº›æ•°æ®æ¥æ¸²æŸ“è¿™ä¸ªæ¨¡ç‰ˆ&lt;/span&gt;
&lt;span class="n"&gt;html&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Eric&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;skills&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;python&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;english&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;music&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;comic&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]}&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸€åˆ‡é­”æ³•éƒ½åœ¨ &lt;tt class="docutils literal"&gt;Template&lt;/tt&gt; ç±»é‡Œã€‚ä¸‹é¢æˆ‘ä»¬å†™ä¸€ä¸ªåŸºæœ¬çš„ &lt;tt class="docutils literal"&gt;Template&lt;/tt&gt; ç±»ï¼ˆå¯ä»¥ç›´æ¥åœ¨ github ä¸Šä¸‹è½½ &lt;a class="reference external" href="https://github.com/mozillazg/lsbate/raw/master/part1/template1b.py"&gt;template1b.py&lt;/a&gt; ï¼‰:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;raw_text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;indent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;default_context&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                 &lt;span class="n"&gt;func_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;__func_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result_var&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;__result&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw_text&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;raw_text&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;default_context&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;default_context&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;func_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func_name&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;result_var&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;result_var&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;code_builder&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;code_builder&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;CodeBuilder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;indent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;indent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;buffered&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

        &lt;span class="c"&gt;# ç”Ÿæˆ def __func_name():&lt;/span&gt;
        &lt;span class="n"&gt;code_builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_line&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;def {}():&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;func_name&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="n"&gt;code_builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;forward&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="c"&gt;# ç”Ÿæˆ __result = []&lt;/span&gt;
        &lt;span class="n"&gt;code_builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_line&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;{} = []&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;result_var&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_parse_text&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;flush_buffer&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="c"&gt;# ç”Ÿæˆ return &amp;quot;&amp;quot;.join(__result)&lt;/span&gt;
        &lt;span class="n"&gt;code_builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_line&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;return &amp;quot;&amp;quot;.join({})&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;result_var&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="n"&gt;code_builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;backward&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_parse_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;pass&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;flush_buffer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c"&gt;# ç”Ÿæˆç±»ä¼¼ä»£ç : __result.extend([&amp;#39;&amp;lt;h1&amp;gt;&amp;#39;, name, &amp;#39;&amp;lt;/h1&amp;gt;&amp;#39;])&lt;/span&gt;
        &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;{0}.extend([{1}])&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;result_var&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;buffered&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;code_builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_line&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;buffered&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;namespace&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
        &lt;span class="n"&gt;namespace&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;default_context&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;namespace&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;code_builder&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;func_name&lt;/span&gt;&lt;span class="p"&gt;]()&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ &lt;tt class="docutils literal"&gt;Template&lt;/tt&gt; ç±»çš„æ ¸å¿ƒæ–¹æ³•äº†ã€‚æˆ‘ä»¬ä¹‹åè¦åšçš„å°±æ˜¯å®ç°å’Œå®Œå–„ &lt;tt class="docutils literal"&gt;_parse_text&lt;/tt&gt; æ–¹æ³•ã€‚
å½“æ¨¡ç‰ˆå­—ç¬¦ä¸²ä¸ºç©ºæ—¶ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;template1b&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;template1b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;code_builder&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__func_name&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;__result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="n"&gt;__result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extend&lt;/span&gt;&lt;span class="p"&gt;([])&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°è·Ÿä¸Šé¢[ä½¿ç”¨æŠ€æœ¯]é‚£èŠ‚æ‰€è¯´ç”Ÿæˆçš„ä»£ç æ˜¯ç±»ä¼¼çš„ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä¸€èµ·æ¥å®ç°è¿™ä¸ª &lt;tt class="docutils literal"&gt;_parse_text&lt;/tt&gt; æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id3"&gt;
&lt;h2&gt;å˜é‡&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆè¦å®ç°æ˜¯å¯¹å˜é‡çš„æ”¯æŒï¼Œæ¨¡ç‰ˆè¯­æ³•æ˜¯ &lt;tt class="docutils literal"&gt;{{ variable }}&lt;/tt&gt; ã€‚
æ—¢ç„¶è¦æ”¯æŒå˜é‡ï¼Œé¦–å…ˆè¦åšçš„å°±æ˜¯æŠŠå˜é‡ä»æ¨¡ç‰ˆä¸­æ‰¾å‡ºæ¥ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å®ç°:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;re_variable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;\{\{ .*? \}\}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;re_variable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;\{\{ .*? \}\}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;re_variable&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;findall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;h1&amp;gt;{{ title }}&amp;lt;/h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;{{ title }}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;çŸ¥é“äº†å¦‚ä½•åŒ¹é…å˜é‡è¯­æ³•ï¼Œä¸‹é¢æˆ‘ä»¬è¦æŠŠå˜é‡è·Ÿå…¶ä»–çš„æ¨¡ç‰ˆå­—ç¬¦ä¸²åˆ†å‰²å¼€æ¥ï¼Œè¿™é‡Œè¿˜æ˜¯ç”¨çš„ &lt;tt class="docutils literal"&gt;re&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;re_variable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;(\{\{ .*? \}\})&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;re_variable&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;h1&amp;gt;{{ title }}&amp;lt;/h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;{{ title }}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;lt;/h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™é‡Œçš„æ­£åˆ™ä¹‹æ‰€ä»¥åŠ äº†ä¸ªåˆ†ç»„æ˜¯å› ä¸ºæˆ‘ä»¬åŒæ—¶è¿˜éœ€è¦ç”¨åˆ°æ¨¡ç‰ˆé‡Œçš„å˜é‡ã€‚
åˆ†å‰²å¼€æ¥ä»¥åæˆ‘ä»¬å°±å¯ä»¥å¯¹æ¯ä¸€é¡¹è¿›è¡Œè§£æäº†ã€‚æ”¯æŒ &lt;tt class="docutils literal"&gt;{{ variable }}&lt;/tt&gt; è¯­æ³•çš„ &lt;tt class="docutils literal"&gt;Template&lt;/tt&gt; ç±»å¢åŠ äº†å¦‚ä¸‹ä»£ç 
ï¼ˆå¯ä»¥ç›´æ¥åœ¨ github ä¸Šä¸‹è½½ &lt;a class="reference external" href="https://github.com/mozillazg/lsbate/raw/master/part1/template1c.py"&gt;template1c.py&lt;/a&gt; ï¼‰:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;raw_text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;indent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;default_context&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                 &lt;span class="n"&gt;func_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;__func_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result_var&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;__result&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c"&gt;# ...&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;buffered&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_variable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;\{\{ .*? \}\}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_tokens&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;(\{\{ .*? \}\})&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="c"&gt;# ç”Ÿæˆ def __func_name():&lt;/span&gt;
        &lt;span class="n"&gt;code_builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_line&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;def {}():&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;func_name&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="c"&gt;# ...&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_parse_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;tokens&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_tokens&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw_text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;tokens&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_variable&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="n"&gt;variable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;{} &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;buffered&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;str({})&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;variable&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;buffered&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;{}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;repr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;_parse_text&lt;/tt&gt; ä¸­ä¹‹æ‰€ä»¥è¦ç”¨ &lt;tt class="docutils literal"&gt;repr&lt;/tt&gt; ï¼Œæ˜¯å› ä¸ºæ­¤æ—¶éœ€è¦æŠŠ &lt;tt class="docutils literal"&gt;token&lt;/tt&gt; å½“æˆä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²æ¥å¤„ç†ï¼Œ
åŒæ—¶éœ€è¦è€ƒè™‘ &lt;tt class="docutils literal"&gt;token&lt;/tt&gt; ä¸­åŒ…å« &lt;tt class="docutils literal"&gt;&amp;quot;&lt;/tt&gt; å’Œ &lt;tt class="docutils literal"&gt;'&lt;/tt&gt; çš„æƒ…å†µã€‚
ä¸‹é¢æ˜¯å‡ ç§æœ‰é—®é¢˜çš„å†™æ³•:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;'str({})'.format(token)&lt;/span&gt;&lt;/tt&gt;: è¿™ç§æ˜¯æŠŠ &lt;tt class="docutils literal"&gt;token&lt;/tt&gt; å½“æˆå˜é‡æ¥ç”¨äº†ï¼Œç”Ÿæˆçš„ä»£ç ä¸º &lt;tt class="docutils literal"&gt;str(token)&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;'&amp;quot;{}&amp;quot;'.format(token)&lt;/span&gt;&lt;/tt&gt;: è¿™ç§è™½ç„¶æ˜¯æŠŠ &lt;tt class="docutils literal"&gt;token&lt;/tt&gt; å½“æˆäº†å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¼šæœ‰è½¬ä¹‰çš„é—®é¢˜ï¼Œå½“ &lt;tt class="docutils literal"&gt;token&lt;/tt&gt; ä¸­åŒ…å« &lt;tt class="docutils literal"&gt;&amp;quot;&lt;/tt&gt; æ—¶ç”Ÿæˆçš„ä»£ç ä¸º &lt;tt class="docutils literal"&gt;&amp;quot;&amp;quot;hello&amp;quot;&amp;quot;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢å…ˆæ¥çœ‹ä¸€ä¸‹æ–°çš„ &lt;tt class="docutils literal"&gt;template1c.py&lt;/tt&gt; ç”Ÿæˆäº†ä»€ä¹ˆæ ·çš„ä»£ç :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;template1c&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Template&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;h1&amp;gt;{{ title }}&amp;lt;/h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;code_builder&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__func_name&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;__result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="n"&gt;__result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extend&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;/h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ²¡é—®é¢˜ï¼Œè·Ÿé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ã€‚å†æ¥çœ‹ä¸€ä¸‹ &lt;tt class="docutils literal"&gt;render&lt;/tt&gt; çš„æ•ˆæœ:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;title&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Python&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;&amp;lt;h1&amp;gt;Python&amp;lt;/h1&amp;gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œå…¶å® &lt;tt class="docutils literal"&gt;{{ variable }}&lt;/tt&gt; ä¸åªæ”¯æŒå˜é‡ï¼Œè¿˜æ”¯æŒè¡¨è¾¾å¼å’Œè¿ç®—ç¬¦:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;{{ 1 + 2 }}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;3&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;{{ items[0] }}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;items&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]})&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;1&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;{{ func() }}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;func&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;[]&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™ä¸ªæ—¢å¯ä»¥è¯´æ˜¯ä¸ª BUG ä¹Ÿå¯ä»¥è¯´æ˜¯ä¸ªç‰¹æ€§ğŸ˜‚ï¼Œ çœ‹æ¨¡ç‰ˆå¼•æ“æ˜¯å¦æ‰“ç®—æ”¯æŒè¿™äº›åŠŸèƒ½äº†ï¼Œ
æˆ‘ä»¬åœ¨è¿™é‡Œæ˜¯æ‰“ç®—æ”¯æŒè¿™äº›åŠŸèƒ½ ;)ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶æ”¯æŒäº† &lt;tt class="docutils literal"&gt;{{ }}&lt;/tt&gt; é‚£ä¹ˆæ”¯æŒæ³¨é‡Šä¹Ÿå°±éå¸¸å¥½å®ç°äº†ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id4"&gt;
&lt;h2&gt;æ³¨é‡Š&lt;/h2&gt;
&lt;p&gt;æ‰“ç®—æ”¯æŒçš„æ³¨é‡Šæ¨¡ç‰ˆè¯­æ³•æ˜¯ &lt;tt class="docutils literal"&gt;{# comments #}&lt;/tt&gt; ï¼Œæœ‰äº†ä¸Šé¢å®ç° &lt;tt class="docutils literal"&gt;{{ variable }}&lt;/tt&gt;
çš„ç»éªŒï¼Œå®ç°æ³¨é‡Šæ˜¯ç±»ä¼¼çš„ä»£ç 
ï¼ˆå¯ä»¥ç›´æ¥åœ¨ github ä¸Šä¸‹è½½ &lt;a class="reference external" href="https://github.com/mozillazg/lsbate/raw/master/part1/template1d.py"&gt;template1d.py&lt;/a&gt; ï¼‰:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;raw_text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;indent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;default_context&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                 &lt;span class="n"&gt;func_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;__func_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result_var&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;__result&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c"&gt;# ...&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;buffered&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_variable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;\{\{ .*? \}\}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_comment&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;\{# .*? #\}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_tokens&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;&amp;#39;&amp;#39;(&lt;/span&gt;
&lt;span class="s"&gt;            (?:\{\{ .*? \}\})&lt;/span&gt;
&lt;span class="s"&gt;            |(?:\{\# .*? \#\})&lt;/span&gt;
&lt;span class="s"&gt;        )&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="c"&gt;# ç”Ÿæˆ def __func_name():&lt;/span&gt;
        &lt;span class="c"&gt;# ...&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_parse_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;tokens&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_tokens&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw_text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;tokens&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_variable&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="c"&gt;# ...&lt;/span&gt;
            &lt;span class="c"&gt;# æ³¨é‡Š {# ... #}&lt;/span&gt;
            &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;re_comment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="k"&gt;continue&lt;/span&gt;
            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="c"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ•ˆæœ:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;template1d&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Template&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;h1&amp;gt;{{ title }} {# comment #}&amp;lt;/h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;code_builder&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__func_name&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;__result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="n"&gt;__result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extend&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="s"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;/h1&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;title&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Python&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;&amp;lt;h1&amp;gt;Python &amp;lt;/h1&amp;gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬çš„æ¨¡ç‰ˆå¼•æ“å·²ç»æ”¯æŒäº†å˜é‡å’Œæ³¨é‡ŠåŠŸèƒ½ã€‚
é‚£ä¹ˆå¦‚ä½•å®ç°æ”¯æŒ &lt;tt class="docutils literal"&gt;if&lt;/tt&gt; è¯­å¥å’Œ &lt;tt class="docutils literal"&gt;for&lt;/tt&gt; å¾ªç¯çš„æ ‡ç­¾è¯­æ³•å‘¢:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;{% if user.is_admin %}
    admin, {{ user.name }}
{% elif user.is_staff %}
    staff
{% else %}
    others
{% endif %}

{% for name in names %}
    {{ name }}
{% endfor %}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æˆ‘å°†åœ¨ &lt;a class="reference external" href="#"&gt;ç¬¬äºŒç¯‡æ–‡ç« &lt;/a&gt; ä¸­å‘ä½ è¯¦ç»†çš„è®²è§£ã€‚æ•¬è¯·æœŸå¾…ã€‚&lt;/p&gt;
&lt;/div&gt;
</summary><category term="lsbate"></category><category term="è®©æˆ‘ä»¬ä¸€èµ·æ¥æ„å»ºä¸€ä¸ªæ¨¡ç‰ˆå¼•æ“"></category></entry><entry><title>[python]å¦‚ä½•è®©å‘½ä»¤è¡Œç¨‹åºæ”¯æŒç®¡é“å’Œé‡å®šå‘è¾“å…¥</title><link href="https://mozillazg.com/2016/03/python-let-cli-support-pipe-read-data-from-stdin.html" rel="alternate"></link><updated>2016-03-10T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-03-10:2016/03/python-let-cli-support-pipe-read-data-from-stdin.html</id><summary type="html">&lt;p&gt;ç®¡é“å’Œé‡å®šå‘è¾“å…¥çš„æ•°æ®éƒ½æ˜¯é€šè¿‡æ ‡å‡†è¾“å…¥ä¼ å…¥ç¨‹åºçš„ï¼Œ &lt;tt class="docutils literal"&gt;sys.stdin&lt;/tt&gt; è¿™ä¸ª file-like å¯¹è±¡å³ä¸ºæ ‡å‡†è¾“å…¥ã€‚
åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ &lt;tt class="docutils literal"&gt;sys.stdin.isatty()&lt;/tt&gt;
åˆ¤æ–­æ˜¯å¦æ˜¯ç®¡é“å’Œé‡å®šå‘è¾“å…¥ï¼ˆä¸º &lt;tt class="docutils literal"&gt;True&lt;/tt&gt; æ—¶è¡¨ç¤ºæ˜¯äº¤äº’å¼ç¯å¢ƒï¼Œ
ä¸º &lt;tt class="docutils literal"&gt;False&lt;/tt&gt; æ—¶æ˜¯æˆ‘ä»¬è¦çš„åœºæ™¯ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸ª &lt;tt class="docutils literal"&gt;hello.py&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:]&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isatty&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
        &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æµ‹è¯•æ•ˆæœ:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;$ echo &amp;quot;hello&amp;quot; &amp;gt; hello.txt
$ python hello.py hello world       # å‚æ•°è¾“å…¥
hello world
$ cat hello.txt | python hello.py   # ç®¡é“è¾“å…¥
hello

$ python hello.py &amp;lt; hello.txt       # é‡å®šå‘è¾“å…¥
hello

$
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.stdin"&gt;29.1. sys â€” System-specific parameters and functions â€” Python 3.5.1 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary></entry><entry><title>[python] exec å‡½æ•°çš„ globals å’Œ locals å‚æ•°çš„ç”¨æ³•</title><link href="https://mozillazg.com/2016/03/python-exec-function-globals-and-locals-arguments.html" rel="alternate"></link><updated>2016-03-10T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-03-08:2016/03/python-exec-function-globals-and-locals-arguments.html</id><summary type="html">&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ &lt;tt class="docutils literal"&gt;exec&lt;/tt&gt; å‡½æ•°å¯ä»¥ç”¨æ¥åŠ¨æ€æ‰§è¡Œ python ä»£ç :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;foobar = 123&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;
&lt;span class="mi"&gt;123&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é‚£ä¹ˆå¤§å®¶æ˜¯å¦çŸ¥é“ &lt;tt class="docutils literal"&gt;exec&lt;/tt&gt; å‡½æ•°è¿˜æ”¯æŒä¸¤ä¸ªå¯é€‰å‚æ•°å‘¢(ä¸æ”¯æŒé€šè¿‡å…³é”®å­—å»æŒ‡å®šå‚æ•°)ï¼Ÿ :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;[,&lt;/span&gt; &lt;span class="nb"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;[,&lt;/span&gt; &lt;span class="nb"&gt;locals&lt;/span&gt;&lt;span class="p"&gt;]])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥ç”¨æ¥æŒ‡å®šæ‰§è¡Œä»£ç æ—¶å¯ä»¥ä½¿ç”¨çš„å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡,
ä»¥åŠæ”¶é›†æ‰§è¡Œä»£ç åçš„å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ã€‚&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;globals&lt;/tt&gt; é»˜è®¤ä¸º &lt;tt class="docutils literal"&gt;globals()&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;locals&lt;/tt&gt; é»˜è®¤ä¸º &lt;tt class="docutils literal"&gt;globals&lt;/tt&gt; å‚æ•°çš„å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢å°†ä¸¾ä¾‹è¯´æ˜æŒ‡å®š &lt;tt class="docutils literal"&gt;globals&lt;/tt&gt; å’Œ &lt;tt class="docutils literal"&gt;locals&lt;/tt&gt; æ—¶çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;div class="section" id="globals"&gt;
&lt;h2&gt;globals&lt;/h2&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;globals&lt;/tt&gt; æ˜¯ä¸ª &lt;tt class="docutils literal"&gt;dict&lt;/tt&gt; å¯¹è±¡ï¼Œç”¨æ¥æŒ‡å®šä»£ç æ‰§è¡Œæ—¶å¯ä»¥ä½¿ç”¨çš„å…¨å±€å˜é‡ä»¥åŠæ”¶é›†ä»£ç æ‰§è¡Œåçš„å…¨å±€å˜é‡:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc = age + 1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc = age + 1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{})&lt;/span&gt;
&lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;lt;stdin&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;lt;string&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="ne"&gt;NameError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;defined&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc = age + 1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;g&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc = age + 1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœåªæŒ‡å®šäº† &lt;tt class="docutils literal"&gt;globals&lt;/tt&gt; å‚æ•°ï¼Œå®ƒçš„å€¼å°†åŒæ ·ç”¨äº &lt;tt class="docutils literal"&gt;locals&lt;/tt&gt; å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯&lt;/strong&gt;: å½“ &lt;tt class="docutils literal"&gt;globals&lt;/tt&gt; å­—å…¸ä¸åŒ…å« &lt;tt class="docutils literal"&gt;__builtins__&lt;/tt&gt; è¿™ä¸ª key æ—¶ï¼Œ
python ä¼šè‡ªåŠ¨åŠ ä¸€ä¸ªæŒ‡å‘ &lt;a class="reference external" href="https://docs.python.org/3/library/builtins.html#module-builtins"&gt;builtins&lt;/a&gt; çš„å¼•ç”¨ã€‚æ‰€ä»¥å¦‚æœè¦ç¦æ­¢/é™åˆ¶ä»£ç ä½¿ç”¨å†…ç½®å‡½æ•°çš„è¯ï¼Œ
éœ€è¦åŒæ—¶æŒ‡å®š &lt;tt class="docutils literal"&gt;__builtins__&lt;/tt&gt; è¿™ä¸ª key:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;int(1)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{})&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;int(1)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;__builtins__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{}})&lt;/span&gt;
&lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;lt;stdin&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;lt;string&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="ne"&gt;NameError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;int&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;defined&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="locals"&gt;
&lt;h2&gt;locals&lt;/h2&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;locals&lt;/tt&gt; å¯ä»¥æ˜¯ä»»ä½• mapping å¯¹è±¡ï¼Œç”¨æ¥æŒ‡å®šä»£ç æ‰§è¡Œæ—¶çš„å±€éƒ¨å˜é‡ä»¥åŠæ”¶é›†ä»£ç æ‰§è¡Œåçš„å±€éƒ¨å˜é‡:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc = age + 1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{},&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;local&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="s"&gt;... name = &amp;#39;Tom&amp;#39;&lt;/span&gt;
&lt;span class="s"&gt;... age = 13&lt;/span&gt;
&lt;span class="s"&gt;... &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{},&lt;/span&gt; &lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;local&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Tom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docs.python.org/3/library/functions.html#exec"&gt;2. Built-in Functions â€” Python 3.5.1 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="exec"></category><category term="sanbox"></category></entry><entry><title>[python]ä½¿ç”¨ keyword æ¨¡å—æ£€æŸ¥å˜é‡åæ˜¯å¦æ˜¯ python å…³é”®å­—</title><link href="https://mozillazg.com/2016/03/python-use-keyword-model-check-an-name-weither-keyword.html" rel="alternate"></link><updated>2016-03-08T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-03-08:2016/03/python-use-keyword-model-check-an-name-weither-keyword.html</id><summary type="html">&lt;p&gt;æ— æ„ä¸­å‘ç° python æ ‡å‡†åº“ä¸­åŒ…å«å‘¢ä¸€ä¸ª &lt;tt class="docutils literal"&gt;keyword&lt;/tt&gt; æ¨¡å—
å¯ä»¥ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªå˜é‡åæ˜¯å¦æ˜¯ python å…³é”®å­—:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;keyword&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;keyword&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iskeyword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;is&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="bp"&gt;True&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;keyword&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iskeyword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="bp"&gt;False&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;keyword&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;kwlist&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;False&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;None&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;True&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;and&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;as&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;with&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;yield&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™ä¸ªæ¨¡å—åªæœ‰ä¸¤ä¸ªå‡½æ•°:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;keyword.iskeyword(s)&lt;/tt&gt;: æ˜¯å¦æ˜¯å…³é”®å­—&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;keyword.kwlist&lt;/tt&gt;: è¿”å›è§£é‡Šå™¨å®šä¹‰çš„æ‰€æœ‰å…³é”®å­—åˆ—è¡¨&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docs.python.org/3/library/keyword.html"&gt;32.6. keyword â€” Testing for Python keywords â€” Python 3.5.1 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary></entry><entry><title>[python]bustard: ä¸€ä¸ªç©å…·å¼çš„ web æ¡†æ¶</title><link href="https://mozillazg.com/2016/02/bustard-a-tiny-wsgi-web-framework.html" rel="alternate"></link><updated>2016-02-22T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-02-22:2016/02/bustard-a-tiny-wsgi-web-framework.html</id><summary type="html">&lt;p&gt;æœ€è¿‘ä¸€ç›´åœ¨å¡«ä¸€ä¸ªç©å…·å¼ï¼ˆä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸å¯ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰çš„ WEB æ¡†æ¶çš„å‘ï¼Œç°åœ¨å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½å·²ç»å®Œæˆçš„å·®ä¸å¤šäº†ï¼Œ æ‰€ä»¥å†™ç¯‡åšæ–‡ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶ã€‚&lt;/p&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;é¡¹ç›®åœ°å€ï¼š &lt;a class="reference external" href="https://github.com/mozillazg/bustard"&gt;https://github.com/mozillazg/bustard&lt;/a&gt;&lt;/div&gt;
&lt;div class="line"&gt;å®‰è£…ï¼š&lt;/div&gt;
&lt;/div&gt;
&lt;pre class="literal-block"&gt;
pip install bustard
pip install psycopg2  # å¦‚æœéœ€è¦ orm åŠŸèƒ½
&lt;/pre&gt;
&lt;p&gt;åŒ…å«çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/mozillazg/bustard/blob/master/bustard/router.py"&gt;è·¯ç”±&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/mozillazg/bustard/blob/master/bustard/http.py"&gt;Request å’Œ Response&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/mozillazg/bustard/blob/master/bustard/http.py"&gt;Cookies&lt;/a&gt; å’Œ &lt;a class="reference external" href="https://github.com/mozillazg/bustard/blob/master/bustard/sessions.py"&gt;Session&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/mozillazg/bustard/blob/master/bustard/orm.py"&gt;ORM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/mozillazg/bustard/blob/master/bustard/template.py"&gt;æ¨¡ç‰ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/mozillazg/bustard/blob/master/bustard/servers.py"&gt;WSGI server&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾èµ–:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Python 3.5&lt;/li&gt;
&lt;li&gt;psycopg2&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="section" id="hello-world"&gt;
&lt;h2&gt;Hello World&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/mozillazg/bustard"&gt;bustard&lt;/a&gt; å‚è€ƒäº† &lt;a class="reference external" href="https://github.com/mitsuhiko/flask"&gt;Flask&lt;/a&gt; å’Œ &lt;a class="reference external" href="https://github.com/django/django"&gt;Django&lt;/a&gt; çš„è®¾è®¡ï¼Œè·¯ç”±é£æ ¼è·Ÿ &lt;a class="reference external" href="https://github.com/mitsuhiko/flask"&gt;Flask&lt;/a&gt;
ç±»ä¼¼é‡‡ç”¨è£…é¥°å™¨é£æ ¼ï¼Œview é£æ ¼è·Ÿ &lt;a class="reference external" href="https://github.com/django/django"&gt;Django&lt;/a&gt; ç±»ä¼¼é‡‡ç”¨æ˜¾ç¤ºä¼ å…¥ &lt;tt class="docutils literal"&gt;request&lt;/tt&gt;
çš„æ–¹å¼ã€‚ :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;bustard.app&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Bustard&lt;/span&gt;

&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Bustard&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;helloword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Hello World!&amp;#39;&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;è·¯ç”±&lt;/h2&gt;
&lt;p&gt;æ”¯æŒä»¥ä¸‹ä¸‰ç§æ–¹å¼çš„è·¯ç”±:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;é™æ€è·¯ç”± :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;/hello&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;hello&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;hello&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;ç±»ä¼¼ &lt;a class="reference external" href="https://github.com/mitsuhiko/flask"&gt;Flask&lt;/a&gt; çš„åŠ¨æ€è·¯ç”±(&lt;tt class="docutils literal"&gt;&amp;lt;name&amp;gt;&lt;/tt&gt;) :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;/hello/&amp;lt;name&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;hello&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;hello {}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;ç±»ä¼¼ &lt;a class="reference external" href="https://github.com/django/django"&gt;Django&lt;/a&gt; çš„åŠ¨æ€è·¯ç”±(æ­£åˆ™è¡¨è¾¾å¼) :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;/hello/(?P&amp;lt;name&amp;gt;\w+)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;hello&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;hello {}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;app.route&lt;/tt&gt; æ”¯æŒä¸€ä¸ªå¯é€‰å‚æ•° &lt;tt class="docutils literal"&gt;methods&lt;/tt&gt; ç”¨äºæŒ‡å®šæ”¯æŒçš„ http method:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;GET&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39; POST&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;hello&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;hello&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="request"&gt;
&lt;h2&gt;Request&lt;/h2&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;request&lt;/tt&gt; å¯¹è±¡è·Ÿ &lt;a class="reference external" href="https://github.com/mitsuhiko/flask"&gt;Flask&lt;/a&gt; é‡Œçš„ &lt;tt class="docutils literal"&gt;request&lt;/tt&gt; å¯¹è±¡ç±»ä¼¼ï¼Œå¸¸ç”¨çš„æ–¹æ³•å’Œå±æ€§å¦‚ä¸‹:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;request.headers&lt;/tt&gt;: url å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;request.args&lt;/tt&gt;: url å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;request.form&lt;/tt&gt;: POST è¡¨å•æ•°æ®ï¼ˆä¸åŒ…å«æ–‡ä»¶ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;request.files&lt;/tt&gt;: POST è¡¨å•é‡Œçš„æ–‡ä»¶æ•°æ®&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;request.data&lt;/tt&gt;: POST body&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;request.cookies&lt;/tt&gt;: Cookies&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="response"&gt;
&lt;h2&gt;Response&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;status_code&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;content_type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;text/html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;X-Total&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;response&lt;/tt&gt; å¯¹è±¡å¸¸ç”¨çš„æ–¹æ³•å’Œå±æ€§å¦‚ä¸‹:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;response.status_code&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;response.content_type&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;response.headers&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;response.content&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;response.set_cookie(...)&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;response.delete_cookie(...)&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="session"&gt;
&lt;h2&gt;Session&lt;/h2&gt;
&lt;p&gt;è®¿é—® &lt;tt class="docutils literal"&gt;request.session&lt;/tt&gt; æ¥è·å– &lt;tt class="docutils literal"&gt;session&lt;/tt&gt; æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±» &lt;tt class="docutils literal"&gt;dict&lt;/tt&gt; å¯¹è±¡`:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;user_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;user_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Tom&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="orm"&gt;
&lt;h2&gt;ORM&lt;/h2&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;ORM&lt;/tt&gt; åªæ”¯æŒ &lt;a class="reference external" href="http://www.postgresql.org/docs/9.5/static/index.html"&gt;postgresql&lt;/a&gt; æ•°æ®åº“ï¼Œç”¨æ³•ç±»ä¼¼ &lt;a class="reference external" href="https://github.com/django/django"&gt;Django&lt;/a&gt; ORM å’Œ &lt;a class="reference external" href="https://bitbucket.org/zzzeek/sqlalchemy/"&gt;SQLAlchemy&lt;/a&gt; çš„ç»“åˆä½“:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;bustard.orm&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Engine&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Session&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;AutoField&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;BooleanField&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;__tablename__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;users&amp;#39;&lt;/span&gt;

    &lt;span class="nb"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;AutoField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;primary_key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;username&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;is_actived&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BooleanField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server_default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;engine&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Engine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;postgresql://dbuser:password@localhost/exampledb&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Session&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;engine&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ–°å¢:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;tom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;is_actived&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;insert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æŸ¥è¯¢:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;order_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_actived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;limit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ›´æ–°:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is_actived&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_actived&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åˆ é™¤:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;æ¨¡ç‰ˆ&lt;/h2&gt;
&lt;p&gt;æ¨¡ç‰ˆè¯­æ³•ç±»ä¼¼ &lt;a class="reference external" href="http://jinja.pocoo.org"&gt;Jinja2&lt;/a&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;{% for user in users %}
    {{ user.name }}
    {% if user.is_actived %}
        is_actived
    {% endif %}
{% endfor %}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ›´å¤šä½¿ç”¨ç¤ºä¾‹è¯¦è§ &lt;a class="reference external" href="https://github.com/mozillazg/bustard/tree/master/examples"&gt;examples&lt;/a&gt; å’Œ &lt;a class="reference external" href="https://github.com/mozillazg/bustard/tree/master/tests"&gt;tests&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
</summary><category term="wsgi"></category><category term="framework"></category><category term="orm"></category><category term="template"></category><category term="router"></category></entry><entry><title>psycopg2 æ’å…¥æ•°æ®æ—¶å¦‚ä½•è·å–æ–°çºªå½•çš„ä¸»é”®å€¼</title><link href="https://mozillazg.com/2016/02/psycopg2-how-to-get-lastrowid-when-insert-a-new-row.html" rel="alternate"></link><updated>2016-02-15T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-02-15:2016/02/psycopg2-how-to-get-lastrowid-when-insert-a-new-row.html</id><summary type="html">&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ psycopg2 æ—¶ &lt;code&gt;cursor.lastrowid&lt;/code&gt; å¹¶ä¸ä¼šè¿”å›æ–°çºªå½•çš„ä¸»é”®å€¼ã€‚
&lt;a href="http://initd.org/psycopg/docs/cursor.html?highlight=lastrowid#cursor.lastrowid"&gt;æ–‡æ¡£&lt;/a&gt; ä¸­æ˜¯è¿™æ ·è§£é‡Šçš„ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;cursor.lastrowid&lt;/p&gt;
&lt;p&gt;This read-only attribute provides the OID of the last row inserted by the cursor.
If the table wasnâ€™t created with OID support or the last operation is not a single record insert,
the attribute is set to None.&lt;/p&gt;
&lt;p&gt;Note&lt;/p&gt;
&lt;p&gt;PostgreSQL currently advices to not create OIDs on the tables and the default for &lt;code&gt;CREATE TABLE&lt;/code&gt;
is to not support them. The &lt;code&gt;INSERT ... RETURNING&lt;/code&gt; syntax available from
PostgreSQL 8.3 allows more flexibility.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ ¹æ®æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¯ç”¨ &lt;code&gt;INSERT ... RETURNING&lt;/code&gt; çš„æ–¹å¼æ¥è·å–ä¸»é”®ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;exampledb&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;INSERT&lt;/span&gt; &lt;span class="n"&gt;INTO&lt;/span&gt; &lt;span class="n"&gt;users&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;hello&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;RETURNING&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 &lt;span class="n"&gt;id&lt;/span&gt;
&lt;span class="o"&gt;----&lt;/span&gt;
 &lt;span class="mi"&gt;11&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;INSERT&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;python ä¸­è¿™æ ·ç”¨ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;INSERT INTO users (username) VALUES (&amp;#39;hello&amp;#39;) RETURNING id;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchone&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;,)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.python.org/dev/peps/pep-0249/#lastrowid"&gt;PEP 0249 -- Python Database API Specification v2.0 | Python.org&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://initd.org/psycopg/docs/cursor.html?highlight=lastrowid#cursor.lastrowid"&gt;The cursor class â€” Psycopg 2.6.2.dev0 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="psycopg2"></category><category term="postgresql"></category></entry><entry><title>python ä¸­ += è¿ç®—ç¬¦åœ¨å¯å˜å¯¹è±¡å’Œä¸å¯å˜å¯¹è±¡ä¸Šçš„ä¸åŒæ•ˆæœ</title><link href="https://mozillazg.com/2016/01/python-plus-work-on-immutable-or-mutable-object.md.html" rel="alternate"></link><updated>2016-01-31T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-01-31:2016/01/python-plus-work-on-immutable-or-mutable-object.md.html</id><summary type="html">&lt;p&gt;å…ˆæ¥çœ‹å†…ç½®çš„ä¸å¯å˜å¯¹è±¡ &lt;code&gt;+=&lt;/code&gt; çš„ç»“æœï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;140606482358088&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;bc&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;140606244543656&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥çœ‹åˆ°å†…ç½®çš„ä¸å¯å˜å¯¹è±¡ &lt;code&gt;+=&lt;/code&gt; æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚é‚£ä¹ˆå†…ç½®çš„å¯å˜å¯¹è±¡ &lt;code&gt;+=&lt;/code&gt; å‘¢ï¼Ÿï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;140606245413384&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;140606245413384&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;140606245413384&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥çœ‹åˆ°å†…ç½®çš„å¯å˜å¯¹è±¡çš„ &lt;code&gt;+=&lt;/code&gt; æ“ä½œå®é™…æ˜¯åŸåœ°ä¿®æ”¹æ“ä½œï¼Œå¹¶ä¸æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;h2 id="_1"&gt;å¯ç¤º&lt;/h2&gt;
&lt;p&gt;ä¸€æ–¹é¢è¦æ³¨æ„åˆ° &lt;code&gt;+=&lt;/code&gt;, &lt;code&gt;-=&lt;/code&gt; ä¹‹ç±»çš„ &lt;code&gt;x=&lt;/code&gt; æ“ä½œåœ¨ä½œç”¨äºå†…ç½®çš„å¯å˜å¯¹è±¡æ—¶æ˜¯åŸåœ°ä¿®æ”¹çš„æƒ…å†µï¼Œ
å¦ä¸€æ–¹é¢ä¹Ÿç»™äº†æˆ‘ä»¬é‡è½½ &lt;code&gt;+=&lt;/code&gt;, &lt;code&gt;-=&lt;/code&gt; ä¹‹ç±»çš„ &lt;code&gt;x=&lt;/code&gt; è¿ç®—ç¬¦æ—¶çš„ä¸€ä¸ªå‚è€ƒã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚è‡ªå®šä¹‰çš„ä¸€ä¸ªå¯å˜å¯¹è±¡è¦å®ç°æ”¯æŒ &lt;code&gt;+=&lt;/code&gt; è¿ç®—ç¬¦:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="n"&gt;Mutable&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;

    &lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;number&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;number&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;number&lt;/span&gt;

    &lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;__iadd__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;å¯å˜å¯¹è±¡åŸåœ°ä¿®æ”¹ï¼Œè¿”å› self&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;number&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;number&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;self&lt;/span&gt;


&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Mutable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;140606244895432&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;Mutable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;number&lt;/span&gt;
&lt;span class="mi"&gt;7&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;140606244895432&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸å¯å˜å¯¹è±¡:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="n"&gt;Immutable&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;

    &lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;number&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_number&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;number&lt;/span&gt;

    &lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;property&lt;/span&gt;
    &lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;number&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_number&lt;/span&gt;

    &lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;__iadd__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;ä¸å¯å˜å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__class__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_number&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;number&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;im&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Immutable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;140606234970432&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;im&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;Immutable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;number&lt;/span&gt;
&lt;span class="mi"&gt;7&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;140606245096192&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_2"&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/3/reference/datamodel.html#object.__radd__"&gt;3. Data model &amp;mdash; Python 3.5.1 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary></entry><entry><title>ä½¿ç”¨ sqlalchemy æ—¶å¦‚ä½•é…ç½®ä½¿ç”¨ postgresql çš„ uuid ç±»å‹</title><link href="https://mozillazg.com/2016/01/sqlalchemy-use-postgresql-uuid.html" rel="alternate"></link><updated>2016-01-30T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-01-30:2016/01/sqlalchemy-use-postgresql-uuid.html</id><summary type="html">&lt;p&gt;åœ¨ sqlalchemy ä¸­ postgresql çš„ uuid ç±»å‹å¯¹è±¡æ˜¯ï¼š 
&lt;code&gt;sqlalchemy.dialects.postgresql.UUID&lt;/code&gt;, æ‰€ä»¥åŸºæœ¬çš„ç”¨æ³•æ˜¯ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;sqlalchemy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dialects&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;postgresql&lt;/span&gt; &lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;UUID&lt;/span&gt;

&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UUID&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸‹é¢é‡ç‚¹è¦è¯´çš„å°±æ˜¯å¦‚ä½•è®¾ç½®è‡ªåŠ¨ç”Ÿæˆéšæœºçš„ uuidã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ç§åŠæ³•æ˜¯ï¼Œä½¿ç”¨ python çš„ &lt;code&gt;uuid&lt;/code&gt; æ¨¡å—ç”Ÿæˆ uuid:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UUID&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lambda&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uuid&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;uuid4&lt;/span&gt;&lt;span class="p"&gt;()))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç¬¬äºŒç§åŠæ³•ï¼ˆæ¨èï¼‰æ˜¯ï¼ŒæœåŠ¡ç«¯å»ç”Ÿæˆ uuid ä¹‹ &lt;code&gt;gen_random_uuid()&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;postgreql&lt;/span&gt; &lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt;

&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UUID&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server_default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;gen_random_uuid()&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;gen_random_uuid()&lt;/code&gt; å¹¶ä¸æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œéœ€è¦åœ¨æ•°æ®åº“ä¸­å®‰è£… &lt;code&gt;pgcrypto&lt;/code&gt; æ¨¡å—ï¼ˆä¸‹é¢çš„æ“ä½œåœ¨ postgresql æ•°æ®åº“æ§åˆ¶å°ä¸­æ“ä½œï¼‰ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# \c db_name&lt;/span&gt;
&lt;span class="cp"&gt;# create extension pgcrypto;&lt;/span&gt;
&lt;span class="n"&gt;CREATE&lt;/span&gt; &lt;span class="n"&gt;EXTENSION&lt;/span&gt;
&lt;span class="cp"&gt;# select gen_random_uuid();&lt;/span&gt;
           &lt;span class="n"&gt;gen_random_uuid&lt;/span&gt;            
&lt;span class="o"&gt;--------------------------------------&lt;/span&gt;
 &lt;span class="mf"&gt;52f3e12&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;b42a&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;47&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="n"&gt;de&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;bfd9396b87e&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç¬¬ä¸‰ç§åŠæ³•æ˜¯ï¼ŒæœåŠ¡ç«¯å»ç”Ÿæˆ uuid ä¹‹ &lt;code&gt;uuid_generate_v4()&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UUID&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server_default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;uuid_generate_v4()&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;éœ€è¦åœ¨æ•°æ®åº“ä¸­å®‰è£… &lt;code&gt;uuid-ossp&lt;/code&gt; æ¨¡å—ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# \c db_name&lt;/span&gt;
&lt;span class="cp"&gt;# create extension &amp;quot;uuid-ossp&amp;quot;;&lt;/span&gt;
&lt;span class="n"&gt;CREATE&lt;/span&gt; &lt;span class="n"&gt;EXTENSION&lt;/span&gt;
&lt;span class="cp"&gt;# select uuid_generate_v4();&lt;/span&gt;
           &lt;span class="n"&gt;uuid_generate_v4&lt;/span&gt;           
&lt;span class="o"&gt;--------------------------------------&lt;/span&gt;
 &lt;span class="mi"&gt;53153822&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8516&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="n"&gt;d7&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8804&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;9792439e449&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://docs.sqlalchemy.org/en/rel_1_1/dialects/postgresql.html#sqlalchemy.dialects.postgresql.UUID"&gt;PostgreSQL &amp;mdash; SQLAlchemy 1.1 Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://docs.sqlalchemy.org/en/rel_1_1/core/defaults.html#server-side-defaults"&gt;Column Insert/Update Defaults &amp;mdash; SQLAlchemy 1.1 Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/a/20537690/1804866"&gt;How to set a column default to a PostgreSQL function using SQLAlchemy? - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.postgresql.org/docs/9.5/static/pgcrypto.html"&gt;PostgreSQL: Documentation: 9.5: pgcrypto&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.postgresql.org/docs/9.5/static/uuid-ossp.html"&gt;PostgreSQL: Documentation: 9.5: uuid-ossp&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="sqlalchemy"></category><category term="postgresql"></category></entry><entry><title>åŸºäº Python 3 æ–°å¢çš„å‡½æ•°æ³¨è§£ï¼ˆFunction Annotations ï¼‰è¯­æ³•å®ç°å‚æ•°ç±»å‹æ£€æŸ¥åŠŸèƒ½</title><link href="https://mozillazg.com/2016/01/python-function-argument-type-check-base-on-function-annotations.html" rel="alternate"></link><updated>2016-01-06T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-01-06:2016/01/python-function-argument-type-check-base-on-function-annotations.html</id><summary type="html">&lt;h2 id="function-annotations"&gt;å‡½æ•°æ³¨è§£ï¼ˆFunction Annotationsï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.python.org/dev/peps/pep-3107/"&gt;å‡½æ•°æ³¨è§£è¯­æ³•&lt;/a&gt; å¯ä»¥è®©ä½ åœ¨å®šä¹‰å‡½æ•°çš„æ—¶å€™å¯¹å‚æ•°å’Œè¿”å›å€¼æ·»åŠ æ³¨è§£ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;it&amp;#39;s b&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;tuple&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;&lt;code&gt;a: int&lt;/code&gt; è¿™ç§æ˜¯æ³¨è§£å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;c: str = 5&lt;/code&gt; æ˜¯æ³¨è§£æœ‰é»˜è®¤å€¼çš„å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-&amp;gt; tuple&lt;/code&gt; æ˜¯æ³¨è§£è¿”å›å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨è§£çš„å†…å®¹æ—¢å¯ä»¥æ˜¯ä¸ªç±»å‹ä¹Ÿå¯ä»¥æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œç”šè‡³è¡¨è¾¾å¼ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é‚£ä¹ˆå¦‚ä½•è·å–æˆ‘ä»¬å®šä¹‰çš„å‡½æ•°æ³¨è§£å‘¢ï¼Ÿè‡³å°‘æœ‰ä¸¤ç§åŠæ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;__annotations__&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__annotations__&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;it&amp;#39;s b&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;tuple&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;inspect.signature&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;inspect&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;sig&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;inspect&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;signature&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;è·å–å‡½æ•°å‚æ•°&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;sig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;paraments&lt;/span&gt;
&lt;span class="n"&gt;mappingproxy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;OrderedDict&lt;/span&gt;&lt;span class="p"&gt;([(&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Parameter&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;a:int&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Parameter&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;b:&amp;quot;&lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Parameter&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;c:str=5&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;)]))&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;è·å–å‡½æ•°å‚æ•°æ³¨è§£&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;sig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parameters&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;annotation&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;     
&lt;span class="nl"&gt;a:&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nl"&gt;b:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;it&amp;#39;s b&amp;quot;&lt;/span&gt;
&lt;span class="nl"&gt;c:&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;è¿”å›å€¼æ³¨è§£&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;sig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_annotation&lt;/span&gt;
&lt;span class="n"&gt;tuple&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ—¢ç„¶å¯ä»¥å¾—åˆ°å‡½æ•°ä¸­å®šä¹‰çš„æ³¨è§£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒè¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥äº†ã€‚&lt;/p&gt;
&lt;h2 id="_1"&gt;ç±»å‹æ£€æŸ¥&lt;/h2&gt;
&lt;p&gt;Python è§£é‡Šå™¨å¹¶ä¸ä¼šåŸºäºå‡½æ•°æ³¨è§£æ¥è‡ªåŠ¨è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»å®ç°ç±»å‹æ£€æŸ¥åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__annotations__&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;it&amp;#39;s b&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;tuple&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ—¢ç„¶é€šè¿‡ &lt;code&gt;inspect.signature&lt;/code&gt; æˆ‘ä»¬å¯ä»¥è·å–å‡½æ•°å®šä¹‰çš„å‚æ•°çš„é¡ºåºä»¥åŠå‡½æ•°æ³¨è§£ï¼Œ
é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªè£…é¥°å™¨æ¥æ£€æŸ¥ä¼ å…¥å‡½æ•°çš„å‚æ•°çš„ç±»å‹æ˜¯å¦è·Ÿå‡½æ•°æ³¨è§£ç›¸ç¬¦ï¼Œ
è¿™é‡Œå®ç°çš„è£…é¥°å™¨å‡½æ•°ï¼ˆcheck_type.pyï¼‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# coding: utf8&lt;/span&gt;
&lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;collections&lt;/span&gt;
&lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;functools&lt;/span&gt;
&lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;inspect&lt;/span&gt;


&lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;check&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Expected&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;expected&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;argument&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;argument&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;
           &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;but&lt;/span&gt; &lt;span class="n"&gt;got&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;got&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;è·å–å‡½æ•°å®šä¹‰çš„å‚æ•°&lt;/span&gt;
    &lt;span class="n"&gt;sig&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;inspect&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;signature&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;parameters&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parameters&lt;/span&gt;          &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;å‚æ•°æœ‰åºå­—å…¸&lt;/span&gt;
    &lt;span class="n"&gt;arg_keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tuple&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parameters&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;   &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;å‚æ•°åç§°&lt;/span&gt;

    &lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;functools&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wraps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;CheckItem&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;collections&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;namedtuple&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;CheckItem&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;anno&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;arg_name&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="n"&gt;check_list&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

        &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;collect&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;   &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt; &lt;span class="err"&gt;ä¼ å…¥çš„å‚æ•°ä»¥åŠå¯¹åº”çš„å‡½æ•°å‚æ•°æ³¨è§£&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;enumerate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;arg_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;arg_keys&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="n"&gt;anno&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;parameters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;arg_name&lt;/span&gt;&lt;span class="p"&gt;].&lt;/span&gt;&lt;span class="n"&gt;annotation&lt;/span&gt;
            &lt;span class="n"&gt;check_list&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CheckItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;anno&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arg_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

        &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;collect&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;  &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt; &lt;span class="err"&gt;ä¼ å…¥çš„å‚æ•°ä»¥åŠå¯¹åº”çš„å‡½æ•°å‚æ•°æ³¨è§£&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;arg_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
           &lt;span class="n"&gt;anno&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;parameters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;arg_name&lt;/span&gt;&lt;span class="p"&gt;].&lt;/span&gt;&lt;span class="n"&gt;annotation&lt;/span&gt;
           &lt;span class="n"&gt;check_list&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CheckItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;anno&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arg_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

        &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;check&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;item&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;check_list&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;not&lt;/span&gt; &lt;span class="n"&gt;isinstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;anno&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;error&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;expected&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;anno&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;argument&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arg_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                   &lt;span class="n"&gt;got&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="n"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;TypeError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸‹é¢æ¥æµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬çš„è£…é¥°å™¨:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;check&lt;/span&gt;
&lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;float&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;3.2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;tuple&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é¡ºåºä¼ å‚æµ‹è¯•:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;3.2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;3.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;3.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="nl"&gt;TypeError:&lt;/span&gt; &lt;span class="n"&gt;Expected&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;argument&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;but&lt;/span&gt; &lt;span class="n"&gt;got&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="nl"&gt;TypeError:&lt;/span&gt; &lt;span class="n"&gt;Expected&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;argument&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;but&lt;/span&gt; &lt;span class="n"&gt;got&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="nl"&gt;TypeError:&lt;/span&gt; &lt;span class="n"&gt;Expected&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;argument&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;but&lt;/span&gt; &lt;span class="n"&gt;got&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å…³é”®å­—ä¼ å‚:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;3.2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;3.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;3.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;foo&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;bar&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="nl"&gt;TypeError:&lt;/span&gt; &lt;span class="n"&gt;Expected&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;argument&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;but&lt;/span&gt; &lt;span class="n"&gt;got&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;foo&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="nl"&gt;TypeError:&lt;/span&gt; &lt;span class="n"&gt;Expected&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;argument&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;but&lt;/span&gt; &lt;span class="n"&gt;got&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;bar&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="nl"&gt;TypeError:&lt;/span&gt; &lt;span class="n"&gt;Expected&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;argument&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;but&lt;/span&gt; &lt;span class="n"&gt;got&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å€ŸåŠ©äº Function Annotations ä¸€ä¸ªç®€å•çš„å‚æ•°ç±»å‹æ£€æŸ¥çš„è£…é¥°å™¨å°±è¿™æ ·å®ç°äº†ã€‚&lt;/p&gt;
&lt;h2 id="_2"&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.python.org/dev/peps/pep-3107/"&gt;PEP 3107 -- Function Annotations | Python.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python 3"></category><category term="Function Annotations"></category></entry><entry><title>è®©æˆ‘ä»¬ä¸€èµ·æ¥æ„å»ºä¸€ä¸ª Web æœåŠ¡å™¨ï¼ˆä¸‰ï¼‰</title><link href="https://mozillazg.com/2015/08/let-us-build-a-web-server-part-3-zh-cn.html" rel="alternate"></link><updated>2015-08-27T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2015-08-04:2015/08/let-us-build-a-web-server-part-3-zh-cn.html</id><summary type="html">&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š &lt;a class="reference external" href="http://ruslanspivak.com/lsbaws-part3/"&gt;http://ruslanspivak.com/lsbaws-part3/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
â€œå½“æˆ‘ä»¬å¿…é¡»è¦å‘æ˜åˆ›é€ çš„æ—¶å€™å­¦åˆ°çš„ä¸œè¥¿æœ€å¤šâ€ â€”â€” Piaget&lt;/blockquote&gt;
&lt;p&gt;åœ¨ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-2-zh-cn.html"&gt;ç¬¬äºŒéƒ¨åˆ†&lt;/a&gt; ä½ åˆ›å»ºäº†ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†åŸºæœ¬çš„ GET è¯·æ±‚çš„å¾®å‹ WSGI æœåŠ¡å™¨ã€‚
åŒæ—¶æˆ‘å‘ä½ æäº†ä¸€ä¸ªé—®é¢˜ï¼Œâ€œå¦‚ä½•æ‰èƒ½è®©ä½ çš„æœåŠ¡å™¨åœ¨åŒä¸€æ—¶åˆ»èƒ½å¤Ÿå¤„ç†å¤šä¸ªè¯·æ±‚ï¼Ÿâ€
åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä½ å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚é‚£ä¹ˆï¼Œç³»å¥½å®‰å…¨å¸¦ï¼ŒåŠ è¶³é©¬åŠ›å§ã€‚
ä½ å°†ä¼šæœ‰ä¸€è¶Ÿéå¸¸å¿«é€Ÿçš„æ—…ç¨‹ã€‚
ç¡®ä¿ä½ å·²ç»å‡†å¤‡å¥½äº†ä½ çš„ Linux, Mac OS X ï¼ˆæˆ–ä»»ä¸€ *nix ç³»ç»Ÿï¼‰ä»¥åŠ Python ã€‚
æœ¬æ–‡æ‰€æœ‰çš„æºä»£ç éƒ½å·²ç»æ”¾åœ¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/"&gt;Github&lt;/a&gt; ä¸Šäº†ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä¸€ä¸ªéå¸¸åŸºç¡€çš„ Web æœåŠ¡å™¨çœ‹èµ·æ¥æ˜¯å•¥æ ·çš„ï¼Œ
ä»¥åŠè¿™ä¸ªæœåŠ¡å™¨éœ€è¦åšäº›ä»€ä¹ˆæ‰èƒ½æœåŠ¡æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚
ä½ åœ¨ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-1-zh-cn.html"&gt;ç¬¬ä¸€éƒ¨åˆ†&lt;/a&gt; å’Œ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-2-zh-cn.html"&gt;ç¬¬äºŒéƒ¨åˆ†&lt;/a&gt; åˆ›å»ºçš„æœåŠ¡å™¨æ˜¯ä¸ªä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚çš„å¾ªç¯æœåŠ¡å™¨ã€‚
åœ¨å®ƒå¤„ç†å®Œæ­£åœ¨å¤„ç†çš„å®¢æˆ·ç«¯è¯·æ±‚ä¹‹å‰ï¼Œå®ƒæ˜¯æ— æ³•æ¥å—æ–°çš„è¿æ¥çš„ã€‚
ä¸€äº›å®¢æˆ·ç«¯å¯èƒ½ä¼šä¸é«˜å…´ï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»å¾—æ’é˜Ÿç­‰å¾…ï¼Œ
å¯¹äºé‚£äº›éå¸¸ç¹å¿™çš„æœåŠ¡å™¨ï¼Œè¿™ä¸ªç­‰å¾…å¯èƒ½ä¼šæ˜¯ä¸ªéå¸¸æ¼«é•¿çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it1.png" src="/static/images/lsbaws-part3/lsbaws_part3_it1.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å¾ªç¯æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3a.py"&gt;webserver3a.py&lt;/a&gt; ä»£ç :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#####################################################################&lt;/span&gt;
&lt;span class="c"&gt;# Iterative server - webserver3a.py                                 #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                   #&lt;/span&gt;
&lt;span class="c"&gt;# Tested with Python 2.7.9 &amp;amp; Python 3.4 on Ubuntu 14.04 &amp;amp; Mac OS X  #&lt;/span&gt;
&lt;span class="c"&gt;#####################################################################&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;

&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;
&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
    &lt;span class="n"&gt;http_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s"&gt;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class="s"&gt;Hello, World!&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Serving HTTP on port {port} ...&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client_address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸ºäº†è§‚å¯Ÿä½ çš„æœåŠ¡å™¨ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚çš„ç°è±¡ï¼Œ
æœåŠ¡å™¨ä»£ç éœ€è¦åšä¸€ç‚¹ä¿®æ”¹ï¼Œåœ¨å‘é€å“åº”ä¿¡æ¯ç»™å®¢æˆ·ç«¯åçš„åœ°æ–¹å¢åŠ äº†
ä¸€ä¸ª 60 ç§’çš„å»¶æ—¶ã€‚è¿™ä¸€è¡Œçš„æ›´æ”¹æ˜¯ä¸ºäº†å‘Šè¯‰æœåŠ¡å™¨è¿›ç¨‹éœ€è¦ä¼‘æ¯ 60 ç§’ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it2.png" src="/static/images/lsbaws-part3/lsbaws_part3_it2.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯åŒ…å«ä¼‘æ¯ä»£ç çš„æœåŠ¡å™¨ä»£ç  &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3b.py"&gt;webserver3b.py&lt;/a&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#########################################################################&lt;/span&gt;
&lt;span class="c"&gt;# Iterative server - webserver3b.py                                     #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                       #&lt;/span&gt;
&lt;span class="c"&gt;# Tested with Python 2.7.9 &amp;amp; Python 3.4 on Ubuntu 14.04 &amp;amp; Mac OS X      #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                       #&lt;/span&gt;
&lt;span class="c"&gt;# - Server sleeps for 60 seconds after sending a response to a client   #&lt;/span&gt;
&lt;span class="c"&gt;#########################################################################&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;
&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
    &lt;span class="n"&gt;http_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s"&gt;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class="s"&gt;Hello, World!&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# sleep and block the process for 60 seconds&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Serving HTTP on port {port} ...&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client_address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç”¨ä»¥ä¸‹æ–¹å¼å¯åŠ¨æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3b.py
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ï¼Œç„¶åæ‰§è¡Œ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘½ä»¤ã€‚
ä½ åº”è¯¥ä¼šçœ‹åˆ°å±å¹•ä¸Šæ‰“å°äº† &amp;quot;Hello, World!&amp;quot; å­—ç¬¦ä¸²ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ curl http://localhost:8888/hello
Hello, World!
&lt;/pre&gt;
&lt;p&gt;ç„¶åç«‹å³æ‰“å¼€ç¬¬äºŒä¸ªç»ˆç«¯çª—å£å¹¶æ‰§è¡Œç›¸åŒçš„ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ curl http://localhost:8888/hello
&lt;/pre&gt;
&lt;p&gt;å¦‚æœä½ åœ¨ 60 ç§’å†…åšå®Œäº†è¿™äº›æ“ä½œçš„è¯ï¼Œç¬¬äºŒä¸ª &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; åº”è¯¥ä¸ä¼šç«‹é©¬
è¾“å‡ºä»»ä½•çš„çš„ä¿¡æ¯ï¼Œåªæ˜¯ä¼šé˜»å¡åœ¨é‚£é‡Œã€‚
æœåŠ¡å™¨åº”è¯¥ä¹Ÿæ²¡æœ‰åœ¨å®ƒçš„æ ‡å‡†è¾“å‡ºä¸­ç­”åº”æ–°çš„è¯·æ±‚ body ä¿¡æ¯ã€‚
ä¸‹é¢æ˜¯è¿™ç§ç°è±¡åœ¨æˆ‘çš„ Mac ç”µè„‘ä¸Šçš„æ ·å­ï¼ˆå³ä¸‹è§’ç”¨é»„è‰²é«˜äº®çš„çª—å£æ˜¾ç¤ºç¬¬äºŒä¸ª &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘½ä»¤é˜»å¡äº†ï¼Œ
æ­£åœ¨ç­‰å¾…è¿æ¥èƒ½å¤Ÿè¢«æœåŠ¡å™¨æ¥å—ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it3.png" src="/static/images/lsbaws-part3/lsbaws_part3_it3.png" /&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä½ ç­‰äº†è¶³å¤Ÿé•¿çš„æ—¶é—´åï¼ˆå¤§äº 60 ç§’ï¼‰ä½ åº”è¯¥ä¼šçœ‹åˆ°ç¬¬ä¸€ä¸ª &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt;  ç»“æŸ
ä»¥åŠç¬¬äºŒä¸ª &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; åœ¨å±å¹•ä¸Šæ‰“å°äº† &amp;quot;Hello, World!&amp;quot;ï¼Œç„¶åé˜»å¡ 60 ç§’ï¼Œä¹‹åå†ç»“æŸï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it4.png" src="/static/images/lsbaws-part3/lsbaws_part3_it4.png" /&gt;&lt;/p&gt;
&lt;p&gt;å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯ï¼ŒæœåŠ¡å™¨å®Œæˆå¯¹ç¬¬ä¸€ä¸ª &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œåªæœ‰ç­‰å®ƒä¼‘æ¯å®Œ 60 ç§’ä¹‹åæ‰ä¼š
å¼€å§‹å¤„ç†ç¬¬äºŒä¸ªè¯·æ±‚ã€‚è¿™å°†å¯¼è‡´å‡ºç°é¡ºåºï¼Œæˆ–ä¸€æ­¥ä¸€æ­¥çš„å¾ªç¯ï¼Œæˆ–åœ¨è¿™é‡Œæ˜¯ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æŠ½å‡ºä¸€ç‚¹æ—¶é—´æ¥è¯´ä¸€ä¸‹å…³äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ–¹é¢çš„ä¸œè¥¿ã€‚
ä¸ºäº†è®©ä¸¤ä¸ªç¨‹åºèƒ½å¤Ÿåœ¨ç½‘ç»œè¿›è¡Œä¸­è¿›è¡Œé€šä¿¡ï¼Œå®ƒä»¬éœ€è¦ä½¿ç”¨å¥—æ¥å­—ï¼ˆsocketï¼‰ã€‚
ä½ å·²ç»åœ¨ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-1-zh-cn.html"&gt;ç¬¬ä¸€éƒ¨åˆ†&lt;/a&gt; å’Œ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-2-zh-cn.html"&gt;ç¬¬äºŒéƒ¨åˆ†&lt;/a&gt; ä¸­è§è¿‡ socket äº†ã€‚ä½†æ˜¯ä»€ä¹ˆæ˜¯ä¸€ä¸ª socket å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_socket.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_socket.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª socket æ˜¯ä¸€ä¸ªé€šä¿¡ç«¯ç‚¹çš„æŠ½è±¡æ¦‚å¿µï¼Œ
å®ƒå…è®¸ä½ çš„ç¨‹åºé€šè¿‡æ–‡ä»¶æè¿°ä¸å¦ä¸€ä¸ªç¨‹åºè¿›è¡Œé€šä¿¡ã€‚
åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šç‰¹åˆ«è®²è¿°åœ¨ Linux/Mac OS X ä¸Šçš„  TCP/IP socketã€‚
éœ€è¦ç†è§£ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œé‚£å°±æ˜¯ TCP socket å¯¹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
ä¸€ä¸ª TCP è¿æ¥çš„ socket å¯¹æ˜¯ä¸€ä¸ª 4 å…ƒç»„ï¼Œè¿™ä¸ªå…ƒç»„æ ‡è¯†äº†ä¸€ä¸ª TCP è¿æ¥çš„ä¸¤ä¸ªç«¯ç‚¹ï¼š
æœ¬åœ° IP åœ°å€ï¼Œæœ¬åœ°ç«¯å£ï¼Œè¿œç¨‹ IP åœ°å€ï¼Œä»¥åŠè¿œç¨‹ç«¯å£ã€‚
ä¸€ä¸ªå¥—æ¥å­—å¯¹å”¯ä¸€æ ‡è¯†äº†ç½‘ç»œä¸Šæ¯ä¸ª TCP è¿æ¥ã€‚
ä¸€ä¸ª IP åœ°å€å’Œä¸€ä¸ªç«¯å£å·è¿™ä¸ªä¸¤ä¸ªå€¼æ ‡è¯†äº†æ¯ä¸ªç«¯ç‚¹ï¼Œé€šå¸¸è¢«å«åšä¸€ä¸ªå¥—æ¥å­—ã€‚ &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_socketpair.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_socket.png" /&gt;&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå…ƒç»„ &lt;tt class="docutils literal"&gt;{10.10.10.2:49152, 12.12.12.3:8888}&lt;/tt&gt; æ˜¯ä¸€ä¸ªå¥—æ¥å­—å¯¹ï¼Œå®ƒå”¯ä¸€æ ‡è¯†äº†
å®¢æˆ·ç«¯ ä¸Šçš„ä¸€ä¸ª TCP è¿æ¥çš„ä¸¤ä¸ªç«¯ç‚¹ã€‚
å…ƒç»„ &lt;tt class="docutils literal"&gt;{12.12.12.3:8888, 10.10.10.2:49152}&lt;/tt&gt; æ˜¯ä¸€ä¸ªå¥—æ¥å­—å¯¹ï¼Œå®ƒå”¯ä¸€æ ‡è¯†äº†
æœåŠ¡ç«¯ ä¸Šçš„ä¸€ä¸ª TCP è¿æ¥çš„ä¸¤ä¸ªç«¯ç‚¹ã€‚è¿™ä¸ªä¸¤ä¸ªå€¼æ ‡è¯†äº†ä¸€ä¸ª TCP è¿æ¥çš„æœåŠ¡ç«¯ç«¯ç‚¹ï¼Œ
IP åœ°å€ 12.12.12.3 å’Œç«¯å£ 8888 åœ¨è¿™é‡Œè¢«å½’ä¸ºä¸€ä¸ªå¥—æ¥å­—ï¼ˆå®¢æˆ·ç«¯ç«¯ç‚¹æœ‰ç›¸åŒçš„åº”ç”¨ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæœåŠ¡å™¨é€šå¸¸é€šè¿‡åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—,ç„¶åå¼€å§‹æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå®ƒçš„å¸¸è§„é¡ºåºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_server_socket_sequence.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_server_socket_sequence.png" /&gt;&lt;/p&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ª TCP/IP socketã€‚è¿™ä¸ªç”¨çš„æ˜¯ä¸‹é¢çš„ Python è¯­å¥æ¥å®ç°çš„ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
listen_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;æœåŠ¡å™¨å¯èƒ½ä¼šè®¾ç½®ä¸€äº› socket é€‰é¡¹ï¼ˆè¿™æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯ä½ èƒ½åœ¨ä¸Šé¢çš„æœåŠ¡å™¨ä»£ç ä¸­çœ‹åˆ°å®ƒ,åªæ˜¯ä¸ºäº†åœ¨ä½ å†³å®šæ€æ­»æˆ–é‡å¯æœåŠ¡å™¨çš„æ—¶å€™èƒ½å¤Ÿç«‹å³å°±å¯ä»¥ä¸€éåˆä¸€éçš„é‡å¤ä½¿ç”¨ç›¸åŒçš„åœ°å€ï¼‰ã€‚:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
listen_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;ç„¶åï¼ŒæœåŠ¡å™¨ç»‘å®šè¿™ä¸ªåœ°å€. &lt;tt class="docutils literal"&gt;bind&lt;/tt&gt; å‡½æ•°åœ¨ socket ä¸Šåˆ†é…ä¸€ä¸ªæœ¬åœ°åè®®åœ°å€ã€‚å¯¹äº TCP åˆ™æ˜¯ï¼Œè°ƒç”¨ &lt;tt class="docutils literal"&gt;bind&lt;/tt&gt; è®©ä½ æŒ‡å®šä¸€ä¸ªç«¯å£å·ï¼Œä¸€ä¸ª IP åœ°å€ï¼Œè¿™ä¸¤ä¸ªéƒ½è¦æˆ–éƒ½ä¸éœ€è¦æŒ‡å®šã€‚:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
listen_socket.bind(SERVER_ADDRESS)
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;ç„¶åï¼ŒæœåŠ¡å™¨æŠŠè¿™ä¸ª socket è®¾å®šä¸ºä¸€ä¸ªç›‘å¬ socket&lt;/p&gt;
&lt;pre class="literal-block"&gt;
listen_socket.listen(REQUEST_QUEUE_SIZE)
&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸ª &lt;tt class="docutils literal"&gt;listen&lt;/tt&gt; æ–¹æ³•åªéœ€è¦åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œè°ƒç”¨ã€‚
å®ƒå‘Šè¯‰å†…æ ¸ï¼Œå®ƒåº”è¯¥æ¥å—ç›®æ ‡ä¸ºè¿™ä¸ª socket çš„æ¥å…¥è¿æ¥è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·åšä»¥åï¼ŒæœåŠ¡å™¨å°±å¼€å§‹åœ¨ä¸€ä¸ªå¾ªç¯å†…ä¸€æ¬¡æ¥å—æ¥è‡ªä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚
å½“æœ‰ä¸€ä¸ªå¯ç”¨çš„è¿æ¥çš„æ—¶å€™ï¼Œ &lt;tt class="docutils literal"&gt;accept&lt;/tt&gt; è°ƒç”¨è¿”å›è¿æ¥çš„å®¢æˆ·ç«¯çš„å¥—æ¥å­—ã€‚
ç„¶åï¼ŒæœåŠ¡å™¨ä»è¿™ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯çš„å¥—æ¥å­—ä¸­è¯»å–è¯·æ±‚æ•°æ®ï¼Œ
åœ¨å®ƒçš„æ ‡å‡†è¾“å‡ºä¸Šç­”åº”è¿™ä¸ªæ•°æ®ï¼Œç„¶åç»™å®¢æˆ·ç«¯å‘é€å›ä¸€æ¡æ¶ˆæ¯ã€‚
ç„¶åï¼ŒæœåŠ¡å™¨å…³é—­äº†è¿™ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œå®ƒå‡†å¤‡å†æ¬¡å¼€å§‹æ¥å—æ¥çš„æ–°å®¢æˆ·ç«¯çš„è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šè¿‡ TCP/IP è¿›è¡Œé€šä¿¡éœ€è¦åšçš„äº‹æƒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_client_socket_sequence.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_client_socket_sequence.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å®¢æˆ·ç«¯è¿æ¥ä½ çš„æœåŠ¡å™¨ï¼Œå‘é€ä¸€ä¸ªè¯·æ±‚ç„¶åç­”åº”å“åº”çš„ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;

&lt;span class="c"&gt;# create a socket and connect to a server&lt;/span&gt;
&lt;span class="n"&gt;sock&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="c"&gt;# send and receive some data&lt;/span&gt;
&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åˆ›å»ºå®Œå¥—æ¥å­—åï¼Œå®¢æˆ·ç«¯éœ€è¦è¿æ¥æœåŠ¡å™¨. å¯ä»¥é€šè¿‡è°ƒç”¨ &lt;tt class="docutils literal"&gt;connect&lt;/tt&gt; å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
sock.connect(('localhost', 8888))
&lt;/pre&gt;
&lt;p&gt;å®¢æˆ·ç«¯åªéœ€è¦æä¾›æƒ³è¦è¿æ¥çš„æœåŠ¡å™¨çš„è¿œç¨‹ IP åœ°å€æˆ–ä¸»æœºåä»¥åŠè¿œç¨‹ç«¯å£å·å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰è°ƒç”¨ &lt;tt class="docutils literal"&gt;bind&lt;/tt&gt;  å’Œ &lt;tt class="docutils literal"&gt;accept&lt;/tt&gt;ã€‚
å®¢æˆ·ä¸éœ€è¦è°ƒç”¨ &lt;tt class="docutils literal"&gt;bind&lt;/tt&gt; æ˜¯å› ä¸ºå®¢æˆ·ç«¯ä¸å…³ç³»æœ¬åœ° IP åœ°å€å’Œæœ¬åœ°ç«¯å£å·ã€‚
å½“å®¢æˆ·ç«¯è°ƒç”¨ &lt;tt class="docutils literal"&gt;connect&lt;/tt&gt; æ—¶ï¼Œå†…æ ¸é‡Œçš„ TCP/IP åè®®æ ˆä¼šåˆ†é…æœ¬åœ° IP åœ°å€å’Œæœ¬åœ°ç«¯å£å·ã€‚
è¿™ä¸ªæœ¬åœ°ç«¯å£å«åš &lt;strong&gt;ä¸´æ—¶ç«¯å£&lt;/strong&gt; æˆ–è€… çŸ­å‘½ç«¯å£ :)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_ephemeral_port.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_ephemeral_port.png" /&gt;&lt;/p&gt;
&lt;p&gt;æœåŠ¡å™¨ä¸Šçš„ç«¯å£æ ‡è¯†äº†ä¸€ä¸ªçŸ¥å(well-know)æœåŠ¡ï¼Œå®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£å«åšä¸€ä¸ªçŸ¥åç«¯å£ï¼ˆæ¯”å¦‚ï¼ŒHTTP çš„ 80 ç«¯å£ï¼Œ SSH çš„ 22 ç«¯å£ï¼‰ã€‚
èµ·ä¸€ä¸ª Python shell ç„¶åå‘èµ·ä¸€ä¸ªåˆ°ä½ æœ¬åœ°è¿è¡Œçš„æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œ
ç„¶åæŸ¥çœ‹ä¸ºä½ åˆ›å»ºçš„å¥—æ¥å­—åˆ†é…äº†ä»€ä¹ˆæ ·çš„ä¸´æ—¶ç«¯å£ï¼ˆåœ¨å°è¯•ä¸‹é¢çš„ä¾‹å­å‰éœ€è¦å…ˆå¯åŠ¨æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3a.py"&gt;webserver3a.py&lt;/a&gt; æˆ– &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3b.py"&gt;webserver3b.py&lt;/a&gt; ï¼‰ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt;&amp;gt;&amp;gt; import socket
&amp;gt;&amp;gt;&amp;gt; sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
&amp;gt;&amp;gt;&amp;gt; sock.connect(('localhost', 8888))
&amp;gt;&amp;gt;&amp;gt; host, port = sock.getsockname()[:2]
&amp;gt;&amp;gt;&amp;gt; host, port
('127.0.0.1', 60589)
&lt;/pre&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå†…æ ¸ç»™é‚£ä¸ªå¥—æ¥å­—åˆ†é…äº†ä¸€ä¸ªä¸´æ—¶ç«¯å£ 60589ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å›ç­” &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-2-zh-cn.html"&gt;ç¬¬äºŒéƒ¨åˆ†&lt;/a&gt; çš„é—®é¢˜å‰æˆ‘è¿˜éœ€è¦å¿«é€Ÿè®²ä¸€ä¸‹å…¶ä»–ä¸€äº›é‡è¦çš„æ¦‚å¿µã€‚
ä½ å¾ˆå¿«å°±ä¼šçœ‹åˆ°ä¸ºä»€ä¹ˆå®ƒä»¬æ˜¯é‡è¦çš„ã€‚
è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ &lt;em&gt;è¿›ç¨‹&lt;/em&gt; å’Œ &lt;em&gt;æ–‡ä»¶æè¿°ç¬¦&lt;/em&gt; ã€‚&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿä¸€ä¸ªè¿›ç¨‹åªæ˜¯ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºçš„å®ä¾‹ã€‚
æ¯”å¦‚è¯´ï¼Œå½“æœåŠ¡å™¨ä»£ç è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒè¢«åŠ è½½åˆ°å†…å­˜é‡Œï¼Œç„¶åè¿™ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºçš„å®ä¾‹å°±å«åšè¿›ç¨‹ã€‚
å†…æ ¸è®°å½•äº†æœ‰å…³è¿™ä¸ªè¿›ç¨‹çš„ä¸€å¤§ä¸²çš„ä¿¡æ¯â€”â€” æ¯”å¦‚è¿›ç¨‹çš„ ID â€”â€”ä¸ºäº†æ–¹ä¾¿è·Ÿè¸ªè¿™ä¸ªè¿›ç¨‹ã€‚
å½“ä½ è¿è¡Œä½ çš„å¾ªç¯æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3a.py"&gt;webserver3a.py&lt;/a&gt; æˆ– &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3b.py"&gt;webserver3b.py&lt;/a&gt; çš„æ—¶å€™ï¼Œä½ åªæ˜¯è¿è¡Œäº†ä¸€ä¸ªè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_server_process.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_server_process.png" /&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç»ˆç«¯çª—å£ä¸­å¯åŠ¨æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3b.py"&gt;webserver3b.py&lt;/a&gt;  :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3b.py
&lt;/pre&gt;
&lt;p&gt;åœ¨å¦ä¸€ä¸ªä¸åŒçš„ç»ˆç«¯çª—å£ä¸­ä½¿ç”¨ &lt;tt class="docutils literal"&gt;ps&lt;/tt&gt; å‘½ä»¤æ¥è·å–åˆšæ‰é‚£ä¸ªè¿›ç¨‹çš„ä¸€äº›ä¿¡æ¯:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ ps | grep webserver3b | grep -v grep
7182 ttys003    0:00.04 python webserver3b.py
&lt;/pre&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;ps&lt;/tt&gt; å‘½ä»¤å‘Šè¯‰ä½ ä½ ç¡®å®åªæ˜¯è¿è¡Œäº†ä¸€ä¸ª Python è¿›ç¨‹ webserver3b ã€‚
å½“ä¸€ä¸ªè¿›ç¨‹è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œå†…æ ¸ç»™å®ƒåˆ†é…äº†ä¸€ä¸ªè¿›ç¨‹ ID, PIDã€‚
åœ¨ UNIX ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·è¿›ç¨‹åŒæ—¶ä¹Ÿæœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹æœ‰å®ƒè‡ªå·±çš„è¿›ç¨‹ ID å«åšçˆ¶è¿›ç¨‹ ID æˆ–ç¼©å†™ä¸º PPIDã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘å‡å®šä½ è¿è¡Œäº†ä¸€ä¸ª BASH shell ï¼Œç„¶åå½“ä½ å¯ç”¨æœåŠ¡å™¨çš„æ—¶å€™ï¼Œ
ä¸€ä¸ªæ–°çš„è¿›ç¨‹è¢«åˆ›å»ºå¹¶ä¸”æœ‰ä¸€ä¸ª PIDï¼ŒåŒæ—¶å®ƒçš„çˆ¶ PID å…¶å®å°±æ˜¯é‚£ä¸ª BASH shel çš„ PIDã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_ppid_pid.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_ppid_pid.png" /&gt;&lt;/p&gt;
&lt;p&gt;äº²è‡ªè¯•ä¸€ä¸‹ï¼Œç„¶åçœ‹çœ‹å…·ä½“æ˜¯ä»€ä¹ˆæƒ…å†µã€‚
å†æ¬¡å¯åŠ¨ä½ çš„ Python shell ï¼Œè¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œ
ç„¶åé€šè¿‡è°ƒç”¨ &lt;a class="reference external" href="https://docs.python.org/2.7/library/os.html#os.getpid"&gt;os.getpid()&lt;/a&gt; å’Œ &lt;a class="reference external" href="https://docs.python.org/2.7/library/os.html#os.getppid"&gt;os.getppid()&lt;/a&gt; æ¥è·å–è¿™ä¸ª  Python shell è¿›ç¨‹çš„ PID å’Œçˆ¶ PIDï¼ˆä½ çš„ BASH shell çš„ PIDï¼‰ã€‚
ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­è¿è¡Œ &lt;tt class="docutils literal"&gt;ps&lt;/tt&gt; å’Œ &lt;tt class="docutils literal"&gt;grep&lt;/tt&gt; å‘½ä»¤æ¥è·å– PPIDï¼ˆçˆ¶è¿›ç¨‹ IDï¼Œåœ¨æˆ‘çš„è¿™é‡Œæ˜¯ 3148ï¼‰ã€‚
åœ¨ä¸‹é¢çš„æˆªå›¾ä¸­ä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªçˆ¶å­å…³ç³»çš„ä¾‹å­ï¼Œ
å®ƒå±•ç¤ºçš„æ˜¯åœ¨æˆ‘çš„ Mac OS X æœºå™¨ä¸Šå­ Python shell è¿›ç¨‹ä¸çˆ¶ BASH shell è¿›ç¨‹ä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_pid_ppid_screenshot.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_pid_ppid_screenshot.png" /&gt;&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªéå¸¸é‡è¦å¹¶ä¸”éœ€è¦äº†è§£çš„æ¦‚å¿µæ˜¯ &lt;strong&gt;æ–‡ä»¶æè¿°ç¬¦&lt;/strong&gt; ã€‚
é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦å‘¢ï¼Ÿ
ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œ
å½“ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„å¥—æ¥å­—çš„æ—¶å€™ï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªæ­£æ•´æ•°ç»™è¿›ç¨‹ï¼Œè¿™ä¸ªæ­£æ•´æ•°å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚
ä½ å¯èƒ½å¬è¯´è¿‡ï¼Œåœ¨ UNIX ä¸­ä¸€åˆ‡çš†æ–‡ä»¶ã€‚
å†…æ ¸é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ¥ç´¢å¼•ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ã€‚
å½“ä½ éœ€è¦è¯»æˆ–å†™ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä½ éœ€è¦ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥æ ‡è®°å®ƒã€‚
Python ç»™äº†ä½ ä¸€äº›æ›´é«˜çº§åˆ«çš„å¯¹è±¡ç”¨æ¥å¤„ç†æ–‡ä»¶ï¼ˆå’Œå¥—æ¥å­—ï¼‰ï¼Œ
ä½ ä¸éœ€è¦ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥æ ‡è¯†ä¸€ä¸ªæ–‡ä»¶ã€‚
ä¸‹é¢å±•ç¤ºäº†åœ¨ Unix ä¸­æ–‡ä»¶å’Œå¥—æ¥å­—æ˜¯å¦‚ä½•è¢«æ ‡è¯†çš„ï¼šé€šè¿‡å®ƒä»¬çš„æ•´æ•°æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_process_descriptors.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_process_descriptors.png" /&gt;&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒUNIX shell ç»™ä¸€ä¸ªè¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºåˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ 0ï¼Œ
æ ‡å‡†è¾“å…¥çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ 1ï¼Œæ ‡å‡†é”™è¯¯çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ 2ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it_default_descriptors.png" src="/static/images/lsbaws-part3/lsbaws_part3_it_default_descriptors.png" /&gt;&lt;/p&gt;
&lt;p&gt;æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼Œå°½ç®¡ Python ç»™äº†ä½ ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„æ–‡ä»¶æˆ–ç±»æ–‡ä»¶å¯¹è±¡ç”¨æ¥è¿›è¡Œæ“ä½œï¼Œ
ä½ ä¾ç„¶å¯ä»¥ä½¿ç”¨å¯¹è±¡çš„ &lt;tt class="docutils literal"&gt;fileno()&lt;/tt&gt; æ–¹æ³•æ¥è·å–åˆ†é…ç»™è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
è¿”å›åˆ°ä½ çš„ Python shell çœ‹çœ‹ä½ æ€æ ·æ‰èƒ½åšåˆ°è¿™æ ·ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt;&amp;gt;&amp;gt; import sys
&amp;gt;&amp;gt;&amp;gt; sys.stdin
&amp;lt;open file '&amp;lt;stdin&amp;gt;', mode 'r' at 0x102beb0c0&amp;gt;
&amp;gt;&amp;gt;&amp;gt; sys.stdin.fileno()
0
&amp;gt;&amp;gt;&amp;gt; sys.stdout.fileno()
1
&amp;gt;&amp;gt;&amp;gt; sys.stderr.fileno()
2
&lt;/pre&gt;
&lt;p&gt;å½“ä½ åœ¨ Python ä¸­å¤„ç†æ–‡ä»¶å’Œå¥—æ¥å­—çš„æ—¶å€™ï¼Œä½ é€šå¸¸éœ€è¦ä½¿ç”¨ä¸€ä¸ªé«˜çº§åˆ«çš„
file/socket å¯¹è±¡ã€‚
ä½†æ˜¯åœ¨è¿™é‡Œä½ å¯èƒ½éœ€è¦å¤šæ¬¡ç›´æ¥ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ã€‚
ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ä¸€ä¸ª &lt;a class="reference external" href="https://docs.python.org/2.7/library/os.html#os.write"&gt;write&lt;/a&gt; ç³»ç»Ÿå¹¶æŠŠæ–‡ä»¶æè¿°ç¬¦æ­£æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°
çš„æ–¹å¼æ¥å†™å…¥ä¸€ä¸ªå­—ç¬¦ä¸²åˆ°æ ‡å‡†è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt;&amp;gt;&amp;gt; import sys
&amp;gt;&amp;gt;&amp;gt; import os
&amp;gt;&amp;gt;&amp;gt; res = os.write(sys.stdout.fileno(), 'hello\n')
hello
&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œæ˜¯ä¸ªéå¸¸æœ‰æ„æ€çš„åœ°æ–¹â€”â€”è¿™åº”è¯¥ä¸ä¼šè®©ä½ æ„Ÿåˆ°ç‰¹åˆ«çš„æƒŠè®¶ï¼Œå› ä¸ºä½ å·²ç»çŸ¥é“åœ¨ UNIX
ä¸­ä¸‡ç‰©çš†æ–‡ä»¶â€”â€”ä½ çš„å¥—æ¥å­—ä¹Ÿæœ‰ä¸€ä¸ªåˆ†é…ç»™å®ƒçš„æ–‡ä»¶æè¿°ç¬¦ã€‚
åœ¨è¯´ä¸€éï¼Œå½“ä½ åœ¨ Python ä¸­åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—çš„æ—¶å€™ï¼Œ
ä½ å¾—åˆ°äº†ä¸€ä¸ªå¯¹è±¡å’Œä¸€ä¸ªæ­£æ•´æ•°ï¼Œ
ä½ ä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥è®¿é—®æˆ‘ä¹‹å‰æè¿‡çš„ &lt;tt class="docutils literal"&gt;fileno()&lt;/tt&gt; æ–¹æ³•çš„æ–¹å¼å¾—åˆ°è¿™ä¸ªå¥—æ¥å­—çš„æ•´æ•°æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt;&amp;gt;&amp;gt; import socket
&amp;gt;&amp;gt;&amp;gt; sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
&amp;gt;&amp;gt;&amp;gt; sock.fileno()
3
&lt;/pre&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä»¶éœ€è¦æåŠçš„äº‹æƒ…æ˜¯ï¼šåœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­çš„å¾ªç¯æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3b.py"&gt;webserver3b.py&lt;/a&gt; ä¸­ä½ å·²ç»çŸ¥é“äº†ï¼Œå½“æœåŠ¡å™¨è¿›ç¨‹æ­£åœ¨ä¼‘çœ  60 ç§’çš„æ—¶å€™ï¼Œä½ ä»ç„¶èƒ½å¤Ÿç”¨ç¬¬äºŒä¸ª &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘½ä»¤è¿æ¥æœåŠ¡å™¨å—ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œåªæ˜¯ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å°†ä¸ä¼šç«‹å³è¾“å‡ºä»»ä½•ä¿¡æ¯ï¼Œå®ƒåªæ˜¯ä¼šé˜»å¡åœ¨é‚£é‡Œã€‚
ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆå½“æ—¶æœåŠ¡å™¨å¹¶æ²¡æœ‰åœ¨ &lt;tt class="docutils literal"&gt;accept&lt;/tt&gt; æ¥å—ä¸€ä¸ªè¿æ¥ï¼Œè€Œå®¢æˆ·ç«¯å´æ²¡æœ‰ç«‹å³è¢«æ‹’ç»è¿æ¥ï¼Œå´ä¾ç„¶èƒ½å¤Ÿè¿æ¥æœåŠ¡å™¨ï¼Ÿ
ç­”æ¡ˆæ˜¯å¥—æ¥å­—å¯¹è±¡çš„ &lt;tt class="docutils literal"&gt;listen&lt;/tt&gt; æ–¹æ³•ä»¥åŠå®ƒçš„  &lt;tt class="docutils literal"&gt;BACKLOG&lt;/tt&gt; å‚æ•°ï¼Œåœ¨ä»£ç é‡Œé¢æˆ‘è°ƒç”¨çš„æ˜¯ &lt;tt class="docutils literal"&gt;REQUEST_QUEUE_SIZE&lt;/tt&gt; ã€‚
&lt;tt class="docutils literal"&gt;BACKLOG&lt;/tt&gt; å‚æ•°æŒ‡å®šäº†å†…æ ¸ä¸­æ¥å…¥è¿æ¥è¯·æ±‚çš„é˜Ÿåˆ—å¤§å°ã€‚
å½“æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3b.py"&gt;webserver3b.py&lt;/a&gt; æ­£åœ¨ä¼‘çœ çš„æ—¶å€™ï¼Œä½ å¯ä»¥ç”¨ç¬¬äºŒä¸ª &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘½ä»¤
è¿æ¥æœåŠ¡å™¨ï¼Œæ˜¯å› ä¸ºå†…æ ¸ä¸­ç”¨äºè¯¥æœåŠ¡å™¨å¥—æ¥å­—çš„æ¥å…¥è¿æ¥è¯·æ±‚é˜Ÿåˆ—è¿˜æœ‰è¶³å¤Ÿçš„å¯ç”¨ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶åŠ å¤§ &lt;tt class="docutils literal"&gt;BACKLOG&lt;/tt&gt; å‚æ•°çš„å€¼å¹¶ä¸èƒ½æŠŠä½ çš„æœåŠ¡å™¨å˜æˆä¸€ä¸ªå¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚çš„æœåŠ¡å™¨ï¼Œä½†æ˜¯ï¼Œå¯¹äºéå¸¸ç¹å¿™çš„æœåŠ¡å™¨æ¥è¯´ï¼Œæœ‰ä¸€ä¸ªè¶³å¤Ÿå¤§
çš„ backlog å‚æ•°æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™æ · &lt;tt class="docutils literal"&gt;accept&lt;/tt&gt; è°ƒç”¨å°±ä¸ç”¨ç­‰å¾…æœ‰æ–°çš„è¿æ¥è¢«å»ºç«‹ï¼Œå¯ä»¥ç›´æ¥ä»é˜Ÿåˆ—ä¸­æ‹¿å–æ–°çš„è¿æ¥ï¼Œç„¶åå¼€å§‹æ²¡æœ‰å»¶æ—¶çš„å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å“‡å“¦ï¼ä½ å·²ç»äº†è§£åˆ°å¾ˆå¤šçŸ¥è¯†äº†ã€‚è®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹ä½ ç›®å‰è¯´å­¦åˆ°çš„ä¸œè¥¿ï¼ˆ
å¦‚æœè¿™äº›ä½ éƒ½éå¸¸ç†Ÿæ‚‰çš„è¯ï¼Œé‚£å°±å†åŠ æ·±ä¸€ä¸‹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_checkpoint.png" src="/static/images/lsbaws-part3/lsbaws_part3_checkpoint.png" /&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;å¾ªç¯æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ socket åˆ›å»ºé¡ºåºï¼ˆsocket, bind, listen, acceptï¼‰&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯é“¾æ¥åˆ›å»ºé¡ºåºï¼ˆsocket, connectï¼‰&lt;/li&gt;
&lt;li&gt;å¥—æ¥å­—å¯¹&lt;/li&gt;
&lt;li&gt;å¥—æ¥å­—&lt;/li&gt;
&lt;li&gt;ä¸´æ—¶ç«¯å£å’ŒçŸ¥åç«¯å£&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹ IDï¼ˆPIDï¼‰ï¼Œçˆ¶è¿›ç¨‹ IDï¼ˆPPIDï¼‰ï¼Œä»¥åŠçˆ¶å­å…³ç³»ã€‚&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;listen&lt;/tt&gt; socket æ–¹æ³•çš„ &lt;tt class="docutils literal"&gt;BACKLOG&lt;/tt&gt; å‚æ•°çš„å«ä¹‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘å·²ç»å‡†å¤‡å·å›ç­” &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-2-zh-cn.html"&gt;ç¬¬äºŒéƒ¨åˆ†&lt;/a&gt; çš„é—®é¢˜äº†ï¼šâ€œå¦‚ä½•è®©ä½ çš„æœåŠ¡å™¨åœ¨åŒä¸€æ—¶åˆ»
å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Ÿâ€ æˆ–è€…æ¢ä¸€ç§æ–¹å¼â€œå¦‚ä½•å†™ä¸€ä¸ªå¹¶å‘æœåŠ¡å™¨ï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc2_service_clients.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc2_service_clients.png" /&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ Unix ä¸‹å†™ä¸€ä¸ªå¹¶å‘æœåŠ¡å™¨çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ &lt;a class="reference external" href="https://docs.python.org/2.7/library/os.html#os.fork"&gt;fork()&lt;/a&gt; ç³»ç»Ÿè°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_fork.png" src="/static/images/lsbaws-part3/lsbaws_part3_fork.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªæ–°çš„å¹¶å‘æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3c.py"&gt;webserver3c.py&lt;/a&gt; çš„ä»£ç ï¼Œè¿™ä¸ªæœåŠ¡å™¨èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼ˆåŒä¸Šä¸€ä¸ªæœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3b.py"&gt;webserver3b.py&lt;/a&gt; ä¸€æ ·ï¼Œæ¯ä¸ªå­è¿›ç¨‹éƒ½ä¼šä¼‘æ¯ 60 ç§’ ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_it2.png" src="/static/images/lsbaws-part3/lsbaws_part3_it2.png" /&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="c"&gt;# Concurrent server - webserver3c.py                                      #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                         #&lt;/span&gt;
&lt;span class="c"&gt;# Tested with Python 2.7.9 &amp;amp; Python 3.4 on Ubuntu 14.04 &amp;amp; Mac OS X        #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                         #&lt;/span&gt;
&lt;span class="c"&gt;# - Child process sleeps for 60 seconds after handling a client&amp;#39;s request #&lt;/span&gt;
&lt;span class="c"&gt;# - Parent and child processes close duplicate descriptors                #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                         #&lt;/span&gt;
&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;
&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;Child PID: {pid}. Parent PID {ppid}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getpid&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
            &lt;span class="n"&gt;ppid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getppid&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
    &lt;span class="n"&gt;http_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s"&gt;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class="s"&gt;Hello, World!&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Serving HTTP on port {port} ...&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Parent PID (PPID): {pid}&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getpid&lt;/span&gt;&lt;span class="p"&gt;()))&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client_address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# child&lt;/span&gt;
            &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# close child copy&lt;/span&gt;
            &lt;span class="n"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# child exits here&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# parent&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# close parent copy and loop over&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åœ¨æ·±å…¥è®¨è®º fork æ˜¯å¦‚ä½•å·¥ä½œå‰ï¼Œå…ˆè¯•ä¸€ä¸‹å§ï¼Œçœ‹çœ‹æœåŠ¡å™¨æ˜¯å¦çœŸçš„èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œ
è€Œä¸æ˜¯æƒ³å®ƒçš„åŒèƒ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3a.py"&gt;webserver3a.py&lt;/a&gt; å’Œ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3b.py"&gt;webserver3b.py&lt;/a&gt; é‚£æ ·æ— æ³•å¤„ç†ã€‚
åœ¨å‘½ä»¤è¡Œä¸‹ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3c.py
&lt;/pre&gt;
&lt;p&gt;ç„¶åå°è¯•ä½ ä¹‹å‰è¯•è¿‡çš„é‚£ä¸¤æ¡åŒæ ·çš„å‘½ä»¤ï¼Œç°åœ¨å°½ç®¡æœåŠ¡å™¨çš„å­è¿›ç¨‹åœ¨æœåŠ¡äº†ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚åä¼šä¼‘çœ  60 ç§’ï¼Œä½†æ˜¯ä»ç„¶ä¸
å½±å“å…¶å®ƒçš„å®¢æˆ·ç«¯ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”±å®Œå…¨æ²¡æœ‰ä¾èµ–çš„ä¸åŒè¿›ç¨‹æœåŠ¡çš„ã€‚ä½ å¯ä»¥çœ‹åˆ°ä½ çš„ curl å‘½ä»¤ç«‹å³è¾“å‡ºäº† â€œHello, World!â€ï¼Œ
ç„¶åå¡ä½äº† 60 ç§’ã€‚ä½ å¯ä»¥ç»§ç»­æ‰§è¡Œ n æ¡ curl å‘½ä»¤ï¼ˆå—¯ï¼Œå·®ä¸å¤šæ˜¯ä½ æƒ³æ‰§è¡Œå¤šå°‘å°±å¤šå°‘ï¼‰æ‰€æœ‰çš„è¿™äº›å‘½ä»¤éƒ½å°†ç«‹å³è¾“å‡ºæœåŠ¡å™¨çš„å“åº”â€œHello, Worldâ€ï¼Œæ²¡æœ‰è‚‰çœ¼å¯è§çš„å»¶è¿Ÿã€‚è¯•è¯•å§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç†è§£ &lt;a class="reference external" href="https://docs.python.org/2.7/library/os.html#os.fork"&gt;fork()&lt;/a&gt; æœ‰ä¸€ç‚¹å¾ˆé•¿çš„é‡è¦é‚£å°±æ˜¯ï¼Œä½ è°ƒç”¨äº†ä¸€æ¬¡ fork ä½†æ˜¯å®ƒè¿”å›äº†ä¸¤æ¬¡ï¼šä¸€æ¬¡åœ¨çˆ¶è¿›ç¨‹ï¼Œä¸€æ¬¡åœ¨å­è¿›ç¨‹ã€‚
å½“ä½  fork ä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œè¿”å›ç»™å­è¿›ç¨‹çš„è¿›ç¨‹ ID æ˜¯ 0ã€‚å½“ fork åœ¨çˆ¶è¿›ç¨‹ä¸­è¿”å›æ—¶ï¼Œå®ƒè¿”å›çš„æ˜¯å­è¿›ç¨‹çš„ PIDã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc2_how_fork_works.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc2_how_fork_works.png" /&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»ç„¶è®°å¾—å½“æˆ‘ç¬¬ä¸€æ¬¡ç ”ç©¶ fork å¹¶å°è¯•å®ƒçš„æ—¶å€™æˆ‘æœ‰å¤šä¹ˆçš„ç€è¿·ã€‚å®ƒå¯¹æˆ‘çœ‹èµ·æ¥å°±åƒé­”æ³•ä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å½“æ—¶æ­£åœ¨é˜…è¯»ä¸€æ®µè¿ç»­çš„ä»£ç ï¼Œç„¶åâ€œå˜­ï¼â€ï¼šé‚£æ®µä»£ç å…‹éš†äº†å®ƒè‡ªå·±ï¼Œç°åœ¨åŒæ—¶è¿è¡Œäº†ä¸¤ä¸ªå…·æœ‰ç›¸åŒä»£ç çš„å®ä¾‹ã€‚
æˆ‘å½“æ—¶çœŸçš„è®¤ä¸ºè¿™å°±æ˜¯é­”æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªçˆ¶è¿›ç¨‹ fork ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹æ—¶ï¼Œå­è¿›ç¨‹è·å¾—äº†ä¸€ä»½çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦çš„æ‹·è´ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc2_shared_descriptors.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc2_shared_descriptors.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½å·²ç»çœ‹åˆ°äº†ï¼Œåœ¨ä¸Šé¢ä»£ç ä¸­çˆ¶è¿›ç¨‹å…³é—­äº†å®¢æˆ·ç«¯è¿æ¥ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
else:  # parent
    client_connection.close()  # close parent copy and loop over
&lt;/pre&gt;
&lt;p&gt;å¦‚æœçˆ¶è¿›ç¨‹å·²ç»å…³æ‰äº†è¿™ä¸ª socket é‚£ä¹ˆå­è¿›ç¨‹æ˜¯æ€ä¹ˆåšä»ç„¶å¯ä»¥ä»å®¢æˆ·ç«¯ socet ä¸­è¯»å–åˆ°æ•°æ®å‘¢ï¼Ÿ
ç­”æ¡ˆå°±åœ¨ä¸Šå›¾æ€»ã€‚å†…æ ¸ä½¿ç”¨æè¿°ç¬¦å¼•ç”¨è®¡æ•°æ¥å†³å®šæ˜¯å¦éœ€è¦å…³é—­ä¸€ä¸ª socketã€‚
åªæœ‰å½“æŸä¸ª socket çš„æè¿°ç¬¦å¼•ç”¨è®¡æ•°å˜æˆ 0 çš„æ—¶å€™æ‰ä¼šå…³é—­è¿™ä¸ª socketã€‚
å½“ä½ çš„æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹çš„æ—¶å€™ï¼Œå­è¿›ç¨‹è·å¾—äº†çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦æ‹·è´ï¼Œå†…æ ¸å°†è¿™äº›æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°ä¹Ÿç›¸åº”çš„å¢åŠ äº†ã€‚
åœ¨æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹å’Œä¸€ä¸ªå­è¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œå…³è”è€…å®¢æˆ·ç«¯ socket çš„æè¿°ç¬¦å¼•ç”¨è®¡æ•°å°±ä¼šæ˜¯ 2ï¼Œ
å½“çˆ¶è¿›ç¨‹æƒ³åœ¨ä¸Šé¢çš„ä»£ç ä¸­é‚£æ ·å…³é—­äº†å®¢æˆ·ç«¯ socket é“¾æ¥çš„æ—¶å€™ï¼Œå¼•ç”¨è®¡æ•°å°±ä¼šå‡å°‘å˜æˆ 1ï¼Œä½†æ˜¯
ä»ç„¶è¿˜æ²¡è¾¾åˆ°è®©å†…æ ¸å…³é—­è¿™ä¸ª socket çš„æ¡ä»¶ã€‚
å­è¿›ç¨‹ä¹Ÿéœ€è¦å…³é—­æ¥è‡ªçˆ¶è¿›ç¨‹ç›‘å¬çš„ socket æ‹·è´ï¼Œå› ä¸ºå­è¿›ç¨‹ä¸å…³å¿ƒæ¥æ”¶æ–°çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œ
å®ƒåªå…³å¿ƒå¤„ç†æ¥è‡ªå·²å»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯è¿æ¥ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
listen_socket.close()  # close child copy
&lt;/pre&gt;
&lt;p&gt;æˆ‘å°†ä¼šåœ¨ç¨åè®²è¿°å¦‚æœä½ ä¸å…³é—­æè¿°ç¬¦å‰¯æœ¬æ—¶è¯ä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¦‚ä½ åœ¨è¿™ä¸ªå¹¶å‘æœåŠ¡å™¨æºç ä¸­è¯´å‘ç°çš„é‚£æ ·ï¼ŒæœåŠ¡å™¨çš„çˆ¶è¿›ç¨‹ç°åœ¨åªæœ‰ä¸€ä¸ªè§’è‰²ï¼Œé‚£å°±æ˜¯
æ¥æ”¶ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œ fork ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ç”¨æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œç„¶åå¾ªç¯ä»¥ä¾¿æ¥æ”¶å¦ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œ
æ²¡æœ‰å…¶ä»–å¤šä½™çš„äº‹æƒ…äº†ã€‚æœåŠ¡å™¨çš„çˆ¶è¿›ç¨‹ä¸ä¼šå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ â€”â€” å®ƒçš„å­è¿›ç¨‹ä¼šå»å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;è¯´ç‚¹é¢å¤–çš„äº‹æƒ…ã€‚å½“æˆ‘ä»¬è¯´ä¸¤ä¸ªäº‹ä»¶æ˜¯å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œå…·ä½“è¯´çš„æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc2_concurrent_events.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc2_concurrent_events.png" /&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬è¯´ä¸¤ä¸ªäº‹ä»¶æ˜¯å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œé€šå¸¸æˆ‘ä»¬çš„æ„æ€æ˜¯ï¼Œå®ƒä»¬æ˜¯åŒæ—¶å‘ç”Ÿçš„ã€‚
ç®€çŸ­çš„å®šä¹‰å½“ç„¶éå¸¸å¥½ï¼Œä½†æ˜¯ä½ ä¹Ÿåº”è¯¥è®°ä½å¤æ‚çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
å¦‚æœä½ æ²¡æ³•é€šè¿‡è§‚å¯Ÿç¨‹åºæ¥çŸ¥é“å“ªä¸ªæ˜¯å…ˆæ‰§è¡Œçš„ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªäº‹ä»¶å°±æ˜¯å¹¶å‘æ‰§è¡Œçš„ã€‚&lt;a class="footnote-reference" href="#id4" id="id2"&gt;[2]&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;åˆåˆ°äº†æ¦‚å†µä½ ç›®å‰æ‰€å­¦çŸ¥è¯†çš„æ—¶é—´äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_checkpoint.png" src="/static/images/lsbaws-part3/lsbaws_part3_checkpoint.png" /&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;åœ¨ Unix ä¸‹å†™å¹¶å‘æœåŠ¡å™¨çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯è°ƒç”¨ç³»ç»Ÿå†…çš„ &lt;a class="reference external" href="https://docs.python.org/2.7/library/os.html#os.fork"&gt;fork()&lt;/a&gt; æ–¹æ³•&lt;/li&gt;
&lt;li&gt;å½“ä¸€ä¸ªè¿›ç¨‹ fork äº†ä¸€ä¸ªæ–°çš„è¿›ç¨‹çš„æ—¶å€™ï¼Œå®ƒå°±å˜æˆäº†é‚£ä¸ªæ–° fork çš„å­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è°ƒç”¨ fork åçˆ¶å­è¿›ç¨‹å…±äº«ç›¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;å†…æ ¸ä½¿ç”¨æè¿°ç¬¦å¼•ç”¨è®¡æ•°æ¥å†³å®šæ˜¯å¦éœ€è¦å…³é—­æ–‡ä»¶/socket&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨çš„çˆ¶è¿›ç¨‹ç°åœ¨åªæœ‰ä¸€ä¸ªè§’è‰²ï¼Œé‚£å°±æ˜¯æ¥æ”¶ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œ fork ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ç”¨æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œç„¶åå¾ªç¯ä»¥ä¾¿æ¥æ”¶å¦ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨çˆ¶å­è¿›ç¨‹ä¸­å…³é—­ socket æè¿°ç¬¦å‰¯æœ¬ä¼šå‘ç”Ÿä»€ä¹ˆã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªä¿®æ”¹ç‰ˆçš„å¹¶å‘æœåŠ¡å™¨ï¼Œå®ƒæ²¡æœ‰å…³é—­æè¿°ç¬¦å‰¯æœ¬ï¼Œ
&lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3d.py"&gt;webserver3d.py&lt;/a&gt; ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="c"&gt;# Concurrent server - webserver3d.py                                      #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                         #&lt;/span&gt;
&lt;span class="c"&gt;# Tested with Python 2.7.9 &amp;amp; Python 3.4 on Ubuntu 14.04 &amp;amp; Mac OS X        #&lt;/span&gt;
&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;

&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;
&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;http_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s"&gt;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class="s"&gt;Hello, World!&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Serving HTTP on port {port} ...&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="n"&gt;clients&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client_address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="c"&gt;# store the reference otherwise it&amp;#39;s garbage collected&lt;/span&gt;
        &lt;span class="c"&gt;# on the next loop run&lt;/span&gt;
        &lt;span class="n"&gt;clients&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# child&lt;/span&gt;
            &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# close child copy&lt;/span&gt;
            &lt;span class="n"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# child exits here&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# parent&lt;/span&gt;
            &lt;span class="c"&gt;# client_connection.close()&lt;/span&gt;
            &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clients&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç”¨ä»¥ä¸‹æ–¹å¼å¯åŠ¨æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3d.py
&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘½ä»¤æ¥è¿æ¥æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ curl http://localhost:8888/hello
Hello, World!
&lt;/pre&gt;
&lt;p&gt;å¥½äº†ï¼Œcurl æ‰“å°äº†æ¥è‡ªå¹¶å‘æœåŠ¡å™¨çš„å“åº”ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰ç«‹å³é€€å‡ºè€Œæ˜¯å¡ä½é‚£å„¿äº†ã€‚
å‘ç”Ÿä»€ä¹ˆäº‹æƒ…äº†ï¼ŸæœåŠ¡å™¨ä¸å†ä¼‘æ¯ 60 äº†ï¼šå®ƒçš„å­è¿›ç¨‹è¿˜åœ¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œ
å…³é—­å®¢æˆ·ç«¯è¿æ¥ç„¶åé€€å‡ºï¼Œä½†æ˜¯å®¢æˆ·ç«¯ curl ä»ç„¶æ²¡æœ‰é€€å‡ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc3_child_is_active.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc3_child_is_active.png" /&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ curl æ²¡æœ‰é€€å‡ºå‘¢ï¼ŸåŸå› å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦å‰¯æœ¬ã€‚
å½“å­è¿›ç¨‹å…³é—­å®¢æˆ·ç«¯è¿æ¥çš„æ—¶å€™ï¼Œå†…æ ¸å‡å°‘äº†é‚£ä¸ªå®¢æˆ·ç«¯ socket çš„å¼•ç”¨è®¡æ•°ï¼Œæ­¤æ—¶è®¡æ•°å˜æˆäº† 1ã€‚
è™½ç„¶æœåŠ¡å™¨çš„å­è¿›ç¨‹é€€å‡ºäº†ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ socket å¹¶æ²¡æœ‰è¢«å†…æ ¸å…³é—­ï¼Œå› ä¸ºæ­¤æ—¶è¯¥ socket æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°è¿˜ä¸æ˜¯ 0ï¼Œ
ç»“æœç»ˆæ­¢åŒ…ï¼ˆåœ¨ TCP/IP ä¸­è¢«å«åš FINï¼‰å¹¶æ²¡æœ‰è¢«å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå¯ä»¥è¯´æ˜¯å®¢æˆ·ç«¯å°±ä¼šä¸€ç›´åœ¨çº¿ã€‚
è¿™é‡Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœä½ çš„é•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡å™¨æ²¡æœ‰å…³é—­æ–‡ä»¶æè¿°ç¬¦å‰¯æœ¬çš„è¯ï¼Œ
å®ƒæœ€ç»ˆå°†ç”¨å°½æ‰€æœ‰å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc3_out_of_descriptors.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc3_out_of_descriptors.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ ctrl + c åœæ­¢ä½ çš„æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3d.py"&gt;webserver3d.py&lt;/a&gt; ï¼Œç„¶åé€šè¿‡åœ¨ shell ä¸­è¾“å…¥å†…ç½®çš„ &lt;tt class="docutils literal"&gt;ulimit&lt;/tt&gt; å‘½ä»¤æ¥æŸ¥çœ‹æœåŠ¡å™¨è¿›ç¨‹é»˜è®¤å¯ç”¨çš„èµ„æºï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ ulimit -a
core file size          (blocks, -c) 0
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 0
file size               (blocks, -f) unlimited
pending signals                 (-i) 3842
max locked memory       (kbytes, -l) 64
max memory size         (kbytes, -m) unlimited
open files                      (-n) 1024
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 8192
cpu time               (seconds, -t) unlimited
max user processes              (-u) 3842
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited
&lt;/pre&gt;
&lt;p&gt;æ­£å¦‚ä½ åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼ŒæœåŠ¡å™¨è¿›ç¨‹åœ¨æˆ‘çš„ Ubuntu ä¸Šæœ€å¤§å¯æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆopen filesï¼‰æ•°ç›®æ˜¯ 1024ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚æœä½ çš„æœåŠ¡å™¨æ²¡æœ‰å…³é—­æè¿°ç¬¦å‰¯æœ¬ï¼Œå®ƒæ˜¯æ€ä¹ˆæ ·ç”¨å°½å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦çš„ã€‚
åœ¨ä¸€ä¸ªå·²æœ‰çš„æˆ–æ–°å¼€çš„ç»ˆç«¯çª—å£ä¸­ï¼Œè®¾ç½®æœ€å¤§å¯æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°ç›®ä¸º 256ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ ulimit -n 256
&lt;/pre&gt;
&lt;p&gt;åœ¨ä½ åˆšæ‰§è¡Œ &lt;tt class="docutils literal"&gt;$ ulimit &lt;span class="pre"&gt;-n&lt;/span&gt; 256&lt;/tt&gt; å‘½ä»¤çš„é‚£ä¸ªç»ˆç«¯ä¸­å¯åŠ¨æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3d.py"&gt;webserver3d.py&lt;/a&gt; :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3d.py
&lt;/pre&gt;
&lt;p&gt;ç„¶åä½¿ç”¨ä¸‹é¢çš„å®¢æˆ·ç«¯ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/client3.py"&gt;client3.py&lt;/a&gt; æµ‹è¯•è¿™ä¸ªæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#####################################################################&lt;/span&gt;
&lt;span class="c"&gt;# Test client - client3.py                                          #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                   #&lt;/span&gt;
&lt;span class="c"&gt;# Tested with Python 2.7.9 &amp;amp; Python 3.4 on Ubuntu 14.04 &amp;amp; Mac OS X  #&lt;/span&gt;
&lt;span class="c"&gt;#####################################################################&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;argparse&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;errno&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;


&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;
&lt;span class="n"&gt;REQUEST&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s"&gt;GET /hello HTTP/1.1&lt;/span&gt;
&lt;span class="s"&gt;Host: localhost:8888&lt;/span&gt;

&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_clients&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_conns&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;socks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;client_num&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_clients&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;connection_num&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_conns&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="n"&gt;sock&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;REQUEST&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="n"&gt;socks&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;connection_num&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;parser&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;argparse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ArgumentParser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Test client for LSBAWS.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;formatter_class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;argparse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ArgumentDefaultsHelpFormatter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;--max-conns&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Maximum number of connections per client.&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;--max-clients&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Maximum number of clients.&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;args&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse_args&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max_clients&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max_conns&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ä¸­ï¼Œå¯åŠ¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/client3.py"&gt;client3.py&lt;/a&gt; å¹¶å‘Šè¯‰å®ƒåŒæ—¶åˆ›å»º 300 ä¸ªè¿æ¥åˆ°æœåŠ¡å™¨çš„è¿æ¥ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python client3.py --max-clients=300
&lt;/pre&gt;
&lt;p&gt;å¾ˆå¿«ä½ çš„æœåŠ¡å™¨å°±ä¼šçˆ†ç‚¸ã€‚ä¸‹é¢æ˜¯æˆ‘æœºå­ä¸Šçš„å¼‚å¸¸ä¿¡æ¯çš„æˆªå›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc3_too_many_fds_exc.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc3_too_many_fds_exc.png" /&gt;&lt;/p&gt;
&lt;p&gt;æ•™è®­å·²ç»éå¸¸æ¸…æ™°äº†â€”â€”ä½ çš„æœåŠ¡å™¨åº”è¯¥å…³é—­æè¿°ç¬¦å‰¯æœ¬ã€‚ä½†æ˜¯ï¼Œå°±ç®—ä½ å…³é—­äº†æè¿°ç¬¦å‰¯æœ¬ï¼Œ
ä½ ä»ç„¶è¿˜æ²¡æœ‰è·³å‡ºä¸›æ—ï¼Œå› ä¸ºä½ çš„æœåŠ¡å™¨è¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯åƒµå°¸è¿›ç¨‹ï¼&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc3_zombies.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc3_zombies.png" /&gt;&lt;/p&gt;
&lt;p&gt;æ˜¯çš„ï¼Œä½ çš„æœåŠ¡å™¨ä»£ç å®é™…ä¸Šåˆ›å»ºäº†ä¸€äº›åƒµå°¸è¿›ç¨‹ã€‚
è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ˜¯æ€ä¹ˆå›äº‹ã€‚å†æ¬¡å¯åŠ¨ä½ çš„æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3d.py
&lt;/pre&gt;
&lt;p&gt;åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­æ‰§è¡Œä¸‹é¢çš„ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ curl http://localhost:8888/hello
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨ä½¿ç”¨ ps å‘½ä»¤æ¥æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„ Python è¿›ç¨‹ã€‚
ä¸‹é¢æ˜¯æˆ‘çš„ Ubuntu ä¸Šçš„ &lt;tt class="docutils literal"&gt;ps&lt;/tt&gt; å‘½ä»¤è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ ps auxw | grep -i python | grep -v grep
vagrant   9099  0.0  1.2  31804  6256 pts/0    S+   16:33   0:00 python webserver3d.py
vagrant   9102  0.0  0.0      0     0 pts/0    Z+   16:33   0:00 [python] &amp;lt;defunct&amp;gt;
&lt;/pre&gt;
&lt;p&gt;ä½ æœ‰æ³¨æ„åˆ°ç¬¬äºŒè¡Œå—ï¼Ÿä¸Šé¢è¯´è¿›ç¨‹ PID ä¸º 9102 çš„è¿›ç¨‹çŠ¶æ€æ˜¯ &lt;strong&gt;Z+&lt;/strong&gt; ï¼Œè¿›ç¨‹åç§°æ˜¯ &lt;strong&gt;&amp;lt;defunct&amp;gt;&lt;/strong&gt; ã€‚
è¿™å°±æ˜¯æˆ‘ä»¬çš„åƒµå°¸è¿›ç¨‹äº†ã€‚åƒµå°¸è¿›ç¨‹çš„é—®é¢˜æ˜¯ä½ æ²¡æ³•æ€æ­»å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc3_kill_zombie.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc3_kill_zombie.png" /&gt;&lt;/p&gt;
&lt;p&gt;å°±ç®—ä½ æƒ³å°è¯•é€šè¿‡ä½¿ç”¨ &lt;tt class="docutils literal"&gt;$ kill &lt;span class="pre"&gt;-9&lt;/span&gt;&lt;/tt&gt; çš„æ–¹å¼æ¥æ€æ­»åƒµå°¸è¿›ç¨‹ä¹Ÿæ²¡æœ‰ç”¨ï¼Œå®ƒä»¬ä»ç„¶èƒ½å¤Ÿæ´»ä¸‹æ¥ã€‚ä½ å¯ä»¥è‡ªå·±è¯•è¯•çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;åƒµå°¸è¿›ç¨‹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æœåŠ¡å™¨ä¼šåˆ›å»ºå®ƒä»¬ï¼Ÿ
åƒµå°¸è¿›ç¨‹æ˜¯æŒ‡ä¸€ä¸ªå·²ç»ç»ˆæ­¢äº†çš„è¿›ç¨‹ï¼Œä½†æ˜¯å®ƒçš„çˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰ç­‰å¾…å®ƒï¼Œä¹Ÿæ²¡æœ‰æ”¶åˆ°å®ƒçš„ç»ˆæ­¢çŠ¶æ€ã€‚
å½“ä¸€ä¸ªå­è¿›ç¨‹åœ¨å®ƒçš„çˆ¶è¿›ç¨‹ä¹‹å‰é€€å‡ºæ—¶ï¼Œå†…æ ¸ä¼šæŠŠè¿™ä¸ªå­è¿›ç¨‹è½¬æ¢ä¸ºåƒµå°¸è¿›ç¨‹ï¼ŒåŒæ—¶å­˜å‚¨è¯¥è¿›ç¨‹çš„ä¸€ä¸‹ä¿¡æ¯æ–¹ä¾¿å®ƒçš„çˆ¶è¿›ç¨‹ä¹‹åæ¥æ¢å¤å®ƒã€‚
å­˜å‚¨çš„ä¿¡æ¯é€šå¸¸åŒ…æ‹¬è¿›ç¨‹ ID,è¿›ç¨‹ç»ˆæ­¢çŠ¶æ€ï¼Œä»¥åŠè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚
å¥½çš„ï¼Œå› æ­¤åƒµå°¸è¿›ç¨‹æœåŠ¡ä¸€ä¸ªç‰¹æ®Šçš„ç›®çš„ï¼Œä½†æ˜¯å¦‚æœä½ çš„æœåŠ¡å™¨æ²¡æœ‰ç…§é¡¾å¥½è¿™äº›åƒµå°¸è¿›ç¨‹çš„è¯ï¼Œä½ çš„ç³»ç»Ÿå°†ä¼šå˜å¾—æ‹¥å µä¸å ªã€‚
è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ã€‚
é¦–å…ˆï¼Œåœæ­¢ä½ æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨ï¼Œç„¶ååœ¨ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£æ€»ï¼Œä½¿ç”¨ &lt;tt class="docutils literal"&gt;ulimit&lt;/tt&gt; å‘½ä»¤è®¾ç½® max user processes ä¸º 400ï¼ˆç¡®ä¿è®¾ç½®çš„ open files è¶³å¤Ÿé«˜ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º 500ï¼‰ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ ulimit -u 400$ ulimit -n 500
&lt;/pre&gt;
&lt;p&gt;åœ¨ä½ åˆšæ‰è¾“å…¥ &lt;tt class="docutils literal"&gt;$ ulimit &lt;span class="pre"&gt;-u&lt;/span&gt; 400&lt;/tt&gt; å‘½ä»¤çš„çª—å£å¯åŠ¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3d.py"&gt;webserver3d.py&lt;/a&gt;  æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3d.py
&lt;/pre&gt;
&lt;p&gt;åœ¨å¦ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ä¸­ï¼Œå¯åŠ¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/client3.py"&gt;client3.py&lt;/a&gt; å¹¶å‘Šè¯‰å®ƒåŒæ—¶åˆ›å»º 500 ä¸ªè¿æ¥ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python client3.py --max-clients=500
&lt;/pre&gt;
&lt;p&gt;å¾ˆå¿«ï¼Œä½ çš„æœåŠ¡å™¨å°±ä¼šå´©æºƒå¹¶æŠ›å‡º &lt;tt class="docutils literal"&gt;OSError: Resource temporarily unavailable&lt;/tt&gt; çš„å¼‚å¸¸ä¿¡æ¯ï¼Œ
å½“å®ƒå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ï¼Œä½†æ˜¯å´æ²¡æ³•åˆ›å»ºæˆåŠŸï¼Œå› ä¸ºå®ƒå·²ç»è¶…å‡ºäº†å…è®¸åˆ›å»ºçš„æœ€å¤§å­è¿›ç¨‹æ•°é‡ã€‚
ä¸‹é¢æ˜¯æˆ‘æœºå­ä¸Šå…³äºå¼‚å¸¸ä¿¡æ¯çš„æˆªå›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc3_resource_unavailable.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc3_resource_unavailable.png" /&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä½ æ‰€è§ï¼Œå¦‚æœä½ çš„é•¿ä¹…è¿è¡Œçš„æœåŠ¡å™¨ä¸å¥½å¥½ç…§çœ‹å¥½åƒµå°¸è¿›ç¨‹çš„è¯ï¼Œå®ƒä»¬å°±ä¼šå¯¼è‡´å‡ºç°é—®é¢˜ã€‚
æˆ‘å°†ä¼šç®€çŸ­çš„è®¨è®ºä¸€ä¸‹æœåŠ¡å™¨åº”è¯¥å¦‚ä½•å¤„ç†åƒµå°¸è¿›ç¨‹é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä½ ç›®å‰å·²ç»äº†è§£åˆ°çš„çŸ¥è¯†ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_checkpoint.png" src="/static/images/lsbaws-part3/lsbaws_part3_checkpoint.png" /&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;å¦‚æœä½ æ²¡æœ‰å…³é—­æè¿°ç¬¦å‰¯æœ¬ï¼Œå®¢æˆ·ç«¯å°†ä¸ä¼šé€€å‡ºï¼Œå› ä¸ºå®¢æˆ·ç«¯è¿æ¥è¿˜æ²¡æœ‰è¢«å…³é—­ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ æ²¡æœ‰å…³é—­æè¿°ç¬¦å‰¯æœ¬ï¼Œä½ é‚£é•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡å™¨æœ€ç»ˆå°†è€—å°½æ‰€æœ‰å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆ&lt;tt class="docutils literal"&gt;max open files&lt;/tt&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å½“ä½  fork ä¸€ä¸ªå­è¿›ç¨‹ç„¶åé€€å‡ºï¼ŒåŒæ—¶çˆ¶è¿›ç¨‹æ²¡æœ‰ç­‰å¾…( &lt;tt class="docutils literal"&gt;wait&lt;/tt&gt; )å­è¿›ç¨‹å®Œæˆé€€å‡ºæ“ä½œï¼Œçˆ¶è¿›ç¨‹å°±æ”¶é›†ä¸åˆ°å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œå­è¿›ç¨‹æœ€ç»ˆå°±ä¼šå˜æˆä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;åƒµå°¸æ˜¯éœ€è¦åƒä¸œè¥¿çš„ã€‚æˆ‘å’±ä»¬è¿™é‡Œï¼Œå®ƒä»¬åƒå†…å­˜ã€‚å¦‚æœä¸ç®¡è¿™äº›åƒµå°¸è¿›ç¨‹çš„è¯ï¼Œä½ çš„æœåŠ¡å™¨å°†æœ€ç»ˆè€—å°½æ‰€æœ‰å¯ç”¨çš„è¿›ç¨‹ï¼ˆ&lt;tt class="docutils literal"&gt;max user processes&lt;/tt&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;ä½ æ— æ³• &lt;tt class="docutils literal"&gt;kill&lt;/tt&gt; ä¸€ä¸ªåƒµå°¸è¿›ç¨‹ï¼Œä½ éœ€è¦ç­‰( &lt;tt class="docutils literal"&gt;wait&lt;/tt&gt; )å®ƒå®Œæˆé€€å‡ºæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œä½ åº”è¯¥å¦‚ä½•å¤„ç†åƒµå°¸è¿›ç¨‹å‘¢ï¼Ÿ
ä½ éœ€è¦ä¿®æ”¹ä½ çš„æœåŠ¡å™¨ä»£ç  &lt;tt class="docutils literal"&gt;wait&lt;/tt&gt; ç­‰å¾…æ‰€æœ‰çš„åƒµå°¸è¿›ç¨‹ç›´åˆ°å¾—åˆ°å®ƒä»¬çš„é€€å‡ºçŠ¶æ€ã€‚
ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹ä½ çš„æœåŠ¡å™¨å»è°ƒç”¨ä¸€ä¸ª &lt;a class="reference external" href="https://docs.python.org/2.7/library/os.html#os.wait"&gt;wait&lt;/a&gt; ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚
ä¸å¹¸çš„æ˜¯ï¼Œç†æƒ³è·Ÿç°å®æ˜¯æœ‰å·®è·çš„ï¼Œå› ä¸ºå¦‚æœä½ è°ƒç”¨ &lt;tt class="docutils literal"&gt;wait&lt;/tt&gt; ç„¶ååˆæ²¡æœ‰å·²ç»é€€å‡ºçš„å­è¿›ç¨‹çš„è¯ï¼Œè°ƒç”¨ &lt;tt class="docutils literal"&gt;wait&lt;/tt&gt; å°†é˜»å¡ä½ çš„æœåŠ¡å™¨ï¼Œ è¿™å°±é˜»æ­¢ä½ çš„æœåŠ¡å™¨å¤„ç†æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ã€‚
éš¾é“å°±æ²¡æœ‰å…¶ä»–é€‰é¡¹äº†å—ï¼Ÿæœ‰çš„ï¼Œä¸€ç§è§£å†³åŠæ³•å°±æ˜¯è”åˆä½¿ç”¨ &lt;tt class="docutils literal"&gt;signal handler&lt;/tt&gt; å’Œ &lt;tt class="docutils literal"&gt;wait&lt;/tt&gt; ç³»ç»Ÿè°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc4_signaling.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc4_signaling.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å±•ç¤ºäº†æ˜¯å®ƒå¦‚ä½•å·¥ä½œã€‚å½“ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œå†…æ ¸å‘é€äº†ä¸€ä¸ª &lt;tt class="docutils literal"&gt;SIGCHLD&lt;/tt&gt; ä¿¡å·ã€‚
çˆ¶è¿›ç¨‹å¯ä»¥è®¾ç½®ä¸€ä¸ªç”¨äºå¼‚æ­¥æ¥æ”¶ &lt;tt class="docutils literal"&gt;SIGCHLD&lt;/tt&gt; äº‹ä»¶çš„ä¿¡å·å¤„ç†å™¨ï¼Œå¹¶ä¸”è¿™ä¸ªå¤„ç†å¯ä»¥ wait å­è¿›ç¨‹ä»¥ä¾¿æ”¶é›†å®ƒçš„ç»ˆæ­¢çŠ¶æ€ï¼Œ
è¿™æ ·å°±å¯ä»¥é˜»æ­¢åƒµå°¸è¿›ç¨‹çš„å‘ç”Ÿäº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part_conc4_sigchld_async.png" src="/static/images/lsbaws-part3/lsbaws_part_conc4_sigchld_async.png" /&gt;&lt;/p&gt;
&lt;p&gt;éšä¾¿è¯´ä¸€å¥ï¼Œä¸€ä¸ªå¼‚æ­¥äº‹ä»¶æ„å‘³ç€çˆ¶è¿›ç¨‹äº‹å…ˆå¹¶ä¸çŸ¥é“é‚£ä¸ªäº‹ä»¶ä¼šå‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹ä½ çš„æœåŠ¡å™¨ä»£ç ï¼Œè®¾ç½®ä¸€ä¸ª &lt;tt class="docutils literal"&gt;SIGCHLD&lt;/tt&gt; æ—¶é—´å¤„ç†å™¨ï¼Œåœ¨è¿™ä¸ªæ—¶é—´å¤„ç†å™¨ä¸­ wait å­è¿›ç¨‹ç»ˆæ­¢ã€‚
å¯ç”¨çš„ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3e.py"&gt;webserver3e.py&lt;/a&gt; ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="c"&gt;# Concurrent server - webserver3e.py                                      #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                         #&lt;/span&gt;
&lt;span class="c"&gt;# Tested with Python 2.7.9 &amp;amp; Python 3.4 on Ubuntu 14.04 &amp;amp; Mac OS X        #&lt;/span&gt;
&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;signal&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;
&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;grim_reaper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signum&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wait&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;Child {pid} terminated with status {status}&amp;#39;&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
    &lt;span class="n"&gt;http_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s"&gt;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class="s"&gt;Hello, World!&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c"&gt;# sleep to allow the parent to loop over to &amp;#39;accept&amp;#39; and block there&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Serving HTTP on port {port} ...&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SIGCHLD&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grim_reaper&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client_address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# child&lt;/span&gt;
            &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# close child copy&lt;/span&gt;
            &lt;span class="n"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# parent&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯åŠ¨æœåŠ¡å™¨ï¼š:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3e.py
&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨ä½ çš„è€æœ‹å‹ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘ä¿®æ”¹åçš„å¹¶å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ curl http://localhost:8888/hello
&lt;/pre&gt;
&lt;p&gt;çœ‹ä¸€ä¸‹æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc4_eintr.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc4_eintr.png" /&gt;&lt;/p&gt;
&lt;p&gt;å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ accept è°ƒç”¨æ˜¯å§äº†ï¼Œå¹¶æŠ¥äº†ä¸ª &lt;tt class="docutils literal"&gt;EINTR&lt;/tt&gt; é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc4_eintr_error.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc4_eintr_error.png" /&gt;&lt;/p&gt;
&lt;p&gt;å½“å­è¿›ç¨‹é€€å‡ºï¼Œè§¦å‘ &lt;tt class="docutils literal"&gt;SIGCHLD&lt;/tt&gt; äº‹ä»¶æ—¶ï¼Œæ¿€æ´»äº†æ—¶é—´ä¿¡å·å¤„ç†å™¨ï¼Œç„¶åçˆ¶è¿›ç¨‹é˜»å¡åœ¨äº† accept è°ƒç”¨è¿™ä¸ªåœ°æ–¹ï¼Œ&lt;/p&gt;
&lt;p&gt;å½“ä¿¡å·å¤„ç†å™¨å¤„ç†å®Œæˆä»¥åï¼Œ accept ç³»ç»Ÿè°ƒç”¨ä¹Ÿè·Ÿç€ä¸­æ–­äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc4_eintr_accept.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc4_eintr_accept.png" /&gt;&lt;/p&gt;
&lt;p&gt;åˆ«æ‹…å¿ƒï¼Œè¿™æ˜¯ä¸ªéå¸¸ç®€å•é—®é¢˜å¾ˆå®¹æ˜“è§£å†³ã€‚ä½ è¦åšåˆ°çš„å°±æ˜¯é‡æ–°å¼€å§‹ accept ç³»ç»Ÿè°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¿®æ”¹ç‰ˆæœ¬çš„æœåŠ¡å™¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3f.py"&gt;webserver3f.py&lt;/a&gt; ï¼Œè¿™ä¸ªç‰ˆæœ¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="c"&gt;# Concurrent server - webserver3f.py                                      #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                         #&lt;/span&gt;
&lt;span class="c"&gt;# Tested with Python 2.7.9 &amp;amp; Python 3.4 on Ubuntu 14.04 &amp;amp; Mac OS X        #&lt;/span&gt;
&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;errno&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;signal&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;

&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;
&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;grim_reaper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signum&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wait&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
    &lt;span class="n"&gt;http_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s"&gt;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class="s"&gt;Hello, World!&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Serving HTTP on port {port} ...&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SIGCHLD&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grim_reaper&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client_address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;IOError&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;
            &lt;span class="c"&gt;# restart &amp;#39;accept&amp;#39; if it was interrupted&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;errno&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EINTR&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;continue&lt;/span&gt;
            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;raise&lt;/span&gt;

        &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# child&lt;/span&gt;
            &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# close child copy&lt;/span&gt;
            &lt;span class="n"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# parent&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# close parent copy and loop over&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯åŠ¨æ›´æ–°åçš„ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3f.py"&gt;webserver3f.py&lt;/a&gt; :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3f.py
&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘ä¿®æ”¹è¿‡çš„å¹¶å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼š&lt;/p&gt;
&lt;blockquote&gt;
$ curl &lt;a class="reference external" href="http://localhost:8888/hello"&gt;http://localhost:8888/hello&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;çœ‹åˆ°äº†æ²¡ï¼Ÿ ä¸å†æœ‰  EINTR å¼‚å¸¸äº†ã€‚ç°åœ¨ï¼ŒéªŒè¯ä¸€ä¸‹ï¼Œä¸å†æœ‰åƒµå°¸äº†ï¼Œè€Œä¸”ä½ çš„ &lt;tt class="docutils literal"&gt;SIGCHLD&lt;/tt&gt; äº‹ä»¶å¤„ç†å™¨é€šè¿‡ wait è°ƒç”¨æ¥å¤„ç†å­è¿›ç¨‹çš„ç»ˆæ­¢äº‹ä»¶ã€‚ä¸ºäº†éªŒè¯è¿™ä¸ªï¼Œåªéœ€è¦è¿è¡Œ ps å‘½ä»¤ï¼Œç„¶åä½ å¯ä»¥çœ‹ä¸€ä¸‹åº”è¯¥ä¸å†æœ‰çŠ¶æ€ä¸º &lt;strong&gt;Z+&lt;/strong&gt; çš„ Python åƒµå°¸è¿›ç¨‹äº†ï¼ˆä¸å†æœ‰ &lt;strong&gt;&amp;lt;default&amp;gt;&lt;/strong&gt; è¿›ç¨‹ï¼‰ã€‚å¤ªæ£’äº†ï¼ä¸å†æœ‰åƒµå°¸è¿›ç¨‹çš„æ—¥å­å®‰å…¨æ„Ÿç»ˆäºæœ‰ä¿éšœäº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_checkpoint.png" src="/static/images/lsbaws-part3/lsbaws_part3_checkpoint.png" /&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;å¦‚æœä½  fork äº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œä½†æ˜¯å´æ²¡æœ‰ wait å®ƒï¼Œå®ƒå°±ä¼šå˜æˆä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;tt class="docutils literal"&gt;SIGCHLD&lt;/tt&gt; äº‹ä»¶å¤„ç†å™¨æ¥å¼‚æ­¥ wait ç»ˆæ­¢çš„å­è¿›ç¨‹ä»¥ä¾¿æ”¶é›†å®ƒçš„ç»ˆæ­¢çŠ¶æ€ï¼Œ&lt;/li&gt;
&lt;li&gt;å½“ä½¿ç”¨äº‹ä»¶å¤„ç†å™¨çš„æ—¶å€™ï¼Œä½ éœ€è¦è€ƒè™‘åˆ°ç³»ç»Ÿå¯èƒ½ä¼šä¸­æ–­ï¼Œè¿™æ ·çš„è¯ä½ å°±éœ€æ±‚ä¸ºè¿™ä¸ªåœºæ™¯åšäº›å‡†å¤‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¥½äº†ï¼Œç›®å‰æ¥çœ‹ä¸€èµ·éƒ½å¾ˆæ£’ã€‚æ²¡é—®é¢˜ï¼Œæ˜¯å§ï¼Ÿå—¯ï¼Œç¡®å®å¦‚æ­¤ã€‚
å†è¯•è¯• &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3f.py"&gt;webserver3f.py&lt;/a&gt; ï¼Œä¸è¿‡è¿™æ¬¡ä¸æ˜¯ä½¿ç”¨ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; åˆ¶é€ ä¸€ä¸ªè¯·æ±‚ï¼Œè€Œæ˜¯ä½¿ç”¨ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/client3.py"&gt;client3.py&lt;/a&gt; åˆ›å»º 128 ä¸ªåŒæ—¶å‘ç”Ÿçš„è¿æ¥ï¼š:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python client3.py --max-clients 128
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨å†ä¸€æ¬¡æ‰§è¡Œ &lt;tt class="docutils literal"&gt;ps&lt;/tt&gt; å‘½ä»¤&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ ps auxw | grep -i python | grep -v grep
&lt;/pre&gt;
&lt;p&gt;çœ‹å‘ï¼Œå“¦ï¼Œå¤©å“ªï¼Œåƒµå°¸è¿›ç¨‹åˆå›æ¥äº†ï¼&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc5_zombies_again.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc5_zombies_again.png" /&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡åˆæ€ä¹ˆäº†å‘¢ï¼Ÿå½“ä½ è¿è¡Œäº† 128 ä¸ªåŒæ­¥çš„å®¢æˆ·ç«¯æ—¶ï¼ŒåŒæ—¶å°±å»ºç«‹äº† 128 æ¡è¿æ¥ï¼ŒæœåŠ¡å™¨ä¸Šå¤„ç†è¯·æ±‚å’Œé€€å‡ºçš„å­è¿›ç¨‹å¤§å¤šæ•°éƒ½åœ¨åŒä¸€æ—¶è§¦å‘å¤§é‡çš„ &lt;tt class="docutils literal"&gt;SIGCHLD&lt;/tt&gt; ä¿¡å·è¢«å‘é€ç»™çˆ¶è¿›ç¨‹ã€‚
é—®é¢˜å°±æ˜¯è¿™äº›ä¿¡å·å¹¶ä¸æ˜¯æŒ‰é˜Ÿåˆ—è¿›è¡Œå¤„ç†çš„ï¼Œè¿™æ ·çš„è¯ï¼Œä½ çš„æœåŠ¡å™¨è¿›ç¨‹å°±ä¼šé”™è¿‡ä¸€äº›ä¿¡å·ï¼Œè¿™ä¼šé—ç•™ä¸€ä¸‹æ— äººç…§çœ‹çš„åƒµå°¸è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc5_signals_not_queued.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc5_signals_not_queued.png" /&gt;&lt;/p&gt;
&lt;p&gt;è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯è®¾ç½®ä¸€ä¸ª &lt;tt class="docutils literal"&gt;SIGCHLD&lt;/tt&gt; äº‹ä»¶å¤„ç†å™¨ï¼Œ
ä¸ä½¿ç”¨ &lt;tt class="docutils literal"&gt;wait&lt;/tt&gt; è€Œæ˜¯è°ƒç”¨ &lt;a class="reference external" href="https://docs.python.org/2.7/library/os.html#os.waitpid"&gt;waitpid&lt;/a&gt; ç³»ç»Ÿè°ƒç”¨å¹¶åœ¨å¾ªç¯ä¸­ä½¿ç”¨ &lt;tt class="docutils literal"&gt;WNOHANG&lt;/tt&gt; é€‰é¡¹ï¼Œç¡®ä¿æ‰€æœ‰ç»ˆæ­¢çš„å­è¿›ç¨‹éƒ½è¢«ç…§é¡¾åˆ°äº†ã€‚
ä¸‹é¢æ˜¯ä¿®æ”¹åçš„æœåŠ¡å™¨ä»£ç ï¼Œ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3g.py"&gt;webserver3g.py&lt;/a&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="c"&gt;# Concurrent server - webserver3g.py                                      #&lt;/span&gt;
&lt;span class="c"&gt;#                                                                         #&lt;/span&gt;
&lt;span class="c"&gt;# Tested with Python 2.7.9 &amp;amp; Python 3.4 on Ubuntu 14.04 &amp;amp; Mac OS X        #&lt;/span&gt;
&lt;span class="c"&gt;###########################################################################&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;errno&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;signal&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;

&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;
&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;grim_reaper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signum&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;waitpid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;          &lt;span class="c"&gt;# Wait for any child process&lt;/span&gt;
                 &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WNOHANG&lt;/span&gt;  &lt;span class="c"&gt;# Do not block and return EWOULDBLOCK error&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;OSError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# no more zombies&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
    &lt;span class="n"&gt;http_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s"&gt;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class="s"&gt;Hello, World!&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;REQUEST_QUEUE_SIZE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Serving HTTP on port {port} ...&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SIGCHLD&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grim_reaper&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client_address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;IOError&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;
            &lt;span class="c"&gt;# restart &amp;#39;accept&amp;#39; if it was interrupted&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;errno&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EINTR&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;continue&lt;/span&gt;
            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;raise&lt;/span&gt;

        &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# child&lt;/span&gt;
            &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# close child copy&lt;/span&gt;
            &lt;span class="n"&gt;handle_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c"&gt;# parent&lt;/span&gt;
            &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# close parent copy and loop over&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯åŠ¨æœåŠ¡å™¨:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver3g.py
&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨æµ‹è¯•å®¢æˆ·ç«¯ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/client3.py"&gt;client3.py&lt;/a&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python client3.py --max-clients 128
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨éªŒè¯ä¸€ä¸‹å·²ç»ä¸å†æœ‰åƒµå°¸è¿›ç¨‹äº†ã€‚è€¶ï¼æ²¡æœ‰åƒµå°¸è¿›ç¨‹çš„ç”Ÿæ´»æ˜¯å¦‚æ­¤çš„ç¾å¥½ :)&lt;/p&gt;
&lt;p&gt;&lt;img alt="lsbaws_part3_conc5_no_zombies.png" src="/static/images/lsbaws-part3/lsbaws_part3_conc5_no_zombies.png" /&gt;&lt;/p&gt;
&lt;p&gt;æ­å–œï¼è¿™å¯çœŸæ˜¯ä¸ªæ¼«é•¿çš„æ—…ç¨‹ï¼Œä½†æ˜¯æˆ‘å¸Œæœ›ä½ èƒ½å–œæ¬¢å®ƒã€‚
ç°åœ¨ä½ å·²ç»æœ‰äº†ä½ è‡ªå·±çš„ç®€å•çš„å¹¶å‘æœåŠ¡å™¨ï¼Œè¿™äº›ä»£ç å¯ä»¥ä½œä¸ºä½ å°†æ¥å¼€å‘äº§å“çº§ Web æœåŠ¡å™¨çš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¦ç»™ä½ ç•™ä¸€ä¸ªç»ƒä¹ ï¼Œé‚£å°±æ˜¯å°†çš„ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-2-zh-cn.html"&gt;ç¬¬äºŒéƒ¨åˆ†&lt;/a&gt; çš„ WSGI æœåŠ¡å™¨æ›´æ–°ä¸ºå¹¶å‘æœåŠ¡å™¨ã€‚
ä½ å¯ä»¥ä» &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part3/webserver3h.py"&gt;è¿™é‡Œ&lt;/a&gt; å¾—åˆ°æœ€ç»ˆçš„ä¿®æ”¹ç‰ˆã€‚ä½†æ˜¯ï¼Œåªåœ¨ä½ å®Œæˆä½ çš„ç‰ˆæœ¬åæ‰èƒ½æŸ¥çœ‹æˆ‘çš„ä»£ç ã€‚
ä½ å·²ç»å…·å¤‡äº†å®Œæˆè¿™é¡¹å·¥ä½œçš„æ‰€å¿…éœ€çš„æ‰€æœ‰ä¿¡æ¯äº†ã€‚æ‰€ä»¥ï¼Œæ”¾æ‰‹å»åšå§ï¼šï¼‰&lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿæ­£å¦‚ Josh Billings è¯´è¿‡çš„ï¼Œ&lt;/p&gt;
&lt;blockquote&gt;
â€œåƒä¸€å¼ é‚®ç¥¨ä¸€æ · â€”â€” åšæŒä¸€ä»¶äº‹æƒ…ç›´åˆ°ä½ åˆ°è¾¾ç»ˆç‚¹ã€‚â€&lt;/blockquote&gt;
&lt;p&gt;å¼€å§‹å¾æœåŸºç¡€çŸ¥è¯†ã€‚è´¨ç–‘ä½ å·²ç»çŸ¥é“çš„ã€‚åŒæ—¶æ€»æ˜¯æ·±å…¥æŒ–æ˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
â€œå¦‚æœä½ åªå­¦ä¹ æ–¹æ³•ï¼Œä½ å°†æŸç¼šäºä½ çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å­¦ä¼šäº†åŸç†ï¼Œä½ å°±å¯ä»¥å‘æ˜ä½ è‡ªå·±çš„æ–¹æ³•ã€‚â€ â€”â€” Ralph Waldo Emerson&lt;/blockquote&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€äº›æˆ‘é€‰å‡ºçš„è¦†ç›–æœ¬æ–‡å¤§éƒ¨åˆ†çŸ¥è¯†çš„ä¹¦ç±ã€‚å®ƒä»¬å°†å¸®åŠ©ä½ æ‹“å®½å’ŒåŠ æ·±æˆ‘æåˆ°çš„çŸ¥è¯†ç‚¹ã€‚
æˆ‘é«˜åº¦æ¨èçš„ä½ æŒ‰ç…§è¿™ä¸ªæ–¹å¼å»è·å¾—è¿™äº›æ•°ï¼šä»ä½ çš„æœ‹å‹é‚£é‡Œå€Ÿè¿™äº›ä¹¦ï¼Œä»ä½ å½“åœ°çš„å›¾ä¹¦é¦†é‡Œå€Ÿï¼Œ
æˆ–è€…å¹²è„†ä»äºšé©¬é€Šä¸Šè´­ä¹°ã€‚å®ƒä»¬æ˜¯å®ˆæŠ¤è€…ï¼š&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://book.douban.com/subject/4859464/"&gt;UNIXç½‘ç»œç¼–ç¨‹ å·1ï¼šå¥—æ¥å­—è”ç½‘APIï¼ˆç¬¬3ç‰ˆï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://book.douban.com/subject/25900403/"&gt;UNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ï¼ˆç¬¬3ç‰ˆï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://book.douban.com/subject/25809330/"&gt;Linux/UNIXç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://book.douban.com/subject/3571433/"&gt;TCP/IPè¯¦è§£ å·1ï¼šåè®®ï¼ˆç¬¬2ç‰ˆï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://book.douban.com/subject/3666232/"&gt;The Little Book of SEMAPHORES (2nd Edition): The Ins and Outs of Concurrency Control and Common Mistakes&lt;/a&gt; ä¹Ÿå¯ä»¥ä»ä½œè€…çš„ç½‘ç«™ä¸Šè·å–å…è´¹ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label" /&gt;&lt;col /&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a class="reference external" href="http://book.douban.com/subject/4859464/"&gt;UNIXç½‘ç»œç¼–ç¨‹ å·1ï¼šå¥—æ¥å­—è”ç½‘APIï¼ˆç¬¬3ç‰ˆï¼‰&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label" /&gt;&lt;col /&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a class="reference external" href="http://book.douban.com/subject/3666232/"&gt;The Little Book of SEMAPHORES (2nd Edition): The Ins and Outs of Concurrency Control and Common Mistakes&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</summary><category term="server"></category><category term="http"></category><category term="fork"></category><category term="lsbaws"></category><category term="è®©æˆ‘ä»¬ä¸€èµ·æ¥æ„å»ºä¸€ä¸ª Web æœåŠ¡å™¨"></category></entry><entry><title>åœ¨ python ä¸­ä½¿ç”¨ str.strip æ–¹æ³•æ—¶éœ€è¦æ³¨æ„çš„åœ°æ–¹</title><link href="https://mozillazg.com/2015/06/python-str-strip-lstrip-rstrip-warnning.html" rel="alternate"></link><updated>2015-06-08T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2015-06-08:2015/06/python-str-strip-lstrip-rstrip-warnning.html</id><summary type="html">&lt;p&gt;é¦–å…ˆé—®å¤§å®¶ä¸€ä¸ªé—®é¢˜ï¼šä½ è§‰å¾—ä¸‹é¢ä»£ç çš„è¾“å‡ºä¼šæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;pre class="literal-block"&gt;
print '12345-abc-12345-defg-54321'.strip('12345')
&lt;/pre&gt;
&lt;p&gt;æˆ‘çŒœæœ‰äº›åŒå­¦çš„ç­”æ¡ˆä¼šæ˜¯: &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-abc-12345-defg-54321&lt;/span&gt;&lt;/tt&gt; ï¼Œå®é™…çš„ç»“æœæ˜¯:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt;&amp;gt;&amp;gt; print '12345-abc-12345-defg-54321'.strip('12345')
-abc-12345-defg-
&lt;/pre&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆä¸æ˜¯ &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-abc-12345-defg-54321&lt;/span&gt;&lt;/tt&gt; å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ &lt;tt class="docutils literal"&gt;str.strip&lt;/tt&gt; çš„æ–‡æ¡£å°±çŸ¥é“äº†:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
S.strip([chars]) -&amp;gt; string or unicode

Return a copy of the string S with leading and trailing
whitespace removed.
If chars is given and not None, remove characters in chars instead.
If chars is unicode, S will be converted to unicode before stripping
&lt;/pre&gt;
&lt;p&gt;é€šè¿‡æ–‡æ¡£æˆ‘ä»¬å¯ä»¥çŸ¥é“:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;å¦‚æœæœªæŒ‡å®š chars å‚æ•°æˆ–å‚æ•°å€¼æœª None, å»é™¤å­—ç¬¦ä¸² &lt;strong&gt;é¦–å°¾ç©ºç™½ç¬¦ï¼ˆç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰ç­‰ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;å¦åˆ™ï¼Œåªè¦ &lt;strong&gt;é¦–å°¾å­—ç¬¦åŒ…å«åœ¨ chars å®šä¹‰çš„å­—ç¬¦ä¸²å†…&lt;/strong&gt; ï¼Œå°±ä¼šè¢«å»é™¤ã€‚å¹¶ä¸”ä¼šé€’å½’è°ƒç”¨ç›´åˆ°é¦–å°¾å­—ç¬¦ä¸åœ¨ chars å†…ã€‚ç±»ä¼¼:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
def _strip(s, chars):
    if s[0] in chars:
        return _strip(s[1:], chars)
    elif s[-1] in chars:
        return _strip(s[:-1], chars)
    else:
        return s
&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šçš„ä¾‹å­:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt;&amp;gt;&amp;gt; '18349-13-3434'.strip('0123456789')
'-13-'

&amp;gt;&amp;gt;&amp;gt; '18349-13-3434'.strip('123')
'8349-13-3434'

&amp;gt;&amp;gt;&amp;gt; 'scene_scdefg'.strip('scene_')
'defg'

&amp;gt;&amp;gt;&amp;gt; '\r   \t\n '.strip()
''
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬çŸ¥é“ &lt;tt class="docutils literal"&gt;str.strip&lt;/tt&gt; æ˜¯æŒ‰ &lt;strong&gt;å­—ç¬¦&lt;/strong&gt; è¿›è¡Œç§»é™¤æ“ä½œçš„ã€‚
é‚£ä¹ˆå¦‚ä½•æŒ‰å­—ç¬¦ä¸²è¿›è¡Œç§»é™¤å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸€ç§è§£å†³åŠæ³•å°±æ˜¯ä½¿ç”¨ &lt;tt class="docutils literal"&gt;re.sub&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
def strip2(s, chars):
    re_chars = re.escape(chars)
    s = re.sub(r'^(?:%s)+(?P&amp;lt;right&amp;gt;.*)$' % re_chars, '\g&amp;lt;right&amp;gt;', s)
    s = re.sub(r'^(?P&amp;lt;left&amp;gt;.*?)(?:%s)+$' % re_chars, '\g&amp;lt;left&amp;gt;', s)
    return s

&amp;gt;&amp;gt;&amp;gt; print strip2('12345-abc-12345-defg-54321', '12345')
-abc-12345-defg-54321
&lt;/pre&gt;
&lt;!-- ä¸€ç§è§£å†³åŠæ³•å°±æ˜¯ï¼Œä½¿ç”¨ ``str.replace``: :: --&gt;
&lt;!--  --&gt;
&lt;!-- &gt;&gt;&gt; '12345-abc-12345-defg-54321'.replace('12345', '', 1) --&gt;
&lt;!-- '-abc-12345-defg-54321' --&gt;
</summary></entry><entry><title>è®©æˆ‘ä»¬ä¸€èµ·æ¥æ„å»ºä¸€ä¸ª Web æœåŠ¡å™¨ï¼ˆäºŒï¼‰</title><link href="https://mozillazg.com/2015/06/let-us-build-a-web-server-part-2-zh-cn.html" rel="alternate"></link><updated>2015-06-10T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2015-06-06:2015/06/let-us-build-a-web-server-part-2-zh-cn.html</id><summary type="html">&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a class="reference external" href="http://ruslanspivak.com/lsbaws-part2/"&gt;http://ruslanspivak.com/lsbaws-part2/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿˜è®°å¾—å—ï¼Ÿåœ¨ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-1-zh-cn.html"&gt;ç¬¬ä¸€éƒ¨åˆ†&lt;/a&gt; æˆ‘å‘ä½ é—®äº†ä¸€ä¸ªé—®é¢˜ï¼šâ€å¦‚ä½•åœ¨ä½ æ–°é²œå‡ºç‚‰çš„ Web æœåŠ¡å™¨ä¸Šä¸åšä»»ä½•ä¿®æ”¹çš„å°±è¿è¡Œ Django åº”ç”¨ï¼ŒFlask åº”ç”¨ï¼Œ Pyramid åº”ç”¨?â€œ
å¾€ä¸‹è¯»å°±å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»ï¼Œå½“ä½ é€‰æ‹©çš„ Python Web æ¡†æ¶ä¼šé™åˆ¶ä½ æ‰€èƒ½é€‰æ‹©çš„ Web æœåŠ¡å™¨, å¦‚æœé‚£ä¸ªæ¡†æ¶å’ŒæœåŠ¡å™¨è¢«è®¾è®¡çš„å¯ä»¥ä¸€èµ·å·¥ä½œçš„è¯ï¼Œé‚£å°±çš†å¤§æ¬¢å–œäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="Server Framework Fit" src="/static/images/lsbaws-part2/lsbaws_part2_before_wsgi.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå½“ä½ å°è¯•æŠŠä¸€ä¸ªæœåŠ¡å™¨å’Œä¸€ä¸ªæ¡†æ¶ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™å¯èƒ½ä¼šï¼ˆå¯èƒ½ä½ å·²ç»ï¼‰é¢ä¸´å®ƒä»¬è¢«è®¾è®¡ä¸ºä¸å…¼å®¹çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="Server Framework Clash" src="/static/images/lsbaws-part2/lsbaws_part2_after_wsgi.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ä½ å¿…é¡»ä½¿ç”¨èƒ½å¤Ÿä¸€èµ·å·¥ä½œçš„ç»„ä»¶è€Œä¸ä»…ä»…æ˜¯ä½ æƒ³ä½¿ç”¨çš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œä½ å¦‚ä½•ç¡®ä¿ä½ èƒ½å¤Ÿåœ¨ä½ çš„ Web æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ª Web æ¡†æ¶ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¿®æ”¹ Web æœåŠ¡å™¨æˆ– Web æ¡†æ¶çš„ç°æœ‰çš„ä»£ç å‘¢ï¼Ÿ
è§£å†³è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå°±æ˜¯ Python Web Server Gateway Interface (æˆ–ç®€ç§° WSGI , è¯»ä½œ â€œwizgyâ€)&lt;/p&gt;
&lt;p&gt;&lt;img alt="WSGI Interface" src="/static/images/lsbaws-part2/lsbaws_part2_wsgi_idea.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://www.python.org/dev/peps/pep-0333/"&gt;WSGI&lt;/a&gt; å…è®¸å¼€å‘è€…è‡ªç”±é€‰æ‹© Web æ¡†æ¶å’Œ Web æœåŠ¡å™¨ã€‚ç°åœ¨ä½ å¯ä»¥ä»»æ„æ··æ­ä¸åŒçš„ Web æœåŠ¡å™¨å’Œ Web æ¡†æ¶ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªä½ éœ€è¦çš„åˆé€‚çš„ç»„åˆã€‚
æ¯”å¦‚ï¼Œä½ å¯ä»¥ ç”¨ &lt;a class="reference external" href="http://gunicorn.org/"&gt;Gunicorn&lt;/a&gt; or &lt;a class="reference external" href="http://uwsgi-docs.readthedocs.org/"&gt;Nginx/uWSGI&lt;/a&gt; or &lt;a class="reference external" href="http://waitress.readthedocs.org/"&gt;Waitress&lt;/a&gt; è¿è¡Œ &lt;a class="reference external" href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt;, &lt;a class="reference external" href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt;, æˆ– &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt; .
çœŸæ­£çš„éšæ„æ··æ­ï¼Œæ„Ÿè°¢é‚£äº›æœåŠ¡å™¨å’Œæ¡†æ¶å¯¹ WSGI çš„æ”¯æŒï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="Mix &amp;amp; Match" src="/static/images/lsbaws-part2/lsbaws_part2_wsgi_interop.png" /&gt;&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œ&lt;a class="reference external" href="https://www.python.org/dev/peps/pep-0333/"&gt;WSGI&lt;/a&gt; å°±æ˜¯æˆ‘åœ¨ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-1-zh-cn.html"&gt;ç¬¬ä¸€éƒ¨åˆ†&lt;/a&gt; å‘ä½ é—®çš„å¹¶åœ¨æ–‡ç« å¼€å¤´é‡å¤è¿‡çš„é—®é¢˜çš„ç­”æ¡ˆã€‚
ä½ çš„ Web æœåŠ¡å™¨å¿…é¡»å®ç° WSGI æ¥å£çš„æœåŠ¡å™¨ç«¯éƒ¨åˆ†ï¼Œ
æ‰€æœ‰çš„ç°ä»£ Python Web æ¡†æ¶éƒ½å·²ç»å®ç°äº† WSGI æ¥å£çš„æ¡†æ¶ç«¯éƒ¨åˆ†ï¼Œ
è¿™éƒ¨åˆ†å…è®¸ä½ ä¸éœ€è¦ä¿®æ”¹ä½ çš„æœåŠ¡å™¨ä»£ç å»é€‚åº”æŸä¸ªç‰¹å®šçš„æ¡†æ¶å°±å¯ä»¥ä½¿ç”¨è¿™äº›æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ä½ å·²ç»çŸ¥é“äº†è¢« Web æœåŠ¡å™¨å’Œ Web æ¡†æ¶æ‰€æ”¯æŒçš„ WSGI å…è®¸ä½ é€‰æ‹©é€‚åˆä½ çš„ç»„åˆï¼Œ
å®ƒåŒæ ·ä¹Ÿå¯¹æœåŠ¡å™¨å’Œæ¡†æ¶çš„å¼€å‘è€…æœ‰ç›Šï¼Œå› ä¸ºä»–ä»¬å¯ä»¥ä¸“æ³¨äºæ ‡å‡†ä¸­ä»–ä»¬å„è‡ªçš„åŒºåŸŸï¼Œä¸ä¼šå‡ºç°å› ä¸ºè¶Šç•Œè€Œè¸©åˆ°å¯¹æ–¹çš„è„šè¶¾ã€‚
å…¶ä»–è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼çš„æ¥å£ï¼šä¾‹å¦‚ï¼ŒJava æœ‰ &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Java_servlet"&gt;Servlet API&lt;/a&gt;ï¼ŒRuby æœ‰ &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Rack_%28web_server_interface%29"&gt;Rack&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;ä¸€åˆ‡éƒ½å¾ˆæ£’ï¼Œä½†æ˜¯æˆ‘çŒœä½ ä¼šè¯´â€Show me the code!â€œï¼Œå¥½å§ï¼Œä¸€èµ·æ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªéå¸¸ç®€çº¦çš„ WSGI æœåŠ¡å™¨å®ç°å§ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Tested with Python 2.7.9, Linux &amp;amp; Mac OS X&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;StringIO&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;WSGIServer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="n"&gt;address_family&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;
    &lt;span class="n"&gt;socket_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;
    &lt;span class="n"&gt;request_queue_size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server_address&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c"&gt;# Create a listening socket&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;address_family&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket_type&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c"&gt;# Allow to reuse the same address&lt;/span&gt;
        &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c"&gt;# Bind&lt;/span&gt;
        &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;server_address&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c"&gt;# Activate&lt;/span&gt;
        &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request_queue_size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c"&gt;# Get server host name and port&lt;/span&gt;
        &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getsockname&lt;/span&gt;&lt;span class="p"&gt;()[:&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;server_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getfqdn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;server_port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;
        &lt;span class="c"&gt;# Return headers set by Web framework/Web application&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers_set&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;set_app&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen_socket&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="c"&gt;# New client connection&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client_address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="c"&gt;# Handle one request and close the client connection. Then&lt;/span&gt;
            &lt;span class="c"&gt;# loop over to wait for another client connection&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;handle_one_request&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_one_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c"&gt;# Print formatted request data a la &amp;#39;curl -v&amp;#39;&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s"&gt;&amp;#39;&amp;lt; {line}&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;request_data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="p"&gt;))&lt;/span&gt;

        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request_data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="c"&gt;# Construct environment dictionary using request data&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_environ&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

        &lt;span class="c"&gt;# It&amp;#39;s time to call our application callable and get&lt;/span&gt;
        &lt;span class="c"&gt;# back a result that will become HTTP response body&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="c"&gt;# Construct a response and send it back to the client&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;finish_response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;parse_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;request_line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;request_line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request_line&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rstrip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c"&gt;# Break down the request line into components&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request_method&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="c"&gt;# GET&lt;/span&gt;
         &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;            &lt;span class="c"&gt;# /hello&lt;/span&gt;
         &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request_version&lt;/span&gt;  &lt;span class="c"&gt;# HTTP/1.1&lt;/span&gt;
         &lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request_line&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_environ&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
        &lt;span class="c"&gt;# The following code snippet does not follow PEP8 conventions&lt;/span&gt;
        &lt;span class="c"&gt;# but it&amp;#39;s formatted the way it is for demonstration purposes&lt;/span&gt;
        &lt;span class="c"&gt;# to emphasize the required variables and their values&lt;/span&gt;
        &lt;span class="c"&gt;#&lt;/span&gt;
        &lt;span class="c"&gt;# Required WSGI variables&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;wsgi.version&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;      &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;wsgi.url_scheme&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;   &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;http&amp;#39;&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;wsgi.input&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;        &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;StringIO&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;StringIO&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request_data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;wsgi.errors&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stderr&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;wsgi.multithread&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;wsgi.multiprocess&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;wsgi.run_once&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;     &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
        &lt;span class="c"&gt;# Required CGI variables&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;REQUEST_METHOD&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request_method&lt;/span&gt;    &lt;span class="c"&gt;# GET&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;PATH_INFO&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;         &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;              &lt;span class="c"&gt;# /hello&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;SERVER_NAME&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;server_name&lt;/span&gt;       &lt;span class="c"&gt;# localhost&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;SERVER_PORT&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;server_port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# 8888&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;start_response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;response_headers&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;exc_info&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c"&gt;# Add necessary server headers&lt;/span&gt;
        &lt;span class="n"&gt;server_headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Date&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Tue, 31 Mar 2015 12:54:48 GMT&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
            &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Server&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;WSGIServer 0.2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers_set&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;response_headers&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;server_headers&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="c"&gt;# To adhere to WSGI specification the start_response must return&lt;/span&gt;
        &lt;span class="c"&gt;# a &amp;#39;write&amp;#39; callable. We simplicity&amp;#39;s sake we&amp;#39;ll ignore that detail&lt;/span&gt;
        &lt;span class="c"&gt;# for now.&lt;/span&gt;
        &lt;span class="c"&gt;# return self.finish_response&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;finish_response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;response_headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers_set&lt;/span&gt;
            &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;HTTP/1.1 {status}&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;response_headers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;{0}: {1}&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;
            &lt;span class="c"&gt;# Print formatted response data a la &amp;#39;curl -v&amp;#39;&lt;/span&gt;
            &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="s"&gt;&amp;#39;&amp;gt; {line}&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="p"&gt;))&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;finally&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;make_server&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;server_address&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;WSGIServer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;server_address&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_app&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Provide a WSGI application object as module:callable&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;app_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;app_path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;__import__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;application&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;getattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;httpd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;make_server&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SERVER_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;WSGIServer: Serving HTTP on port {port} ...&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;httpd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;serve_forever&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸Šé¢çš„ä»£ç æ¯” &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-1-zh-cn.html"&gt;ç¬¬ä¸€éƒ¨åˆ†&lt;/a&gt; çš„æœåŠ¡å™¨ä»£ç æ›´é•¿ï¼Œä½†æ˜¯ï¼Œä¸ºäº†è®©ä½ èƒ½å¤Ÿç†è§£è€Œä¸è‡³äºé™·å…¥ç»†èŠ‚çš„æ³¥æ½­ä¸­ï¼Œå®ƒå·²ç»è¶³å¤Ÿå°äº†ï¼ˆåªæœ‰ä¸åˆ° 150 è¡Œï¼‰ã€‚
ä¸Šé¢çš„æœåŠ¡å™¨ä»£ç åŒæ ·ä¹Ÿèƒ½åšæ›´å¤šçš„å·¥ä½œâ€”â€”å®ƒèƒ½è¿è¡Œç”¨ä½ ä¸Šé¢æ‰€è§çš„ Web æ¡†æ¶ï¼ˆ&lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt;, &lt;a class="reference external" href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt;, &lt;a class="reference external" href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt;, æˆ–å…¶ä»–çš„ Python WSGI æ¡†æ¶ï¼‰æ‰€å†™çš„åŸºç¡€ Web åº”ç”¨ï¼Œ&lt;/p&gt;
&lt;p&gt;ä¸ä¿¡ï¼ŸåŠ¨æ‰‹è¯•ä¸€ä¸‹å§ã€‚æŠŠä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º &lt;tt class="docutils literal"&gt;webserver2.py&lt;/tt&gt; æˆ–è€…ç›´æ¥ä» &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part2/webserver2.py"&gt;GitHub&lt;/a&gt; ä¸Šä¸‹è½½ä¸‹æ¥ã€‚å¦‚æœä½ ä¸å¸¦ä»»ä½•å‚æ•°å°±è¿è¡Œè¿™ä¸ªç¨‹åºçš„è¯ï¼Œå®ƒä¼šå‘ä½ æŠ±æ€¨ï¼Œç„¶åé€€å‡ºã€‚&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver2.py
Provide a WSGI application object as module:callable
&lt;/pre&gt;
&lt;p&gt;å®ƒçœŸçš„éå¸¸æƒ³è¦æœåŠ¡ä½ çš„ Web åº”ç”¨ï¼Œè¿™æ˜¯ä¸ªéå¸¸æœ‰è¶£çš„å¼€å§‹ã€‚
ä¸ºäº†èƒ½å¤Ÿè¿è¡Œè¿™ä¸ªæœåŠ¡å™¨ä½ åªéœ€è¦å®‰è£… Python å°±å¯ä»¥äº†ã€‚
ä½†æ˜¯ï¼Œä¸ºäº†è¿è¡Œç”¨ &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt;, &lt;a class="reference external" href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt;, æˆ– &lt;a class="reference external" href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt; å¼€å‘çš„åº”ç”¨ï¼Œä½ éœ€è¦é¦–å…ˆå®‰è£…è¿™äº›æ¡†æ¶ã€‚
è®©æˆ‘ä»¬æ¥å®‰è£…è¿™ä¸‰ä¸ªæ¡†æ¶å§ã€‚
æˆ‘å–œæ¬¢ä½¿ç”¨ &lt;a class="reference external" href="https://virtualenv.pypa.io/"&gt;virtualenv&lt;/a&gt;. åªéœ€æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å»åˆ›å»ºå¹¶æ¿€æ´»ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œç„¶åå°±å¯ä»¥å®‰è£…è¿™ä¸‰ä¸ªæ¡†æ¶äº†ã€‚&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ [sudo] pip install virtualenv
$ mkdir ~/envs
$ virtualenv ~/envs/lsbaws/
$ cd ~/envs/lsbaws/
$ ls
bin  include  lib
$ source bin/activate
(lsbaws) $ pip install pyramid
(lsbaws) $ pip install flask
(lsbaws) $ pip install django
&lt;/pre&gt;
&lt;p&gt;åˆ°è¿™ä¸€æ­¥çš„æ—¶å€™ä½ éœ€è¦åˆ›å»ºä¸€ä¸ª Web åº”ç”¨ã€‚è®©æˆ‘ä»¬å…ˆç”¨ &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt; å¼€å§‹å§ã€‚æŠŠä¸‹é¢çš„ä»£ç ä¿å­˜ä¸º &lt;tt class="docutils literal"&gt;pyramidapp.py&lt;/tt&gt;  å¹¶æ”¾åˆ°ä½ ä¹‹å‰æ‰€ä¿å­˜çš„ &lt;tt class="docutils literal"&gt;webserver2.py&lt;/tt&gt; æ–‡ä»¶æˆ–ç›´æ¥ä» &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part2/pyramidapp.py"&gt;GitHub&lt;/a&gt; æ‰€ä¸‹è½½çš„æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼ˆå³ï¼šæŠŠ &lt;tt class="docutils literal"&gt;pyramidapp.py&lt;/tt&gt; æ”¾åœ¨ &lt;tt class="docutils literal"&gt;webserver2.py&lt;/tt&gt; æ‰€åœ¨ç›®å½•ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pyramid.config&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pyramid.response&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;hello_world&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;Hello world from Pyramid!&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;content_type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;text/plain&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;hello&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;/hello&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_view&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hello_world&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;route_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;hello&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_wsgi_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç°åœ¨ï¼Œä½ å¯ä»¥å‡†å¤‡ç”¨ä½ è‡ªå·±çš„ Web æœåŠ¡å™¨æ¥æœåŠ¡ä½ çš„ Pyramid åº”ç”¨äº†ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
(lsbaws) $ python webserver2.py pyramidapp:app
WSGIServer: Serving HTTP on port 8888 ...
&lt;/pre&gt;
&lt;p&gt;ä½ åªéœ€å‘Šè¯‰ä½ çš„æœåŠ¡å™¨ä» python æ¨¡å— &lt;tt class="docutils literal"&gt;pyramidapp&lt;/tt&gt; ä¸­è½½å…¥ä¸€ä¸ªå¯è°ƒç”¨çš„ &lt;tt class="docutils literal"&gt;app&lt;/tt&gt; å¯¹è±¡ï¼Œä½ çš„æœåŠ¡å™¨ç°åœ¨å·²ç»å‡†å¤‡å¥½
æ¥æ”¶è¯·æ±‚å¹¶æŠŠå®ƒä»¬è½¬å‘ç»™ä½ çš„ Pyramid åº”ç”¨äº†ã€‚
è¿™ä¸ªåº”ç”¨ç›®å‰åªå¤„ç†äº†ä¸€ä¸ªè·¯ç”±ï¼š&lt;tt class="docutils literal"&gt;/hello&lt;/tt&gt; è·¯ç”±ã€‚
åœ¨ä½ çš„æµè§ˆå™¨ä¸­è¾“å…¥ &lt;a class="reference external" href="http://localhost:8888/hello"&gt;http://localhost:8888/hello&lt;/a&gt; åœ°å€ï¼Œç„¶åæŒ‰ä¸‹å›è½¦é”®ï¼Œæ³¨æ„è¿”å›çš„ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pyramid" src="/static/images/lsbaws-part2/lsbaws_part2_browser_pyramid.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘½ä»¤æ¥æµ‹è¯•è¿™ä¸ªæœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ curl -v http://localhost:8888/hello
...
&lt;/pre&gt;
&lt;p&gt;æ£€æŸ¥æœåŠ¡å™¨ä»¥åŠ &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºçš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨è½®åˆ° &lt;a class="reference external" href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt; äº†ã€‚è®©æˆ‘ä»¬æŒ‰ç…§ç›¸åŒçš„æ­¥éª¤æ¥æ“ä½œã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt;
&lt;span class="n"&gt;flask_app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;flaskapp&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="nd"&gt;@flask_app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;/hello&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;hello_world&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;#39;Hello world from Flask!&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;mimetype&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;text/plain&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;flask_app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wsgi_app&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æŠŠä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º &lt;tt class="docutils literal"&gt;flaskapp.py&lt;/tt&gt;  æˆ–ä» &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part2/flaskapp.py"&gt;GitHub&lt;/a&gt; ä¸Šä¸‹è½½ï¼Œç„¶åç”¨ä»¥ä¸‹æ–¹å¼è¿è¡ŒæœåŠ¡å™¨:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
(lsbaws) $ python webserver2.py flaskapp:app
WSGIServer: Serving HTTP on port 8888 ...
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨åœ¨ä½ çš„æµè§ˆå™¨ä¸­è¾“å…¥ &lt;a class="reference external" href="http://localhost:8888/hello"&gt;http://localhost:8888/hello&lt;/a&gt; ç„¶åæŒ‰ä¸‹å›è½¦é”®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="Flask" src="/static/images/lsbaws-part2/lsbaws_part2_browser_flask.png" /&gt;&lt;/p&gt;
&lt;p&gt;å†ä¸€æ¬¡ï¼Œå°è¯• &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; å‘½ä»¤ï¼Œç„¶åçœ‹ä¸€ä¸‹æœåŠ¡å™¨è¿”å›çš„ç”±è¿™ä¸ª Flask åº”ç”¨æ‰€ç”Ÿæˆçš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ curl -v http://localhost:8888/hello
...
&lt;/pre&gt;
&lt;p&gt;è¿™ä¸ªæœåŠ¡å™¨èƒ½å¤„ç† &lt;a class="reference external" href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt; åº”ç”¨å—å•Šï¼Ÿè¯•ä¸€ä¸‹å°±çŸ¥é“äº†ï¼
è¿™æ¬¡æ¶‰åŠçš„ä¸œè¥¿æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘å»ºè®®ä½ å…‹éš†è¿™ä¸ª &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/"&gt;ä»“åº“&lt;/a&gt; ç„¶åä½¿ç”¨  GitHub ä»“åº“ ä¸­çš„ &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part2/djangoapp.py"&gt;djangoapp.py&lt;/a&gt; æ–‡ä»¶ã€‚
ä¸‹é¢çš„æºç ä¸»è¦æ˜¯æ·»åŠ  Django &lt;tt class="docutils literal"&gt;helloworld&lt;/tt&gt; é¡¹ç›®ï¼ˆé¢„å…ˆä½¿ç”¨ Django çš„ &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;django-admin.py&lt;/span&gt; startproject&lt;/tt&gt; å‘½ä»¤ï¼‰åˆ°å½“å‰ Python è·¯å¾„
ç„¶åå¯¼å…¥é¡¹ç›®ä¸­çš„ WSGI åº”ç”¨ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;insert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;./helloworld&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;helloworld&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;wsgi&lt;/span&gt;


&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;wsgi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æŠŠä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º &lt;tt class="docutils literal"&gt;djangoapp.py&lt;/tt&gt;  ç„¶åç”¨ä½ çš„ Web æœåŠ¡å™¨è¿è¡Œè¿™ä¸ª Django åº”ç”¨ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
(lsbaws) $ python webserver2.py djangoapp:app
WSGIServer: Serving HTTP on port 8888 ...
&lt;/pre&gt;
&lt;p&gt;è¾“å…¥å¦‚ä¸‹åœ°å€å¹¶å›è½¦ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="Django" src="/static/images/lsbaws-part2/lsbaws_part2_browser_django.png" /&gt;&lt;/p&gt;
&lt;p&gt;æ­£å¦‚ä½ ä¹‹å‰åšè¿‡çš„é‚£å‡ æ¬¡ä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿›è¡Œæµ‹è¯•ã€‚
ç¡®è®¤è¿™ä¸ª Django åº”ç”¨å¤„ç†äº†ä½ è¿™ä¸€æ¬¡çš„è¯·æ±‚ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ curl -v http://localhost:8888/hello
...
&lt;/pre&gt;
&lt;p&gt;ä½ è¯•è¿‡äº†å—ï¼Ÿä½ æœ‰ç¡®è®¤è¿‡è¿™ä¸ªæœåŠ¡å™¨å¯ä»¥ä¸è¿™ä¸‰ä¸ªæ¡†æ¶ä¸€èµ·å·¥ä½œå—ï¼Ÿ
å¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼Œä¸€å®šè¦è¯•ä¸€ä¸‹ã€‚
é˜…è¯»å¾ˆé‡è¦ï¼Œä½†æ˜¯è¿™ä¸ªç³»åˆ—è®²çš„æ˜¯å…³äºé‡æ–°æ„å»ºï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦æ‰‹åŠ¨è¿›è¡Œè¿™äº›å°è¯•ã€‚
å¿«å»è¯•è¯•å§ã€‚åˆ«æ‹…å¿ƒï¼Œæˆ‘ä¼šç­‰ä½ çš„ã€‚
æˆ‘æ˜¯è®¤çœŸçš„ï¼Œä½ å¿…é¡»å»å°è¯•ï¼Œæœ€å¥½èƒ½å¤Ÿäº²è‡ªä¸€ä¸ªå­—ä¸€ä¸ªå­—çš„æ•²ä¸‹æ‰€æœ‰çš„å­—ç¬¦ï¼Œ
å¹¶ç¡®ä¿å®ƒèƒ½è¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;å¥½äº†ï¼Œä½ å·²ç»ç†Ÿæ‚‰ WSGI çš„å¨åŠ›äº†ï¼šå®ƒå…è®¸ä½ æ··æ­ä½ çš„ Web æœåŠ¡å™¨å’Œ Web æ¡†æ¶ã€‚
WSGI è§„å®šäº† Python Web æœåŠ¡å™¨å’Œ  Python Web æ¡†æ¶ä¹‹é—´çš„ä¸€äº›æ¥å£ã€‚
å®ƒéå¸¸çš„ç®€å•ï¼Œä¸ç®¡æ˜¯åœ¨æœåŠ¡å™¨è¿˜æ˜¯æ¡†æ¶ç«¯éƒ½éå¸¸å®¹æ˜“å®ç°ã€‚
ä¸‹é¢çš„ç‰‡æ®µå±•ç¤ºäº†æœåŠ¡å™¨å’Œæ¡†æ¶ç«¯çš„æ¥å£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run_application&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Server code.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="c"&gt;# This is where an application/framework stores&lt;/span&gt;
    &lt;span class="c"&gt;# an HTTP status and HTTP response headers for the server&lt;/span&gt;
    &lt;span class="c"&gt;# to transmit to the client&lt;/span&gt;
    &lt;span class="n"&gt;headers_set&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="c"&gt;# Environment dictionary with WSGI/CGI variables&lt;/span&gt;
    &lt;span class="n"&gt;environ&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;start_response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;response_headers&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;exc_info&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;headers_set&lt;/span&gt;&lt;span class="p"&gt;[:]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;response_headers&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="c"&gt;# Server invokes the â€˜application&amp;#39; callable and gets back the&lt;/span&gt;
    &lt;span class="c"&gt;# response body&lt;/span&gt;
    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c"&gt;# Server builds an HTTP response and transmits it to the client&lt;/span&gt;
    &lt;span class="err"&gt;â€¦&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;app&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start_response&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;A barebones WSGI app.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;start_response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;200 OK&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;text/plain&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)])&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Hello world!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;run_application&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å®ƒçš„å·¥ä½œåŸç†æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;æ¡†æ¶æä¾›äº†ä¸€ä¸ª &lt;tt class="docutils literal"&gt;application&lt;/tt&gt; å¯è°ƒç”¨å¯¹è±¡ï¼ˆWSGI è§„èŒƒæ²¡æœ‰è§„å®šå®ƒåº”è¯¥å¦‚ä½•è¢«å®ç°ï¼‰&lt;/li&gt;
&lt;li&gt;æ¯å½“æ”¶åˆ°æ¥è‡ª HTTP å®¢æˆ·ç«¯çš„è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°±è°ƒç”¨è¿™ä¸ª &lt;tt class="docutils literal"&gt;application&lt;/tt&gt; å¯è°ƒç”¨å¯¹è±¡ã€‚
å®ƒæŠŠä¸€ä¸ªåŒ…å« WSGI/CGI å˜é‡çš„å­—å…¸ &lt;tt class="docutils literal"&gt;environ&lt;/tt&gt; å’Œä¸€ä¸ª &lt;tt class="docutils literal"&gt;start_response&lt;/tt&gt; å¯è°ƒç”¨å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™äº† &lt;tt class="docutils literal"&gt;application&lt;/tt&gt; å¯è°ƒç”¨å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;æ¡†æ¶/åº”ç”¨ç”Ÿæˆä¸€ä¸ª HTTP çŠ¶æ€ä¿¡æ¯å’Œ HTTP å“åº”å¤´ä¿¡æ¯ï¼Œå¹¶æŠŠå®ƒä»¬ä¼ é€’ç»™äº† &lt;tt class="docutils literal"&gt;start_response&lt;/tt&gt; å¯è°ƒç”¨å¯¹è±¡ï¼Œ
è®©æœåŠ¡å™¨æŠŠå®ƒä»¬å­˜èµ·æ¥ã€‚æ¡†æ¶/åº”ç”¨ä¹Ÿè¿”å›äº†ä¸€ä¸ªå“åº” body ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨æŠŠçŠ¶æ€ä¿¡æ¯ï¼Œå“åº”å¤´ä¿¡æ¯ä»¥åŠå“åº” body ä¿¡æ¯åˆå¹¶ä¸ºä¸€ä¸ª HTTP å“åº”ï¼Œç„¶åæŠŠå®ƒä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼ˆè¿™ä¸€æ­¥ä¸æ˜¯è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œ
ä½†æ˜¯å®ƒæ˜¯æµç¨‹ä¸­çš„ä¸‹ä¸€ä¸ªé€»è¾‘æ­¥éª¤ï¼Œä¸ºäº†æ¸…æ™°å¯è§æˆ‘æŠŠå®ƒåˆ—åœ¨äº†è¿™é‡Œï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢æ˜¯è¿™ä¸ªæ¥å£çš„å¯è§†åŒ–å›¾è¡¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="WSGI Interface Visual" src="/static/images/lsbaws-part2/lsbaws_part2_wsgi_interface.png" /&gt;&lt;/p&gt;
&lt;p&gt;åˆ°ç›®å‰ä½ç½®ï¼Œä½ å·²ç»è§è¿‡äº† &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt;, &lt;a class="reference external" href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt; ä»¥åŠ &lt;a class="reference external" href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt; Web åº”ç”¨ï¼Œä½ ä¹Ÿè§è¿‡äº†å®ç° WSGI è§„èŒƒçš„æœåŠ¡å™¨ç«¯ä»£ç ã€‚
ä½ ä¹Ÿè§è¿‡ä¸ç”¨ä»»ä½•æ¡†æ¶æ‰€å®ç°çš„æç®€ WSGI åº”ç”¨çš„ä»£ç ç‰‡æ®µã€‚&lt;/p&gt;
&lt;p&gt;äº‹å®æ˜¯ï¼Œå½“ä½ ç”¨è¿™äº›æ¡†æ¶ä¸­æŸä¸ªå¼€å‘ä¸€ä¸ª Web åº”ç”¨çš„æ—¶å€™ï¼Œä½ æ˜¯åœ¨é«˜å±‚é¢è¿›è¡Œå·¥ä½œï¼Œ
å¹¶æ²¡æœ‰ç›´æ¥ä¸ WSGI æ‰“äº¤åˆ°ï¼Œä½†æ˜¯æˆ‘çŸ¥é“éå¸¸å¥½å¥‡æ¡†æ¶ç«¯çš„ WSGI æ¥å£å®ç°ï¼Œä¹Ÿæ˜¯å› ä¸ºä½ æ­£åœ¨é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚
é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªä¸ä½¿ç”¨ &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt;, &lt;a class="reference external" href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt;, &lt;a class="reference external" href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt; çš„å¾®å‹ WSGI Web åº”ç”¨/Web æ¡†æ¶ï¼Œ
å¹¶ç”¨ä½ çš„æœåŠ¡å™¨æ¥è¿è¡Œå®ƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;app&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start_response&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;A barebones WSGI application.&lt;/span&gt;

&lt;span class="sd"&gt;    This is a starting point for your own Web framework :)&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;200 OK&amp;#39;&lt;/span&gt;
    &lt;span class="n"&gt;response_headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;text/plain&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
    &lt;span class="n"&gt;start_response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;response_headers&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Hello world from a simple WSGI application!&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å†ä¸€æ¬¡çš„ï¼ŒæŠŠä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º &lt;tt class="docutils literal"&gt;wsgiapp.py&lt;/tt&gt; æˆ–ç›´æ¥ä» &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part2/wsgiapp.py"&gt;GitHub&lt;/a&gt; ä¸Šä¸‹è½½å®ƒï¼Œç„¶åç”¨ä½ çš„
Web æœåŠ¡å™¨åƒä¸‹é¢è¿™æ ·è¿è¡Œè¿™ä¸ªåº”ç”¨ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
(lsbaws) $ python webserver2.py wsgiapp:app
WSGIServer: Serving HTTP on port 8888 ...
&lt;/pre&gt;
&lt;p&gt;è¾“å…¥å¦‚ä¸‹åœ°å€å¹¶æŒ‰ä¸‹å›è½¦é”®ã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°è¿™æ ·çš„ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="Simple WSGI Application" src="/static/images/lsbaws-part2/lsbaws_part2_browser_simple_wsgi_app.png" /&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å­¦ä¹ å¦‚ä½•åˆ›å»ºä¸€ä¸ª Web æœåŠ¡å™¨çš„åŒæ—¶ï¼Œä½ åˆšåˆšåˆå†™äº†ä¸€ä¸ªä½ è‡ªå·±çš„å¾®å‹ WSGI WEB æ¡†æ¶ï¼
çœŸæ˜¯æ„å¤–ä¹‹å–œï¼&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ°æœåŠ¡å™¨éƒ½ç»™å®¢æˆ·ç«¯ä¼ è¾“äº†ä»€ä¹ˆä¸œè¥¿ã€‚
ä¸‹é¢æ˜¯å½“ä½ ä½¿ç”¨ HTTP å®¢æˆ·ç«¯è°ƒç”¨ä½ çš„ Pyramind åº”ç”¨æ—¶ï¼ŒæœåŠ¡å™¨ç”Ÿæˆçš„ HTTP å“åº”ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="HTTP Response Part 1" src="/static/images/lsbaws-part2/lsbaws_part2_http_response.png" /&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå“åº”æœ‰ä¸€äº›ä½ åœ¨ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-1-zh-cn.html"&gt;ç¬¬ä¸€éƒ¨åˆ†&lt;/a&gt; çœ‹åˆ°è¿‡çš„ä¸œè¥¿ï¼Œä½†æ˜¯å®ƒä¹Ÿæœ‰ä¸€äº›æ–°ä¸œè¥¿ã€‚æ¯”å¦‚è¯´ï¼Œå®ƒæœ‰å››ä¸ªä½ ä¹‹å‰è¿˜æ²¡è§è¿‡çš„ &lt;a class="reference external" href="http://en.wikipedia.org/wiki/List_of_HTTP_header_fields"&gt;HTTP headers&lt;/a&gt;ï¼š
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;Content-Type&lt;/span&gt;&lt;/tt&gt; , &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;Content-Length&lt;/span&gt;&lt;/tt&gt; , &lt;tt class="docutils literal"&gt;Date&lt;/tt&gt; ä»¥åŠ &lt;tt class="docutils literal"&gt;Server&lt;/tt&gt; .
è¿™äº›åŒ…å«åœ¨å“åº”é‡Œçš„å¤´ä¿¡æ¯æ˜¯ä¸€ä¸ª Web æœåŠ¡å™¨åº”è¯¥è¦ç”Ÿæˆçš„ä¿¡æ¯ã€‚
è™½ç„¶å®ƒä»¬ä¸­æ²¡æœ‰ä¸€ä¸ªæ˜¯ä¸¥æ ¼è¦æ±‚å¿…é¡»æä¾›çš„ã€‚
è¿™äº›å¤´ä¿¡æ¯çš„ç›®çš„æ˜¯ä¼ è¾“å…³äº HTTP è¯·æ±‚/å“åº”çš„é™„åŠ ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ä½ å·²ç»äº†è§£äº†å…³äº WSGI æ¥å£çš„æ›´è¯¦ç»†çš„ä¿¡æ¯äº†ï¼Œä¸‹é¢æ˜¯åŒä¸€ä¸ª HTTP å“åº”éƒ¨åˆ†æ˜¯å¦‚ä½•äº§ç”Ÿçš„æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="HTTP Response Part 2" src="/static/images/lsbaws-part2/lsbaws_part2_http_response_explanation.png" /&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘è¿˜æ²¡æœ‰è¯´è¿‡ä»»ä½•æœ‰å…³ &lt;tt class="docutils literal"&gt;environ&lt;/tt&gt; å­—å…¸ç›¸å…³çš„ä¿¡æ¯ï¼Œä½†æ˜¯ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å®ƒæ˜¯ä¸€ä¸ª Python å­—å…¸ï¼Œå®ƒå¿…é¡»åŒ…å«æŸäº›ç”± WSGI è§„èŒƒæ‰€è§„å®šçš„ WSGI å’Œ CGI å˜é‡ã€‚
è§£æå®Œè¯·æ±‚ä¿¡æ¯åï¼ŒæœåŠ¡å™¨ä» HTTP è¯·æ±‚ä¸­å¾—åˆ°è¿™ä¸ªå­—å…¸æ‰€éœ€çš„ä¸€äº›å€¼ã€‚
è¿™ä¸ªå­—å…¸çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="Environ Python Dictionary" src="/static/images/lsbaws-part2/lsbaws_part2_environ.png" /&gt;&lt;/p&gt;
&lt;p&gt;Web æ¡†æ¶ä½¿ç”¨æ¥è‡ªè¿™ä¸ªå­—å…¸é‡Œçš„ä¿¡æ¯æ¥å†³å®šé‚£ä¸ª view å¯ä»¥è¢«ç”¨æ¥æœåŠ¡ï¼ŒåŸºäºè·å¾—çš„è·¯ç”±ï¼Œè¯·æ±‚æ–¹æ³•ç­‰ä¿¡æ¯,
å†³å®šå¯ä»¥ä»å“ªé‡Œè¯»å–è¯·æ±‚çš„ body ä¿¡æ¯ä»¥åŠå“ªé‡Œå¯ä»¥ç”¨æ¥å†™å…¥é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæœ‰çš„è¯ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»åˆ›å»ºäº†ä½ è‡ªå·±çš„ WSGI Web æœåŠ¡å™¨ï¼Œä½ ä¹Ÿç”¨ä¸åŒçš„ Web æ¡†æ¶ç¼–å†™è¿‡ Web åº”ç”¨äº†ã€‚åŒæ—¶ï¼Œä½ ä¹Ÿé¡ºä¾¿åˆ›å»ºè¿‡æå…¶ç®€é™‹çš„ Web åº”ç”¨/Web æ¡†æ¶ã€‚
çœŸæ˜¯ä¸€ä¸ªæ“è›‹çš„æ—…ç¨‹ã€‚è®©æˆ‘ä»¬æ¥é‡è¿°ä¸€ä¸‹ä¸ºäº†æœåŠ¡ä¸€ä¸ªé’ˆå¯¹ WSGI åº”ç”¨çš„è¯·æ±‚ä¿¡æ¯ï¼Œä½ çš„ WSGI Web æ¡†æ¶éœ€è¦åšçš„äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;é¦–å…ˆï¼ŒæœåŠ¡å™¨å¯åŠ¨å¹¶è½½å…¥ä¸€ä¸ªç”±ä½ çš„ Web æ¡†æ¶/åº”ç”¨æ‰€å®šä¹‰çš„ &lt;tt class="docutils literal"&gt;application&lt;/tt&gt; å¯è°ƒç”¨å¯¹è±¡&lt;/li&gt;
&lt;li&gt;ç„¶åï¼ŒæœåŠ¡å™¨è¯»å–ä¸€ä¸ªè¯·æ±‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼ŒæœåŠ¡å™¨è§£æè¿™ä¸ªè¯·æ±‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼ŒæœåŠ¡å™¨ç”¨è¿™ä¸ªè¯·æ±‚æ•°æ®æ„å»ºäº†ä¸€ä¸ª &lt;tt class="docutils literal"&gt;environ&lt;/tt&gt; å­—å…¸&lt;/li&gt;
&lt;li&gt;ç„¶åï¼ŒæœåŠ¡å™¨ä»¥ &lt;tt class="docutils literal"&gt;environ&lt;/tt&gt; å­—å…¸å’Œä¸€ä¸ª &lt;tt class="docutils literal"&gt;start_response&lt;/tt&gt; å¯è°ƒç”¨å¯¹è±¡ä½œä¸ºå‚æ•°æ¥è°ƒç”¨ &lt;tt class="docutils literal"&gt;application&lt;/tt&gt; å¯¹è±¡ï¼Œå¹¶è·å¾—ä¸€ä¸ªè¿”å›çš„å“åº” body ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼ŒæœåŠ¡å™¨ç”¨é€šè¿‡è°ƒç”¨ &lt;tt class="docutils literal"&gt;application&lt;/tt&gt; å¯¹è±¡è·å¾—çš„ body æ•°æ®ä»¥åŠé€šè¿‡ &lt;tt class="docutils literal"&gt;start_reponse&lt;/tt&gt; å¯è°ƒç”¨å¯¹è±¡è®¾ç½®çš„çŠ¶æ€ä¿¡æ¯å’Œå“åº”å¤´ä¿¡æ¯ä¸€èµ·æ„å»ºäº†ä¸€ä¸ª HTTP å“åº”ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼ŒæœåŠ¡å™¨æŠŠ HTTP å“åº”ä¼ è¾“å›å®¢æˆ·ç«¯&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img alt="Server Summary" src="/static/images/lsbaws-part2/lsbaws_part2_server_summary.png" /&gt;&lt;/p&gt;
&lt;p&gt;å°±è¿™äº›äº†ã€‚ä½ ç°åœ¨æœ‰äº†ä¸€ä¸ªå¯ä»¥å·¥ä½œçš„ WSGI æœåŠ¡å™¨ï¼Œå®ƒèƒ½å¤ŸæœåŠ¡é‚£äº›ç”¨ WSGI å…¼å®¹çš„ Web æ¡†æ¶ï¼ˆæ¯”å¦‚ï¼š&lt;a class="reference external" href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt;, &lt;a class="reference external" href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt;, &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt; æˆ–è€…æ˜¯ä½ è‡ªå·±å¼€å‘çš„ WSGI æ¡†æ¶) å¼€å‘çš„åŸºç¡€çš„ Web åº”ç”¨ã€‚æœ€æ£’çš„æ˜¯ä¸éœ€è¦ä¿®æ”¹ä»»ä½•çš„æœåŠ¡å™¨ä»£ç å°±å¯ä»¥ä¸å¤šä¸ª Web æ¡†æ¶ä¸€èµ·ä½¿ç”¨ã€‚ç›®å‰çœ‹èµ·æ¥è¿˜ä¸èµ–å˜›ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½ ç¦»å¼€å‰ï¼Œè¿™é‡Œæœ‰å¦ä¸€ä¸ªé—®é¢˜éœ€è¦ä½ æ€è€ƒï¼Œâ€å¦‚ä½•è®©ä½ çš„æœåŠ¡å™¨èƒ½å¤Ÿåœ¨åŒä¸€æ—¶åˆ»å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Ÿâ€œ&lt;/p&gt;
&lt;p&gt;æ•¬è¯·æœŸå¾…ï¼Œåœ¨ &lt;a class="reference external" href="https://mozillazg.com/2015/08/let-us-build-a-web-server-part-3-zh-cn.html"&gt;ç¬¬ä¸‰éƒ¨åˆ†&lt;/a&gt; æˆ‘å°†å‘ä½ å±•ç¤ºä¸€ç§æ–¹æ³•ã€‚åŠ æ²¹ï¼&lt;/p&gt;
</summary><category term="server"></category><category term="http"></category><category term="wsgi"></category><category term="lsbaws"></category><category term="è®©æˆ‘ä»¬ä¸€èµ·æ¥æ„å»ºä¸€ä¸ª Web æœåŠ¡å™¨"></category></entry><entry><title>è®©æˆ‘ä»¬ä¸€èµ·æ¥æ„å»ºä¸€ä¸ª Web æœåŠ¡å™¨ï¼ˆä¸€ï¼‰</title><link href="https://mozillazg.com/2015/06/let-us-build-a-web-server-part-1-zh-cn.html" rel="alternate"></link><updated>2015-06-03T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2015-06-03:2015/06/let-us-build-a-web-server-part-1-zh-cn.html</id><summary type="html">&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a class="reference external" href="http://ruslanspivak.com/lsbaws-part1/"&gt;http://ruslanspivak.com/lsbaws-part1/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ‰ä¸€å¤©å‡ºå»æ•£æ­¥çš„æ—¶å€™ï¼Œä¸€ä¸ªå¥³äººæ¥åˆ°ä¸€å¤„å·¥åœ°ä¸Šï¼Œå¥¹çœ‹åˆ°æœ‰ä¸‰ä¸ªç”·äººåœ¨å·¥ä½œã€‚
å¥¹é—®ç¬¬ä¸€ä¸ªäººï¼Œâ€œä½ åœ¨åšä»€ä¹ˆï¼Ÿâ€œï¼Œç¬¬ä¸€ä¸ªç”·äººå¯¹è¿™ä¸ªé—®é¢˜æ„Ÿåˆ°éå¸¸çš„åŒçƒ¦ï¼Œ
ä»–å¤§å£°çš„è¯´åˆ°â€ä½ æ²¡çœ‹åˆ°æˆ‘æ­£åœ¨ç Œç –å—ï¼Ÿâ€œå¥³äººå¯¹è¿™ä¸ªç­”æ¡ˆä¸å¤§æ»¡æ„ï¼Œ
å¥¹åˆå»é—®ç¬¬äºŒä¸ªç”·äººä»–åœ¨åšä»€ä¹ˆã€‚
ç¬¬äºŒä¸ªç”·äººå›ç­”é“ï¼Œâ€æˆ‘æ­£åœ¨å»ºé€ ä¸€é¢ç –å¢™ã€‚â€
ç„¶åï¼Œä»–æŠŠæ³¨æ„åŠ›è½¬å‘äº†ç¬¬ä¸€ä¸ªç”·äººï¼Œä»–è¯´é“ï¼Œ
â€œå˜¿ï¼Œä½ åªå®Œæˆå¢™çš„å°¾éƒ¨ã€‚ä½ éœ€è¦æŠŠæœ€åé‚£å—ç –æ‹¿æ‰ã€‚â€
ä»æ—§ä¸æ»¡æ„è¿™ä¸ªç­”æ¡ˆï¼Œå¥¹åˆé—®ç¬¬ä¸‰ä¸ªç”·äººä»–åœ¨åšä»€ä¹ˆã€‚
è¿™ä¸ªç”·äººè¾¹æœ›ç€å¤©è¾¹å¯¹ä»–è¯´ï¼Œ
â€æˆ‘æ­£åœ¨å»ºé€ ä¸–ç•Œä¸Šæœ€å¤§çš„æ•™å ‚ã€‚â€œ
å½“ä»–ç«™åœ¨è¿™é‡Œä»°æœ›ç€å¤©ç©ºçš„æ—¶å€™ï¼Œå¦å¤–ä¸¤ä¸ªç”·äººå¼€å§‹äº‰åµåº”è¯¥æ€ä¹ˆæ”¾ç –ã€‚
è¿™ä¸ªç”·äººè½¬å‘å‰é¢çš„ä¸¤ä¸ªç”·äººå¹¶è¯´é“ï¼Œ
â€œå˜¿ï¼Œä¼™è®¡ä»¬ï¼Œåˆ«æ‹…å¿ƒé‚£å—ç –äº†ã€‚é‚£åªæ˜¯ä¸€å—å†…å¢™ï¼Œ
å®ƒå°†ä¼šè¢«æ¶‚å¹³æ²¡äººä¼šçœ‹åˆ°é‚£å—ç –ã€‚
åªéœ€ç§»åŠ¨åˆ°å¦ä¸€å±‚ã€‚â€ &lt;a class="footnote-reference" href="#id2" id="id1"&gt;[1]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿™åˆ™æ•…äº‹çš„å¯“æ„æ˜¯å½“ä½ äº†è§£äº†æ•´ä¸ªç³»ç»Ÿå¹¶ä¸”ç†è§£äº†ä¸åŒçš„éƒ¨åˆ†æ˜¯å¦‚ä½•ç»„åˆåœ¨ä¸€èµ·çš„æ—¶å€™ï¼ˆç –ï¼Œå¢™ï¼Œæ•™å ‚ï¼‰ï¼Œ
ä½ å°±å¯ä»¥æ›´å¿«çš„è¯†åˆ«å’Œè§£å†³é—®é¢˜ï¼ˆä¸æ­£ç¡®çš„ç –ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä»é›¶å¼€å§‹åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„ Web server æ¥è¯´éœ€è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘ç›¸ä¿¡è¦æˆä¸ºä¸€ä¸ªä¼˜ç§€çš„å¼€å‘è€…ä½ å¿…é¡»æ›´å¥½çš„ç†è§£ä½ æ—¥å¸¸ä½¿ç”¨çš„åŸºç¡€è½¯ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç¼–ç¨‹è¯­è¨€ï¼Œç¼–è¯‘å™¨ï¼Œè§£é‡Šå™¨ï¼Œæ•°æ®åº“å’Œæ“ä½œç³»ç»Ÿï¼Œweb server å’Œ web æ¡†æ¶ã€‚åŒæ—¶ï¼Œä¸ºäº†æ›´æ·±å…¥çš„ç†è§£æ•´ä¸ªç³»ç»Ÿï¼Œå¿…é¡»ä»é›¶å¼€å§‹ï¼Œä¸€å—ç –ä¸€é¢å¢™çš„é‡æ–°æ„å»ºå®ƒä»¬&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å­æ›¾ç»æ›°è¿‡ï¼š&lt;/p&gt;
&lt;blockquote&gt;
â€œæˆ‘å¬åˆ°ï¼Œæˆ‘å¿˜è®°ã€‚â€œ&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="LSBAWS_confucius_hear.png" src="/static/images/lsbaws-part1/LSBAWS_confucius_hear.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
â€æˆ‘çœ‹åˆ°ï¼Œæˆ‘è®°ä½ã€‚â€œ&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="LSBAWS_confucius_see.png" src="/static/images/lsbaws-part1/LSBAWS_confucius_see.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
â€æˆ‘åšåˆ°ï¼Œæˆ‘ç†è§£ã€‚â€œ&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="LSBAWS_confucius_do.png" src="/static/images/lsbaws-part1/LSBAWS_confucius_do.png" /&gt;&lt;/p&gt;
&lt;p&gt;æ­¤åˆ»ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½æ·±ä¿¡é€šè¿‡é‡æ–°æ„å»ºä¸€ä¸ªä¸åŒçš„è½¯ä»¶ç³»ç»Ÿæ¥å­¦ä¹ å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸‰ç¯‡ç³»åˆ—ä¸­æˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•æ„å»ºä½ è‡ªå·±çš„åŸºç¡€çš„ Web serverã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆå¼€å§‹æœ€é‡è¦çš„äº‹æƒ…ï¼Œä»€ä¹ˆæ˜¯ä¸€ä¸ª Web serverï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;img alt="LSBAWS_HTTP_request_response.png" src="/static/images/lsbaws-part1/LSBAWS_HTTP_request_response.png" /&gt;&lt;/p&gt;
&lt;p&gt;ä¸€è¨€ä»¥è”½ä¹‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰©ç†æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨ï¼ˆå“å‘€ï¼Œä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„æœåŠ¡å™¨ï¼‰åŒæ—¶ç­‰å¾…å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚
å½“å®ƒæ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œå®ƒå°†ç”Ÿæˆä¸€ä¸ªå“åº”å¹¶æŠŠå®ƒå‘é€å›å®¢æˆ·ç«¯ã€‚
å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„é€šä¿¡æ–¹å¼æ˜¯ä½¿ç”¨çš„ HTTP åè®®ã€‚
å®¢æˆ·ç«¯å¯ä»¥æ˜¯ä½ çš„æµè§ˆå™¨æˆ–å…¶ä»–ä¼šè¯´ HTTP çš„ä»»ä½•è½¯ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªéå¸¸ç®€å•çš„ Web server å®ç°é•¿ä»€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘æ”¾äº†ä¸€ä¸ªåœ¨è¿™é‡Œã€‚è¿™ä¸ªä¾‹å­ä½¿ç”¨ Python å†™çš„ï¼Œä½†æ˜¯å°±ç®—ä½ ä¸æ‡‚ Pythonï¼ˆå®ƒæ˜¯ä¸ªéå¸¸å®¹æ˜“å­¦ä¹ çš„è¯­è¨€ï¼Œä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼ï¼‰ä½ ä¹Ÿèƒ½å¤Ÿä»ä¸‹é¢çš„ä»£ç å’Œè§£é‡Šä¸­ç†è§£åŸºæœ¬çš„æ¦‚å¿µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;

&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8888&lt;/span&gt;

&lt;span class="n"&gt;listen_socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Serving HTTP on port &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt; ...&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;
&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client_address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listen_socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;

    &lt;span class="n"&gt;http_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s"&gt;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class="s"&gt;Hello, World!&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http_response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;client_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å°†ä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º &lt;em&gt;webserver1.py&lt;/em&gt; æˆ–è€…ç›´æ¥ä» &lt;a class="reference external" href="https://github.com/rspivak/lsbaws/blob/master/part1/webserver1.py"&gt;GitHub&lt;/a&gt;  ä¸Šä¸‹è½½ä¸‹æ¥ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸‹åƒè¿™æ ·è¿è¡Œ:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ python webserver1.py
Serving HTTP on port 8888 â€¦
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨åœ¨ä½ æµè§ˆå™¨çš„åœ°å€æ ä¸­è¾“å…¥å¦‚ä¸‹é“¾æ¥ &lt;a class="reference external" href="http://localhost:8888/hello"&gt;http://localhost:8888/hello&lt;/a&gt; ï¼ŒæŒ‰å›è½¦é”®ç„¶åå°±å¯ä»¥çœ‹åˆ°é­”æ³•æ•ˆæœäº†ã€‚
ä½ åº”è¯¥ä¼šçœ‹åˆ°åœ¨ä½ çš„æµè§ˆå™¨ä¸­æ˜¾ç¤º &amp;quot;Hello, World!â€ ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="browser_hello_world.png" src="/static/images/lsbaws-part1/browser_hello_world.png" /&gt;&lt;/p&gt;
&lt;p&gt;æ”¾æ‰‹å»åšå§ï¼Œè¯´çœŸçš„ã€‚å½“ä½ åœ¨æµ‹è¯•çš„æ—¶å€™æˆ‘ä¼šç­‰ä½ çš„ã€‚&lt;/p&gt;
&lt;p&gt;åšå®Œäº†ï¼Ÿéå¸¸å¥½ã€‚ç°åœ¨è®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹å®ƒå®é™…ä¸Šæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè®©æˆ‘ä»¬ä»ä½ è¾“å…¥çš„ Web åœ°å€å¼€å§‹ã€‚å®ƒè¢«å«åš &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Uniform_resource_locator"&gt;URL&lt;/a&gt; ï¼Œä¸‹é¢æ˜¯å®ƒçš„åŸºæœ¬ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="LSBAWS_URL_Web_address.png" src="/static/images/lsbaws-part1/LSBAWS_URL_Web_address.png" /&gt;&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯ä½ å¦‚ä½•å‘Šè¯‰ä½ çš„æµè§ˆå™¨å®ƒéœ€è¦ç”¨æ¥æŸ¥æ‰¾å’Œè¿æ¥çš„ Web server åœ°å€ä»¥åŠéœ€è¦æ˜¾ç¤ºç»™ä½ çš„ä½äºæœåŠ¡å™¨ä¸Šçš„é¡µé¢ï¼ˆè·¯å¾„ï¼‰ã€‚
åœ¨ä½ çš„æµè§ˆå™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚å‰ï¼Œå®ƒé¦–å…ˆéœ€è¦ä¸ Web server å»ºç«‹ä¸€æ¡ TCP è¿æ¥ã€‚
ç„¶åå†é€šè¿‡è¿™ä¸ª TCP è¿æ¥å‘é€ä¸€ä¸ª HTTP è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œç„¶åç­‰å¾…æœåŠ¡å™¨å‘é€å›ä¸€ä¸ª HTTP å“åº”ã€‚
å½“ä½ çš„æµè§ˆå™¨æ¥æ”¶åˆ°è¿™ä¸ªå“åº”çš„æ—¶å€™ï¼Œå®ƒå°±ä¼šæ˜¾ç¤ºå®ƒã€‚
åœ¨è¿™é‡Œå®ƒå°†æ˜¾ç¤º &amp;quot;Hello, World!&amp;quot;&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ›´è¯¦ç»†çš„æ¢ç´¢ä¸€ä¸‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨å‘é€ HTTP è¯·æ±‚å’Œå“åº”ä¹‹å‰æ˜¯å¦‚ä½•å»ºç«‹ä¸€æ¡ TCP è¿æ¥çš„ã€‚
ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨äº†æ‰€è°“çš„ sockets ã€‚
ä¸ºäº†ä»£æ›¿æµè§ˆå™¨ç›´è¿ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨ telnet å‘½ä»¤çš„æ–¹å¼æ¥æ‰‹åŠ¨æ¨¡æ‹Ÿæµè§ˆå™¨çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½ è¿è¡Œ Web server çš„ç”µè„‘ä¸Šæ‰“å¼€ä¸€ä¸ª telnet ä¼šè¯ï¼Œå¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šè¾“å…¥ telent å¹¶æŒ‡å®šè¿æ¥åˆ° localhost è¿™ä¸ªä¸»æœºå’Œ 8888 è¿™ä¸ªç«¯å£ï¼Œç„¶åæŒ‰ä¸‹å›è½¦é”®ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ telnet localhost 8888
Trying 127.0.0.1 â€¦
Connected to localhost.
&lt;/pre&gt;
&lt;p&gt;æ­¤åˆ»ï¼Œä½ å·²ç»ä¸è¿è¡Œåœ¨ä½ çš„æœ¬åœ°æœºå™¨ä¸Šçš„å‡†å¤‡å‘é€å’Œæ¥æ”¶ HTTP æ¶ˆæ¯çš„æœåŠ¡å™¨å»ºç«‹äº†ä¸€æ¡ TCP è¿æ¥ã€‚
åœ¨ä¸‹é¢çš„å›¾ç‰‡ä¸­ä½ å°†çœ‹åˆ°ä¸€å¥—æ ‡å‡†çš„ç¨‹åºï¼ŒæœåŠ¡å™¨å¿…é¡»éµå®ˆè¿™å¥—ç¨‹åºä»¥ä¾¿èƒ½å¤Ÿæ¥å—æ–°çš„ TCP è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="LSBAWS_socket.png" src="/static/images/lsbaws-part1/LSBAWS_socket.png" /&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç›¸åŒçš„ telnet ä¼šè¯ä¸­è¾“å…¥ &lt;tt class="docutils literal"&gt;GET /hello HTTP/1.1&lt;/tt&gt; ç„¶åæŒ‰ä¸‹å›è½¦é”®ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ telnet localhost 8888
Trying 127.0.0.1 â€¦
Connected to localhost.
GET /hello HTTP/1.1

HTTP/1.1 200 OK
Hello, World!
&lt;/pre&gt;
&lt;p&gt;ä½ åˆšåˆšæ‰‹åŠ¨æ¨¡æ‹Ÿäº†ä½ çš„æµè§ˆå™¨ï¼ä½ å‘é€äº†ä¸€ä¸ª HTTP è¯·æ±‚å¹¶æ”¶åˆ°äº†ä¸€ä¸ª HTTP å“åº”ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ HTTP è¯·æ±‚çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="LSBAWS_HTTP_request_anatomy.png" src="/static/images/lsbaws-part1/LSBAWS_HTTP_request_anatomy.png" /&gt;&lt;/p&gt;
&lt;p&gt;HTTP è¯·æ±‚åŒ…å«äº†ä¸€ä¸ªè¡¨ç¤º HTTP æ–¹æ³•çš„è¡Œï¼ˆGET, å› ä¸ºæˆ‘ä»¬è¦æ±‚æˆ‘ä»¬çš„æœåŠ¡å™¨è¿”å›æˆ‘ä»¬ä¸€ä¸‹ä¸œè¥¿ï¼‰ï¼Œ
è·¯å¾„ /hello è¡¨ç¤ºäº†æœåŠ¡å™¨ä¸Šä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„â€é¡µé¢â€œï¼Œä»¥åŠåè®®ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬çš„ Web server åœ¨è¿™é‡Œå®Œå…¨å¿½ç•¥äº†ä¸Šé¢æåˆ°çš„è¯·æ±‚è¡Œã€‚
ä½ å¯ä»¥ç”¨ä»»ä½•åƒåœ¾æ•°æ®ä»£æ›¿ â€GET /hello HTTP/1.1â€œï¼Œä½ ä¾ç„¶å¯ä»¥å¾—åˆ°ä¸€ä¸ªå†…å®¹ä¸º â€Hello, World!â€œ çš„å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦ä½ è¾“å…¥å®Œè¯·æ±‚è¡Œå¹¶æŒ‰ä¸‹å›è½¦é”®ï¼Œå®¢æˆ·ç«¯å°±ä¼šæŠŠè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è¯»å–è¯·æ±‚è¡Œï¼Œæ‰“å°å‡ºæ¥ï¼Œå¹¶è¿”å›åˆé€‚çš„ HTTP å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ server å‘é€å›ä½ çš„å®¢æˆ·ç«¯(åœ¨è¿™é‡Œæ˜¯ telnet)çš„ HTTP å“åº”ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="LSBAWS_HTTP_response_anatomy.png" src="/static/images/lsbaws-part1/LSBAWS_HTTP_response_anatomy.png" /&gt;&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ã€‚å“åº”åŒ…æ‹¬ä¸€ä¸ªçŠ¶æ€è¡Œ &lt;tt class="docutils literal"&gt;HTTP/1.1&amp;nbsp; 200 OK&lt;/tt&gt;, æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªç©ºè¡Œï¼Œç„¶åæ˜¯ HTTP å“åº”çš„ body ã€‚&lt;/p&gt;
&lt;p&gt;response çŠ¶æ€è¡Œ &lt;tt class="docutils literal"&gt;HTTP/1.1 200 OK&lt;/tt&gt; åŒ…æ‹¬äº† HTTP ç‰ˆæœ¬ï¼ŒHTTP çŠ¶æ€ç  ä»¥åŠ HTTP çŠ¶æ€ç åŸå› è¯ç»„ OKã€‚
å½“æµè§ˆå™¨è·å–åˆ°å“åº”æ—¶ï¼Œå®ƒå°†æ˜¾ç¤ºå“åº”çš„ body éƒ¨åˆ†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ èƒ½åœ¨ä½ çš„æµè§ˆå™¨ä¸­çœ‹åˆ° â€œHello, World!â€ çš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯ä¸€ä¸ª Web server å¦‚ä½•å·¥ä½œçš„åŸºæœ¬æ¨¡å‹äº†ã€‚æ€»ç»“ä¸€ä¸‹ï¼š Web server åˆ›å»ºä¸€ä¸ª socket ç›‘å¬å¹¶å¼€å§‹åœ¨ä¸€ä¸ªå¾ªç¯é‡Œæ¥å—æ–°çš„è¿æ¥ã€‚å®¢æˆ·ç«¯å¯åŠ¨ä¸€ä¸ª TCP è¿æ¥ï¼ŒæˆåŠŸå»ºç«‹è¿æ¥ä¹‹åå®¢æˆ·ç«¯å‘é€ä¸€ä¸ª HTTP è¯·æ±‚åˆ° server ï¼Œç„¶å server å“åº”ä¸€ä¸ªå±•ç¤ºç»™ç”¨æˆ·çš„ HTTP response ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½ä½¿ç”¨ socket æ¥å»ºç«‹ TCP è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ä½ å·²ç»æœ‰ä¸€ä¸ªéå¸¸åŸºç¡€çš„ Web server äº†ï¼Œä½ å¯ä»¥ç”¨ä½ çš„æµè§ˆå™¨æˆ–å…¶ä»–çš„ HTTP å®¢æˆ·ç«¯æ¥æµ‹è¯•å®ƒã€‚
æ­£å¦‚ä½ è§è¿‡çš„ï¼Œå¦‚æœæƒ³å°è¯•çš„è¯ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ telent æ‰‹åŠ¨è¾“å…¥ HTTP è¯·æ±‚çš„æ–¹å¼æˆä¸ºä¸€ä¸ªäººè‚‰ HTTP å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸ªé—®é¢˜è¦é—®ä½ ï¼šâ€œå¦‚ä½•åœ¨ä½ è¿™ä¸ªæ–°é²œå‡ºç‚‰çš„ Web server ä¸Šè¿è¡Œä¸€ä¸ª Django åº”ç”¨ï¼Œ
Flask åº”ç”¨ï¼Œä»¥åŠ Pyramid åº”ç”¨ï¼Œå¹¶ä¸”ä¸éœ€è¦åšä»»ä½•çš„æ”¹åŠ¨å°±å¯ä»¥é€‚åº”è¿™äº›ä¸åŒçš„ Web æ¡†æ¶ï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;æˆ‘å°†åœ¨ &lt;a class="reference external" href="http://mozillazg.com/2015/06/let-us-build-a-web-server-part-2-zh-cn.html"&gt;ç¬¬äºŒç¯‡æ–‡ç« &lt;/a&gt; ä¸­å‘ä½ è¯¦ç»†çš„è®²è§£ã€‚æ•¬è¯·æœŸå¾…ã€‚&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id2" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label" /&gt;&lt;col /&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;çµæ„Ÿæ¥è‡ª &lt;a class="reference external" href="http://www.amazon.com/gp/product/0814420303/ref=as_li_tl?ie=UTF8&amp;amp;camp=1789&amp;amp;creative=9325&amp;amp;creativeASIN=0814420303&amp;amp;linkCode=as2&amp;amp;tag=russblo0b-20&amp;amp;linkId=HY2LNXTSGPPFZ2EV"&gt;Lead with a Story: A Guide to Crafting Business Narratives That Captivate, Convince, and Inspire&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</summary><category term="server"></category><category term="http"></category><category term="lsbaws"></category><category term="è®©æˆ‘ä»¬ä¸€èµ·æ¥æ„å»ºä¸€ä¸ª Web æœåŠ¡å™¨"></category></entry><entry><title>[python]ä¿®å¤ python-gearman å‡ºç° Received non-binary arguments é”™è¯¯</title><link href="https://mozillazg.com/2015/04/fix-python-gearman-raise-received-non-binary-arguments-errors.html" rel="alternate"></link><updated>2015-04-20T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2015-04-20:2015/04/fix-python-gearman-raise-received-non-binary-arguments-errors.html</id><summary type="html">&lt;p&gt;ä»Šå¤©ç¬¬ä¸€æ¬¡ä½¿ç”¨ python-gearman å°±å‡ºç°äº† &lt;tt class="docutils literal"&gt;Received &lt;span class="pre"&gt;non-binary&lt;/span&gt; arguments&lt;/tt&gt; é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢é‡ç°ä¸€ä¸‹é”™è¯¯ï¼Œå½“ä¼ å…¥çš„ task_name å‚æ•°ç±»å‹æ˜¯ unicode æ—¶å°±ä¼šæŠ¥é”™:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
client.submit_job(u&amp;quot;task1&amp;quot;)  # error: Received non-binary arguments
&lt;/pre&gt;
&lt;p&gt;æŸ¥çœ‹æºç åå‘ç°ï¼Œæ˜¯å› ä¸º gearman client submit_job çš„ task name ä¸æ”¯æŒ unicode, æŠŠå‚æ•°ç±»å‹æ”¹æˆ str æˆ– bytes å°±å¯ä»¥äº†ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
client.submit_job(b&amp;quot;task1&amp;quot;)  # ok
&lt;/pre&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/Yelp/python-gearman/blob/740a23f20f39f0f0d557e25afe998e56cc72a9bf/gearman/protocol.py#L246"&gt;python-gearman/protocol.py at 740a23f20f39f0f0d557e25afe998e56cc72a9bf Â· Yelp/python-gearman&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary></entry><entry><title>ä¿®å¤å®‰è£… psycopg2 æ—¶å‡ºç°â€œpg_config executable not foundâ€é”™è¯¯</title><link href="https://mozillazg.com/2015/03/fix-install-psycopg2-raise-pg_config-excutable-not-found.html" rel="alternate"></link><updated>2015-03-15T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2015-03-15:2015/03/fix-install-psycopg2-raise-pg_config-excutable-not-found.html</id><summary type="html">&lt;p&gt;é”™è¯¯è¯¦æƒ…ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;Running&lt;/span&gt; &lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt; &lt;span class="n"&gt;egg_info&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;package&lt;/span&gt; &lt;span class="n"&gt;psycopg2&lt;/span&gt;

    &lt;span class="nl"&gt;Error:&lt;/span&gt; &lt;span class="n"&gt;pg_config&lt;/span&gt; &lt;span class="n"&gt;executable&lt;/span&gt; &lt;span class="n"&gt;not&lt;/span&gt; &lt;span class="n"&gt;found&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;

    &lt;span class="n"&gt;Please&lt;/span&gt; &lt;span class="n"&gt;add&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;directory&lt;/span&gt; &lt;span class="n"&gt;containing&lt;/span&gt; &lt;span class="n"&gt;pg_config&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;PATH&lt;/span&gt;
    &lt;span class="n"&gt;or&lt;/span&gt; &lt;span class="n"&gt;specify&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;full&lt;/span&gt; &lt;span class="n"&gt;executable&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;option&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;

        &lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt; &lt;span class="n"&gt;build_ext&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;pg&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pg_config&lt;/span&gt; &lt;span class="n"&gt;build&lt;/span&gt; &lt;span class="p"&gt;...&lt;/span&gt;

    &lt;span class="n"&gt;or&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;pg_config&lt;/span&gt; &lt;span class="n"&gt;option&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cfg&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å‡ºé”™çš„åŸå› æ˜¯å› ä¸ºæ‰¾ä¸åˆ° &lt;code&gt;pg_config&lt;/code&gt; å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘çš„æœºå™¨ä¸Š &lt;code&gt;pg_config&lt;/code&gt; ç¨‹åºåœ¨ &lt;code&gt;/usr/pgsql-9.4/bin/&lt;/code&gt; ç›®å½•ä¸‹ï¼Œåªéœ€è®© &lt;code&gt;pg_config&lt;/code&gt; å‘½ä»¤å¯ä»¥è¢«æ‰¾åˆ°å°±å¯ä»¥äº†ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;ln&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pgsql&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;9.4&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pg_config&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pg_config&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary></entry><entry><title>[python] è§£å†³ SQLAlchemy æç¤º Instance is not bound to a Session é”™è¯¯çš„é—®é¢˜</title><link href="https://mozillazg.com/2014/12/python-sqlalchemy-fix-Instance-is-not-bound-to-a-Session-error.html" rel="alternate"></link><updated>2014-12-22T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-12-22:2014/12/python-sqlalchemy-fix-Instance-is-not-bound-to-a-Session-error.html</id><summary type="html">&lt;p&gt;åœ¨ä½¿ç”¨ SQLAlchemy çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶ä¼šå‡ºç°ä¸‹åˆ—é”™è¯¯:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Parent instance '&amp;lt;User at 0x2b45b53509d0&amp;gt;' is not bound to a Session; lazy load operation of attribute  cannot proceed&lt;/li&gt;
&lt;li&gt;Instance '&amp;lt;User at 0x2b45b53509d0&amp;gt;' is not bound to a Session; attribute refresh operation cannot proceed&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‡ºç°ä»¥ä¸Šé”™è¯¯çš„åŸå› æ˜¯å› ä¸ºï¼šsession å·²ç»è¢«æäº¤ï¼Œå¯¼è‡´æ“ä½œçš„ model å¯¹è±¡å·²ç»ä¸åœ¨å½“å‰ session ä¸­äº†ã€‚
è§£å†³çš„åŠæ³•å°±æ˜¯ï¼šæŠŠå¯¹è±¡é‡æ–°åŠ å…¥åˆ°å½“å‰ session ä¸­:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;foo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c"&gt;# do something...&lt;/span&gt;
    &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Jim&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;foo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;  &lt;span class="c"&gt;# False&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;  &lt;span class="c"&gt;# DetachedInstanceError: Instance &amp;lt;User at 0x2b45b53509d0&amp;gt; is not bound to a Session&lt;/span&gt;

&lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;merge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;  &lt;span class="c"&gt;# True&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;  &lt;span class="c"&gt;# Jim&lt;/span&gt;
&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;refresh&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;  &lt;span class="c"&gt;# Eric&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://flask-webtest.readthedocs.org/en/latest/#using-flask-webtest-with-flask-sqlalchemy"&gt;https://flask-webtest.readthedocs.org/en/latest/#using-flask-webtest-with-flask-sqlalchemy&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary></entry><entry><title>[python] redis-py æ¨¡å—ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„ä¸€äº›äº‹æƒ…</title><link href="https://mozillazg.com/2014/12/python-redis-py-notes.html" rel="alternate"></link><updated>2014-12-21T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-12-21:2014/12/python-redis-py-notes.html</id><summary type="html">&lt;div class="section" id="redis-strictredis"&gt;
&lt;h2&gt;Redis ç±» ä¸ StrictRedis ç±»&lt;/h2&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;Redis&lt;/tt&gt; ç±» ä¸ &lt;tt class="docutils literal"&gt;StrictRedis&lt;/tt&gt; ç±»æ–¹æ³•çš„ä¸€äº›å·®å¼‚ï¼ˆ&lt;tt class="docutils literal"&gt;StrictRedis&lt;/tt&gt; å®ç°çš„æ˜¯æ ‡å‡† redis å‘½ä»¤ï¼‰ï¼š&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="8%" /&gt;
&lt;col width="45%" /&gt;
&lt;col width="48%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;å‘½ä»¤&lt;/th&gt;
&lt;th class="head"&gt;Redis&lt;/th&gt;
&lt;th class="head"&gt;StrictRedis&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;SETEX&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;setex(name, value, time)&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;setex(name, time, value)&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;ZADD&lt;/td&gt;
&lt;td&gt;&lt;p class="first"&gt;&lt;tt class="docutils literal"&gt;zadd(name, *args, **kwargs)&lt;/tt&gt;&lt;/p&gt;
&lt;ul class="last simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;args&lt;/tt&gt;: name1, score1, name2, score2,...&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;kwargs&lt;/tt&gt;: name1=score1, name2=score2,...&lt;/li&gt;
&lt;/ul&gt;
&lt;/td&gt;
&lt;td&gt;&lt;p class="first"&gt;&lt;tt class="docutils literal"&gt;zadd(name, *args, **kwargs)&lt;/tt&gt;&lt;/p&gt;
&lt;ul class="last simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;args&lt;/tt&gt;: score1, name1, score2, name2,...&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;kwargs&lt;/tt&gt;: score1=name1, score2=name2,...&lt;/li&gt;
&lt;/ul&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;LREM&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;lrem(name, value, num=0)&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;lrem(name, count, value)&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="responseerror-wrong-number-of-arguments-for-xxx-command"&gt;
&lt;h2&gt;ResponseError: wrong number of arguments for 'xxx' command&lt;/h2&gt;
&lt;p&gt;å½“ä½¿ç”¨ &lt;tt class="docutils literal"&gt;*args&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;**kwargs&lt;/tt&gt; å‚æ•°æ—¶å®¹æ˜“å‡ºç°è¿™ä¸ª &lt;tt class="docutils literal"&gt;ResponseError&lt;/tt&gt; é”™è¯¯ã€‚
ä½¿ç”¨å‰éœ€è¦å…ˆæ£€æŸ¥ &lt;tt class="docutils literal"&gt;args&lt;/tt&gt; å’Œ &lt;tt class="docutils literal"&gt;kwargs&lt;/tt&gt; æ˜¯å¦ä¸ºç©º:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
if keys:
    r.hdel('name', *keys)
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/andymccurdy/redis-py"&gt;https://github.com/andymccurdy/redis-py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://redis-py.readthedocs.org/en/latest/"&gt;http://redis-py.readthedocs.org/en/latest/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary></entry><entry><title>[python]é€šè¿‡ alembic æ›´æ”¹å¤–é”®ç›¸å…³çš„å±æ€§</title><link href="https://mozillazg.com/2014/11/python-alembic-change-foreignkey-attribute.html" rel="alternate"></link><updated>2014-11-25T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-11-25:2014/11/python-alembic-change-foreignkey-attribute.html</id><summary type="html">&lt;p&gt;å½“æˆ‘ä»¬æƒ³ä¿®æ”¹å·²æœ‰çš„å¤–é”®å­—æ®µå±æ€§å€¼æ—¶ï¼Œ &lt;tt class="docutils literal"&gt;alembic reversion &lt;span class="pre"&gt;--autogenerate&lt;/span&gt;&lt;/tt&gt; æ— æ³•æ£€æŸ¥å¤–é”®å±æ€§ä¿®æ”¹ï¼Œ
éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å†™ç›¸å…³çš„æ“ä½œè¯­å¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä»¥ä¿®æ”¹å¤–é”®çš„ &lt;tt class="docutils literal"&gt;ondelete&lt;/tt&gt; å’Œ &lt;tt class="docutils literal"&gt;onupdate&lt;/tt&gt; å±æ€§ä¸ºä¾‹ï¼Œè®²è§£å¦‚ä½•ä¿®æ”¹å¤–é”®å±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰å¦‚ä¸‹ Model:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Parent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Base&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;__tablename__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;parent&amp;#39;&lt;/span&gt;
    &lt;span class="nb"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;primary_key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;children&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;relationship&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Child&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Child&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Base&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;__tablename__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;child&amp;#39;&lt;/span&gt;
    &lt;span class="nb"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;primary_key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;parent_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;parent.id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç°åœ¨æƒ³è¦ä¿®æ”¹ &lt;tt class="docutils literal"&gt;Child&lt;/tt&gt; ä¸­ &lt;tt class="docutils literal"&gt;parent_id&lt;/tt&gt; çš„å¤–é”®å±æ€§:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;parent_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;parent.id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;onupdate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;CASCADE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ondelete&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;CASCADE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é¦–å…ˆï¼Œéœ€è¦ä»æ•°æ®ä¸­æŸ¥çœ‹ `` child`` çš„å»ºè¡¨è¯­å¥ï¼Œæ‰¾åˆ°å¤–é”®åç§°:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
mysql&amp;gt;show create table child;
| child | CREATE TABLE `child` (
  `id` int(10) NOT NULL AUTO_INCREMENT,
  `parent_id` int(10) DEFAULT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`) REFERENCES `parent` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=66 DEFAULT CHARSET=utf8 |
&lt;/pre&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;child_ibfk_1&lt;/tt&gt; å³ä¸ºå¤–é”®åç§°&lt;/p&gt;
&lt;p&gt;ç„¶åé€šè¿‡ &lt;tt class="docutils literal"&gt;alembic reversion&lt;/tt&gt; ç”Ÿæˆä¸€ä¸ª version æ–‡ä»¶ï¼Œæ‰“å¼€ç”Ÿæˆçš„æ–‡ä»¶ç¼–è¾‘å†…å®¹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;upgrade&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c"&gt;### commands auto generated by Alembic - please adjust! ###&lt;/span&gt;
    &lt;span class="c"&gt;# åˆ é™¤å·²æœ‰å¤–é”®         å¤–é”®åç§°        è¡¨å&lt;/span&gt;
    &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;drop_constraint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;child_ibfk_1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;child&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;type_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;foreignkey&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c"&gt;# é‡æ–°æ·»åŠ å¤–é”®&lt;/span&gt;
    &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create_foreign_key&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;child_ibfk_1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;    &lt;span class="c"&gt;# å¤–é”®åç§°&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;child&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;           &lt;span class="c"&gt;# å½“å‰è¡¨çš„è¡¨å&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;          &lt;span class="c"&gt;# å¤–é”®æŒ‡å‘çš„ç›®æ ‡è¡¨çš„è¡¨å&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;parent_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;     &lt;span class="c"&gt;# å¤–é”®åˆ—åï¼ˆå­—æ®µåï¼‰&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;            &lt;span class="c"&gt;# ä¸ç›®æ ‡è¡¨çš„æŸä¸€åˆ—ï¼ˆå­—æ®µï¼‰å»ºç«‹å¤–é”®å…³ç³»&lt;/span&gt;
        &lt;span class="n"&gt;onupdate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CASCADE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ondelete&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CASCADE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# æ–°å¢çš„å±æ€§&lt;/span&gt;
    &lt;span class="c"&gt;### end Alembic commands ###&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;downgrade&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c"&gt;### commands auto generated by Alembic - please adjust! ###&lt;/span&gt;
    &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;drop_constraint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;child_ibfk_1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;child&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;type_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;foreignkey&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create_foreign_key&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;child_ibfk_1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;child&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;parent_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="c"&gt;### end Alembic commands ###&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a class="reference external" href="http://alembic.readthedocs.org/en/latest/ops.html#alembic.operations.Operations.drop_constraint"&gt;drop_constraint&lt;/a&gt; å’Œ &lt;a class="reference external" href="http://alembic.readthedocs.org/en/latest/ops.html#alembic.operations.Operations.create_foreign_key"&gt;create_foreign_key&lt;/a&gt; çš„åŸºæœ¬ç”¨æ³•å·²ç»åœ¨ä¸Šé¢çš„æ³¨é‡Šä¸­æœ‰è¯´æ˜äº†ï¼Œ
æƒ³è¦æ›´è¯¦ç»†çš„ç”¨æ³•ï¼Œè¯·é˜…è¯»ç›¸åº”çš„å®˜æ–¹æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;div class="section" id="id3"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://alembic.readthedocs.org/en/latest/ops.html#alembic.operations.Operations.create_foreign_key"&gt;create_foreign_key Operation Reference â€” Alembic 0.7.0 documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://alembic.readthedocs.org/en/latest/ops.html#alembic.operations.Operations.drop_constraint"&gt;drop_constraint Operation Reference â€” Alembic 0.7.0 documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://groups.google.com/forum/?_escaped_fragment_=topic/sqlalchemy-alembic/wHk9ZAtzmcw#!topic/sqlalchemy-alembic/wHk9ZAtzmcw"&gt;Add ondelete='CASCADE' to existing foreignkey - Google ã‚°ãƒ«ãƒ¼ãƒ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/urschrei/CDP/blob/master/db/versions/25b06dd4bab6_add_sign_orphan_deletion_to_cdp.py"&gt;CDP/25b06dd4bab6_add_sign_orphan_deletion_to_cdp.py at master Â· urschrei/CDP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://bitbucket.org/zzzeek/alembic/issue/44/"&gt;zzzeek / alembic / issues / #44 - need operation to drop foreign key â€” Bitbucket&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_9/orm/session.html#cascades"&gt;Cascades - Using the Session â€” SQLAlchemy 0.9 Documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="sqlalchemy"></category><category term="alembic"></category></entry><entry><title>[python]é€šè¿‡ alembic é‡å‘½åè¡¨åˆ—åï¼ˆModelå­—æ®µåï¼‰</title><link href="https://mozillazg.com/2014/11/python-alembic-rename-column-name-field-name.html" rel="alternate"></link><updated>2014-11-25T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-11-25:2014/11/python-alembic-rename-column-name-field-name.html</id><summary type="html">&lt;p&gt;ä¸ºä»€ä¹ˆè¦ç‰¹æ„è®²ä¸€ä¸‹è¿™ä¸ªï¼Œæ˜¯å› ä¸º alembic æ— æ³•è‡ªåŠ¨æ£€æµ‹æ˜¯å¦å¯¹å­—æ®µåè¿›è¡Œäº†é‡å‘½åæ“ä½œï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ ç›¸å…³è¯­å¥ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸‹é¢è¿™æ ·ä¸€ä¸ª Model&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Base&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;__tablename__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;

    &lt;span class="nb"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;primary_key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨æƒ³è¦æŠŠ &lt;tt class="docutils literal"&gt;name&lt;/tt&gt; å­—æ®µæ”¹åä¸º &lt;tt class="docutils literal"&gt;username&lt;/tt&gt;, é€šè¿‡ &lt;tt class="docutils literal"&gt;alembic revision &lt;span class="pre"&gt;--autogenerate&lt;/span&gt;&lt;/tt&gt; æ— æ³•å®ç°æˆ‘ä»¬çš„ç›®çš„:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
INFO  [alembic.migration] Context impl MySQLImpl.
INFO  [alembic.migration] Will assume non-transactional DDL.
INFO  [alembic.autogenerate.compare] Detected added column 'user.username'
INFO  [alembic.autogenerate.compare] Detected removed column 'user.name'
  Generating /home/xx/alembic/versions/4475103466d3_rename_user_name_to_username.py .
.. done
&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢çš„æ£€æµ‹ç»“æœæ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œéœ€è¦æ‰‹åŠ¨æ›´æ”¹ç”Ÿæˆçš„ version æ–‡ä»¶:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;sqlalchemy.dialects&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;mysql&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;upgrade&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c"&gt;### commands auto generated by Alembic - please adjust! ###&lt;/span&gt;
    &lt;span class="c"&gt;# æŠŠ user è¡¨é‡Œçš„ name åˆ—é‡å‘½åä¸º username&lt;/span&gt;
    &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alter_column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new_column_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;username&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;existing_type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;VARCHAR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="c"&gt;### end Alembic commands ###&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;downgrade&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c"&gt;### commands auto generated by Alembic - please adjust! ###&lt;/span&gt;
    &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alter_column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;username&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new_column_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;existing_type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;VARCHAR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="c"&gt;### end Alembic commands ###&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;alemblic upgrade&lt;/tt&gt; å‘½ä»¤ç»“æœ:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ alembic upgrade 549c504fe1b5:4475103466d3 --sql
INFO  [alembic.migration] Context impl MySQLImpl.
INFO  [alembic.migration] Generating static SQL
INFO  [alembic.migration] Will assume non-transactional DDL.
INFO  [alembic.migration] Running upgrade 549c504fe1b5 -&amp;gt; 4475103466d3, rename User.name to username
-- Running upgrade 549c504fe1b5 -&amp;gt; 4475103466d3

ALTER TABLE user CHANGE name username VARCHAR(20) NULL;

UPDATE alembic_version SET version_num='4475103466d3';
&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„ sql è¯­å¥å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;tt class="docutils literal"&gt;alter_column&lt;/tt&gt; æ–¹æ³•è¿›è¡Œé‡å‘½åçš„åŸºæœ¬ç”¨æ³•å°±æ˜¯ &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;alter_column('è¡¨å',&lt;/span&gt; 'å…ˆæœ‰çš„åˆ—å', &lt;span class="pre"&gt;new_column_name='é‡å‘½ååçš„åˆ—å',&lt;/span&gt; existring_type=å­—æ®µç±»å‹)&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;tt class="docutils literal"&gt;alter_column&lt;/tt&gt; æ–¹æ³•å¯ä»¥æ›´å¤šçš„ &lt;tt class="docutils literal"&gt;ALTER TABLE&lt;/tt&gt; æ“ä½œï¼Œè¯¦è§ &lt;a class="reference external" href="http://alembic.readthedocs.org/en/latest/ops.html#alembic.operations.Operations.alter_column"&gt;æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://alembic.readthedocs.org/en/latest/ops.html#alembic.operations.Operations.alter_column"&gt;Operation Reference â€” Alembic 0.7.0 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="alembic"></category><category term="sqlalchemy"></category></entry><entry><title>[python]å¦‚ä½•å¤åˆ¶ä¸€ä¸ª class</title><link href="https://mozillazg.com/2014/11/python-copy-a-class.html" rel="alternate"></link><updated>2014-11-20T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-11-20:2014/11/python-copy-a-class.html</id><summary type="html">&lt;p&gt;é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹æ³•å¯ä»¥å¤åˆ¶ä¸€ä¸ª &lt;code&gt;class&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;class B(A): pass&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;B = type("B", (A,), {})&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_1"&gt;å‚è€ƒèµ„æ–™&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/9541025/how-to-copy-a-python-class"&gt;How to copy a python class? - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary></entry><entry><title>[python]ä½¿ç”¨ tox æµ‹è¯•ä»£ç åœ¨ä¸åŒç¯å¢ƒä¸‹çš„å…¼å®¹æ€§</title><link href="https://mozillazg.com/2014/07/python-use-tox-test-code.html" rel="alternate"></link><updated>2014-07-16T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-07-16:2014/07/python-use-tox-test-code.html</id><summary type="html">&lt;div class="section" id="tox"&gt;
&lt;h2&gt;Tox æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Tox æ˜¯ä¸ªæ ‡å‡†çš„ &lt;a class="reference external" href="https://pypi.python.org/pypi/virtualenv"&gt;virtualenv&lt;/a&gt; ç®¡ç†å™¨å’Œå‘½ä»¤è¡Œæµ‹è¯•å·¥å…·ã€‚ä½ å¯ä»¥ç”¨äº:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;æ£€æŸ¥ä½ çš„è½¯ä»¶åŒ…èƒ½å¦åœ¨ä¸åŒçš„ Python ç‰ˆæœ¬æˆ–è§£é‡Šå™¨ä¸‹æ­£å¸¸å®‰è£…&lt;/li&gt;
&lt;li&gt;åœ¨ä¸åŒçš„ç¯å¢ƒä¸­è¿è¡Œè¿è¡Œä½ çš„æµ‹è¯•ä»£ç &lt;/li&gt;
&lt;li&gt;ä½œä¸ºæŒç»­é›†æˆæœåŠ¡å™¨çš„å‰ç«¯ï¼Œå¤§å¤§å‡å°‘æµ‹è¯•å·¥ä½œæ‰€éœ€æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å®‰è£…&lt;/h2&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;pip install tox&lt;/tt&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;ç®€å•ä½¿ç”¨&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨å‰ï¼Œè¯·ç¡®ä¿ç³»ç»Ÿä¸­å·²ç»å®‰è£…äº†ä¸åŒç‰ˆæœ¬çš„ Python è§£é‡Šå™¨&lt;/strong&gt; :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
 ~$ python -V
Python 2.7.6
 ~$ python2.6 -V
Python 2.6.9
 ~$ python3.3 -V
Python 3.3.2+
 ~$ python3.4 -V
Python 3.4.0
 ~$ pypy -V
Python 2.7.3 (2.2.1+dfsg-1, Nov 28 2013, 05:13:10)
[PyPy 2.2.1 with GCC 4.8.2]
&lt;/pre&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸ªé¡¹ç›®å« hello_tox, åŒ…å« test_hello.py å’Œ setup.py ä¸¤ä¸ªæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;test_hello.py&lt;/tt&gt; å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
def test_hell():
    print 'hello'
&lt;/pre&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;setup.py&lt;/tt&gt; å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
from setuptools import setup

setup(
    name=&amp;quot;test_tox&amp;quot;,
    script=['test_hello'],
)
&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ tox æµ‹è¯•è¿™ä¸ªç¨‹åºã€‚&lt;/p&gt;
&lt;div class="section" id="id3"&gt;
&lt;h3&gt;å»ºç«‹é…ç½®æ–‡ä»¶&lt;/h3&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;tox-quickstart&lt;/span&gt;&lt;/tt&gt; å‘½ä»¤æˆ–æ–‡æœ¬ç¼–è¾‘å™¨åœ¨ &lt;strong&gt;é¡¹ç›®æ ¹ç›®å½•/setup.py æ‰€åœ¨ç›®å½•&lt;/strong&gt; å»ºç«‹é…ç½®æ–‡ä»¶ tox.ini :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# content of: tox.ini , put in same dir as setup.py
[tox]
# è¦æµ‹è¯•çš„ Python ç‰ˆæœ¬
envlist = py27,py34
[testenv]
# å®‰è£…ä¾èµ–
deps=pytest
# æµ‹è¯•æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤
commands=py.test
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class="literal-block"&gt;
 ~/hello_tox$ tree
.
â”œâ”€â”€ setup.py
â”œâ”€â”€ test_hello.py
â””â”€â”€ tox.ini

0 directories, 3 files
&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œ &lt;tt class="docutils literal"&gt;tox&lt;/tt&gt; å‘½ä»¤:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
 ~/hello_tox$ tox
GLOB sdist-make: /home/xxx/hello_tox/setup.py
py27 create: /home/xxx/hello_tox/.tox/py27
py27 installdeps: pytest
py27 inst: /home/xxx/hello_tox/.tox/dist/test_tox-0.0.0.zip
py27 runtests: PYTHONHASHSEED='2501568866'
py27 runtests: commands[0] | py.test
================================================================ test session starts ================================================================
platform linux2 -- Python 2.7.6 -- py-1.4.21 -- pytest-2.5.2
collected 1 items

test_hello.py .

============================================================= 1 passed in 0.01 seconds ==============================================================
py34 create: /home/xxx/hello_tox/.tox/py34
py34 installdeps: pytest
py34 inst: /home/xxx/hello_tox/.tox/dist/test_tox-0.0.0.zip
py34 runtests: PYTHONHASHSEED='2501568866'
py34 runtests: commands[0] | py.test
================================================================ test session starts ================================================================
platform linux -- Python 3.4.0 -- py-1.4.21 -- pytest-2.5.2
collected 0 items / 1 errors

====================================================================== ERRORS =======================================================================
__________________________________________________________ ERROR collecting test_hello.py ___________________________________________________________
.tox/py34/lib/python3.4/site-packages/_pytest/python.py:451: in _importtestmodule
    mod = self.fspath.pyimport(ensuresyspath=True)
.tox/py34/lib/python3.4/site-packages/py/_path/local.py:620: in pyimport
    __import__(modname)
E     File &amp;quot;/home/xxx/hello_tox/test_hello.py&amp;quot;, line 2
E       print 'hello'
E                   ^
E   SyntaxError: invalid syntax
============================================================== 1 error in 0.05 seconds ==============================================================
ERROR: InvocationError: '/home/xxx/hello_tox/.tox/py34/bin/py.test'
______________________________________________________________________ summary ______________________________________________________________________
  py27: commands succeeded
ERROR:   py34: commands failed
 ~/hello_tox$
&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢å°±æ˜¯æµ‹è¯•çš„ç»“æœäº†ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id4"&gt;
&lt;h2&gt;é«˜çº§ä½¿ç”¨&lt;/h2&gt;
&lt;div class="section" id="id5"&gt;
&lt;h3&gt;è‡ªå®šä¹‰ç¯å¢ƒ&lt;/h3&gt;
&lt;p&gt;é»˜è®¤æ”¯æŒå¦‚ä¸‹ç¯å¢ƒåç§°ï¼š&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;py24  (python 2.4)&lt;/li&gt;
&lt;li&gt;py25  (python 2.5)&lt;/li&gt;
&lt;li&gt;py26  (python 2.6)&lt;/li&gt;
&lt;li&gt;py27  (python 2.7)&lt;/li&gt;
&lt;li&gt;py30  (python 3.0)&lt;/li&gt;
&lt;li&gt;py31  (python 3.1)&lt;/li&gt;
&lt;li&gt;py32  (python 3.2)&lt;/li&gt;
&lt;li&gt;py33  (python 3.3)&lt;/li&gt;
&lt;li&gt;py34  (python 3.4)&lt;/li&gt;
&lt;li&gt;jython (jpython)&lt;/li&gt;
&lt;li&gt;pypy   (pypy)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‡ªå®šä¹‰ä¸åŒçš„ç¯å¢ƒï¼Œæ¯”å¦‚è¯´&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;py26-webpy  (python 2.6 + web.py)&lt;/li&gt;
&lt;li&gt;py33-bottle (python 3.3 + bottle)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¿®æ”¹ä¸Šé¢çš„ tox.ini æ–‡ä»¶:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# content of: tox.ini , put in same dir as setup.py
[tox]
# ç¯å¢ƒåˆ—è¡¨
envlist = py26-webpy,py33-bottle

[testenv]
# æµ‹è¯•æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤
commands = py.test

# å®šä¹‰åä¸º base çš„ç¯å¢ƒ
[base]
deps = pytest

# å®šä¹‰åä¸º py26-webpy çš„ç¯å¢ƒ
[testenv:py26-webpy]
# Python è§£é‡Šå™¨
basepython = python2.6
# ä¾èµ–
# åŒæ—¶åº”ç”¨ base ä¸­å®šä¹‰çš„ deps å˜é‡
deps =
  {[base]deps}
  web.py

# å®šä¹‰åä¸º py33-bottle çš„ç¯å¢ƒ
[testenv:py33-bottle]
basepython = python3.3
deps =
  {[base]deps}
  bottle
&lt;/pre&gt;
&lt;p&gt;æ›´æ”¹ test_hello.py æ–‡ä»¶:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
import web
import bottle


def test_hell():
    print 'hello'
&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œ &lt;cite&gt;tox&lt;/cite&gt; å‘½ä»¤:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
 ~/hello_tox$ tox
GLOB sdist-make: /home/xxx/hello_tox/setup.py
py26-webpy create: /home/xxx/hello_tox/.tox/py26-webpy
py26-webpy installdeps: pytest, web.py
py26-webpy inst: /home/xxx/hello_tox/.tox/dist/test_tox-0.0.0.zip
py26-webpy runtests: PYTHONHASHSEED='4132868947'
py26-webpy runtests: commands[0] | py.test
=================================================== test session starts ====================================================
platform linux2 -- Python 2.6.9 -- py-1.4.21 -- pytest-2.5.2
collected 0 items / 1 errors

========================================================== ERRORS ==========================================================
______________________________________________ ERROR collecting test_hello.py ______________________________________________
test_hello.py:2: in &amp;lt;module&amp;gt;
    import bottle
E   ImportError: No module named bottle
================================================= 1 error in 0.05 seconds ==================================================
ERROR: InvocationError: '/home/xxx/hello_tox/.tox/py26-webpy/bin/py.test'
py33-bottle create: /home/xxx/hello_tox/.tox/py33-bottle
py33-bottle installdeps: pytest, bottle
py33-bottle inst: /home/xxx/hello_tox/.tox/dist/test_tox-0.0.0.zip
py33-bottle runtests: PYTHONHASHSEED='4132868947'
py33-bottle runtests: commands[0] | py.test
=================================================== test session starts ====================================================
platform linux -- Python 3.3.2 -- py-1.4.21 -- pytest-2.5.2
collected 0 items / 1 errors

========================================================== ERRORS ==========================================================
______________________________________________ ERROR collecting test_hello.py ______________________________________________
.tox/py33-bottle/lib/python3.3/site-packages/_pytest/python.py:451: in _importtestmodule
    mod = self.fspath.pyimport(ensuresyspath=True)
.tox/py33-bottle/lib/python3.3/site-packages/py/_path/local.py:620: in pyimport
    __import__(modname)
E     File &amp;quot;/home/xxx/hello_tox/test_hello.py&amp;quot;, line 6
E       print 'hello'
E                   ^
E   SyntaxError: invalid syntax
================================================= 1 error in 0.04 seconds ==================================================
ERROR: InvocationError: '/home/xxx/hello_tox/.tox/py33-bottle/bin/py.test'
_________________________________________________________ summary __________________________________________________________
ERROR:   py26-webpy: commands failed
ERROR:   py33-bottle: commands failed
 ~/hello_tox$
&lt;/pre&gt;
&lt;p&gt;å…¶ä»–ç”¨æ³•è¯·é˜…è¯» &lt;a class="reference external" href="http://tox.readthedocs.org/en/latest/"&gt;Tox å®˜æ–¹æ–‡æ¡£&lt;/a&gt; æˆ–åç»­æ›´æ–°ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</summary></entry><entry><title>[python] å®šä¹‰æŠ½è±¡åŸºç±»(Abstract Base Classes)</title><link href="https://mozillazg.com/2014/06/python-define-abstract-base-classes.html" rel="alternate"></link><updated>2014-06-07T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-06-07:2014/06/python-define-abstract-base-classes.html</id><summary type="html">&lt;p&gt;æŠ½è±¡åŸºç±»ä¸€èˆ¬ç”¨äºè§„å®šå­ç±»å¿…é¡»é‡æ–°å®šä¹‰æŸäº›æ–¹æ³•ã€‚æ¯”å¦‚ web æ¡†æ¶ä¸­çš„ cache éƒ¨åˆ†çš„åŸºç±»ä¸€èˆ¬ç±»ä¼¼ä¸‹é¢è¿™æ ·:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;NotImplementedError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;subclasses of BaseCache must provide a get() method&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;NotImplementedError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;subclasses of BaseCache must provide a set() method&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MemcachedCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BaseCache&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_cache&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_cache&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åœ¨æ’ä»¶ã€cacheã€session ç­‰æ”¯æŒåŠŸèƒ½æ‰©å±•çš„ç³»ç»Ÿä¸­ï¼Œå¸¸ç”¨æŠ½è±¡åŸºç±»æ¥ç»Ÿä¸€æ¥å£ã€‚&lt;/p&gt;
&lt;!--  --&gt;
&lt;blockquote&gt;
&lt;p&gt;Why use Abstract Base Classes?&lt;/p&gt;
&lt;p&gt;Abstract base classes are a form of interface checking more strict than individual hasattr() checks for particular methods. By defining an abstract base class, you can define a common API for a set of subclasses. This capability is especially useful in situations where a third-party is going to provide implementations, such as with plugins to an application, but can also aid you when working on a large team or with a large code-base where keeping all classes in your head at the same time is difficult or not possible.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸‹é¢ä»‹ç»ä¸‰ç§å®šä¹‰æŠ½è±¡åŸºç±»çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class="section" id="assert"&gt;
&lt;h2&gt;ä½¿ç”¨ assert è¯­å¥&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;subclasses of BaseClass must provide an action() method&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="ne"&gt;AssertionError&lt;/span&gt;                            &lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;69&lt;/span&gt;&lt;span class="n"&gt;f195c0ee1f&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="n"&gt;c84a2cb72e&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
      &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;         &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;subclasses of BaseClass must provide an action() method&amp;#39;&lt;/span&gt;

&lt;span class="ne"&gt;AssertionError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;subclasses&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;BaseClass&lt;/span&gt; &lt;span class="n"&gt;must&lt;/span&gt; &lt;span class="n"&gt;provide&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="notimplementederror"&gt;
&lt;h2&gt;ä½¿ç”¨ NotImplementedError å¼‚å¸¸&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;NotImplementedError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;subclasses of BaseClass must provide an action() method&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="ne"&gt;NotImplementedError&lt;/span&gt;                       &lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;69&lt;/span&gt;&lt;span class="n"&gt;f195c0ee1f&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;81782&lt;/span&gt;&lt;span class="n"&gt;a1e8377&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
      &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;         &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;NotImplementedError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;subclasses of BaseClass must provide an action() method&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="ne"&gt;NotImplementedError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;subclasses&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;BaseClass&lt;/span&gt; &lt;span class="n"&gt;must&lt;/span&gt; &lt;span class="n"&gt;provide&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="abc"&gt;
&lt;h2&gt;ä½¿ç”¨ abc æ¨¡å—&lt;/h2&gt;
&lt;p&gt;python 2.6, 2.7:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;abc&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ABCMeta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;abstractmethod&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;__metaclass__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ABCMeta&lt;/span&gt;

    &lt;span class="nd"&gt;@abstractmethod&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="ne"&gt;TypeError&lt;/span&gt;                                 &lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;69&lt;/span&gt;&lt;span class="n"&gt;f195c0ee1f&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="ne"&gt;TypeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Can&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;t instantiate abstract class BaseClass with abstract methods action&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;python 3.x:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;abc&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ABCMeta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;abstractmethod&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseClass&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;metaclass&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ABCMeta&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="nd"&gt;@abstractmethod&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;action&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;pass&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ¨èä½¿ç”¨ &lt;tt class="docutils literal"&gt;abc&lt;/tt&gt; æ¨¡å—ï¼Œ&lt;tt class="docutils literal"&gt;NotImplementedError&lt;/tt&gt; ä¹Ÿæ¯”è¾ƒå¸¸ç”¨ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://book.douban.com/subject/6049132/"&gt;ã€ŠPython å­¦ä¹ æ‰‹å†Œç¬¬4ç‰ˆã€‹ç¬¬ 695 ~ 697 é¡µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://pymotw.com/2/abc/"&gt;abc â€“ Abstract Base Classes - Python Module of the Week&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/django/django/tree/master/django/core/cache/backends"&gt;django/django/core/cache/backends at master Â· django/django Â· GitHub&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docs.python.org/2/library/abc.html"&gt;27.8. abc â€” Abstract Base Classes â€” Python v2.7.7 documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docs.python.org/3/library/abc.html"&gt;29.7. abc â€” Abstract Base Classes â€” Python 3.4.1 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary></entry><entry><title>[python] æ¨¡å—é—´äº’ç›¸å¯¼å…¥çš„é—®é¢˜</title><link href="https://mozillazg.com/2014/06/python-import-xy.html" rel="alternate"></link><updated>2014-06-02T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-06-02:2014/06/python-import-xy.html</id><summary type="html">&lt;p&gt;ä¸¤ä¸ªæ¨¡å—é—´äº’ç›¸å¯¼å…¥æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# a.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;b&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;
&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;

&lt;span class="c"&gt;# b.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;a&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;b&lt;/span&gt;
&lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;lt;stdin&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;b.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;a&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;a.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;b&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;
&lt;span class="ne"&gt;ImportError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;cannot&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;name&lt;/span&gt; &lt;span class="nn"&gt;y&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å› ä¸ºåœ¨ b ä¸­ï¼Œ &lt;tt class="docutils literal"&gt;from a import x&lt;/tt&gt; æ­¤æ—¶çš„ x è¿˜ä¸å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸‰ç§åŠæ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;æ¨¡å—é—´ä¸è¦äº’ç›¸å¯¼å…¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;ä½¿ç”¨ import&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# a.py
import b
x = 5
# print b.y  ä¸èƒ½ç«‹å³è®¿é—® b å†…çš„å˜é‡

# b.py
import a
y = 10
# print a.x  ä¸èƒ½ç«‹å³è®¿é—® a å†…çš„å˜é‡
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;åœ¨å‡½æ•°ä¸­æ‰§è¡Œå¯¼å…¥æ“ä½œ&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# a.py
def abc():
    from b import y
    print y
x = 5
abc()

# b.py
def efg():
    from a import x
    print x
y = 10
efg()
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;åœ¨æ–‡ä»¶æœ«å°¾æ‰§è¡Œå¯¼å…¥æ“ä½œ&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# a.py
x = 5
from b import y
print y

# b.py
y = 10
from a import x
print x
&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://book.douban.com/subject/6049132/"&gt;ã€ŠPython å­¦ä¹ æ‰‹å†Œç¬¬4ç‰ˆã€‹ç¬¬ 612 ~ 613 é¡µ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary></entry><entry><title>[python] å‡½æ•°é™·é˜±</title><link href="https://mozillazg.com/2014/05/python-function-xyz.html" rel="alternate"></link><updated>2014-05-28T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-05-28:2014/05/python-function-xyz.html</id><summary type="html">&lt;p&gt;æœ¬æ–‡è¯´çš„è¿™å‡ ä¸ªé—®é¢˜é€‚ç”¨äº &lt;tt class="docutils literal"&gt;python 2.6+&lt;/tt&gt;  ã€‚&lt;/p&gt;
&lt;div class="section" id="unboundlocalerror"&gt;
&lt;h2&gt;UnboundLocalError&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;func&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="ne"&gt;UnboundLocalError&lt;/span&gt;                         &lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="n"&gt;a2da4138f6&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;9e6&lt;/span&gt;&lt;span class="n"&gt;cf545bc05&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;func&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="mi"&gt;3&lt;/span&gt;     &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
      &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="ne"&gt;UnboundLocalError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;local&lt;/span&gt; &lt;span class="n"&gt;variable&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;referenced&lt;/span&gt; &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="n"&gt;assignment&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;äº§ç”Ÿè¿™ç§é—®é¢˜çš„åŸå› åœ¨äºè¢«èµ‹å€¼çš„å˜é‡ååœ¨å‡½æ•°å†…éƒ¨æ˜¯è¢«å½“ä½œå±€éƒ¨å˜é‡æ¥å¯¹å¾…çš„ï¼Œè€Œä¸æ˜¯ä»…ä»…åœ¨èµ‹å€¼ä»¥åçš„è¯­å¥ä¸­æ‰è¢«å½“ä½œæ˜¯å±€éƒ¨å˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ global å…³é”®å­—å®ç°åœ¨å‡½æ•°ä¸­å¯¹å…¨å±€å˜é‡è¿›è¡Œé‡æ–°èµ‹å€¼:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;func&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;global&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœä½ çœŸçš„æ—¢è¦è°ƒç”¨å…¨å±€å˜é‡ï¼Œåˆè¦å®šä¹‰ä¸€ä¸ªåŒåçš„å±€éƒ¨å˜é‡çš„è¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼é—´æ¥è®¿é—®å…¨å±€å˜é‡:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;funcb&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;__main__&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;funcb&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;__main__ äº¤äº’æ¨¡å¼ä¸‹çš„å‘½åç©ºé—´ï¼Œå¯ä»¥é€šè¿‡ __main__.a å–å¾—å…¨å±€å˜é‡ a ã€‚
å¦‚æœæ˜¯åœ¨æ¨¡å—ä¸­çš„è¯ï¼Œè¯·å°† __main__ æ›¿æ¢ä¸ºå‡½æ•°æ‰€åœ¨çš„æ¨¡å—åç§°å³å¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# xyz.py&lt;/span&gt;
&lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;funcb&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;xyz&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xyz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# ipython&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;xyz&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;xyz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;xyz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;funcb&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;xyz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;ä½¿ç”¨å¯å˜ç±»å‹ä½œä¸ºé»˜è®¤å‚æ•°&lt;/h2&gt;
&lt;p&gt;å°†å¯å˜ç±»å‹è®¾ä¸ºå‡½æ•°çš„é»˜è®¤å‚æ•°ä¼šå¯¼è‡´å‡ºç°èƒŒç¦»æˆ‘ä»¬åˆè¡·çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[]):&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨ func() çš„è¿”å›å€¼éƒ½ä¸ä¸€æ ·ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å› ä¸ºé»˜è®¤å‚æ•°æ˜¯åœ¨ def è¯­å¥å®šä¹‰æ—¶è¯„ä¼°å¹¶ä¿å­˜çš„ï¼Œè€Œä¸æ˜¯åœ¨è¿™ä¸ªå‡½æ•°è°ƒç”¨æ—¶ã€‚
ä»å†…éƒ¨æ¥è®²ï¼ŒPython ä¼šå°†æ¯ä¸€ä¸ªé»˜è®¤å‚æ•°ä¿å­˜æˆä¸€ä¸ªå¯¹è±¡ï¼Œé™„åŠ åœ¨è¿™ä¸ªå‡½æ•°æœ¬èº«,
å¦‚æœé»˜è®¤å‚æ•°æ˜¯ä¸ªå¯å˜ç±»å‹çš„è¯ï¼Œè¯¥å¯¹è±¡ä¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¿ç•™çŠ¶æ€ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è°ƒç”¨æ—¶éƒ½é‡æ–°è®¾å®šåˆå§‹å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹å¯å˜çš„é»˜è®¤å‚æ•°å°±ç±»ä¼¼äºä¿®æ”¹å‡½æ•°çš„ä¸€ä¸ªå¯å˜ç±»å‹çš„å±æ€§ã€‚è·Ÿä¸‹é¢ç±»ä¼¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;func&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸¤ç§è§£å†³åŠæ³•:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;ä¸è¦ä½¿ç”¨å¯å˜ç±»å‹ä½œä¸ºå‡½æ•°é»˜è®¤å‚æ•°çš„å€¼ï¼ˆæ¨èï¼‰:&lt;/p&gt;
&lt;blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;35&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;36&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;åœ¨å‡½æ•°å†…éƒ¨å¯¹é»˜è®¤å‚æ•°è¿›è¡Œç®€å•çš„æ‹·è´:&lt;/p&gt;
&lt;blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;copy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;copy&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[]):&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;åµŒå¥—ä½œç”¨åŸŸçš„å¾ªç¯å˜é‡&lt;/h2&gt;
&lt;p&gt;åœ¨è¿›è¡ŒåµŒå¥—å‡½æ•°ä½œç”¨åŸŸæŸ¥æ‰¾æ—¶ï¼Œ&lt;strong&gt;å¤„ç†åœ¨å¾ªç¯ä¸­è¢«æ”¹å˜çš„åµŒå¥—å˜é‡æ—¶è¦å°å¿ƒï¼Œæ‰€æœ‰çš„å¼•ç”¨éƒ½å°†ä¼šä½¿ç”¨åœ¨æœ€åçš„å¾ªç¯è¿­ä»£ä¸­å¯¹åº”çš„å€¼&lt;/strong&gt; ã€‚ä½œä¸ºæ›¿ä»£ï¼Œè¯·ä½¿ç”¨é»˜è®¤å‚æ•°æ¥ä¿å­˜å¾ªç¯å˜é‡çš„å€¼ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;func&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;function&lt;/span&gt; &lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;47&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;47&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™ç§æƒ…å†µæ˜¯å› ä¸ºï¼šåµŒå¥—ä½œç”¨åŸŸçš„å˜é‡åœ¨åµŒå¥—çš„å‡½æ•°è¢«è°ƒç”¨æ—¶æ‰è¿›è¡ŒæŸ¥æ‰¾ï¼Œ
æ‰€ä»¥å®ƒä»¬å®é™…ä¸Šè®°ä½çš„æ˜¯åŒæ ·çš„å€¼ï¼ˆåœ¨æœ€åä¸€æ¬¡å¾ªç¯è¿­ä»£ä¸­å¾ªç¯å˜é‡çš„å€¼ï¼‰ã€‚
å› æ­¤ï¼Œå¯¹äºä¸Šé¢çš„ ab åˆ—è¡¨, lambda ä¸­ x çš„å€¼æ°¸è¿œéƒ½æ˜¯ 4ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©è¿™ç±»ä»£ç èƒ½å¤Ÿå·¥ä½œï¼Œå¿…é¡»ä½¿ç”¨é»˜è®¤å‚æ•°æŠŠå½“å‰çš„å€¼ä¼ é€’ç»™åµŒå¥—çš„ä½œç”¨åŸŸçš„å˜é‡ï¼Œå› ä¸ºé»˜è®¤å‚æ•°ä½¿ä¹‹åµŒå¥—å‡½æ•°åˆ›å»ºæ˜¯è¯„ä¼°çš„ï¼ˆè€Œä¸æ˜¯åœ¨å…¶ç¨åè°ƒç”¨æ—¶ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;57&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;func&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
   &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;58&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;59&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;59&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;function&lt;/span&gt; &lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;61&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;61&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;62&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;62&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;27&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id3"&gt;
&lt;h2&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://book.douban.com/subject/6049132/"&gt;ã€ŠPython å­¦ä¹ æ‰‹å†Œç¬¬4ç‰ˆã€‹ç¬¬ 16 ~ 20 ç« &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary></entry><entry><title>[python]å¦‚ä½•ç”Ÿæˆä¸€ä¸ª Unicode ç¼–ç çš„æ–‡ä»¶</title><link href="https://mozillazg.com/2014/03/python-save-an-Unicode-encoding-file.html" rel="alternate"></link><updated>2014-03-03T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-03-03:2014/03/python-save-an-Unicode-encoding-file.html</id><summary type="html">&lt;p&gt;å¹³æ—¶æˆ‘ä»¬ç”¨è®°äº‹æœ¬ä¿å­˜æ–‡ä»¶æ—¶ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶ç¼–ç å¯ä»¥é€‰æ‹© Unicode ç¼–ç ã€‚
é‚£ä¹ˆå¦‚ä½•ç”¨ python ç”Ÿæˆä¸€ä¸ª Unicode ç¼–ç çš„æ–‡ä»¶å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åªéœ€çŸ¥é“ python ä¸­å“ªä¸ªç¼–ç ä»£è¡¨ Unicode ç¼–ç ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ª Unicode ç¼–ç çš„æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="14%" /&gt;
&lt;col width="16%" /&gt;
&lt;col width="38%" /&gt;
&lt;col width="32%" /&gt;
&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;Codec&lt;/td&gt;
&lt;td&gt;Aliases&lt;/td&gt;
&lt;td&gt;Languages&lt;/td&gt;
&lt;td&gt;Note&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;utf_16&lt;/td&gt;
&lt;td&gt;U16, utf16&lt;/td&gt;
&lt;td&gt;all languages&lt;/td&gt;
&lt;td&gt;Unicode(UTF-16 LE BOM)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;utf_16_be&lt;/td&gt;
&lt;td&gt;UTF-16BE&lt;/td&gt;
&lt;td&gt;all languages (BMP only)&lt;/td&gt;
&lt;td&gt;Unicode(UTF-16 BE)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;utf_16_le&lt;/td&gt;
&lt;td&gt;UTF-16LE&lt;/td&gt;
&lt;td&gt;all languages (BMP only)&lt;/td&gt;
&lt;td&gt;Unicode(UTF-16 LE)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸Šé¢è¡¨æ ¼ä¸­ï¼ŒLE æ˜¯ Little Endian çš„ç¼©å†™, BE æ˜¯ Big Endian çš„ç¼©å†™ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;codecs&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;codecs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a.txt&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;utf_16&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;u&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://stackoverflow.com/questions/8466460/how-to-read-a-file-that-can-be-saved-as-either-ansi-or-unicode-in-python"&gt;how to read a file that can be saved as either ansi or unicode in python?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://docs.python.org/2/library/codecs.html#standard-encodings"&gt;7.8. codecs â€” Codec registry and base classes â€” Python v2.7.6 documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://docs.python.org/2/howto/unicode.html#reading-and-writing-unicode-data"&gt;Unicode HOWTO â€” Python v2.7.6 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="python"></category></entry><entry><title>[python]å¦‚ä½•åˆ›å»ºä¸€ä¸ªä¸å¯å˜çš„ç±»</title><link href="https://mozillazg.com/2014/01/python-create-immutable-class.html" rel="alternate"></link><updated>2014-01-25T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-01-25:2014/01/python-create-immutable-class.html</id><summary type="html">&lt;p&gt;æ‰€è°“çš„ä¸å¯å˜çš„ç±»å°±æ˜¯ç±»çš„å®ä¾‹ä¸å¯ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ™®é€šçš„ç±»:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;A&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;pass&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abc&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ™®é€šçš„ç±»çš„å®ä¾‹å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ æ–°çš„å±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå¦‚ä½•å®šä¹‰ä¸€ä¸ªä¸å¯å˜çš„ç±»å‘¢ï¼Ÿ
ä¸‹é¢å°±æ¥çœ‹ä¸€ä¸ªä¸å¯å˜ç±»çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;B&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;__slots__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;abc&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__setattr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;abc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__setattr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;AttributeError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;#39; has no attribute &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__class__&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
  &lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abc&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;123&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="o"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="ne"&gt;AttributeError&lt;/span&gt;                            &lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fecd1642a038&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;030&lt;/span&gt;&lt;span class="n"&gt;c2c96393c&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;__setattr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="mi"&gt;4&lt;/span&gt;         &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__setattr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;abc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__setattr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;         &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;AttributeError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;#39; has no attribute &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__class__&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
      &lt;span class="mi"&gt;7&lt;/span&gt;

&lt;span class="ne"&gt;AttributeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;lt;class &amp;#39;&lt;/span&gt;&lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;has&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;attribute&lt;/span&gt; &lt;span class="n"&gt;abc&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__dict__&lt;/span&gt;
&lt;span class="o"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="ne"&gt;AttributeError&lt;/span&gt;                            &lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;25106575&lt;/span&gt;&lt;span class="n"&gt;ab93&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__dict__&lt;/span&gt;

&lt;span class="ne"&gt;AttributeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;object&lt;/span&gt; &lt;span class="n"&gt;has&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;attribute&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__dict__&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="ne"&gt;AttributeError&lt;/span&gt;                            &lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;0205&lt;/span&gt;&lt;span class="n"&gt;c051c209&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;030&lt;/span&gt;&lt;span class="n"&gt;c2c96393c&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;__setattr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="mi"&gt;4&lt;/span&gt;         &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__setattr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;abc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__setattr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;         &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;AttributeError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;#39; has no attribute &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__class__&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
      &lt;span class="mi"&gt;7&lt;/span&gt;

&lt;span class="ne"&gt;AttributeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;lt;class &amp;#39;&lt;/span&gt;&lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;has&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;attribute&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™é‡Œæœ‰ä¸¤ä¸ªè¦ç‚¹ï¼šä¸€ä¸ªæ˜¯ &lt;tt class="docutils literal"&gt;__slots__&lt;/tt&gt; å¦ä¸€ä¸ªæ˜¯ &lt;tt class="docutils literal"&gt;__setattr__&lt;/tt&gt; ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å®šä¹‰ &lt;tt class="docutils literal"&gt;__slots__&lt;/tt&gt; æ›¿æ¢æ‰äº†ç±»çš„å®ä¾‹çš„ &lt;tt class="docutils literal"&gt;__dict__&lt;/tt&gt; å±æ€§ï¼Œé˜»æ­¢æ–°å¢å±æ€§ã€‚
é€šè¿‡è¦†ç›– &lt;tt class="docutils literal"&gt;__setattr__&lt;/tt&gt; æ–¹æ³•ï¼Œé˜»æ­¢ä¿®æ”¹ç°æœ‰å±æ€§çš„å€¼ã€‚&lt;/p&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.blog.pythonlibrary.org/2014/01/17/how-to-create-immutable-classes-in-python/"&gt;How to Create â€œImmutableâ€ Classes in Python Â« The Mouse Vs. The Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://stackoverflow.com/questions/472000/python-slots"&gt;Python __slots__ - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.elfsternberg.com/2009/07/06/python-what-the-hell-is-a-slot/"&gt;Python: What the Hell is a Slot?&amp;nbsp;by&amp;nbsp;Elf Sternberg&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://docs.python.org/2/reference/datamodel.html?highlight=__slots__#slots"&gt;3. Data model â€” Python v2.7.6 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="python"></category></entry><entry><title>[python]è§£å†³å°† python ç¨‹åºè¾“å‡ºç»“æœé‡å®šå‘åˆ°æ–‡ä»¶æ—¶ï¼Œå‡ºç° UnicodeDecodeError é”™è¯¯</title><link href="https://mozillazg.com/2014/01/python-fix-shell-python-program-redirect-to-file-raise-UnicodeDecodeError.html" rel="alternate"></link><updated>2014-01-19T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-01-19:2014/01/python-fix-shell-python-program-redirect-to-file-raise-UnicodeDecodeError.html</id><summary type="html">&lt;p&gt;æ¯”å¦‚ï¼šæœ‰ä¸€ä¸ª python ç¨‹åº hello.py&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/usr/bin/env python&lt;/span&gt;
&lt;span class="c"&gt;# -*- coding: utf-8 -*-&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;ä½ å¥½&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å°†è¾“å‡ºç»“æœé‡å®šå‘åˆ°æ–‡ä»¶ï¼Œå°±ä¼šå‡ºç° UnicodeEncodeError:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; python hello.py &amp;gt; hello.txt
&lt;span class="go"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="go"&gt;  File &amp;quot;hello.py&amp;quot;, line 4, in &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;    print u&amp;#39;ä½ å¥½&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;UnicodeEncodeError: &amp;#39;ascii&amp;#39; codec can&amp;#39;t encode characters in position 0-1: ordinal not in range(128)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥ä¼šå‡ºç°ç¼–ç é”™è¯¯ï¼Œæ˜¯å› ä¸ºï¼š
è¾“å‡ºåˆ°æ§åˆ¶å°æ—¶ï¼Œprint ä½¿ç”¨çš„æ˜¯æ§åˆ¶å°çš„é»˜è®¤ç¼–ç ï¼Œ
è€Œé‡å®šå‘åˆ°æ–‡ä»¶æ—¶ï¼Œprint å°±ä¸çŸ¥é“ä½¿ç”¨ä»€ä¹ˆç¼–ç äº†ï¼Œäºæ˜¯å°±ä½¿ç”¨äº†é»˜è®¤ç¼–ç  ascii å¯¼è‡´å‡ºç°ç¼–ç é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ &lt;tt class="docutils literal"&gt;PYTHONIOENCODING&lt;/tt&gt; å‘Šè¯‰ python ä½¿ç”¨å“ªç§ç¼–ç :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;export &lt;/span&gt;&lt;span class="nv"&gt;PYTHONIOENCODING&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;utf8
&lt;span class="gp"&gt;$&lt;/span&gt; python hello.py  &amp;gt; hello.txt
&lt;span class="gp"&gt;$&lt;/span&gt; cat hello.txt
&lt;span class="go"&gt;ä½ å¥½&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.cnblogs.com/bamanzi/archive/2012/08/16/python-encoding-when-redirection.html"&gt;Pythonè„šæœ¬é‡å®šå‘å…¶è¾“å‡ºæ—¶çš„ç¼–ç é—®é¢˜ - å·´è›®å­ - åšå®¢å›­&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://wiki.python.org/moin/PrintFails"&gt;PrintFails - Python Wiki&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://stackoverflow.com/questions/4545661/unicodedecodeerror-when-redirecting-to-file"&gt;python - UnicodeDecodeError when redirecting to file - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://stackoverflow.com/questions/4374455/how-to-set-sys-stdout-encoding-in-python-3"&gt;unicode - How to set sys.stdout encoding in Python 3? - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="python"></category></entry><entry><title>[python]ä½¿ç”¨ multiprocessing.dummy æ‰§è¡Œå¤šçº¿ç¨‹ä»»åŠ¡</title><link href="https://mozillazg.com/2014/01/python-use-multiprocessing-dummy-run-theading-task.html" rel="alternate"></link><updated>2014-01-19T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-01-19:2014/01/python-use-multiprocessing-dummy-run-theading-task.html</id><summary type="html">&lt;p&gt;æœ¬æ–‡å°†ç®€å•è®²è¿°ä¸€ç§ä½¿ç”¨ &lt;tt class="docutils literal"&gt;multiprocessing.dummy&lt;/tt&gt; æ¨¡å—æ‰§è¡Œå¤šçº¿ç¨‹ä»»åŠ¡çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;multiprocessing.dummy&lt;/tt&gt; æ¨¡å—ä¸ &lt;tt class="docutils literal"&gt;multiprocessing&lt;/tt&gt; æ¨¡å—çš„åŒºåˆ«ï¼š &lt;tt class="docutils literal"&gt;dummy&lt;/tt&gt;
æ¨¡å—æ˜¯å¤šçº¿ç¨‹ï¼Œè€Œ &lt;tt class="docutils literal"&gt;multiprocessing&lt;/tt&gt; æ˜¯å¤šè¿›ç¨‹ï¼Œ api éƒ½æ˜¯é€šç”¨çš„ã€‚
æ‰€æœ‰å¯ä»¥å¾ˆæ–¹ä¾¿å°†ä»£ç åœ¨å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹ä¹‹é—´åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# from multiprocessing import Pool&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;multiprocessing.dummy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Pool&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;ThreadPool&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;urllib2&lt;/span&gt;

&lt;span class="n"&gt;urls&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://www.baidu.com&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://home.baidu.com/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://tieba.baidu.com/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://zhidao.baidu.com/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://music.baidu.com/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://image.baidu.com/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://python-china.org/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://python-china.org/node/about&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://python-china.org/node/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://python-china.org/account/signin&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://python-china.org/account/signup&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://www.qq.com&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://www.youku.com&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;http://www.tudou.com&amp;#39;&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;results&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;urllib2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;urlopen&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;urls&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Normal:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;

&lt;span class="n"&gt;start2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="c"&gt;# å¼€8ä¸ª workerï¼Œæ²¡æœ‰å‚æ•°æ—¶é»˜è®¤æ˜¯ cpu çš„æ ¸å¿ƒæ•°&lt;/span&gt;
&lt;span class="n"&gt;pool&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ThreadPool&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;processes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c"&gt;# åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ urllib2.urlopen(url) å¹¶è¿”å›æ‰§è¡Œç»“æœ&lt;/span&gt;
&lt;span class="n"&gt;results2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pool&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;urllib2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;urlopen&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;urls&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pool&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;pool&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Thread Pool:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;start2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ‰§è¡Œç»“æœ:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="go"&gt;Normal: 12.5460000038&lt;/span&gt;
&lt;span class="go"&gt;Thread Pool: 2.0680000782&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»¥åé‡åˆ°è¦åŠ é€Ÿ for å¾ªç¯çš„æ—¶å€™ï¼Œå¯ä»¥è¯•è¯• &lt;tt class="docutils literal"&gt;multiprocessing.dummy&lt;/tt&gt; ã€‚&lt;/p&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://medium.com/p/40e9b2b36148"&gt;A Better Model for Day to Day Threading Tasks â€” Medium&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html"&gt;16.6. multiprocessing â€” Process-based â€œthreadingâ€ interface â€” Python v2.7.6 documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://pymotw.com/2/multiprocessing/"&gt;multiprocessing â€“ Manage processes like threads - Python Module of the Week&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="python"></category><category term="multiprocessing"></category><category term="thread"></category><category term="threading"></category></entry><entry><title>[python]è¾“å‡ºä¸€ä¸ªç®€å•çš„è¿›åº¦æ¡</title><link href="https://mozillazg.com/2014/01/python-make-a-simple-progress-bar.html" rel="alternate"></link><updated>2014-01-13T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-01-13:2014/01/python-make-a-simple-progress-bar.html</id><summary type="html">&lt;p&gt;ä½¿ç”¨ &lt;tt class="docutils literal"&gt;sys.stdout&lt;/tt&gt; æˆ– &lt;tt class="docutils literal"&gt;sys.stderr&lt;/tt&gt; å°±å¯ä»¥è¾“å‡ºä¸€ä¸ªç®€å•çš„è¿›åº¦æ¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;

&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdout&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;101&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;#&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ljust&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;-&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\r&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</summary><category term="python"></category></entry><entry><title>[python]é…ç½® fabric ç©¿è¶Šè·³æ¿æœº</title><link href="https://mozillazg.com/2013/12/python-fabric-gateway.html" rel="alternate"></link><updated>2013-12-27T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-12-27:2013/12/python-fabric-gateway.html</id><summary type="html">&lt;p&gt;è¯´å®è¯ï¼Œè·³æ¿æœºç»™ç ”å‘çš„æ—¥å¸¸å·¥ä½œæ·»åŠ äº†äº›è®¸éº»çƒ¦ã€‚
å¹¸å¥½ fabric æä¾›äº†ç©¿è¶Šè·³æ¿æœºçš„åŠŸèƒ½ï¼Œä½¿è·³æ¿æœºä¸å†å½±å“æˆ‘ä»¬çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; fab --version
&lt;span class="go"&gt;Fabric 1.8.1&lt;/span&gt;
&lt;span class="go"&gt;Paramiko 1.12.0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# è·³æ¿æœº&lt;/span&gt;
&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gateway&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;lisi@192.168.100.123&amp;#39;&lt;/span&gt;

&lt;span class="c"&gt;# ç›®æ ‡æœåŠ¡å™¨&lt;/span&gt;
&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hosts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;foo@111.111.111.111&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
             &lt;span class="s"&gt;&amp;#39;bar@111.111.111.112&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
             &lt;span class="s"&gt;&amp;#39;bar2@122.123.124.139&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;passwords&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;lisi@192.168.100.123:22&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;pssword3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="c"&gt;# è·³æ¿æœºå¯†ç &lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;foo@111.111.111.111:22&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;pssword4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;   &lt;span class="c"&gt;# ç›®æ ‡æœåŠ¡å™¨å¯†ç &lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;bar@111.111.111.112:22&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;pssword5&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;   &lt;span class="c"&gt;# ç›®æ ‡æœåŠ¡å™¨å¯†ç &lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;bar2@122.123.124.139:22&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;pssword6&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;   &lt;span class="c"&gt;# ç›®æ ‡æœåŠ¡å™¨å¯†ç &lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nd"&gt;@task&lt;/span&gt;
&lt;span class="nd"&gt;@hosts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hosts&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç©¿è¶Šè·³æ¿æœºçš„åŸç†æ˜¯ï¼š &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Tunneling_protocol"&gt;SSH éš§é“æŠ€æœ¯&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://docs.fabfile.org/en/latest/usage/env.html#gateway"&gt;The environment dictionary, env â€” Fabric 1.8.1 documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/fabric/fabric/issues/976"&gt;Pre-filling env.passwords no longer works in 1.7 Â· Issue #976 Â· fabric/fabric Â· GitHub&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://en.wikipedia.org/wiki/Tunneling_protocol"&gt;Tunneling protocol - Wikipedia, the free encyclopedia&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="python"></category><category term="fabric"></category><category term="fab"></category><category term="gateway"></category><category term="è·³æ¿æœº"></category></entry><entry><title>[python]å»æ‰ unicode å­—ç¬¦ä¸²å‰é¢çš„ u</title><link href="https://mozillazg.com/2013/12/python-raw-unicode.html" rel="alternate"></link><updated>2013-12-26T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-12-26:2013/12/python-raw-unicode.html</id><summary type="html">&lt;p&gt;æœ‰æ—¶æˆ‘ä»¬ä¼šç¢°åˆ°ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ unicode å­—ç¬¦ä¸²:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="s"&gt;u&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xe4\xbd\xa0\xe5\xa5\xbd&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ˜æ˜¾ä¸æ˜¯ä¸€ä¸ªæ­£ç¡®çš„ unicode å­—ç¬¦ä¸²ï¼Œå¯èƒ½æ˜¯åœ¨å“ªä¸ªåœ°æ–¹è½¬ç è½¬é”™äº†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦æƒ³å¾—åˆ°æ­£ç¡®çš„ unicode å­—ç¬¦ä¸²é¦–å…ˆå°±å¿…é¡»å…ˆå°†è¿™ä¸ªå­—ç¬¦ä¸²è½¬æˆé unicode å­—ç¬¦ä¸²ï¼Œ
ç„¶åå†è¿›è¡Œè§£ç ã€‚æŒ‰ç…§æ™®é€šçš„åŠæ³•è¿›è¡Œ &lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªæ­£ç¡®çš„ unicode å­—ç¬¦ä¸²ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xe4\xbd\xa0\xe5\xa5\xbd&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;utf8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xc3\xa4\xc2\xbd\xc2\xa0\xc3\xa5\xc2\xa5\xc2\xbd&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xe4\xbd\xa0\xe5\xa5\xbd&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;utf8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="err"&gt;ç›²é™†è½æ°“æ¥¼é™†&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é‚£å¦‚ä½•æ‰èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ &lt;tt class="docutils literal"&gt;\xe4\xbd\xa0\xe5\xa5\xbd&lt;/tt&gt; å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;python æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„ç¼–ç ï¼ˆ &lt;tt class="docutils literal"&gt;raw_unicode_escape&lt;/tt&gt; ï¼‰ç”¨æ¥å¤„ç†è¿™ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xe4\xbd\xa0\xe5\xa5\xbd&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;raw_unicode_escape&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xe4\xbd\xa0\xe5\xa5\xbd&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xe4\xbd\xa0\xe5\xa5\xbd&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;raw_unicode_escape&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;utf8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u4f60\u597d&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u4f60\u597d&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="err"&gt;ä½ å¥½&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://docs.python.org/2/library/codecs.html#python-specific-encodings"&gt;7.8. codecs â€” Codec registry and base classes â€” Python v2.7.6 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="python"></category><category term="unicode"></category></entry><entry><title>[python]æŒ‡å®š Socket connect æ–¹æ³•çš„è¶…æ—¶æ—¶é—´</title><link href="https://mozillazg.com/2013/11/python-socket-connect-set-timeout.html" rel="alternate"></link><updated>2013-11-18T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-11-18:2013/11/python-socket-connect-set-timeout.html</id><summary type="html">&lt;p&gt;é€šè¿‡è®¾ç½® &lt;code&gt;socket.settimeout&lt;/code&gt; æ¥å®ç°è¶…æ—¶åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;select&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;

&lt;span class="n"&gt;HOST&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;127.0.0.1&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;PORT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;8000&lt;/span&gt;
&lt;span class="n"&gt;timeout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;   &lt;span class="c"&gt;# 1 åˆ†é’Ÿ&lt;/span&gt;

&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c"&gt;# è®¾ç½®è¿æ¥è¶…æ—¶&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;settimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c"&gt;# æ¢å¤é»˜è®¤è¶…æ—¶è®¾ç½®&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;settimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/3432102/python-socket-connection-timeout"&gt;Python socket connection timeout - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="socket"></category></entry><entry><title>[python]æŒ‡å®š Socket recv æ–¹æ³•çš„è¶…æ—¶æ—¶é—´</title><link href="https://mozillazg.com/2013/11/python-socket-recv-set-timeout.html" rel="alternate"></link><updated>2013-11-18T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-11-18:2013/11/python-socket-recv-set-timeout.html</id><summary type="html">&lt;p&gt;ä½¿ç”¨ &lt;code&gt;select&lt;/code&gt; æ¥å˜ç›¸å®ç°è¶…æ—¶åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;select&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;

&lt;span class="n"&gt;HOST&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;127.0.0.1&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;PORT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;8000&lt;/span&gt;
&lt;span class="n"&gt;timeout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;   &lt;span class="c"&gt;# 1 åˆ†é’Ÿ&lt;/span&gt;

&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c"&gt;# è®¾ç½® recv è¶…æ—¶æ—¶é—´&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setblocking&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ready&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;select&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[],&lt;/span&gt; &lt;span class="p"&gt;[],&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ready&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="c"&gt;# æ¥æ”¶ç»“æœ&lt;/span&gt;
    &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x00&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/2719017/how-to-set-timeout-on-pythons-socket-recv-method"&gt;How to set timeout on python's socket recv method? - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="socket"></category></entry><entry><title>[python] ä¿®å¤è¯»å– utf-8 BOM ç¼–ç çš„é…ç½®æ–‡ä»¶æ—¶å‡ºç°çš„ ConfigParser.MissingSectionHeaderError: File contains no section headers é”™è¯¯</title><link href="https://mozillazg.com/2013/11/python-utf8-bom-MissingSectionHeaderError.html" rel="alternate"></link><updated>2013-11-10T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-11-10:2013/11/python-utf8-bom-MissingSectionHeaderError.html</id><summary type="html">&lt;p&gt;å½“ä½¿ç”¨ ConfigParser è¯»å– utf-8 BOM ç¼–ç çš„é…ç½®æ–‡ä»¶æ—¶,ä¼šå‡ºç°å¦‚ä¸‹ç±»ä¼¼é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;ConfigParser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MissingSectionHeaderError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="n"&gt;contains&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;section&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;File&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ini&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xef\xbb\xbf&lt;/span&gt;&lt;span class="s"&gt;[General]&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è§£å†³åŠæ³•å°±æ˜¯å…ˆå°†æ–‡ä»¶å†…å®¹è¯»å‡ºæ¥ï¼Œç„¶åè½¬ç ï¼Œç„¶åå†è¯»å–è½¬ç åçš„é…ç½®ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;ConfigParser&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;StringIO&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;StringIO&lt;/span&gt;

&lt;span class="n"&gt;conf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ConfigParser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RawConfigParser&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;settings.ini&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;rb&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;utf-8-sig&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;utf8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;conf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readfp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;StringIO&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://bugs.python.org/issue7519"&gt;Issue 7519: ConfigParser can't read files with BOM markers - Python tracker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://docs.python.org/2/library/configparser.html"&gt;13.2. ConfigParser â€” Configuration file parser â€” Python v2.7.5 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="python"></category><category term="unicode"></category></entry><entry><title>[python]for å¾ªç¯ä¸­çš„å±€éƒ¨å˜é‡é™·é˜±</title><link href="https://mozillazg.com/2013/10/python-for-loop-pit.html" rel="alternate"></link><updated>2013-10-13T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-10-13:2013/10/python-for-loop-pit.html</id><summary type="html">&lt;p&gt;å…ˆçœ‹ä¸€æ®µä»£ç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šfor å¾ªç¯ä¸­ç”¨äºå¾ªç¯ä¸»ä½“çš„å˜é‡ä¼šå½±å“ä¸Šä¸‹æ–‡çš„å±€éƒ¨å˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ä»£ç å°±ä¼šæœ‰é—®é¢˜ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;foo&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;bar&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;foobar&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;abc&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;   &lt;span class="c"&gt;# error&lt;/span&gt;
    &lt;span class="c"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</summary><category term="python"></category></entry><entry><title>[python]Windows ä¸‹çš„ ANSI ç¼–ç </title><link href="https://mozillazg.com/2013/09/python-windows-ansi.html" rel="alternate"></link><updated>2013-09-24T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-09-24:2013/09/python-windows-ansi.html</id><summary type="html">&lt;p&gt;Windows ä¸‹ç”¨è®°äº‹æœ¬ä¿å­˜æ–‡ä»¶æ—¶æœ‰ä¸ª ANSI ç¼–ç ï¼Œé‚£ä¹ˆå¦‚ä½•ç”¨ python ä¿å­˜ä¸€ä¸ª ANSI ç¼–ç çš„æ–‡ä»¶å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;python ä¸­ä½¿ç”¨ &lt;code&gt;mbcs&lt;/code&gt; ç¼–ç ï¼ˆWindows onlyï¼‰è¡¨ç¤º ANSI:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;hello.txt&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;u&amp;#39;ä½ å¥½&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;mbcs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ª ANSI ç¼–ç çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ANSI == Windows æœ¬åœ°ç¼–ç &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨ç®€ä½“ä¸­æ–‡ Windows ç³»ç»Ÿä¸­ï¼šansi == gbk :&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;ä½ å¥½&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;mbcs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xc4\xe3\xba\xc3&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;ä½ å¥½&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;mbcs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;gbk&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="s"&gt;u&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u4f60\u597d&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://comments.gmane.org/gmane.org.user-groups.python.chinese/93052"&gt;[CPyUG] è¯·é—®åœ¨pythonä¸­å¦‚ä½•å°†utf8ç¼–ç çš„æ–‡ä»¶è½¬æ¢æˆansiç¼–ç &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://docs.python.org/2/library/codecs.html#python-specific-encodings"&gt;7.8. codecs â€” Codec registry and base classes â€” Python v2.7.5 documentation &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary></entry><entry><title>[python]ç»Ÿè®¡åˆ—è¡¨ä¸­é‡å¤é¡¹çš„å‡ºç°æ¬¡æ•°</title><link href="https://mozillazg.com/2013/08/python-count-duplicate-values-of-list.html" rel="alternate"></link><updated>2013-08-17T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-08-17:2013/08/python-count-duplicate-values-of-list.html</id><summary type="html">&lt;p&gt;åˆ—è¡¨é¡¹ç”±æ•°å­—ã€å­—ç¬¦ä¸²ç»„æˆï¼Œç»Ÿè®¡é‡å¤é¡¹ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;collections&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;defaultdict&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;defaultdict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;defaultdict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åˆ—è¡¨é¡¹ç”±å­—å…¸ç»„æˆï¼Œç»Ÿè®¡æŸä¸€é”®å€¼çš„é‡å¤æ•°ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;defaultdict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;}]:&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;   &lt;span class="c"&gt;# &amp;#39;a&amp;#39;: 1 å‡ºç°2æ¬¡ï¼Œ&amp;#39;a&amp;#39;: 2 å‡ºç°1æ¬¡&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/14374568/counting-duplicate-words-in-python-the-fastest-way"&gt;dictionary - counting duplicate words in python the fastest way - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="list"></category></entry><entry><title>[python]è¿”å›ä¸€ä¸ªç©ºçš„ç”Ÿæˆå™¨</title><link href="https://mozillazg.com/2013/08/python-empty-generator.html" rel="alternate"></link><updated>2013-08-15T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-08-15:2013/08/python-empty-generator.html</id><summary type="html">&lt;p&gt;å¦‚ä½•è¿”å›ä¸€ä¸ªç©ºçš„ç”Ÿæˆå™¨ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;foo&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="k"&gt;return&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="k"&gt;yield&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;foo&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt; &lt;span class="nb"&gt;object&lt;/span&gt; &lt;span class="n"&gt;foo&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mh"&gt;0x01C46968&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;foo&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/13243766/python-empty-generator-function"&gt;Python Empty Generator Function - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="generator"></category></entry><entry><title>[python]è®¾ç½® gunicorn ç»‘å®šå¤šä¸ªåœ°å€</title><link href="https://mozillazg.com/2013/07/python-gunicorn-multiple-address.html" rel="alternate"></link><updated>2013-07-08T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-07-08:2013/07/python-gunicorn-multiple-address.html</id><summary type="html">
&lt;p&gt;æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®¾ç½® gunicorn  ç»‘å®šå¤šä¸ªåœ°å€ã€‚&lt;/p&gt;
&lt;h2 id="_1"&gt;å‘½ä»¤è¡Œå‚æ•°&lt;/h2&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;gunicorn -b unix:/tmp/gunicorn.sock -b 127.0.0.1:8000 wsgi:app

gunicorn --bind unix:/tmp/gunicorn.sock --bind 127.0.0.1:8000 wsgi:app
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id="_2"&gt;é…ç½®æ–‡ä»¶&lt;/h2&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;bind&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'unix:/tmp/gunicorn.sock'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;'127.0.0.1:8000'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;'0.0.0.0:1234'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id="_3"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://docs.gunicorn.org/en/latest/configure.html"&gt;Congiuration - gunicorn documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/benoitc/gunicorn/commit/b7b51adf13e92044211b267ba07e3498585f219a"&gt;allows gunicorn to bind to multiple address - b7b51ad - benoitc/gunicorn - GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="gunicorn"></category></entry><entry><title>[python] å‘é€é‚®ä»¶æ—¶è®¾ç½®é‚®ä»¶çš„ä¼˜å…ˆçº§/é‡è¦æ€§</title><link href="https://mozillazg.com/2013/07/python-send-email-set-priority.html" rel="alternate"></link><updated>2013-07-02T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-07-02:2013/07/python-send-email-set-priority.html</id><summary type="html">
&lt;p&gt;è®¾ç½®é‚®ä»¶ header ä¸­ X-Priority çš„å€¼å°±å¯ä»¥äº†ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;X-Priority çš„å€¼&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;"1"&lt;/td&gt;
&lt;td&gt;æœ€é«˜çº§åˆ«ï¼ˆé‡è¦æ€§é«˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;"2"&lt;/td&gt;
&lt;td&gt;ä»‹äºä¸­é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;"3"&lt;/td&gt;
&lt;td&gt;æ™®é€šçº§åˆ«ï¼ˆä¸æç¤ºé‡è¦æ€§ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;"4"&lt;/td&gt;
&lt;td&gt;ä»‹äºä¸­é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;"5"&lt;/td&gt;
&lt;td&gt;æœ€ä½çº§åˆ«ï¼ˆé‡è¦æ€§ä½ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id="python"&gt;python ä½¿ç”¨ç¤ºä¾‹&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/a/11844141"&gt;http://stackoverflow.com/a/11844141&lt;/a&gt;&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;smtplib&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;email.Message&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Message&lt;/span&gt;

&lt;span class="n"&gt;smtp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;smtplib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SMTP&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'localhost'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Message&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'From'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'me'&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'To'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'you'&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'X-Priority'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'2'&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'Subject'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'Urgent!'&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_payload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'Nothing.'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;smtp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendmail&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;from_addr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_addr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;as_string&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;h2 id="django"&gt;django ä½¿ç”¨ç¤ºä¾‹&lt;/h2&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.core.mail&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;EmailMessage&lt;/span&gt;

&lt;span class="n"&gt;subject&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'hello'&lt;/span&gt;
&lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'hello'&lt;/span&gt;
&lt;span class="n"&gt;headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;'X-Priority'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;'1'&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;  &lt;span class="c"&gt;# æ³¨æ„å€¼æ˜¯å­—ç¬¦ä¸²&lt;/span&gt;
&lt;span class="n"&gt;email&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;EmailMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;from_email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_emails&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                     &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/11843148/smtp-sending-an-priority-email"&gt;python - SMTP sending an priority email - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.chilkatsoft.com/braindump/email_headers/X-Priority_header.html"&gt;X-Priority Header Field&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="email"></category><category term="X-Priority"></category></entry><entry><title>[python]è§£å†³ç¼–è¯‘å®‰è£… lxml æ—¶æç¤ºï¼šlibxml/xmlversion.h:No such file or directory</title><link href="https://mozillazg.com/2013/06/python-install-lxml-libxml-xmlversion.h-No-such-file-or-directory.html" rel="alternate"></link><updated>2013-06-23T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-06-23:2013/06/python-install-lxml-libxml-xmlversion.h-No-such-file-or-directory.html</id><summary type="html">&lt;p&gt;ç¼–è¯‘å®‰è£… lxml æ—¶ï¼Œå‡ºç°äº†å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;libxml/xmlversion.h: No such file or directory&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‡ºç°è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºæœ‰äº›ä¾èµ–åŒ…æ²¡æœ‰å®‰è£…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;libxml2&lt;/li&gt;
&lt;li&gt;libxml2-dev&lt;/li&gt;
&lt;li&gt;libxslt&lt;/li&gt;
&lt;li&gt;libxslt-dev&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åªè¦å®‰è£…å¥½è¦ä¸Šé¢çš„ä¾èµ–åŒ…å°±å¯ä»¥äº†&lt;/p&gt;</summary><category term="python"></category><category term="lxml"></category><category term="libxml"></category><category term="libxslt"></category></entry><entry><title>[python]ç¬¬ä¸‰æ–¹æ¨¡å— python-dateutilï¼šæ‰©å±•å¹¶å¢å¼º datetime æ¨¡å—çš„åŠŸèƒ½</title><link href="https://mozillazg.com/2013/06/python-third-party-model-python-dateutil.html" rel="alternate"></link><updated>2013-06-09T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-06-09:2013/06/python-third-party-model-python-dateutil.html</id><summary type="html">&lt;h2 id="_1"&gt;ç®€ä»‹&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‰©å±•å¹¶å¢å¼º datetime æ¨¡å—çš„åŠŸèƒ½ã€‚æ”¯æŒ Python 2.3+ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="_2"&gt;ä¸»é¡µ&lt;/h2&gt;
&lt;p&gt;&lt;a href="http://labix.org/python-dateutil"&gt;http://labix.org/python-dateutil&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="_3"&gt;æ–‡æ¡£&lt;/h2&gt;
&lt;p&gt;&lt;a href="http://labix.org/python-dateutil"&gt;http://labix.org/python-dateutil&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="_4"&gt;å®‰è£…&lt;/h2&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;pip install python-dateutil

&lt;span class="c"&gt;# or&lt;/span&gt;
&lt;span class="c"&gt;# download from https://pypi.python.org/pypi/python-dateutil&lt;/span&gt;
python setup.py install
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_5"&gt;ç®€å•ä½¿ç”¨&lt;/h2&gt;
&lt;p&gt;è·å–å†å²ä¸Šçš„ä»Šå¤©ï¼Œä¸Šä¸ªæœˆçš„ä»Šå¤©ï¼Œä¸‹ä¸ªæœˆçš„ä»Šå¤© &lt;a href="http://labix.org/python-dateutil#head-6a1472b7c74e5b8bab7784f11214250d34e09aa5"&gt;link&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;dateutil.relativedelta&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;relativedelta&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;today&lt;/span&gt;
&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;today&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;relativedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;years&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;today&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;relativedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;months&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;today&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;relativedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;months&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ›´å¤šç”¨æ³•è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href="https://pypi.python.org/pypi/python-dateutil"&gt;https://pypi.python.org/pypi/python-dateutil&lt;/a&gt;&lt;/p&gt;</summary><category term="python-third-party-model"></category><category term="python"></category><category term="python-dateutil"></category><category term="dateutil"></category><category term="datetime"></category></entry><entry><title>[python]è§£å†³ä½¿ç”¨ argparse æ—¶å‡ºç°ï¼šValueError: unsupported format character 'p' (0x70) at index 8</title><link href="https://mozillazg.com/2013/06/python-valueerror-unsupported-format-character-p-0x70-at-index-8.html" rel="alternate"></link><updated>2013-06-07T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-06-07:2013/06/python-valueerror-unsupported-format-character-p-0x70-at-index-8.html</id><summary type="html">&lt;p&gt;å°†ç¨‹åºä» optparse è½¬åˆ° argparse åï¼Œå‡ºç°äº†å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="p"&gt;...&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;C:\PYTHON26\lib\site-packages&lt;/span&gt;&lt;span class="se"&gt;\a&lt;/span&gt;&lt;span class="s"&gt;rgparse-1.2.1-py2.6.egg&lt;/span&gt;&lt;span class="se"&gt;\a&lt;/span&gt;&lt;span class="s"&gt;rgparse.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;230&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;format_help&lt;/span&gt;
    &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;C:\PYTHON26\lib\site-packages&lt;/span&gt;&lt;span class="se"&gt;\a&lt;/span&gt;&lt;span class="s"&gt;rgparse-1.2.1-py2.6.egg&lt;/span&gt;&lt;span class="se"&gt;\a&lt;/span&gt;&lt;span class="s"&gt;rgparse.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;317&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_format_usage&lt;/span&gt;
    &lt;span class="n"&gt;usage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;usage&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;prog&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_prog&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nl"&gt;ValueError:&lt;/span&gt; &lt;span class="n"&gt;unsupported&lt;/span&gt; &lt;span class="n"&gt;format&lt;/span&gt; &lt;span class="n"&gt;character&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;p&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x70&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/blockquote&gt;
&lt;p&gt;å°†ç¨‹åºä¸­çš„ &lt;code&gt;%prog&lt;/code&gt; æ”¹ä¸º &lt;code&gt;%(prog)s&lt;/code&gt; ï¼Œ&lt;code&gt;%default&lt;/code&gt; æ”¹ä¸º &lt;code&gt;%(default)s&lt;/code&gt; å³å¯ã€‚&lt;/p&gt;
&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://mail.python.org/pipermail/python-dev/2009-December/094598.html"&gt;[Python-Dev] Pronouncement on PEP 389: argparse?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://docs.python.org/2/library/argparse.html"&gt;argparse â€” Parser for command-line options, arguments and sub-commands - Python 2.7 Documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="argparse"></category></entry><entry><title>[python]è§£å†³ 64 ä½ windows ä¸‹ä½¿ç”¨ pip å®‰è£…å¸¦ c æ‰©å±•çš„æ¨¡å—æ—¶ï¼Œå‡ºç° "ValueError: [u'path']" é”™è¯¯</title><link href="https://mozillazg.com/2013/06/python-Windows-x64-compile-c-valueerror-path.html" rel="alternate"></link><updated>2013-06-06T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-06-06:2013/06/python-Windows-x64-compile-c-valueerror-path.html</id><summary type="html">&lt;p&gt;ä»Šå¤©åœ¨ 64 ä½ Windows ä¸‹ä½¿ç”¨ pip å®‰è£… rcssmin æ—¶ï¼Œå‡ºç°äº†å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;...
   File &lt;span class="s2"&gt;&amp;quot;C:\Python27\lib\distutils\msvc9compiler.py&amp;quot;&lt;/span&gt;, line 299, in query_vcvarsall

      raise ValueError&lt;span class="o"&gt;(&lt;/span&gt;str&lt;span class="o"&gt;(&lt;/span&gt;list&lt;span class="o"&gt;(&lt;/span&gt;result.keys&lt;span class="o"&gt;())))&lt;/span&gt;

 ValueError: &lt;span class="o"&gt;[&lt;/span&gt;u&lt;span class="s1"&gt;&amp;#39;path&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯å› ä¸ºåœ¨ç¼–è¯‘ c æ‰©å±•ç¨‹åºæ—¶ï¼Œå‡ºç°äº†é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³åŠæ³•æ˜¯ï¼Œå®‰è£… Visual Studio 2008 Professional x64ï¼Œå¹¶ä¸”åœ¨å®‰è£…æ—¶é€‰ä¸­ x64 compiler tools:&lt;/p&gt;
&lt;p&gt;&lt;img alt="install vs2008" src="/static/images/install_vs_x64_compiler_tools.png" /&gt;&lt;/p&gt;
&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/4676728/value-error-trying-to-install-python-for-windows-extensions"&gt;command line - Value error trying to install Python for Windows extensions - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="ValueError"></category></entry><entry><title>[python][linux]CentOS ä¸‹å®‰è£… Pillow</title><link href="https://mozillazg.com/2013/04/pythonlinuxcentos-xia-an-zhuang-pillow.html" rel="alternate"></link><updated>2013-04-20T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-04-20:2013/04/pythonlinuxcentos-xia-an-zhuang-pillow.html</id><summary type="html">&lt;p&gt;å®‰è£…ä¾èµ–ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;libjpeg&lt;/span&gt; &lt;span class="n"&gt;libjpeg&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt; &lt;span class="n"&gt;freetype&lt;/span&gt; &lt;span class="n"&gt;freetype&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt; &lt;span class="n"&gt;zlib&lt;/span&gt; &lt;span class="n"&gt;zlib&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt; &lt;span class="n"&gt;littlecms&lt;/span&gt; &lt;span class="n"&gt;littlecms&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt; &lt;span class="n"&gt;libwebp&lt;/span&gt; &lt;span class="n"&gt;libwebp&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt; &lt;span class="n"&gt;libfreetype&lt;/span&gt; &lt;span class="n"&gt;libfreetype&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å®‰è£… Pillow:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;pip&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;pillow&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="python"></category><category term="linux"></category><category term="centos"></category><category term="pillow"></category><category term="pil"></category></entry><entry><title>[python]åœ¨ zope2 ä¸­è·å–å½“å‰æ—¶é—´åŠæ ¼å¼åŒ–è¾“å‡º</title><link href="https://mozillazg.com/2013/03/python-zope2-datetime.html" rel="alternate"></link><updated>2013-03-18T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-03-18:2013/03/python-zope2-datetime.html</id><summary type="html">&lt;p&gt;å¯ä»¥ä½¿ç”¨ Zope2 å†…ç½®çš„ &lt;code&gt;DateTime()&lt;/code&gt; è·å–å½“å‰æ—¶é—´ã€‚&lt;/p&gt;
&lt;h2 id="scriptpython"&gt;Script(Python)&lt;/h2&gt;
&lt;p&gt;æ–°å»º Script(Python) æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;DateTime&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mo"&gt;03&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;22.825950&lt;/span&gt; &lt;span class="n"&gt;GMT&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ ¼å¼è¾“å‡ºï¼š&lt;/p&gt;
&lt;p&gt;return DateTime().strftime('%Y-%m-%d %H:%M:%S')
ç»“æœï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mo"&gt;03&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="dtml"&gt;DTML&lt;/h2&gt;
&lt;p&gt;æ–°å»º DTML æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;dtml&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt; &lt;span class="n"&gt;expr&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;DateTime()&amp;quot;&lt;/span&gt; &lt;span class="n"&gt;fmt&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;%Y/%m/%d %H:%M&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mo"&gt;03&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.faqs.org/docs/ZopeBook/AppendixB.html"&gt;ZopeBook Appendix B: API Reference&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="zope2"></category></entry><entry><title>[python]zope2 æ–‡ä»¶ä¸‹è½½åŠå¯¼å‡ºä¸º csv æ–‡ä»¶</title><link href="https://mozillazg.com/2013/03/python-zope2-download-file-and-generator-csv-file.html" rel="alternate"></link><updated>2013-03-18T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-03-18:2013/03/python-zope2-download-file-and-generator-csv-file.html</id><summary type="html">&lt;p&gt;æœ¬æ–‡å°†ç®€å•å®ç° zope2 å¯¼å‡ºæ•°æ®åº“æ•°æ®ä¸º csv æ–‡ä»¶å¹¶æä¾›ä¸‹è½½é“¾æ¥ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆå»ºä¸€ä¸ª &lt;strong&gt;Z SQL Method&lt;/strong&gt;ï¼ŒID ä¸º &lt;strong&gt;query_sql&lt;/strong&gt;ï¼Œå†…å®¹å°±æ˜¯æŸ¥è¯¢æ‰€æœ‰ç»“æœçš„ sql è¯­å¥ ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;select&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å†å»ºä¸€ä¸ª &lt;strong&gt;Script (Python)&lt;/strong&gt; ID ä¸º &lt;strong&gt;hello_py&lt;/strong&gt;, å†…å®¹æ˜¯è°ƒç”¨ä¸Šé¢å®šä¹‰çš„ Z SQL Methodï¼Œå¹¶å°†ç»“æœè½¬æ¢ä¸º&lt;strong&gt;é€—å·åˆ†éš”&lt;/strong&gt;çš„ cvs æ ¼å¼ï¼Œä¸‹é¢å°†è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;container&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;REQUEST&lt;/span&gt;
&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;

&lt;span class="n"&gt;query_result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query_sql&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# è·å–æ•°æ®åº“æŸ¥è¯¢ç»“æœ&lt;/span&gt;
&lt;span class="n"&gt;dics&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;query_result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dictionaries&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c"&gt;# å°†æŸ¥è¯¢ç»“æœè½¬æ¢ä¸ºä¸€ä¸ªå­—å…¸&lt;/span&gt;

&lt;span class="c"&gt;# è¾“å‡ºæŸ¥è¯¢ç»“æœåŒ…å«çš„å­—æ®µåç§°ï¼Œä¹Ÿå°±æ˜¯ csv æ–‡ä»¶çš„ç¬¬ä¸€è¡Œ&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dics&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;()])&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dics&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c"&gt;#print x.keys()&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="c"&gt;# è¾“å‡ºæ¯æ¡æŸ¥è¯¢ç»“æœä¸­å„å­—æ®µçš„å€¼&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;

&lt;span class="c"&gt;# è®¾ç½®è¿”å›çš„ response å¯¹è±¡çš„ Header&lt;/span&gt;
&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;application/ms-excel;charset=utf-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# æ–‡ä»¶ MIME ç±»å‹åŠç¼–ç &lt;/span&gt;
&lt;span class="c"&gt;# å£°æ˜æ˜¯ä¸ªé™„ä»¶ï¼Œä¸è¦æ‰“å¼€è€Œæ˜¯ä¸‹è½½ï¼ŒåŒæ—¶è®¾ç½®æ–‡ä»¶å&lt;/span&gt;
&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Content-Disposition&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;attachment; filename=txt.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;printed&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç„¶åå»ºä¸€ä¸ª DTML æ–‡ä»¶ï¼ŒID ä¸º &lt;strong&gt;txt.csv&lt;/strong&gt; ç”¨æ¥è°ƒç”¨ä¸Šé¢çš„è„šæœ¬ï¼Œè¿™ä¸ªæ–‡ä»¶å…¶å®å°±æ˜¯è¦ä¸‹è½½çš„é™„ä»¶:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;dtml&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt; &lt;span class="n"&gt;hello_py&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æœ€åå°±æ˜¯å†å»ºä¸€ä¸ª DTML æ–‡ä»¶ï¼ŒID ä¸º download ã€‚ä¸»è¦æ˜¯æä¾›ä¸€ä¸ªæŒ‡å‘ txt.csv DTML æ–‡ä»¶çš„é“¾æ¥ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;p&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;txt.csv&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;Download txt.csv&lt;span class="nt"&gt;&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;!--æ•ˆæœï¼š--&gt;

&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://gqliu.blog.163.com/blog/static/22584907200831065054649/"&gt;ç”¨Zopeä¸Šä¼ ä¸‹è½½æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="zope2"></category><category term="csv"></category></entry><entry><title>[python]è§£å†³ zope2 åå°ç¼–è¾‘å™¨ä¸­æ–‡ç¼–ç é—®é¢˜</title><link href="https://mozillazg.com/2013/03/python-zope2-zmi-chinese-problem.html" rel="alternate"></link><updated>2013-03-15T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-03-15:2013/03/python-zope2-zmi-chinese-problem.html</id><summary type="html">&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ zope2 çš„åå°ç¼–è¾‘å™¨ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;title&amp;gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;#24050;&amp;amp;#25552;&amp;amp;#20132;&amp;amp;#21464;&amp;amp;#26356;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åœ¨ manage åå°ç¨ä½œä¿®æ”¹åå°±å¯ä»¥æ­£å¸¸ä¿å­˜ä¸­æ–‡äº†ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;title&amp;gt;&lt;/span&gt;å·²æäº¤å˜æ›´&lt;span class="nt"&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¿®æ”¹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨zopeçš„æ ¹ç›®å½•çš„propertyiesé¡µä¸‹é¢ï¼Œå¢åŠ å¦‚ä¸‹ç‰¹æ€§ï¼šmanagement_page_set: utf-8ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="alt" src="/static/images/2013-3-zope2-chinese-01.png" /&gt;&lt;/p&gt;
&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://comments.gmane.org/gmane.comp.web.zope.chinese/541"&gt;å¦‚ä½•æ”¹å˜Zopeé»˜è®¤çš„ç¼–ç ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://315ok.org/blogs/zmizhongwenluanmawentijiejue"&gt;ZMI ä¸­æ–‡ ä¹±ç é—®é¢˜è§£å†³&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="zope2"></category></entry><entry><title>[python]ä¿®å¤ ZMySQLDA-2.0.8 å‡ºç°çš„â€œImportError: No module named ImageFileâ€é”™è¯¯</title><link href="https://mozillazg.com/2013/03/python-fix-zmysqlda-2.0.8-no-module-named-imagefile.html" rel="alternate"></link><updated>2013-03-08T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-03-08:2013/03/python-fix-zmysqlda-2.0.8-no-module-named-imagefile.html</id><summary type="html">&lt;p&gt;ä¿®æ”¹ ZMySQLDA æ–‡ä»¶å¤¹å†…çš„ DA.pyã€DABase.py æ–‡ä»¶ï¼Œå°†&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ImageFile&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ImageFile&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ”¹ä¸º&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;App.ImageFile&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ImageFile&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å³å¯ã€‚&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="go"&gt;[zope@localhost ZMySQLDA]$ cat DA.py | grep App.Image -n&lt;/span&gt;
&lt;span class="go"&gt;96:from App.ImageFile import ImageFile&lt;/span&gt;

&lt;span class="go"&gt;[zope@localhost ZMySQLDA]$ cat DABase.py | grep App.Image -n&lt;/span&gt;
&lt;span class="go"&gt;92:from App.ImageFile import ImageFile&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://rescue.unchor.com/4"&gt;zope ã® version up ã§ Products "COREBlog" "EPos" ã§ã‚¨ãƒ©ãƒ¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://mxm-mad-science.blogspot.com/2008/01/installing-zmysqlda-in-zope-using.html"&gt;Installing ZMySQLDA in Zope using buildout on Ubuntu and perhaps Debian in general&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category><category term="zope"></category><category term="mysql"></category></entry><entry><title>[python]æ’åºï¼ˆSorting Mini-HOW TOï¼‰</title><link href="https://mozillazg.com/2013/03/python-sorting-how-to.html" rel="alternate"></link><updated>2013-03-03T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-03-03:2013/03/python-sorting-how-to.html</id><summary type="html">&lt;p&gt;æœ¬æ–‡æ•´ç†è‡ª &lt;a href="http://wiki.python.org/moin/HowTo/Sorting/"&gt;HowTo/Sorting - Python Wiki&lt;/a&gt;ï¼Œå¦‚æœ‰ä¸å¦¥ä¹‹å¤„ï¼Œè¯·ç¿»é˜…è‹±æ–‡åŸæ–‡ã€‚&lt;/p&gt;
&lt;p&gt;Python å†…ç½®çš„ &lt;code&gt;sort()&lt;/code&gt; æ–¹æ³•å¯ä»¥å®ç°å¯¹åˆ—è¡¨çš„åŸåœ°æ’åºåŠŸèƒ½ã€‚å†…ç½®çš„ &lt;code&gt;sorted()&lt;/code&gt; å‡½æ•°åˆ™ä¸ä¼šä¿®æ”¹åŸåˆ—è¡¨ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªç»è¿‡æ’åºçš„æ–°åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ€»ç»“ä¸€äº›å¸¸ç”¨çš„æ’åºæ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id="_1"&gt;åŸºæœ¬æ’åº&lt;/h2&gt;
&lt;p&gt;æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ &lt;code&gt;sorted()&lt;/code&gt; å‡½æ•°ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªç»è¿‡æ’åºçš„æ–°åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;list.sort()&lt;/code&gt; æ–¹æ³•ï¼Œ ä½†æ˜¯å®ƒä¼šä¿®æ”¹åŸåˆ—è¡¨ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨ &lt;code&gt;sorted()&lt;/code&gt;ã€‚å¦‚æœä½ ä¸å†éœ€è¦åŸå§‹åˆ—è¡¨çš„è¯ï¼Œç”¨ç”¨ &lt;code&gt;list.sort()&lt;/code&gt; ä¹Ÿæ— å¦¨ã€‚&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¦ä¸€ä¸ªä¸åŒç‚¹æ˜¯ï¼Œ&lt;code&gt;list.sort()&lt;/code&gt; æ–¹æ³•åªèƒ½ä½œç”¨äºåˆ—è¡¨ï¼Œè€Œ &lt;code&gt;sorted()&lt;/code&gt; å‡½æ•°åˆ™æ¥å—ä»»ä½•å¯è¿­ä»£å¯¹è±¡ã€‚&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;D&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;E&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="key"&gt;Key å‡½æ•°&lt;/h2&gt;
&lt;p&gt;ä» Python 2.4 å¼€å§‹ï¼Œ &lt;code&gt;list.sort()&lt;/code&gt; åŠ &lt;code&gt;sorted()&lt;/code&gt; å¢åŠ äº†ä¸€ä¸ª &lt;code&gt;key&lt;/code&gt; å‚æ•°ï¼Œè¯¥å‚æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå®ƒçš„å€¼ï¼Œå¯ä»¥é€šè¿‡é‚£ä¸ªå‡½æ•°å®šä¹‰æ’åºåº”è¯¥éµå¾ªçš„è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œå¯¹å­—ç¬¦ä¸²åšä¸åŒºåˆ†å¤§å°å†™çš„æ’åºï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;This is a test string from Andrew&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lower&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Andrew&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;from&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;is&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;string&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;This&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;# å¯¹ç…§&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;This is a test string from Andrew&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Andrew&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;This&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;from&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;is&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;string&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;key&lt;/code&gt; å‚æ•°çš„å€¼å¿…é¡»æ˜¯ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°ï¼ˆåˆ—è¡¨å…ƒç´ ï¼‰å¹¶ä¸”è¿”å›ä¸€ä¸ªç”¨æ¥æ’åºçš„ keyï¼ˆæŒ‰è¿™ä¸ª key è¿›è¡Œæ’åºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬é€šè¿‡ä½¿ç”¨å¯¹è±¡çš„æŸä¸ªç´¢å¼•ä½œä¸º key çš„å€¼æ¥å¯¹å¤æ‚å¯¹è±¡è¿›è¡Œæ’åºã€‚æ¯”å¦‚å¯¹ä¸€ä¸ªå¤šç»´æ•°ç»„è¿›è¡Œæ’åºï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;student_tuples&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="c"&gt;# æŒ‰åˆ—è¡¨å…ƒç´ ï¼ˆå…ƒç»„ï¼‰çš„ç¬¬3ä¸ªå€¼æ’åº&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_tuples&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;student&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;student&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;   &lt;span class="c"&gt;# sort by age&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™ä¸ªæŠ€æœ¯ä¹Ÿå¯ä»¥ç”¨æ¥æŒ‰å¯¹è±¡çš„å±æ€§å€¼è¿›è¡Œæ’åºã€‚æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grade&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;grade&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;grade&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;age&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__repr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;repr&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;grade&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;student_objects&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="c"&gt;# æŒ‰ age å±æ€§çš„å€¼æ’åº&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_objects&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;student&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;student&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;   &lt;span class="c"&gt;# sort by age&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="operator"&gt;Operator æ¨¡å—å‡½æ•°&lt;/h2&gt;
&lt;p&gt;ç”±äº key å‚æ•°æ¯”è¾ƒå¸¸ç”¨ï¼Œæ‰€ä»¥ Python å†…ç½®äº†ä¸€äº›ç”¨æ¥ç®€å•ã€å¿«é€Ÿç”Ÿæˆç›¸å…³å‡½æ•°çš„æ–¹æ³•ã€‚
&lt;a href="http://docs.python.org/library/operator.html#module-operator"&gt;operator æ¨¡å—&lt;/a&gt; æä¾›äº† &lt;a href="http://docs.python.org/2/library/operator.html#operator.itemgetter"&gt;itemgetter&lt;/a&gt;ï¼Œ&lt;a href="http://docs.python.org/2/library/operator.html#operator.attrgetter"&gt;attrgetter&lt;/a&gt;ï¼Œ
ä»¥åŠä» Python 2.6 å¼€å§‹æä¾›çš„ &lt;a href="http://docs.python.org/2/library/operator.html#operator.methodcaller"&gt;methodcaller&lt;/a&gt; å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œä¸Šé¢çš„ä¾‹å­å°†å˜å¾—æ›´ç®€å•ã€æ›´å¿«é€Ÿï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;operator&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;itemgetter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;attrgetter&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;student_tuples&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_tuples&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;itemgetter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;  &lt;span class="c"&gt;# æŒ‰å…ƒç´ ç´¢å¼•æ’åº&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grade&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;grade&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;grade&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;age&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__repr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;repr&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;grade&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;student_objects&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_objects&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;attrgetter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;  &lt;span class="c"&gt;# æŒ‰å¯¹è±¡å±æ€§æ’åº&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€šè¿‡ operator æ¨¡å—æä¾›çš„å‡½æ•°è¿˜å¯ä»¥å®ç°å¤šé‡æ’åºçš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œå…ˆæŒ‰ grade æ’åºå†æŒ‰ age æ’åºï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_tuples&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;itemgetter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_objects&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;attrgetter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;grade&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;a href="http://docs.python.org/2/library/operator.html#operator.methodcaller"&gt;methodcaller&lt;/a&gt;
å‡½æ•°å¯ä»¥è®©å…ƒç´ è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åæŒ‰æ–¹æ³•çš„è¿”å›å€¼è¿›è¡Œæ’åºï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;words&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;abase&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;alfalfa&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;words&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;methodcaller&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;count&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;  &lt;span class="c"&gt;# word.count(&amp;#39;a&amp;#39;)&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;abase&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;alfalfa&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;# ç­‰ä»·äº&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;words&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;word&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;word&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;abase&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;alfalfa&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_2"&gt;å‡åºå’Œé™åº&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;list.sort()&lt;/code&gt; å’Œ &lt;code&gt;sorted()&lt;/code&gt; éƒ½æ¥å—ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„ &lt;code&gt;reverse&lt;/code&gt; å‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”¨æ¥æ ‡è®°æ˜¯å¦ä½¿ç”¨é™åºæ’åºã€‚æ¯”å¦‚è·å–æŒ‰ age é™åºæ’åºçš„ student æ•°æ®ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_tuples&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;itemgetter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;reverse&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_objects&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;attrgetter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;reverse&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="stability"&gt;å¹³è¡¡ï¼ˆStabilityï¼‰æ’åºå’Œå¤æ‚æ’åº&lt;/h2&gt;
&lt;p&gt;ä» Python 2.2 å¼€å§‹ï¼Œæ’åºå°†ä¿è¯èƒ½å¤Ÿ &lt;a href="http://en.wikipedia.org/wiki/Sorting_algorithm#Stability"&gt;stable&lt;/a&gt;ã€‚
è¿™æ„å‘³ç€å½“å¤šä¸ªè®°å½•æ‹¥æœ‰ç›¸åŒçš„ key æ—¶ï¼Œå®ƒä»¬çš„åŸå§‹é¡ºåºå°†è¢«ä¿ç•™ã€‚&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;itemgetter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™é‡Œæœ‰ä¸¤æ¡è®°å½•éƒ½åŒ…å« 'blue' å¹¶ä¸”åŸåˆ—è¡¨ä¸­ ('blue', 1) æ’åœ¨ ('blue', 2) ä¹‹å‰ï¼Œæ’åºåè¿™ä¸ªé¡ºåºä¾æ—§è¢«ä¿ç•™ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§å¯ä»¥ç”¨æ¥å®ç°åŒ…å«å¤šé‡æ’åºï¼ˆä¸€ä¼šå‡åºï¼Œä¸€ä¼šé™åºï¼‰çš„å¤æ‚æ’åºã€‚æ¯”å¦‚ï¼Œç›®æ ‡æ˜¯å®ç° student æ•°æ®å…ˆä»¥ grade é™åºæ’åºå†ä»¥ age å‡åºæ’åºï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grade&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;grade&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;grade&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;age&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__repr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;repr&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;grade&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;student_objects&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_objects&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;attrgetter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;     &lt;span class="c"&gt;# sort on secondary key&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;attrgetter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;grade&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;reverse&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;       &lt;span class="c"&gt;# now sort on primary key, descending&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Python ä½¿ç”¨çš„ &lt;a href="http://en.wikipedia.org/wiki/Timsort"&gt;Timsort&lt;/a&gt; æ’åºç®—æ³•èƒ½å¤Ÿé«˜æ•ˆçš„å®ç°å¤šé‡æ’åºã€‚&lt;/p&gt;
&lt;h2 id="decorate-sort-undecorate"&gt;ä»¥å‰çš„å®ç°æ–¹å¼(Decorate-Sort-Undecorate)&lt;/h2&gt;
&lt;p&gt;Python 2.4 ä¹‹å‰çš„æƒ¯ç”¨æ–¹æ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨ Decorate-Sort-Undecorateï¼Œæ¯”å¦‚å°† student æ•°æ®æŒ‰ grade æ’åºï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;decorated&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;student&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;grade&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;student&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;student&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;enumerate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_objects&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;decorated&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;student&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;grade&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;student&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;decorated&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;               &lt;span class="c"&gt;# undecorate&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™ç§æ–¹æ³•çš„å¦ä¸€ä¸ªåå­—æ˜¯ &lt;a href="http://en.wikipedia.org/wiki/Schwartzian_transform"&gt;Schwartzian transform&lt;/a&gt;ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id="cmp"&gt;ä»¥å‰çš„å®ç°æ–¹å¼(ä½¿ç”¨ cmp å‚æ•°)&lt;/h2&gt;
&lt;p&gt;Python 2.4 ä¹‹å‰æƒ¯ç”¨çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ cmp å‚æ•°ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;numeric_compare&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;cmp&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;numeric_compare&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å€’åºï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;reverse_numeric&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;cmp&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;reverse_numeric&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Python 3 ä¸å†æ”¯æŒ cmp å‚æ•°ï¼Œé‚£ä¹ˆå¦‚æœè½¬æ¢ä¹‹å‰çš„ç¨‹åºå‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;cmp_to_key&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mycmp&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;Convert a cmp= function into a key= function&amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;K&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__lt__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;mycmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__gt__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;mycmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__eq__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;mycmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__le__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;mycmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__ge__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;mycmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__ne__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;mycmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;K&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç”¨æ³•ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cmp_to_key&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;reverse_numeric&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åœ¨ Python 2.7 ä¸­ï¼Œ&lt;code&gt;cmp_to_key()&lt;/code&gt; å·¥å…·å·²ç»è¢«å†…ç½®åˆ° &lt;a href="http://docs.python.org/2/library/functools.html#functools.cmp_to_key"&gt;functools&lt;/a&gt; æ¨¡å—ä¸­ã€‚&lt;/p&gt;
&lt;h2 id="_3"&gt;å…¶ä»–&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºæœ¬åœ°åŒ–æ’åºï¼Œå¯ä»¥ä½¿ç”¨ &lt;a href="http://docs.python.org/2/library/locale.html#locale.strxfrm"&gt;locale.strxfrm()&lt;/a&gt; ä½œä¸º key å‡½æ•°æˆ–ä½¿ç”¨ &lt;a href="http://docs.python.org/2/library/locale.html#locale.strcoll"&gt;locale.strcoll()&lt;/a&gt; ä½œä¸ºæ¯”è¾ƒå‡½æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;reverse&lt;/code&gt; å‚æ•°ä¾ç„¶èƒ½å¤Ÿä¿å­˜æ’åºçš„ç¨³å®šæ€§ï¼ˆæ¯”å¦‚ï¼Œæ‹¥æœ‰ç›¸åŒè®°å½•çš„ keys ä¾æ—§ä¿ç•™äº†åŸæ¥çš„é¡ºåºï¼‰ï¼Œæœ‰è¶£çš„æ˜¯ï¼Œå°±ç®—æ˜¯ä¸ä½¿ç”¨è¯¥å‚æ•°ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ä¸¤æ¬¡ &lt;code&gt;reversed&lt;/code&gt; å‡½æ•°æ¥å®ç°è¿™ç§æ•ˆæœï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;reverse&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;reversed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;reversed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæƒ³ç»™ç±»æ’åºçš„è¯ï¼Œåªéœ€æ·»åŠ ç›¸å…³çš„æ¯”è¾ƒæ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__eq__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__ne__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__lt__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__le__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__gt__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Student&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__ge__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;student_objects&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªéœ€å®šä¹‰ä¸Šé¢6ä¸ªæ¯”è¾ƒæ“ä½œå°±å¯ä»¥äº†ã€‚&lt;a href="http://docs.python.org/2/library/functools.html#functools.total_ordering"&gt;functools.total_ordering&lt;/a&gt; ç±»è£…é¥°å™¨å¯ä»¥å¾ˆæ–¹ä¾¿å°±å®ç°è¿™ä¸ªéœ€æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;key å‡½æ•°ä¹Ÿå¯ä»¥ä¸è®¿é—®è¦æ’åºå¯¹è±¡çš„ç›¸å…³æ•°æ®ï¼Œè®¿é—®å¤–éƒ¨èµ„æºä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ¯”å¦‚ï¼Œå­¦ç”Ÿæˆç»©å­˜å‚¨åœ¨ä¸€ä¸ªå­—å…¸ä¸­ï¼Œè¿™ä¸ªå­—å…¸å¯ä»¥ç”¨æ¥å¯¹å­¦ç”Ÿåå­—è¿›è¡Œæ’åºï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;students&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;newgrades&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;F&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;C&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;students&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;newgrades&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__getitem__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;jane&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;dave&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;john&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;!--## å‚è€ƒ--&gt;

&lt;!--* [TimSort ä¸­çš„æ ¸å¿ƒè¿‡ç¨‹ - YD Blog - ITeyeæŠ€æœ¯ç½‘ç«™](http://yangdong.iteye.com/blog/1170214)--&gt;</summary><category term="python"></category><category term="sorting"></category><category term="sort"></category><category term="sorted"></category></entry><entry><title>[python]å°†åˆ—è¡¨åˆ†ç»„æˆåŒ…å«å¤šä¸ªå­åˆ—è¡¨çš„åˆ—è¡¨</title><link href="https://mozillazg.com/2013/02/python-group-list-in-sub-lists-of-n-items.html" rel="alternate"></link><updated>2013-02-19T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-02-19:2013/02/python-group-list-in-sub-lists-of-n-items.html</id><summary type="html">&lt;p&gt;æƒ³å–å¾—çš„æ•ˆæœæ˜¯ï¼š [1, 2, 3, 4, 5, 6, 7] --&amp;gt; [[1, 2, 3], [4, 5, 6], [7]]&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä¸‰ç§æ–¹æ³•å–è‡ªåšæ–‡ &lt;a href="http://sandrotosi.blogspot.com/2011/04/python-group-list-in-sub-lists-of-n.html"&gt;http://sandrotosi.blogspot.com/2011/04/python-group-list-in-sub-lists-of-n.html&lt;/a&gt; åŠè¯„è®ºã€‚&lt;/p&gt;
&lt;h2 id="_1"&gt;ç¬¬ä¸€ç§æ–¹æ³•&lt;/h2&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;group_iter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;iterator&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot; Given an iterator, it returns sub-lists made of n items&lt;/span&gt;
&lt;span class="sd"&gt;    (except the last that can have len &amp;lt; n)&lt;/span&gt;
&lt;span class="sd"&gt;    inspired by http://countergram.com/python-group-iterator-list-function&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;accumulator&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;item&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;iterator&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;accumulator&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;accumulator&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="c"&gt;# tested as fast as separate counter&lt;/span&gt;
            &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;accumulator&lt;/span&gt;
            &lt;span class="n"&gt;accumulator&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt; &lt;span class="c"&gt;# tested faster than accumulator[:] = []&lt;/span&gt;
            &lt;span class="c"&gt;# and tested as fast as re-using one list object&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;accumulator&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;accumulator&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ•ˆæœï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;group_iter&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt; &lt;span class="nb"&gt;object&lt;/span&gt; &lt;span class="n"&gt;group_iter&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mh"&gt;0x02A43418&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_iter&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_iter&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_2"&gt;ç¬¬äºŒç§æ–¹æ³•ï¼š&lt;/h2&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;original_list&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;list_size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;original_list&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;list_size&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;xrange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;original_list&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;list_size&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_3"&gt;ç¬¬ä¸‰ç§æ–¹æ³•ï¼š&lt;/h2&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;splitarray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gsize&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;arraylen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arraylen&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;gsize&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;gsize&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;gsize&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;gsize&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;arraylen&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;gsize&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arraylen&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;gsize&lt;/span&gt;&lt;span class="p"&gt;):]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ•ˆæœï¼š&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;original_list&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;list_size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;original_list&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;list_size&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;xrange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;original_list&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;list_size&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_4"&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://code.activestate.com/recipes/303060-group-a-list-into-sequential-n-tuples/"&gt;Group a list into sequential n-tuples Â« Python recipes Â« ActiveState Code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://sandrotosi.blogspot.com/2011/04/python-group-list-in-sub-lists-of-n.html"&gt;Sandro Tosi: Python: group a list in sub-lists of n items&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.garyrobinson.net/2008/04/splitting-a-pyt.html"&gt;Gary Robinson's Rants: Splitting a Python list into sublists&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="python"></category></entry></feed>