<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>mozillazg's blog</title><link href="https://mozillazg.com/" rel="alternate"></link><link href="https://mozillazg.com/feeds/mongodb.atom.xml" rel="self"></link><id>https://mozillazg.com/</id><updated>2016-07-02T00:00:00+00:00</updated><entry><title>MongoDB: 解决 Overflow sort stage buffered data 错误</title><link href="https://mozillazg.com/2016/07/mongodb-overflow-sort-stage-buffered-data-usage-of-x-bytes-exceeds-internal-limit-of-33554432-bytes.html" rel="alternate"></link><updated>2016-07-02T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2016-07-02:2016/07/mongodb-overflow-sort-stage-buffered-data-usage-of-x-bytes-exceeds-internal-limit-of-33554432-bytes.html</id><summary type="html">&lt;p&gt;使用 pymongo 时有时会遇到提示如下的错误:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  File &amp;quot;/usr/local/lib/python2.7/dist-packages/pymongo/cursor.py&amp;quot;, line 1090, in next
    if len(self.__data) or self._refresh():
  File &amp;quot;/usr/local/lib/python2.7/dist-packages/pymongo/cursor.py&amp;quot;, line 1022, in _refresh
    self.__uuid_subtype))
  File &amp;quot;/usr/local/lib/python2.7/dist-packages/pymongo/cursor.py&amp;quot;, line 958, in __send_message
    self.__compile_re)
  File &amp;quot;/usr/local/lib/python2.7/dist-packages/pymongo/helpers.py&amp;quot;, line 113, in _unpack_response
    error_object)
OperationFailure: database error: Executor error: Overflow sort stage buffered data usage of 33597009 bytes exceeds internal limit of 33554432 bytes
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;为什么会出现这样的错误呢？ 原来 mongodb 限制了在内存中进行 sort 操作（无法使用索引的情况下）时所使用的最大内存大小，默认是 32 M(33554432 bytes)。&lt;/p&gt;
&lt;p&gt;如果要修改这个限制的话，可以通过如下的 mongo 命令进行修改，比如修改为 50 M(52428800 bytes):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt; use admin
&amp;gt; db.adminCommand({setParameter: 1, internalQueryExecMaxBlockingSortBytes: 52428800})
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;参考资料&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://askubuntu.com/questions/501937/how-to-increase-buffered-data-limit"&gt;mongodb - How to increase buffered data limit? - Ask Ubuntu&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.mongodb.com/manual/reference/limits/#Sort-Operations"&gt;MongoDB Limits and Thresholds &amp;mdash; MongoDB Manual 3.2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary></entry><entry><title>[mongodb]复制文档（document）</title><link href="https://mozillazg.com/2014/10/mongodb-copy-document.html" rel="alternate"></link><updated>2014-10-27T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2014-10-27:2014/10/mongodb-copy-document.html</id><summary type="html">&lt;p&gt;可以通过下列命令复制文档&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt; use db1
&amp;gt; var docs=db.doc1.find();

&amp;gt; use db2;
&amp;gt; docs.forEach(function(doc){
    db.doc2.insert(doc); 
} );
&lt;/pre&gt;&lt;/div&gt;</summary></entry></feed>