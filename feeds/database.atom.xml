<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Mozillazg's Blog</title><link href="http://mozillazg.com/" rel="alternate"></link><link href="http://mozillazg.com/feeds/database.atom.xml" rel="self"></link><id>http://mozillazg.com/</id><updated>2013-09-10T00:00:00+00:00</updated><entry><title>[MySQL]修复 DatabaseError: (1061, "Duplicate key name 'bar_xxx_uniq'") 错误</title><link href="http://mozillazg.com/2013/09/mysql-DatabaseError-1061-Duplicate-key-name.html" rel="alternate"></link><updated>2013-09-10T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-09-10:2013/09/mysql-DatabaseError-1061-Duplicate-key-name.html</id><summary type="html">&lt;p&gt;当 MySQL 数据库的索引 key 出现重复时，就会提示类似的错误：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;DatabaseError: (1061, "Duplicate key name 'abc_xxx_uniq'")&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;解决办法是移除重复的索引 key:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;ALTER&lt;/span&gt; &lt;span class="n"&gt;TABLE&lt;/span&gt; &lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;foo&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;bar&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt; &lt;span class="n"&gt;DROP&lt;/span&gt; &lt;span class="n"&gt;INDEX&lt;/span&gt; &lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;bar_xxx_uniq&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="mysql"></category></entry><entry><title>mysql 基于 master-master 的双机热备配置</title><link href="http://mozillazg.com/2013/06/mysql-master-master.html" rel="alternate"></link><updated>2013-06-21T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-06-21:2013/06/mysql-master-master.html</id><summary type="html">
&lt;p&gt;master-master 就是两台服务器互为主从：        &lt;br/&gt;
master1-slave(master2) &amp;amp;&amp;amp; master2-slave(master1)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;master1: 192.168.100.191&lt;/li&gt;
&lt;li&gt;master2: 192.168.100.166&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="master1-slavemaster2"&gt;master1-slave(master2)&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;mysql 版本最好一致&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id="master1"&gt;设置 master1&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;创建给 slave 登录用的用户名密码:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; GRANT REPLICATION SLAVE ON *.* TO &lt;span class="s1"&gt;'backup'&lt;/span&gt;@&lt;span class="s1"&gt;'192.168.100.166'&lt;/span&gt; IDENTIFIED BY &lt;span class="s1"&gt;'yNZE7fK9*@aMA?*ppF'&lt;/span&gt;;

&lt;span class="c"&gt;# humanreadable&lt;/span&gt;
mysql&amp;gt; &lt;span class="c"&gt;# grant replication slave on *.* to 'backup'@'192.168.100.166' identified by 'yNZE7fK9*@aMA?*ppF';&lt;/span&gt;

mysql&amp;gt; create database hello default charset utf8;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;配置 my.cnf&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;# vim /etc/my.cnf&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;mysqld&lt;span class="o"&gt;]&lt;/span&gt;
server-id&lt;span class="o"&gt;=&lt;/span&gt;1    &lt;span class="c"&gt;#主机id，整数&lt;/span&gt;
&lt;span class="c"&gt;#开启二进制日志，并且名称为 /var/lib/mysql/mysql-bin.***&lt;/span&gt;
&lt;span class="c"&gt;# 如果是个路径则，保存到该路径下(log-bin=/var/log/mysql-bin.log  -&amp;gt; /var/log/mysql-bin.***)&lt;/span&gt;
log-bin&lt;span class="o"&gt;=&lt;/span&gt;mysql-bin
&lt;span class="nb"&gt;read&lt;/span&gt;-only&lt;span class="o"&gt;=&lt;/span&gt;0  &lt;span class="c"&gt;#主机读写权限，读写都可以&lt;/span&gt;
binlog-do-db&lt;span class="o"&gt;=&lt;/span&gt;hello   &lt;span class="c"&gt;#记录日志的数据库：需要的备份数据，多个写多行&lt;/span&gt;
&lt;span class="c"&gt;# binlog-do-db=hello2&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;mysql &lt;span class="c"&gt;#不记录日志的数据库：不需要备份的数据库，多个写多行&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;information_schema

&lt;span class="c"&gt;# 自增字段奇数递增，防止冲突（1, 3, 5, ...,）&lt;/span&gt;
auto-increment-increment &lt;span class="o"&gt;=&lt;/span&gt; 2  &lt;span class="c"&gt;# 每次递增的步长&lt;/span&gt;
auto-increment-offset &lt;span class="o"&gt;=&lt;/span&gt; 1  &lt;span class="c"&gt;# 初始值&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重启 mysql: &lt;code&gt;serivce mysqld restart&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;导出数据库&lt;/p&gt;
&lt;p&gt;锁定数据库，不要退出 mysql shell&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt;FLUSH TABLES WITH READ LOCK;
mysql&amp;gt;# flush tables with &lt;span class="nb"&gt;read &lt;/span&gt;lock;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;新开一个终端，导出数据库&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysqldump --master-data -uroot -p hello &amp;gt; hello.sql
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看主服务器的状态&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; show master status&lt;span class="se"&gt;\G&lt;/span&gt;;
*************************** 1. row ***************************
            File: mysql-bin.000001
        Position: 98
    Binlog_Do_DB: hello
Binlog_Ignore_DB: mysql,test,information_schema
1 row in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;0.00 sec&lt;span class="o"&gt;)&lt;/span&gt;

ERROR: 
No query specified
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;记下 Position 和 File 的值。
解锁&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; UNLOCK TABLES;
mysql&amp;gt; &lt;span class="c"&gt;# unlock tables;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="slavemaster2"&gt;设置 slave(master2)&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;编辑 my.cnf&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;# vim /etc/my.cnf&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt;mysqld&lt;span class="o"&gt;]&lt;/span&gt;
server-id&lt;span class="o"&gt;=&lt;/span&gt;2
log-bin&lt;span class="o"&gt;=&lt;/span&gt;mysql-bin
master-host&lt;span class="o"&gt;=&lt;/span&gt;192.168.100.191  &lt;span class="c"&gt;# master1&lt;/span&gt;
master-user&lt;span class="o"&gt;=&lt;/span&gt;backup  &lt;span class="c"&gt;# 刚才在 master1 上设置的用户名密码&lt;/span&gt;
master-password&lt;span class="o"&gt;=&lt;/span&gt;yNZE7fK9*@aMA?*ppF  &lt;span class="c"&gt;# password&lt;/span&gt;
master-port&lt;span class="o"&gt;=&lt;/span&gt;3306   &lt;span class="c"&gt;# master1 mysql port&lt;/span&gt;
master-connect-retry&lt;span class="o"&gt;=&lt;/span&gt;60 &lt;span class="c"&gt;#如果从服务器发现主服务器断掉，重新连接的时间差(秒)&lt;/span&gt;
replicate-do-db &lt;span class="o"&gt;=&lt;/span&gt;hello &lt;span class="c"&gt;#只复制某个库，多个写多行&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;mysql &lt;span class="c"&gt;#不复制某个库&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;information_schema
relay-log&lt;span class="o"&gt;=&lt;/span&gt;mysqld-relay-bin  &lt;span class="c"&gt;# 开启日志中继&lt;/span&gt;
log-slave-updates  &lt;span class="c"&gt;# slave将复制事件写进自己的二进制日志&lt;/span&gt;
&lt;span class="c"&gt;#5.5&lt;/span&gt;
&lt;span class="c"&gt;#log-slave-updates = ON&lt;/span&gt;
&lt;span class="c"&gt;#5.1&lt;/span&gt;
&lt;span class="c"&gt;#log-slave-updates = 1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;导入 master 导出的数据库：&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; create database hello default charset utf8;
mysql -uroot -p hello &amp;lt; hello.sql
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;配置 master 信息：&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; slave stop;

mysql&amp;gt; CHANGE MASTER TO
-&amp;gt; &lt;span class="nv"&gt;MASTER_HOST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'192.168.100.191'&lt;/span&gt;, //主服务器的IP地址
-&amp;gt; &lt;span class="nv"&gt;MASTER_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'backup'&lt;/span&gt;, //同步数据库的用户
-&amp;gt; &lt;span class="nv"&gt;MASTER_PASSWORD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'yNZE7fK9*@aMA?*ppF'&lt;/span&gt;, //同步数据库的密码
-&amp;gt; &lt;span class="nv"&gt;MASTER_LOG_FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'mysql-bin.000001'&lt;/span&gt;, //主服务器二进制日志的文件名&lt;span class="o"&gt;(&lt;/span&gt;前面要求记住的 File 参数&lt;span class="o"&gt;)&lt;/span&gt;
-&amp;gt; &lt;span class="nv"&gt;MASTER_LOG_POS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;98; //日志文件的开始位置&lt;span class="o"&gt;(&lt;/span&gt;前面要求记住的 Position 参数&lt;span class="o"&gt;)&lt;/span&gt;

mysql&amp;gt; CHANGE MASTER TO &lt;span class="nv"&gt;MASTER_HOST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'192.168.100.191'&lt;/span&gt;, &lt;span class="nv"&gt;MASTER_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'backup'&lt;/span&gt;, &lt;span class="nv"&gt;MASTER_PASSWORD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'yNZE7fK9*@aMA?*ppF'&lt;/span&gt;, &lt;span class="nv"&gt;MASTER_LOG_FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'mysql-bin.000001'&lt;/span&gt;, &lt;span class="nv"&gt;MASTER_LOG_POS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;98;

mysql &amp;gt; slave start;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重启 master, slave: &lt;code&gt;service mysqld restart&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;查看 slave 状态：&lt;/p&gt;
&lt;p&gt;进入 slave mysql:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; show slave status&lt;span class="se"&gt;\G&lt;/span&gt;;
*************************** 1. row ***************************
            Slave_IO_State: Connecting to master
                Master_Host: 192.168.100.191
                Master_User: backup
                Master_Port: 3306
            Connect_Retry: 60
            Master_Log_File: mysql-bin.000001
        Read_Master_Log_Pos: 98
            Relay_Log_File: mysqld-relay-bin.000001
            Relay_Log_Pos: 98
    Relay_Master_Log_File: mysql-bin.000001
        Slave_IO_Running: Yes
        Slave_SQL_Running: Yes
            Replicate_Do_DB: hello
        Replicate_Ignore_DB: mysql,test,information_schema
        Exec_Master_Log_Pos: 98
            Relay_Log_Space: 98
            Until_Log_Pos: 0
    Seconds_Behind_Master: NULL
1 row in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;0.00 sec&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意一定要有下面两项，没有的话查看错误日志(less /var/log/mysqld.log)：&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;        &lt;span class="nl"&gt;Slave_IO_Running:&lt;/span&gt; &lt;span class="n"&gt;Yes&lt;/span&gt;
        &lt;span class="nl"&gt;Slave_SQL_Running:&lt;/span&gt; &lt;span class="n"&gt;Yes&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;测试&lt;/p&gt;
&lt;p&gt;master 服务器&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; use hello;
Database changed
mysql&amp;gt; create table &lt;span class="nb"&gt;test&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;id int&lt;span class="o"&gt;)&lt;/span&gt;;
mysql&amp;gt; insert int &lt;span class="nb"&gt;test set &lt;/span&gt;&lt;span class="nv"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1;

mysql&amp;gt; show master status&lt;span class="se"&gt;\G&lt;/span&gt;;
*************************** 1. row ***************************
            File: mysql-bin.000002  &lt;span class="c"&gt;# 注意这里&lt;/span&gt;
        Position: 276    &lt;span class="c"&gt;# 注意这里&lt;/span&gt;
    Binlog_Do_DB: hello
Binlog_Ignore_DB: mysql,test,information_schema
1 row in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;0.00 sec&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;slave 服务器&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; use hello;
mysql&amp;gt; show tables;
+-----------------+
| Tables_in_hello |
+-----------------+
| &lt;span class="nb"&gt;test&lt;/span&gt;            | 
+-----------------+
1 row in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;0.00 sec&lt;span class="o"&gt;)&lt;/span&gt;

mysql&amp;gt; &lt;span class="k"&gt;select&lt;/span&gt; * from &lt;span class="nb"&gt;test&lt;/span&gt;;
+------+
| id   |
+------+
|    1 | 
+------+
1 row in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;0.00 sec&lt;span class="o"&gt;)&lt;/span&gt;

mysql&amp;gt; show slave status&lt;span class="se"&gt;\G&lt;/span&gt;;
*************************** 1. row ***************************
            Slave_IO_State: Waiting &lt;span class="k"&gt;for &lt;/span&gt;master to send event
                Master_Host: 192.168.100.191
                Master_User: backup
                Master_Port: 3306
            Connect_Retry: 60
            Master_Log_File: mysql-bin.000002  &lt;span class="c"&gt;# 跟 master 一样&lt;/span&gt;
        Read_Master_Log_Pos: 276  &lt;span class="c"&gt;# 跟 master 一样&lt;/span&gt;
            Relay_Log_File: mysqld-relay-bin.000003
            Relay_Log_Pos: 413
    Relay_Master_Log_File: mysql-bin.000002
        Slave_IO_Running: Yes
        Slave_SQL_Running: Yes
            Replicate_Do_DB: hello
        Replicate_Ignore_DB: mysql,test,information_schema
                Last_Errno: 0
                Last_Error: 
            Skip_Counter: 0
        Exec_Master_Log_Pos: 276
            Relay_Log_Space: 413
    Seconds_Behind_Master: 0
1 row in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;0.00 sec&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="master2-slavemaster1"&gt;master2-slave(master1)&lt;/h2&gt;
&lt;h3 id="master2"&gt;master2:&lt;/h3&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; grant replication slave on *.* to &lt;span class="s1"&gt;'backup'&lt;/span&gt;@&lt;span class="s1"&gt;'192.168.100.191'&lt;/span&gt; identified by &lt;span class="s1"&gt;'yNZE7fK9*@aMA?*ppF'&lt;/span&gt;;
mysql&amp;gt; flush tables with &lt;span class="nb"&gt;read &lt;/span&gt;lock;
mysql&amp;gt; show master status&lt;span class="se"&gt;\G&lt;/span&gt;;
*************************** 1. row ***************************
            File: mysql-bin.000002
        Position: 276
    Binlog_Do_DB: 
Binlog_Ignore_DB: 
mysql&amp;gt; unlock tables;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;vim /etc/my.cnf:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;# as master&lt;/span&gt;
&lt;span class="c"&gt;#开启二进制日志，并且名称为 /var/log/mysql/mysql-bin.***&lt;/span&gt;
log-bin&lt;span class="o"&gt;=&lt;/span&gt;mysql-bin
&lt;span class="nb"&gt;read&lt;/span&gt;-only&lt;span class="o"&gt;=&lt;/span&gt;0  &lt;span class="c"&gt;#主机读写权限，读写都可以&lt;/span&gt;
binlog-do-db&lt;span class="o"&gt;=&lt;/span&gt;hello   &lt;span class="c"&gt;#记录日志的数据库：需要的备份数据，多个写多行&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;mysql &lt;span class="c"&gt;#不记录日志的数据库：不需要备份的数据库，多个写多行&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;information_schema


&lt;span class="c"&gt;# 自增字段偶数递增，防止冲突（2, 4, 6, ...,）&lt;/span&gt;
auto-increment-increment &lt;span class="o"&gt;=&lt;/span&gt; 2  &lt;span class="c"&gt;# 每次递增的步长&lt;/span&gt;
auto-increment-offset &lt;span class="o"&gt;=&lt;/span&gt; 2  &lt;span class="c"&gt;# 初始值&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;service mysqld restart&lt;/p&gt;
&lt;h4 id="slave"&gt;slave:&lt;/h4&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; slave stop;

mysql&amp;gt;  CHANGE MASTER TO &lt;span class="nv"&gt;MASTER_HOST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'192.168.100.166'&lt;/span&gt;, &lt;span class="nv"&gt;MASTER_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'backup'&lt;/span&gt;, &lt;span class="nv"&gt;MASTER_PASSWORD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'yNZE7fK9*@aMA?*ppF'&lt;/span&gt;, &lt;span class="nv"&gt;MASTER_LOG_FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'mysql-bin.000002, MASTER_LOG_POS=276'&lt;/span&gt;;

mysql&amp;gt; slave start;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;vim /etc/my.cnf&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;# as slave&lt;/span&gt;
master-host&lt;span class="o"&gt;=&lt;/span&gt;192.168.100.166  &lt;span class="c"&gt;# master&lt;/span&gt;
master-user&lt;span class="o"&gt;=&lt;/span&gt;backup  &lt;span class="c"&gt;# 刚才在 master1 上设置的用户名密码&lt;/span&gt;
master-password&lt;span class="o"&gt;=&lt;/span&gt;yNZE7fK9*@aMA?*ppF  &lt;span class="c"&gt;# password&lt;/span&gt;
master-port&lt;span class="o"&gt;=&lt;/span&gt;3306   &lt;span class="c"&gt;# master1 mysql port&lt;/span&gt;
master-connect-retry&lt;span class="o"&gt;=&lt;/span&gt;60 &lt;span class="c"&gt;#如果从服务器发现主服务器断掉，重新连接的时间差(秒)&lt;/span&gt;
replicate-do-db &lt;span class="o"&gt;=&lt;/span&gt;hello &lt;span class="c"&gt;#只复制某个库，多个写多行&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;mysql &lt;span class="c"&gt;#不复制某个库&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;information_schema
relay-log&lt;span class="o"&gt;=&lt;/span&gt;mysqld-relay-bin  &lt;span class="c"&gt;# 开启日志中继&lt;/span&gt;
log-slave-updates  &lt;span class="c"&gt;# slave将复制事件写进自己的二进制日志&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;serivce mysqld restart&lt;/p&gt;
&lt;h4 id="_1"&gt;测试&lt;/h4&gt;
&lt;p&gt;master2:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; use hello;    
mysql&amp;gt; insert into &lt;span class="nb"&gt;test set &lt;/span&gt;&lt;span class="nv"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;2;
mysql&amp;gt; &lt;span class="k"&gt;select&lt;/span&gt; * from &lt;span class="nb"&gt;test&lt;/span&gt;;
+------+
| id   |
+------+
|    1 | 
|    2 | 
+------+
2 rows in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;0.00 sec&lt;span class="o"&gt;)&lt;/span&gt;
mysql&amp;gt; show master status&lt;span class="se"&gt;\G&lt;/span&gt;;
*************************** 1. row ***************************
            File: mysql-bin.000003
        Position: 187
    Binlog_Do_DB: hello
Binlog_Ignore_DB: mysql,test,information_schema
1 row in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;0.00 sec&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;slave:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;mysql&amp;gt; show slave status &lt;span class="se"&gt;\G&lt;/span&gt;;
*************************** 1. row ***************************
            Slave_IO_State: Waiting &lt;span class="k"&gt;for &lt;/span&gt;master to send event
                Master_Host: 192.168.100.166
                Master_User: backup
                Master_Port: 3306
            Connect_Retry: 60
            Master_Log_File: mysql-bin.000003
        Read_Master_Log_Pos: 187
            Relay_Log_File: mysqld-relay-bin.000003
            Relay_Log_Pos: 324
    Relay_Master_Log_File: mysql-bin.000003
        Slave_IO_Running: Yes
        Slave_SQL_Running: Yes
            Replicate_Do_DB: hello
        Replicate_Ignore_DB: mysql,test,information_schema
                Last_Errno: 0
                Last_Error: 
            Skip_Counter: 0
        Exec_Master_Log_Pos: 187
            Relay_Log_Space: 324
            Until_Condition: None
            Until_Log_File: 
            Until_Log_Pos: 0
    Seconds_Behind_Master: 0

mysql&amp;gt; use hello;

mysql&amp;gt; &lt;span class="k"&gt;select&lt;/span&gt; * from &lt;span class="nb"&gt;test&lt;/span&gt;;
+------+
| id   |
+------+
|    1 | 
|    2 | 
+------+
2 rows in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;0.00 sec&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;!--less /var/log/mysqld.log--&gt;
&lt;p&gt;最后的配置文件&lt;/p&gt;
&lt;p&gt;master1:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;# /etc/my.cnf&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;mysqld&lt;span class="o"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;# as master&lt;/span&gt;
server-id&lt;span class="o"&gt;=&lt;/span&gt;1    &lt;span class="c"&gt;#主机id，整数&lt;/span&gt;
&lt;span class="c"&gt;#开启二进制日志，并且名称为 /var/lib/mysql/mysql-bin.***&lt;/span&gt;
log-bin&lt;span class="o"&gt;=&lt;/span&gt;mysql-bin
&lt;span class="nb"&gt;read&lt;/span&gt;-only&lt;span class="o"&gt;=&lt;/span&gt;0  &lt;span class="c"&gt;#主机读写权限，读写都可以&lt;/span&gt;
binlog-do-db&lt;span class="o"&gt;=&lt;/span&gt;hello   &lt;span class="c"&gt;#记录日志的数据库：需要的备份数据，多个写多行&lt;/span&gt;
&lt;span class="c"&gt;# binlog-do-db=hello2&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;mysql &lt;span class="c"&gt;#不记录日志的数据库：不需要备份的数据库，多个写多行&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;information_schema

&lt;span class="c"&gt;# as slave&lt;/span&gt;
master-host&lt;span class="o"&gt;=&lt;/span&gt;192.168.100.166  &lt;span class="c"&gt;# master&lt;/span&gt;
master-user&lt;span class="o"&gt;=&lt;/span&gt;backup  &lt;span class="c"&gt;# 刚才在 master1 上设置的用户名密码&lt;/span&gt;
master-password&lt;span class="o"&gt;=&lt;/span&gt;yNZE7fK9*@aMA?*ppF  &lt;span class="c"&gt;# password&lt;/span&gt;
master-port&lt;span class="o"&gt;=&lt;/span&gt;3306   &lt;span class="c"&gt;# master1 mysql port&lt;/span&gt;
master-connect-retry&lt;span class="o"&gt;=&lt;/span&gt;60 &lt;span class="c"&gt;#如果从服务器发现主服务器断掉，重新连接的时间差(秒)&lt;/span&gt;
replicate-do-db &lt;span class="o"&gt;=&lt;/span&gt;hello &lt;span class="c"&gt;#只复制某个库，多个写多行&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;mysql &lt;span class="c"&gt;#不复制某个库&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;information_schema
relay-log&lt;span class="o"&gt;=&lt;/span&gt;mysqld-relay-bin  &lt;span class="c"&gt;# 开启日志中继&lt;/span&gt;
log-slave-updates  &lt;span class="c"&gt;# slave将复制事件写进自己的二进制日志&lt;/span&gt;


&lt;span class="c"&gt;# 自增字段奇数递增，防止冲突（1, 3, 5, ...,）&lt;/span&gt;
auto-increment-increment &lt;span class="o"&gt;=&lt;/span&gt; 2  &lt;span class="c"&gt;# 每次递增的步长&lt;/span&gt;
auto-increment-offset &lt;span class="o"&gt;=&lt;/span&gt; 1  &lt;span class="c"&gt;# 初始值&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;master2:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;# /etc/my.cnf&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;mysqld&lt;span class="o"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;# as slave&lt;/span&gt;
server-id&lt;span class="o"&gt;=&lt;/span&gt;2
log-bin&lt;span class="o"&gt;=&lt;/span&gt;mysql-bin
master-host&lt;span class="o"&gt;=&lt;/span&gt;192.168.100.191  &lt;span class="c"&gt;# master1&lt;/span&gt;
master-user&lt;span class="o"&gt;=&lt;/span&gt;backup  &lt;span class="c"&gt;# 刚才在 master1 上设置的用户名密码&lt;/span&gt;
master-password&lt;span class="o"&gt;=&lt;/span&gt;yNZE7fK9*@aMA?*ppF  &lt;span class="c"&gt;# password&lt;/span&gt;
master-port&lt;span class="o"&gt;=&lt;/span&gt;3306   &lt;span class="c"&gt;# master1 mysql port&lt;/span&gt;
master-connect-retry&lt;span class="o"&gt;=&lt;/span&gt;60 &lt;span class="c"&gt;#如果从服务器发现主服务器断掉，重新连接的时间差(秒)&lt;/span&gt;
replicate-do-db &lt;span class="o"&gt;=&lt;/span&gt;hello &lt;span class="c"&gt;#只复制某个库，多个写多行&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;mysql &lt;span class="c"&gt;#不复制某个库&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;
replicate-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;information_schema
relay-log&lt;span class="o"&gt;=&lt;/span&gt;mysqld-relay-bin  &lt;span class="c"&gt;# 开启日志中继&lt;/span&gt;
log-slave-updates  &lt;span class="c"&gt;# 示slave将复制事件写进自己的二进制日志&lt;/span&gt;

&lt;span class="c"&gt;# as master&lt;/span&gt;
&lt;span class="c"&gt;#开启二进制日志，并且名称为 /var/lib/mysql/mysql-bin.***&lt;/span&gt;
log-bin&lt;span class="o"&gt;=&lt;/span&gt;mysql-bin
&lt;span class="nb"&gt;read&lt;/span&gt;-only&lt;span class="o"&gt;=&lt;/span&gt;0  &lt;span class="c"&gt;#主机读写权限，读写都可以&lt;/span&gt;
binlog-do-db&lt;span class="o"&gt;=&lt;/span&gt;hello   &lt;span class="c"&gt;#记录日志的数据库：需要的备份数据，多个写多行&lt;/span&gt;
&lt;span class="c"&gt;# binlog-do-db=hello2&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;mysql &lt;span class="c"&gt;#不记录日志的数据库：不需要备份的数据库，多个写多行&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;
binlog-ignore-db&lt;span class="o"&gt;=&lt;/span&gt;information_schema


&lt;span class="c"&gt;# 自增字段偶数递增，防止冲突（2, 4, 6, ...,）&lt;/span&gt;
auto-increment-increment &lt;span class="o"&gt;=&lt;/span&gt; 2  &lt;span class="c"&gt;# 每次递增的步长&lt;/span&gt;
auto-increment-offset &lt;span class="o"&gt;=&lt;/span&gt; 2  &lt;span class="c"&gt;# 初始值&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id="_2"&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.d5s.cn/archives/95"&gt;MYSQL 主从服务器配置 | 无影的博客&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://database.51cto.com/art/200510/8434.htm"&gt;Mysql 数据库双机热备的配置 - 51CTO.COM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://serverfault.com/questions/268627/mysql-master-master-replication-of-all-databases-how"&gt;MySQL Master-Master Replication of ALL databases. How? - Server Fault&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://dev.mysql.com/doc/refman/5.1/en/replication.html"&gt;MySQL :: MySQL 5.1 Reference Manual :: 16 Replication&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="file:///D:/Settings/Mozilla/ScrapBook/data/20130522165305/index.html"&gt;MySqL的主从复制和读写分离 - ZhouLS的个人空间 - 开源中国社区&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://blog.csdn.net/hguisu/article/details/7325124"&gt;高性能Mysql主从架构的复制原理及配置详解 - guisu，程序人生。 - 博客频道 - CSDN.NET&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://mvbridge.blog.sohu.com/172644721.html"&gt;MySQL master slave 安装部署及常见问题-桥-搜狐博客&lt;/a&gt;
&lt;!--* [)--&gt;
&lt;!--https://groups.google.com/forum/#!topic/django-users/0RiRw6jlnAs--&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://blog.phpok.com/archives/29/"&gt;三台Mysql实现数据同步及主从模式 - 情感个人博客站 - Powered by Sablog-X&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://blog.csdn.net/wh62592855/article/details/6726724"&gt;MYSQL中的auto_increment_increment和auto_increment_offset - 朝着梦想 渐行前进 - 博客频道 - CSDN.NET&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/8262863/how-is-the-mysql-auto-increment-step-size-determined"&gt;auto increment - How is the MySQL auto_increment step size determined - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://dev.mysql.com/doc/refman/5.1/en/replication-options-master.html#sysvar_auto_increment_increment"&gt;MySQL :: MySQL 5.1 Reference Manual :: 16.1.3.2 Replication Master Options and Variables&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="mysql"></category><category term="replication"></category></entry><entry><title>[database]Windows 下安装使用 MongoDB（hello world）</title><link href="http://mozillazg.com/2013/02/hello-mongodb-on-windows.html" rel="alternate"></link><updated>2013-02-25T00:00:00+00:00</updated><author><name>mozillazg</name></author><id>tag:mozillazg.com,2013-02-25:2013/02/hello-mongodb-on-windows.html</id><summary type="html">&lt;h2 id="_1"&gt;安装&lt;/h2&gt;
&lt;p&gt;从 &lt;a href="http://www.mongodb.org/downloads"&gt;http://www.mongodb.org/downloads&lt;/a&gt; 下载 mongodb 压缩包，
解压到某个目录下，假设最后的目录路径为：c:\mongodb\，将 &lt;code&gt;;c:\mongodb\bin&lt;/code&gt; 追加到环境变量 path 中。&lt;/p&gt;
&lt;p&gt;新建一个目录用来存放数据库文件，比如该目录为：c:\mongodb\data 。&lt;/p&gt;
&lt;h2 id="_2"&gt;使用&lt;/h2&gt;
&lt;h3 id="_3"&gt;启动服务器&lt;/h3&gt;
&lt;p&gt;命令行下执行：&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="go"&gt;mongod --dbpath c:\mongodb\data&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="hello-world"&gt;hello world&lt;/h3&gt;
&lt;p&gt;命令行下执行：&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="go"&gt;mongo&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;进入数据库终端（默认是连接到 test 数据库）：&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt; var &lt;span class="nv"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hello world&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt; x
&lt;span class="go"&gt;hello world&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_4"&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://docs.mongodb.org/manual/"&gt;The MongoDB Manual — MongoDB Manual&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.ibm.com/developerworks/cn/opensource/os-django-mongo/"&gt;结合使用 MongoDB 和 Django&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="MongoDB，数据库"></category></entry></feed>