<!DOCTYPE html>
<html lang="zh-hans" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml" class="han-init">
<head>
    <title>Python: 多继承模式下 MRO(Method Resolution Order) 的计算方式 - Huang Huang 的博客</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- share.css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">


    <link href="http://127.0.0.1:8000/favicon.ico" rel="icon">

<link rel="canonical" href="http://127.0.0.1:8000/2016/11/python-mro-compute.html">

        <meta name="author" content="mozillazg" />
        <meta name="keywords" content="super,mro" />
    <meta name="description" content="大家可能已经知道了，在 Python 3(Python 2 的新式类)中多继承模式是使用 C3 算法来确定 MRO(Method Resolution Order) 的。 那么具体是怎么计算的呢？本文将基于 https://www.python.org/download/releases/2.3/mro/ 中的几个例子来讲解 MRO 是怎么计算的。（备注：我的理解不一定完全匹配原文的内容，建议直接阅读 https://www.python.org/download/releases/2.3/mro/ 这份原始材料） 我们首先来定义一些符号： 用 CN 表示一个类：C1, C2, C3, ..., CN C1 C2 C3 ... CN 表示的是一个包含多个类的列表 [C1, C2, C3, ..., CN] 其中： head = C1 tail = C2 ... CN 加法运算: C + (C1 C2 ... CN) = C C1 C2 ... CN [C] + [C1, C2, ... ,CN] = [C, C1, C2, ..., CN] L[C] 表示类 C 的线性值，其实就是 C 的 MRO, 其中 L[object] = object 比如有个类 : class C(B1, B2, ..., BN): pass 那么: L[C(B1 ... BN)] = C + merge(L[B1] ... L[BN], B1 ... BN) merge 的计算规则如下 [1] ： take the head of the first list, i.e L[B1][0]; if this head is not in the tail of any of the other lists, then add it to the linearization of C and remove it from the lists in the merge, otherwise look at the head of the next list and take it, if it is a good head. Then repeat the operation until all the class are removed or it is impossible to find good heads. In this case, it is impossible to construct the merge, Python 2.3 will refuse to create the class C and will raise an exception. 计算 MRO¶ 先从简单的类说起： class B(object): pass L[B] = L[B(object)] = B + merge(L[object]) = B + L[object] = B object &gt;&gt;&gt; B.mro() [&lt;class &#39;__main__.B&#39;&gt;, &lt;type &#39;object&#39;&gt;] 简单的子类: class C(B): pass L[C] = L[C(B)] = C + merge(L[B]) = C + L[B] = C B object # 从上面已经知道了 L[B] = B object &gt;&gt;&gt; C.mro() [&lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;type &#39;object&#39;&gt;] 下面来看一个复杂的例子: &gt;&gt;&gt; O = object &gt;&gt;&gt; class F(O): pass &gt;&gt;&gt; class E(O): pass &gt;&gt;&gt; class D(O): pass &gt;&gt;&gt; class C(D,F): pass &gt;&gt;&gt; class B(D,E): pass &gt;&gt;&gt; class A(B,C): pass 很容易就可以想到: L[O] = O = object L[F] = L[F(O)] = F O L[E] = L[E(O)] = E O L[D] = L[D(O)] = D O 下面来计算 C, B, A: L[C]: L[C] = L[C(D, F)] = C + merge(L[D], L[F], DF) # 从前面可知 L[D] 和 L[F] 的结果 = C + merge(DO, FO, DF) # 因为 D 是顺序第一个并且在几个包含 D 的 list 中是 head， # 所以这一次取 D 同时从列表中删除 D = C + D + merge(O, FO, F) # 因为 O 虽然是顺序第一个但在其他 list (FO)中不是 head, 跳过, # 改为检查第二个list FO # F 是第二个 list 和其他 list 的 head, # 取 F同时从列表中删除 F = C + D + F + merge(O) = C D F O &gt;&gt;&gt; C.mro() [&lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.F&#39;&gt;, &lt;type &#39;object&#39;&gt;] L[B]: L[B] = L[B(D, E)] = B + merge(L[D], L[E], DE) = B + merge(DO, EO, DE) = B + D + merge(O, EO, E) = B + D + E + merge(O) = B D E O &gt;&gt;&gt; B.mro() [&lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;type &#39;object&#39;&gt;] L[A]: L[A] = L[A(B, C)] = A + merge(L(B), L(C), BC) = A + merge(BDEO, CDFO, BC) = A + B + merge(DEO, CDFO, C) # 注意这里是 C , 因为第一个list 的 head D 不是其他list 的 head # 所以改为从下一个 list CDFO 开始 = A + B + C + merge(DEO, DFO) = A + B + C + D + merge(EO, FO) = A + B + C + D + E + merge(O, FO) = A + B + C + D + E + F + merge(O) = A B C D E F O &gt;&gt;&gt; A.mro() [&lt;class &#39;__main__.A&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;class &#39;__main__.F&#39;&gt;, &lt;type &#39;object&#39;&gt;] 到这里应该已经有一点眉目了。下面再来个上面那些类的变种，可以先自己算算看，后面有详细的计算过程。 &gt;&gt;&gt; O = object &gt;&gt;&gt; class F(O): pass &gt;&gt;&gt; class E(O): pass &gt;&gt;&gt; class D(O): pass &gt;&gt;&gt; class C(D,F): pass &gt;&gt;&gt; class B(E,D): pass &gt;&gt;&gt; class A(B,C): pass 跟之前唯一的区别是 B(D, E) 变成了 B(E, D) : L[O] = O = object L[F(O)] = F O L[E(O)] = E O L[D(O)] = D O L[C] = L[C(D, F)] = C + merge(L[D], L[F], DF) = C D F O L[B] = L[B(E, D)] = B + merge(L[E], L[D], ED) = B + merge(EO, DO, ED) = B + E + merge(O, DO, D) = B + E + D + merge(O) = B E D O &gt;&gt;&gt; B.mro() [&lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;type &#39;object&#39;&gt;] L[A] = L[A(B, C)] = A + merge(L[B], L[C], BC) = A + merge(BEDO, CDFO, BC) = A + B + merge(EDO, CDFO, C) = A + B + E + merge(DO, CDFO, C) = A + B + E + C + merge(DO, DFO) = A + B + E + C + D + merge(O, FO) = A + B + E + C + D + F + merge(O) = A B E C D F O &gt;&gt;&gt; A.mro() [&lt;class &#39;__main__.A&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.F&#39;&gt;, &lt;type &#39;object&#39;&gt;] 通过这几个例子应该对如何计算 MRO 已经有所了解了，更详细的信息可以阅读 python MRO 文档 以及 wikipedia 中的 C3 算法. 参考资料¶ The Python 2.3 Method Resolution Order | Python.org C3 linearization - Wikipedia [1]: The Python 2.3 Method Resolution Order | Python.org" />
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4941850466486001"
     crossorigin="anonymous"></script>

    <style>
      .js-toc {
        margin-bottom: 20px;
      }
      .donate-modal {
        text-align: center;
      }
      #donate-modal-container .donate-image {
        max-height: 300px !important;
        min-height: inherit !important;
      }
    </style>

        <meta property="og:site_name" content="Huang Huang 的博客" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Python: 多继承模式下 MRO(Method Resolution Order) 的计算方式"/>
        <meta property="og:url" content="http://127.0.0.1:8000/2016/11/python-mro-compute.html"/>
        <meta property="og:description" content="大家可能已经知道了，在 Python 3(Python 2 的新式类)中多继承模式是使用 C3 算法来确定 MRO(Method Resolution Order) 的。 那么具体是怎么计算的呢？本文将基于 https://www.python.org/download/releases/2.3/mro/ 中的几个例子来讲解 MRO 是怎么计算的。（备注：我的理解不一定完全匹配原文的内容，建议直接阅读 https://www.python.org/download/releases/2.3/mro/ 这份原始材料） 我们首先来定义一些符号： 用 CN 表示一个类：C1, C2, C3, ..., CN C1 C2 C3 ... CN 表示的是一个包含多个类的列表 [C1, C2, C3, ..., CN] 其中： head = C1 tail = C2 ... CN 加法运算: C + (C1 C2 ... CN) = C C1 C2 ... CN [C] + [C1, C2, ... ,CN] = [C, C1, C2, ..., CN] L[C] 表示类 C 的线性值，其实就是 C 的 MRO, 其中 L[object] = object 比如有个类 : class C(B1, B2, ..., BN): pass 那么: L[C(B1 ... BN)] = C + merge(L[B1] ... L[BN], B1 ... BN) merge 的计算规则如下 [1] ： take the head of the first list, i.e L[B1][0]; if this head is not in the tail of any of the other lists, then add it to the linearization of C and remove it from the lists in the merge, otherwise look at the head of the next list and take it, if it is a good head. Then repeat the operation until all the class are removed or it is impossible to find good heads. In this case, it is impossible to construct the merge, Python 2.3 will refuse to create the class C and will raise an exception. 计算 MRO¶ 先从简单的类说起： class B(object): pass L[B] = L[B(object)] = B + merge(L[object]) = B + L[object] = B object &gt;&gt;&gt; B.mro() [&lt;class &#39;__main__.B&#39;&gt;, &lt;type &#39;object&#39;&gt;] 简单的子类: class C(B): pass L[C] = L[C(B)] = C + merge(L[B]) = C + L[B] = C B object # 从上面已经知道了 L[B] = B object &gt;&gt;&gt; C.mro() [&lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;type &#39;object&#39;&gt;] 下面来看一个复杂的例子: &gt;&gt;&gt; O = object &gt;&gt;&gt; class F(O): pass &gt;&gt;&gt; class E(O): pass &gt;&gt;&gt; class D(O): pass &gt;&gt;&gt; class C(D,F): pass &gt;&gt;&gt; class B(D,E): pass &gt;&gt;&gt; class A(B,C): pass 很容易就可以想到: L[O] = O = object L[F] = L[F(O)] = F O L[E] = L[E(O)] = E O L[D] = L[D(O)] = D O 下面来计算 C, B, A: L[C]: L[C] = L[C(D, F)] = C + merge(L[D], L[F], DF) # 从前面可知 L[D] 和 L[F] 的结果 = C + merge(DO, FO, DF) # 因为 D 是顺序第一个并且在几个包含 D 的 list 中是 head， # 所以这一次取 D 同时从列表中删除 D = C + D + merge(O, FO, F) # 因为 O 虽然是顺序第一个但在其他 list (FO)中不是 head, 跳过, # 改为检查第二个list FO # F 是第二个 list 和其他 list 的 head, # 取 F同时从列表中删除 F = C + D + F + merge(O) = C D F O &gt;&gt;&gt; C.mro() [&lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.F&#39;&gt;, &lt;type &#39;object&#39;&gt;] L[B]: L[B] = L[B(D, E)] = B + merge(L[D], L[E], DE) = B + merge(DO, EO, DE) = B + D + merge(O, EO, E) = B + D + E + merge(O) = B D E O &gt;&gt;&gt; B.mro() [&lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;type &#39;object&#39;&gt;] L[A]: L[A] = L[A(B, C)] = A + merge(L(B), L(C), BC) = A + merge(BDEO, CDFO, BC) = A + B + merge(DEO, CDFO, C) # 注意这里是 C , 因为第一个list 的 head D 不是其他list 的 head # 所以改为从下一个 list CDFO 开始 = A + B + C + merge(DEO, DFO) = A + B + C + D + merge(EO, FO) = A + B + C + D + E + merge(O, FO) = A + B + C + D + E + F + merge(O) = A B C D E F O &gt;&gt;&gt; A.mro() [&lt;class &#39;__main__.A&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;class &#39;__main__.F&#39;&gt;, &lt;type &#39;object&#39;&gt;] 到这里应该已经有一点眉目了。下面再来个上面那些类的变种，可以先自己算算看，后面有详细的计算过程。 &gt;&gt;&gt; O = object &gt;&gt;&gt; class F(O): pass &gt;&gt;&gt; class E(O): pass &gt;&gt;&gt; class D(O): pass &gt;&gt;&gt; class C(D,F): pass &gt;&gt;&gt; class B(E,D): pass &gt;&gt;&gt; class A(B,C): pass 跟之前唯一的区别是 B(D, E) 变成了 B(E, D) : L[O] = O = object L[F(O)] = F O L[E(O)] = E O L[D(O)] = D O L[C] = L[C(D, F)] = C + merge(L[D], L[F], DF) = C D F O L[B] = L[B(E, D)] = B + merge(L[E], L[D], ED) = B + merge(EO, DO, ED) = B + E + merge(O, DO, D) = B + E + D + merge(O) = B E D O &gt;&gt;&gt; B.mro() [&lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;type &#39;object&#39;&gt;] L[A] = L[A(B, C)] = A + merge(L[B], L[C], BC) = A + merge(BEDO, CDFO, BC) = A + B + merge(EDO, CDFO, C) = A + B + E + merge(DO, CDFO, C) = A + B + E + C + merge(DO, DFO) = A + B + E + C + D + merge(O, FO) = A + B + E + C + D + F + merge(O) = A B E C D F O &gt;&gt;&gt; A.mro() [&lt;class &#39;__main__.A&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.F&#39;&gt;, &lt;type &#39;object&#39;&gt;] 通过这几个例子应该对如何计算 MRO 已经有所了解了，更详细的信息可以阅读 python MRO 文档 以及 wikipedia 中的 C3 算法. 参考资料¶ The Python 2.3 Method Resolution Order | Python.org C3 linearization - Wikipedia [1]: The Python 2.3 Method Resolution Order | Python.org"/>
        <meta property="article:published_time" content="2016-11-06" />
            <meta property="article:section" content="python" />
            <meta property="article:tag" content="super" />
            <meta property="article:tag" content="mro" />
            <meta property="article:author" content="mozillazg" />
            <meta property="og:image"
                  content="http://127.0.0.1:8000/static/avatar.jpeg"/>


    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@mozillazg">
        <meta name="twitter:creator" content="@mozillazg">
    <meta name="twitter:domain" content="http://127.0.0.1:8000">
            <meta property="twitter:image"
                  content="http://127.0.0.1:8000/static/avatar.jpeg"/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.4/dist/css/bootstrap.min.css" type="text/css"/>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/pygments-css@1.0.0/github.css" rel="stylesheet">
    <link rel="stylesheet" href="http://127.0.0.1:8000/theme/css/style.css" type="text/css"/>
            <link href="http://127.0.0.1:8000/static/custom.css" rel="stylesheet">

        <link href="http://127.0.0.1:8000/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Huang Huang 的博客 ATOM Feed"/>

        <link href="http://127.0.0.1:8000/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Huang Huang 的博客 RSS Feed"/>


        <link href="http://127.0.0.1:8000/feeds/python.atom.xml" type="application/atom+xml" rel="alternate"
              title="Huang Huang 的博客 python ATOM Feed"/>


    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Website",
        "publisher": {
            "@type": "Person",
            "name": "mozillazg",
            "logo": "http://127.0.0.1:8000/static/avatar.jpeg"
        },
        "author": {
            "@type": "Person",
            "name": "mozillazg",
            "image": "http://127.0.0.1:8000/static/avatar.jpeg",
            "url": "http://127.0.0.1:8000",
            "sameAs": []
        },
        // "headline": "",
        "url": "http://127.0.0.1:8000/2016/11/python-mro-compute.html",
        "datePublished": "2016-11-06",
        // "dateModified": "",
        "image": "http://127.0.0.1:8000/static/avatar.jpeg",
        "keywords": "super, mro",
        // "description": "大家可能已经知道了，在 Python 3(Python 2 的新式类)中多继承模式是使用 C3 算法来确定 MRO(Method Resolution Order) 的。 那么具体是怎么计算的呢？本文将基于 https://www.python.org/download/releases/2.3/mro/ 中的几个例子来讲解 MRO 是怎么计算的。（备注：我的理解不一定完全匹配原文的内容，建议直接阅读 https://www.python.org/download/releases/2.3/mro/ 这份原始材料） 我们首先来定义一些符号： 用 CN 表示一个类：C1, C2, C3, ..., CN C1 C2 C3 ... CN 表示的是一个包含多个类的列表 [C1, C2, C3, ..., CN] 其中： head = C1 tail = C2 ... CN 加法运算: C + (C1 C2 ... CN) = C C1 C2 ... CN [C] + [C1, C2, ... ,CN] = [C, C1, C2, ..., CN] L[C] 表示类 C 的线性值，其实就是 C 的 MRO, 其中 L[object] = object 比如有个类 : class C(B1, B2, ..., BN): pass 那么: L[C(B1 ... BN)] = C + merge(L[B1] ... L[BN], B1 ... BN) merge 的计算规则如下 [1] ： take the head of the first list, i.e L[B1][0]; if this head is not in the tail of any of the other lists, then add it to the linearization of C and remove it from the lists in the merge, otherwise look at the head of the next list and take it, if it is a good head. Then repeat the operation until all the class are removed or it is impossible to find good heads. In this case, it is impossible to construct the merge, Python 2.3 will refuse to create the class C and will raise an exception. 计算 MRO¶ 先从简单的类说起： class B(object): pass L[B] = L[B(object)] = B + merge(L[object]) = B + L[object] = B object &gt;&gt;&gt; B.mro() [&lt;class &#39;__main__.B&#39;&gt;, &lt;type &#39;object&#39;&gt;] 简单的子类: class C(B): pass L[C] = L[C(B)] = C + merge(L[B]) = C + L[B] = C B object # 从上面已经知道了 L[B] = B object &gt;&gt;&gt; C.mro() [&lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;type &#39;object&#39;&gt;] 下面来看一个复杂的例子: &gt;&gt;&gt; O = object &gt;&gt;&gt; class F(O): pass &gt;&gt;&gt; class E(O): pass &gt;&gt;&gt; class D(O): pass &gt;&gt;&gt; class C(D,F): pass &gt;&gt;&gt; class B(D,E): pass &gt;&gt;&gt; class A(B,C): pass 很容易就可以想到: L[O] = O = object L[F] = L[F(O)] = F O L[E] = L[E(O)] = E O L[D] = L[D(O)] = D O 下面来计算 C, B, A: L[C]: L[C] = L[C(D, F)] = C + merge(L[D], L[F], DF) # 从前面可知 L[D] 和 L[F] 的结果 = C + merge(DO, FO, DF) # 因为 D 是顺序第一个并且在几个包含 D 的 list 中是 head， # 所以这一次取 D 同时从列表中删除 D = C + D + merge(O, FO, F) # 因为 O 虽然是顺序第一个但在其他 list (FO)中不是 head, 跳过, # 改为检查第二个list FO # F 是第二个 list 和其他 list 的 head, # 取 F同时从列表中删除 F = C + D + F + merge(O) = C D F O &gt;&gt;&gt; C.mro() [&lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.F&#39;&gt;, &lt;type &#39;object&#39;&gt;] L[B]: L[B] = L[B(D, E)] = B + merge(L[D], L[E], DE) = B + merge(DO, EO, DE) = B + D + merge(O, EO, E) = B + D + E + merge(O) = B D E O &gt;&gt;&gt; B.mro() [&lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;type &#39;object&#39;&gt;] L[A]: L[A] = L[A(B, C)] = A + merge(L(B), L(C), BC) = A + merge(BDEO, CDFO, BC) = A + B + merge(DEO, CDFO, C) # 注意这里是 C , 因为第一个list 的 head D 不是其他list 的 head # 所以改为从下一个 list CDFO 开始 = A + B + C + merge(DEO, DFO) = A + B + C + D + merge(EO, FO) = A + B + C + D + E + merge(O, FO) = A + B + C + D + E + F + merge(O) = A B C D E F O &gt;&gt;&gt; A.mro() [&lt;class &#39;__main__.A&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;class &#39;__main__.F&#39;&gt;, &lt;type &#39;object&#39;&gt;] 到这里应该已经有一点眉目了。下面再来个上面那些类的变种，可以先自己算算看，后面有详细的计算过程。 &gt;&gt;&gt; O = object &gt;&gt;&gt; class F(O): pass &gt;&gt;&gt; class E(O): pass &gt;&gt;&gt; class D(O): pass &gt;&gt;&gt; class C(D,F): pass &gt;&gt;&gt; class B(E,D): pass &gt;&gt;&gt; class A(B,C): pass 跟之前唯一的区别是 B(D, E) 变成了 B(E, D) : L[O] = O = object L[F(O)] = F O L[E(O)] = E O L[D(O)] = D O L[C] = L[C(D, F)] = C + merge(L[D], L[F], DF) = C D F O L[B] = L[B(E, D)] = B + merge(L[E], L[D], ED) = B + merge(EO, DO, ED) = B + E + merge(O, DO, D) = B + E + D + merge(O) = B E D O &gt;&gt;&gt; B.mro() [&lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;type &#39;object&#39;&gt;] L[A] = L[A(B, C)] = A + merge(L[B], L[C], BC) = A + merge(BEDO, CDFO, BC) = A + B + merge(EDO, CDFO, C) = A + B + E + merge(DO, CDFO, C) = A + B + E + C + merge(DO, DFO) = A + B + E + C + D + merge(O, FO) = A + B + E + C + D + F + merge(O) = A B E C D F O &gt;&gt;&gt; A.mro() [&lt;class &#39;__main__.A&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.E&#39;&gt;, &lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.F&#39;&gt;, &lt;type &#39;object&#39;&gt;] 通过这几个例子应该对如何计算 MRO 已经有所了解了，更详细的信息可以阅读 python MRO 文档 以及 wikipedia 中的 C3 算法. 参考资料¶ The Python 2.3 Method Resolution Order | Python.org C3 linearization - Wikipedia [1]: The Python 2.3 Method Resolution Order | Python.org",
        "description": "<p>大家可能已经知道了，在 Python 3(Python 2 的新式类)中多继承模式是使用 C3 算法来确定 MRO(Method Resolution Order) 的。</p>
<p>那么具体是怎么计算的呢？本文将基于 <a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">https://www.python.org/download/releases/2.3/mro/</a> 中的几个例子来讲解 MRO 是怎么计算的。（备注：我的理解不一定完全匹配原文的内容，建议直接阅读 <a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">https://www.python.org/download/releases/2.3/mro/</a> 这份原始材料）</p>
<p>我们首先来定义一些符号：</p>
<pre class="literal-block">
用 CN 表示一个类：C1, C2, C3, ..., CN
C1 C2 C3 ... CN 表示的是一个包含多个类的列表 [C1, C2, C3, ..., CN]
</pre>
<p>其中：</p>
<pre class="literal-block">
head = C1
tail = C2 ... CN
</pre>
<p>加法运算:</p>
<pre class="literal-block">
C + (C1 C2 ... CN) = C C1 C2 ... CN
[C] + [C1, C2, ... ,CN] = [C, C1, C2, ..., CN]
</pre>
<p>L[C] 表示类 C 的线性值，其实就是 C 的 MRO, 其中</p>
<pre class="literal-block">
L[object] = object
</pre>
<p>比如有个类 :</p>
<pre class="literal-block">
class C(B1, B2, ..., BN): pass
</pre>
<p>那么:</p>
<pre class="literal-block">
L[C(B1 ... BN)] = C + merge(L[B1] ... L[BN], B1 ... BN)
</pre>
<p>merge 的计算规则如下 <a class="footnote-reference" href="#id3" id="id1">[1]</a> ：</p>
<blockquote>
<ol class="arabic simple">
<li>take the head of the first list, i.e L[B1][0];</li>
<li>if this head is not in the tail of any of the other lists, then add it to the linearization of C and remove it from the lists in the merge, otherwise look at the head of the next list and take it, if it is a good head.</li>
<li>Then repeat the operation until all the class are removed or it is impossible to find good heads. In this case, it is impossible to construct the merge, Python 2.3 will refuse to create the class C and will raise an exception.</li>
</ol>
</blockquote>
<div class="section" id="mro">
<h2 id="hidmro">计算 MRO<a class="headerlink" href="#hidmro" title="Permalink to this headline">¶</a></h2>
<p>先从简单的类说起：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">(</span><span class="nb">object</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">L</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span>
     <span class="o">=</span> <span class="n">B</span> <span class="nb">object</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">B</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p>简单的子类:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">B</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">])</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">]</span>
     <span class="o">=</span> <span class="n">C</span> <span class="n">B</span> <span class="nb">object</span>     <span class="c1"># 从上面已经知道了 L[B] = B object</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">C</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p>下面来看一个复杂的例子:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">O</span> <span class="o">=</span> <span class="nb">object</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">F</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">F</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">E</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">):</span> <span class="k">pass</span>
</pre></div>
<p>很容易就可以想到:</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">O</span><span class="p">]</span> <span class="o">=</span> <span class="n">O</span> <span class="o">=</span> <span class="nb">object</span>
<span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">F</span>  <span class="n">O</span>
<span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">E</span>  <span class="n">O</span>
<span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">D</span>  <span class="n">O</span>
</pre></div>
<p>下面来计算 C, B, A:</p>
<p><tt class="docutils literal">L[C]</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">F</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">],</span> <span class="n">DF</span><span class="p">)</span>
     <span class="c1"># 从前面可知 L[D] 和 L[F] 的结果</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span>  <span class="n">merge</span><span class="p">(</span><span class="n">DO</span><span class="p">,</span> <span class="n">FO</span><span class="p">,</span> <span class="n">DF</span><span class="p">)</span>
     <span class="c1"># 因为 D 是顺序第一个并且在几个包含 D 的 list 中是 head，</span>
     <span class="c1"># 所以这一次取 D 同时从列表中删除 D</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">FO</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
     <span class="c1"># 因为 O 虽然是顺序第一个但在其他 list (FO)中不是 head, 跳过,</span>
     <span class="c1"># 改为检查第二个list FO</span>
     <span class="c1"># F 是第二个 list 和其他 list 的 head,</span>
     <span class="c1"># 取 F同时从列表中删除 F</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">F</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">O</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">C</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">F</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p><tt class="docutils literal">L[B]</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">],</span> <span class="n">DE</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DO</span><span class="p">,</span> <span class="n">EO</span><span class="p">,</span> <span class="n">DE</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">EO</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="n">D</span> <span class="n">E</span> <span class="n">O</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">B</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">E</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p><tt class="docutils literal">L[A]</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">B</span><span class="p">),</span> <span class="n">L</span><span class="p">(</span><span class="n">C</span><span class="p">),</span> <span class="n">BC</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">BDEO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">BC</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DEO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
     <span class="c1"># 注意这里是 C , 因为第一个list 的 head D 不是其他list 的 head</span>
     <span class="c1"># 所以改为从下一个 list CDFO 开始</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DEO</span><span class="p">,</span> <span class="n">DFO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">EO</span><span class="p">,</span> <span class="n">FO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span>  <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">FO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">F</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="n">O</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">A</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">A</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">C</span><span class="s1">&#39;&gt;,</span>
 <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">E</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">F</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p>到这里应该已经有一点眉目了。下面再来个上面那些类的变种，可以先自己算算看，后面有详细的计算过程。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">O</span> <span class="o">=</span> <span class="nb">object</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">F</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">F</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">D</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">):</span> <span class="k">pass</span>
</pre></div>
<p>跟之前唯一的区别是 <tt class="docutils literal">B(D, E)</tt> 变成了 <tt class="docutils literal">B(E, D)</tt> :</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">O</span><span class="p">]</span> <span class="o">=</span> <span class="n">O</span> <span class="o">=</span> <span class="nb">object</span>
<span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">F</span>  <span class="n">O</span>
<span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">E</span>  <span class="n">O</span>
<span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">D</span>  <span class="n">O</span>

<span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">F</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">],</span> <span class="n">DF</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">O</span>

<span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">D</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">],</span> <span class="n">ED</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">EO</span><span class="p">,</span> <span class="n">DO</span><span class="p">,</span> <span class="n">ED</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">DO</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="n">E</span> <span class="n">D</span> <span class="n">O</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">B</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">E</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>

<span class="n">L</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">],</span> <span class="n">BC</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">BEDO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">BC</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">EDO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DO</span><span class="p">,</span> <span class="n">DFO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">FO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">F</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="n">B</span> <span class="n">E</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">O</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">A</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">A</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">E</span><span class="s1">&#39;&gt;,</span>
 <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">C</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">F</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p>通过这几个例子应该对如何计算 MRO 已经有所了解了，更详细的信息可以阅读 <a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">python MRO 文档</a>
以及 wikipedia 中的 <a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 算法</a>.</p>
</div>
<div class="section" id="id2">
<h2 id="hidid2">参考资料<a class="headerlink" href="#hidid2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">The Python 2.3 Method Resolution Order | Python.org</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 linearization - Wikipedia</a></li>
</ul>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>: <a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">The Python 2.3 Method Resolution Order | Python.org</a></td></tr>
</tbody>
</table>
</div>
",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http://127.0.0.1:8000"
        }
    }
    </script>

</head>
<body>

<div class="navbar" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://127.0.0.1:8000/" class="navbar-brand">
Huang Huang 的博客            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="http://127.0.0.1:8000/feeds/all.atom.xml">Feed</a></li>
                    <li><a href="/2014/10/pages/about-me.html">About</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://127.0.0.1:8000/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content" class="yue">
        <article>
            <header class="text-center">
                <h1>
                    <a href="http://127.0.0.1:8000/2016/11/python-mro-compute.html"
                       rel="bookmark"
                       title="Permalink to Python: 多继承模式下 MRO(Method Resolution Order) 的计算方式">
                        Python: 多继承模式下 MRO(Method Resolution Order) 的计算方式
                    </a>
                </h1>
                <p class="published">
                    <time datetime="2016-11-06T00:00:00+00:00">
                    2016-11-06
                    </time>
                </p>
            </header>
            <div class="entry-content">
                <div class="well-sm article-info">
<footer class="post-info">
        <a href="http://127.0.0.1:8000/category/python.html">python</a>


<span class="label label-default hide">Tags</span>
	<a href="http://127.0.0.1:8000/tag/super.html">super</a>
        /
	<a href="http://127.0.0.1:8000/tag/mro.html">mro</a>
    
</footer><!-- /.post-info -->                </div>
                <div class="js-toc"></div>
                <div>
                <p>大家可能已经知道了，在 Python 3(Python 2 的新式类)中多继承模式是使用 C3 算法来确定 MRO(Method Resolution Order) 的。</p>
<p>那么具体是怎么计算的呢？本文将基于 <a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">https://www.python.org/download/releases/2.3/mro/</a> 中的几个例子来讲解 MRO 是怎么计算的。（备注：我的理解不一定完全匹配原文的内容，建议直接阅读 <a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">https://www.python.org/download/releases/2.3/mro/</a> 这份原始材料）</p>
<p>我们首先来定义一些符号：</p>
<pre class="literal-block">
用 CN 表示一个类：C1, C2, C3, ..., CN
C1 C2 C3 ... CN 表示的是一个包含多个类的列表 [C1, C2, C3, ..., CN]
</pre>
<p>其中：</p>
<pre class="literal-block">
head = C1
tail = C2 ... CN
</pre>
<p>加法运算:</p>
<pre class="literal-block">
C + (C1 C2 ... CN) = C C1 C2 ... CN
[C] + [C1, C2, ... ,CN] = [C, C1, C2, ..., CN]
</pre>
<p>L[C] 表示类 C 的线性值，其实就是 C 的 MRO, 其中</p>
<pre class="literal-block">
L[object] = object
</pre>
<p>比如有个类 :</p>
<pre class="literal-block">
class C(B1, B2, ..., BN): pass
</pre>
<p>那么:</p>
<pre class="literal-block">
L[C(B1 ... BN)] = C + merge(L[B1] ... L[BN], B1 ... BN)
</pre>
<p>merge 的计算规则如下 <a class="footnote-reference" href="#id3" id="id1">[1]</a> ：</p>
<blockquote>
<ol class="arabic simple">
<li>take the head of the first list, i.e L[B1][0];</li>
<li>if this head is not in the tail of any of the other lists, then add it to the linearization of C and remove it from the lists in the merge, otherwise look at the head of the next list and take it, if it is a good head.</li>
<li>Then repeat the operation until all the class are removed or it is impossible to find good heads. In this case, it is impossible to construct the merge, Python 2.3 will refuse to create the class C and will raise an exception.</li>
</ol>
</blockquote>
<div class="section" id="mro">
<h2 id="hidmro">计算 MRO<a class="headerlink" href="#hidmro" title="Permalink to this headline">¶</a></h2>
<p>先从简单的类说起：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">(</span><span class="nb">object</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">L</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span>
     <span class="o">=</span> <span class="n">B</span> <span class="nb">object</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">B</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p>简单的子类:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">B</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">])</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">]</span>
     <span class="o">=</span> <span class="n">C</span> <span class="n">B</span> <span class="nb">object</span>     <span class="c1"># 从上面已经知道了 L[B] = B object</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">C</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p>下面来看一个复杂的例子:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">O</span> <span class="o">=</span> <span class="nb">object</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">F</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">F</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">E</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">):</span> <span class="k">pass</span>
</pre></div>
<p>很容易就可以想到:</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">O</span><span class="p">]</span> <span class="o">=</span> <span class="n">O</span> <span class="o">=</span> <span class="nb">object</span>
<span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">F</span>  <span class="n">O</span>
<span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">E</span>  <span class="n">O</span>
<span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">D</span>  <span class="n">O</span>
</pre></div>
<p>下面来计算 C, B, A:</p>
<p><tt class="docutils literal">L[C]</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">F</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">],</span> <span class="n">DF</span><span class="p">)</span>
     <span class="c1"># 从前面可知 L[D] 和 L[F] 的结果</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span>  <span class="n">merge</span><span class="p">(</span><span class="n">DO</span><span class="p">,</span> <span class="n">FO</span><span class="p">,</span> <span class="n">DF</span><span class="p">)</span>
     <span class="c1"># 因为 D 是顺序第一个并且在几个包含 D 的 list 中是 head，</span>
     <span class="c1"># 所以这一次取 D 同时从列表中删除 D</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">FO</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
     <span class="c1"># 因为 O 虽然是顺序第一个但在其他 list (FO)中不是 head, 跳过,</span>
     <span class="c1"># 改为检查第二个list FO</span>
     <span class="c1"># F 是第二个 list 和其他 list 的 head,</span>
     <span class="c1"># 取 F同时从列表中删除 F</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">F</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">O</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">C</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">F</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p><tt class="docutils literal">L[B]</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">],</span> <span class="n">DE</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DO</span><span class="p">,</span> <span class="n">EO</span><span class="p">,</span> <span class="n">DE</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">EO</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="n">D</span> <span class="n">E</span> <span class="n">O</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">B</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">E</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p><tt class="docutils literal">L[A]</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">B</span><span class="p">),</span> <span class="n">L</span><span class="p">(</span><span class="n">C</span><span class="p">),</span> <span class="n">BC</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">BDEO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">BC</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DEO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
     <span class="c1"># 注意这里是 C , 因为第一个list 的 head D 不是其他list 的 head</span>
     <span class="c1"># 所以改为从下一个 list CDFO 开始</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DEO</span><span class="p">,</span> <span class="n">DFO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">EO</span><span class="p">,</span> <span class="n">FO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span>  <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">FO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">F</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="n">O</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">A</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">A</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">C</span><span class="s1">&#39;&gt;,</span>
 <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">E</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">F</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p>到这里应该已经有一点眉目了。下面再来个上面那些类的变种，可以先自己算算看，后面有详细的计算过程。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">O</span> <span class="o">=</span> <span class="nb">object</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">F</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">O</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">F</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">D</span><span class="p">):</span> <span class="k">pass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">):</span> <span class="k">pass</span>
</pre></div>
<p>跟之前唯一的区别是 <tt class="docutils literal">B(D, E)</tt> 变成了 <tt class="docutils literal">B(E, D)</tt> :</p>
<div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="n">O</span><span class="p">]</span> <span class="o">=</span> <span class="n">O</span> <span class="o">=</span> <span class="nb">object</span>
<span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">F</span>  <span class="n">O</span>
<span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">E</span>  <span class="n">O</span>
<span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">(</span><span class="n">O</span><span class="p">)]</span> <span class="o">=</span> <span class="n">D</span>  <span class="n">O</span>

<span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">F</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">F</span><span class="p">],</span> <span class="n">DF</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">O</span>

<span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">D</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">E</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">D</span><span class="p">],</span> <span class="n">ED</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">EO</span><span class="p">,</span> <span class="n">DO</span><span class="p">,</span> <span class="n">ED</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">DO</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">B</span> <span class="n">E</span> <span class="n">D</span> <span class="n">O</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">B</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">E</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>

<span class="n">L</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)]</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">B</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="p">],</span> <span class="n">BC</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">BEDO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">BC</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">EDO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DO</span><span class="p">,</span> <span class="n">CDFO</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">DO</span><span class="p">,</span> <span class="n">DFO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">FO</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">E</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">F</span> <span class="o">+</span> <span class="n">merge</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">A</span> <span class="n">B</span> <span class="n">E</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">O</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">A</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">A</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">B</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">E</span><span class="s1">&#39;&gt;,</span>
 <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">C</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">D</span><span class="s1">&#39;&gt;, &lt;class &#39;</span><span class="n">__main__</span><span class="o">.</span><span class="n">F</span><span class="s1">&#39;&gt;, &lt;type &#39;</span><span class="nb">object</span><span class="s1">&#39;&gt;]</span>
</pre></div>
<p>通过这几个例子应该对如何计算 MRO 已经有所了解了，更详细的信息可以阅读 <a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">python MRO 文档</a>
以及 wikipedia 中的 <a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 算法</a>.</p>
</div>
<div class="section" id="id2">
<h2 id="hidid2">参考资料<a class="headerlink" href="#hidid2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">The Python 2.3 Method Resolution Order | Python.org</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 linearization - Wikipedia</a></li>
</ul>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>: <a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">The Python 2.3 Method Resolution Order | Python.org</a></td></tr>
</tbody>
</table>
</div>

                </div>
            </div>
            <!-- /.entry-content -->
<section class="text-center">
  
<div id="donate"></div>

<div class="social-share"></div>
<div class="social-comment-note">
<p>有任何建议和想法欢迎在下方评论区留言或者加我<a href="/static/wechat.png">微信</a>交流</p>
</div>

</section>
<section class="well" id="related-posts">
    <p>Related Posts:</p>
    <ul>
        <li><a href="http://127.0.0.1:8000/2016/12/python-super-is-not-as-simple-as-you-thought.html">Python: super 没那么简单</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'my-github-blog'; // required: replace example with your forum shortname

                    var disqus_identifier = 'python-mro-compute';
                var disqus_url = 'http://127.0.0.1:8000/2016/11/python-mro-compute.html';

            var disqus_config = function () {
                this.language = "zh-hans";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2021 mozillazg
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
            &middot; <a href="/privacy-policy.html" target="_blank">Privacy</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/static/images/by-sa-80x15.png" /></a>
    &quot;<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Huang Huang 的博客</span>&quot; by <a xmlns:cc="http://creativecommons.org/ns#" href="http://127.0.0.1:8000" property="cc:attributionName" rel="cc:attributionURL">mozillazg</a> is
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/jquery@2.1.1/dist/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'my-github-blog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics Universal -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-77172981-1', 'auto');
        ga('send', 'pageview');
    </script>
    <!-- End Google Analytics Universal Code -->

<!-- share.js -->
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>



<script src="https://cdn.jsdelivr.net/npm/tocbot@3.0.2/dist/tocbot.min.js"></script>
<script>
$(document).ready(function(){
  tocbot.init({
    // Where to render the table of contents.
    tocSelector: '.js-toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: '.entry-content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h2, h3, h4,h5',
    // Headings that match the ignoreSelector will be skipped.
    ignoreSelector: '.js-toc-ignore',
    // Main class to add to links.
    linkClass: 'toc-link',
    // Extra classes to add to links.
    extraLinkClasses: '',
    // Class to add to active links,
    // the link corresponding to the top most heading on the page.
    activeLinkClass: 'is-active-link',
    // Main class to add to lists.
    listClass: 'toc-list',
    // Extra classes to add to lists.
    extraListClasses: '',
    // Class that gets added when a list should be collapsed.
    isCollapsedClass: 'is-collapsed',
    // Class that gets added when a list should be able
    // to be collapsed but isn't necessarily collpased.
    collapsibleClass: 'is-collapsible',
    // Class to add to list items.
    listItemClass: 'toc-list-item',
    // How many heading levels should not be collpased.
    // For example, number 6 will show everything since
    // there are only 6 heading levels and number 0 will collpase them all.
    // The sections that are hidden will open
    // and close as you scroll to headings within them.
    collapseDepth: 6,
    // Smooth scrolling enabled.
    smoothScroll: true,
    // Smooth scroll duration.
    smoothScrollDuration: 420,
    // Callback for scroll end (requires: smoothScroll).
    scrollEndCallback: function (e) {},
    // Headings offset between the headings and the top of the document (this is meant for minor adjustments).
    headingsOffset: 0,
    // Timeout between events firing to make sure it's
    // not too rapid (for performance reasons).
    throttleTimeout: 50,
    // Element to add the positionFixedClass to.
    positionFixedSelector: null,
    // Fixed position class to add to make sidebar fixed after scrolling
    // down past the fixedSidebarOffset.
    positionFixedClass: 'is-position-fixed',
    // fixedSidebarOffset can be any number but by default is set
    // to auto which sets the fixedSidebarOffset to the sidebar
    // element's offsetTop from the top of the document on init.
    fixedSidebarOffset: 'auto',
    // includeHtml can be set to true to include the HTML markup from the
    // heading node instead of just including the textContent.
    includeHtml: false
  });
});
</script>
</body>
</html>