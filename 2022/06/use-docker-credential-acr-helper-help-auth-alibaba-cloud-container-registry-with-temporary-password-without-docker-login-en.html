<!DOCTYPE html>
<html lang="en"  prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml" class="han-init">
<head>
    <title>docker-credential-acr-helper: A docker credential helper for Alibaba Cloud Container Registry (ACR) - mozillazg's blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- share.css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">


    <link href="https://mozillazg.com/favicon.ico" rel="icon">

<link rel="canonical" href="https://mozillazg.com/2022/06/use-docker-credential-acr-helper-help-auth-alibaba-cloud-container-registry-with-temporary-password-without-docker-login-en.html">

        <meta name="author" content="mozillazg" />
        <meta name="keywords" content="docker,ACR,en-version" />
    <meta name="description" content="Preface Normally, if we want to do docker pull or docker push on private images on Alibaba Cloud Container Registry (ACR), we need to configure the corresponding access credentials via docker login command in advance. The method of configuring a username and password via the docker login command has several problems, as follows: Requires users to record and maintain an additional set of docker-specific passwords, and password management is a bit of a pain. ACR only supports the configuration of a fixed password with no expiration time. The cost of password change and revocation is high, and users are easily afraid to operate. It is not possible to finely configure the permissions for fixed passwords, and it is not possible to achieve the permission control requirements like only allowing pull operations but not push operations. Although it is possible to obtain an unlimited number of temporary passwords through the Open API, docker login does not support the automatic refresh of temporary passwords. If you use a temporary password for docker login, you will need to get the temporary password frequently and then update it with docker login, which is also a hassle. Fortunately, Docker provides a mechanism called Credential helper, through which Credential helper can be plugged in in a way that The Credential helper extends the way docker can get access credentials, and is no longer limited to configuring access credentials via docker login. The docker-credential-acr-helper developed for ACR is a project to help docker get access credentials to ACR image repositories project. Introduction As mentioned earlier, docker-credential-acr-helper is a project developed specifically for ACR to help docker get access credentials to ACR image repositories. docker-credential-acr-helper solves the aforementioned problems. Based on Aliyun&#39;s existing authentication system, you can directly use the user&#39;s familiar Aliyun access credentials, no need to record and maintain additional docker-specific username and password. Automatically obtain temporary passwords for docker operations, not relying on fixed passwords, and no need to manually refresh temporary passwords frequently. Users can configure AliCloud RAM access control policies to achieve the need for granular permission control for temporary passwords, as described in the ACR documentation. Usage You can experience the features provided by this project by following these steps. Go to the github releases page and download the latest version of the compiled binary archive Use the checksums.txt file on the page to verify the archive, and extract the archive to get the corresponding binaries docker-credential-acr-helper. chmod +x docker-credential-acr-helper cp docker-credential-acr-helper /usr/local/bin Configure alibaba cloud access credentials, for example, use the configuration file to specify the access credentials: $ cat ~/.alibabacloud/credentials [default] # Default client type = access_key # The authentication method is access_key access_key_id = foo # Key access_key_secret = bar # Secret 6. Exit the ACR registry domain you want to test with docker logout &lt;acr_registry_domain&gt; and clean up the corresponding saved docker credentials. Confirm that you do not have access to the corresponding ACR private image by docker pull &lt;acr_image&gt;. 8. Modify the credHelpers configuration item in the docker configuration file ~/.docker/config.json to specify to use docker-credential-acr-helper to get access credentials when accessing an ACR registry domain (See the Official Docker Documentation or the project README for more details on this configuration) . Example configuration: { &#34;credHelpers&#34; : { &#34;registry.cn-beijing.aliyuncs.com&#34; : &#34;acr-helper&#34; } } Verify that the configuration is complete with docker pull &lt;acr_image&gt; and you can access the corresponding ACR private image again. Integrated into third-party projects as a golang package It is also possible to use this project as a golang package, integrating the project&#39;s capabilities into third-party projects. For example, when using github.com/google/go-containerregistry/pkg/crane to operate the docker registry, you can integrate docker-credential-acr-helper in your project using the following method: import ( &#34;github.com/google/go-containerregistry/pkg/authn&#34; &#34;github.com/google/go-containerregistry/pkg/crane&#34; &#34;github.com/mozillazg/docker-credential-acr-helper/pkg/credhelper&#34; ) func main() { kc := authn.NewMultiKeychain( authn.DefaultKeychain, authn.NewKeychainFromHelper(credhelper.NewACRHelper()), // &lt;- here ) ref := os.Getenv(&#34;REPO_URL&#34;) digest, err := crane.Digest(ref, crane.WithAuthFromKeychain(kc)) if err != nil { panic(err) } fmt.Printf(&#34;got digest for %q:\n%s\n&#34;, ref, digest) } The full sample code is here： examples/go-containerregistry-auth FAQ Whether to support ACR Enterprise Edition? Yes. How to implement different Alibaba Cloud access credentials for different ACR domains? this can be achieved by writing separate shell scripts for different access credentials. For example: $ cat /usr/local/bin/docker-credential-acr-helper-user-1 #!/usr/bin/env bash # export ALIBABA_CLOUD_ACCESS_KEY_ID=foo # export ALIBABA_CLOUD_ACCESS_KEY_SECRET=bar export ALIBABA_CLOUD_CREDENTIALS_FILE=/path/to/user-1-credentials exec /usr/local/bin/docker-credential-acr-helper &#34;$@&#34; $ chmod +x /usr/local/bin/docker-credential-acr-helper-user-1 Then configure ~/.docker/config.json to implement different ACR domains using shell scripts configured with different access credentials: { &#34;credHelpers&#34; : { &#34;registry.cn-beijing.aliyuncs.com&#34; : &#34;acr-helper&#34;, &#34;registry.cn-hangzhou.aliyuncs.com&#34; : &#34;acr-helper-user-1&#34;, &#34;registry.cn-shenzhen.aliyuncs.com&#34; : &#34;acr-helper-user-2&#34; } } References docker login | Docker Documentation docker/docker-credential-helpers: Programs to keep Docker login credentials safe by storing in platform keystores mozillazg/docker-credential-acr-helper: A credential helper for the Docker daemon that makes it easier to use Alibaba Cloud Container Registry(ACR). GetAuthorizationToken - ACR Documentation" />
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4941850466486001"
     crossorigin="anonymous"></script>

    <style>
      .js-toc {
        margin-bottom: 20px;
      }
      .donate-modal {
        text-align: center;
      }
      #donate-modal-container .donate-image {
        max-height: 300px !important;
        min-height: inherit !important;
      }
    </style>

        <meta property="og:site_name" content="mozillazg's blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="docker-credential-acr-helper: A docker credential helper for Alibaba Cloud Container Registry (ACR)"/>
        <meta property="og:url" content="https://mozillazg.com/2022/06/use-docker-credential-acr-helper-help-auth-alibaba-cloud-container-registry-with-temporary-password-without-docker-login-en.html"/>
        <meta property="og:description" content="Preface Normally, if we want to do docker pull or docker push on private images on Alibaba Cloud Container Registry (ACR), we need to configure the corresponding access credentials via docker login command in advance. The method of configuring a username and password via the docker login command has several problems, as follows: Requires users to record and maintain an additional set of docker-specific passwords, and password management is a bit of a pain. ACR only supports the configuration of a fixed password with no expiration time. The cost of password change and revocation is high, and users are easily afraid to operate. It is not possible to finely configure the permissions for fixed passwords, and it is not possible to achieve the permission control requirements like only allowing pull operations but not push operations. Although it is possible to obtain an unlimited number of temporary passwords through the Open API, docker login does not support the automatic refresh of temporary passwords. If you use a temporary password for docker login, you will need to get the temporary password frequently and then update it with docker login, which is also a hassle. Fortunately, Docker provides a mechanism called Credential helper, through which Credential helper can be plugged in in a way that The Credential helper extends the way docker can get access credentials, and is no longer limited to configuring access credentials via docker login. The docker-credential-acr-helper developed for ACR is a project to help docker get access credentials to ACR image repositories project. Introduction As mentioned earlier, docker-credential-acr-helper is a project developed specifically for ACR to help docker get access credentials to ACR image repositories. docker-credential-acr-helper solves the aforementioned problems. Based on Aliyun&#39;s existing authentication system, you can directly use the user&#39;s familiar Aliyun access credentials, no need to record and maintain additional docker-specific username and password. Automatically obtain temporary passwords for docker operations, not relying on fixed passwords, and no need to manually refresh temporary passwords frequently. Users can configure AliCloud RAM access control policies to achieve the need for granular permission control for temporary passwords, as described in the ACR documentation. Usage You can experience the features provided by this project by following these steps. Go to the github releases page and download the latest version of the compiled binary archive Use the checksums.txt file on the page to verify the archive, and extract the archive to get the corresponding binaries docker-credential-acr-helper. chmod +x docker-credential-acr-helper cp docker-credential-acr-helper /usr/local/bin Configure alibaba cloud access credentials, for example, use the configuration file to specify the access credentials: $ cat ~/.alibabacloud/credentials [default] # Default client type = access_key # The authentication method is access_key access_key_id = foo # Key access_key_secret = bar # Secret 6. Exit the ACR registry domain you want to test with docker logout &lt;acr_registry_domain&gt; and clean up the corresponding saved docker credentials. Confirm that you do not have access to the corresponding ACR private image by docker pull &lt;acr_image&gt;. 8. Modify the credHelpers configuration item in the docker configuration file ~/.docker/config.json to specify to use docker-credential-acr-helper to get access credentials when accessing an ACR registry domain (See the Official Docker Documentation or the project README for more details on this configuration) . Example configuration: { &#34;credHelpers&#34; : { &#34;registry.cn-beijing.aliyuncs.com&#34; : &#34;acr-helper&#34; } } Verify that the configuration is complete with docker pull &lt;acr_image&gt; and you can access the corresponding ACR private image again. Integrated into third-party projects as a golang package It is also possible to use this project as a golang package, integrating the project&#39;s capabilities into third-party projects. For example, when using github.com/google/go-containerregistry/pkg/crane to operate the docker registry, you can integrate docker-credential-acr-helper in your project using the following method: import ( &#34;github.com/google/go-containerregistry/pkg/authn&#34; &#34;github.com/google/go-containerregistry/pkg/crane&#34; &#34;github.com/mozillazg/docker-credential-acr-helper/pkg/credhelper&#34; ) func main() { kc := authn.NewMultiKeychain( authn.DefaultKeychain, authn.NewKeychainFromHelper(credhelper.NewACRHelper()), // &lt;- here ) ref := os.Getenv(&#34;REPO_URL&#34;) digest, err := crane.Digest(ref, crane.WithAuthFromKeychain(kc)) if err != nil { panic(err) } fmt.Printf(&#34;got digest for %q:\n%s\n&#34;, ref, digest) } The full sample code is here： examples/go-containerregistry-auth FAQ Whether to support ACR Enterprise Edition? Yes. How to implement different Alibaba Cloud access credentials for different ACR domains? this can be achieved by writing separate shell scripts for different access credentials. For example: $ cat /usr/local/bin/docker-credential-acr-helper-user-1 #!/usr/bin/env bash # export ALIBABA_CLOUD_ACCESS_KEY_ID=foo # export ALIBABA_CLOUD_ACCESS_KEY_SECRET=bar export ALIBABA_CLOUD_CREDENTIALS_FILE=/path/to/user-1-credentials exec /usr/local/bin/docker-credential-acr-helper &#34;$@&#34; $ chmod +x /usr/local/bin/docker-credential-acr-helper-user-1 Then configure ~/.docker/config.json to implement different ACR domains using shell scripts configured with different access credentials: { &#34;credHelpers&#34; : { &#34;registry.cn-beijing.aliyuncs.com&#34; : &#34;acr-helper&#34;, &#34;registry.cn-hangzhou.aliyuncs.com&#34; : &#34;acr-helper-user-1&#34;, &#34;registry.cn-shenzhen.aliyuncs.com&#34; : &#34;acr-helper-user-2&#34; } } References docker login | Docker Documentation docker/docker-credential-helpers: Programs to keep Docker login credentials safe by storing in platform keystores mozillazg/docker-credential-acr-helper: A credential helper for the Docker daemon that makes it easier to use Alibaba Cloud Container Registry(ACR). GetAuthorizationToken - ACR Documentation"/>
        <meta property="article:published_time" content="2022-06-20" />
            <meta property="article:section" content="docker" />
            <meta property="article:tag" content="docker" />
            <meta property="article:tag" content="ACR" />
            <meta property="article:tag" content="en-version" />
            <meta property="article:author" content="mozillazg" />
            <meta property="og:image"
                  content="https://mozillazg.com/static/avatar.jpeg"/>


    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@mozillazg">
        <meta name="twitter:creator" content="@mozillazg">
    <meta name="twitter:domain" content="https://mozillazg.com">
            <meta property="twitter:image"
                  content="https://mozillazg.com/static/avatar.jpeg"/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.4/dist/css/bootstrap.min.css" type="text/css"/>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/pygments-css@1.0.0/github.css" rel="stylesheet">
    <link rel="stylesheet" href="https://mozillazg.com/theme/css/style.css" type="text/css"/>
            <link href="https://mozillazg.com/static/custom.css" rel="stylesheet">

        <link href="https://mozillazg.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="mozillazg's blog ATOM Feed"/>

        <link href="https://mozillazg.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="mozillazg's blog RSS Feed"/>


        <link href="https://mozillazg.com/feeds/docker.atom.xml" type="application/atom+xml" rel="alternate"
              title="mozillazg's blog docker ATOM Feed"/>


    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "publisher": {
            "@type": "Person",
            "name": "mozillazg",
            "logo": "https://mozillazg.com/static/avatar.jpeg"
        },
        "author": {
            "@type": "Person",
            "name": "mozillazg",
            "image": "https://mozillazg.com/static/avatar.jpeg",
            "url": "https://mozillazg.com",
            "sameAs": []
        },
        "headline": "docker-credential-acr-helper: A docker credential helper for Alibaba Cloud Container Registry (ACR)",
        "url": "https://mozillazg.com/2022/06/use-docker-credential-acr-helper-help-auth-alibaba-cloud-container-registry-with-temporary-password-without-docker-login-en.html",
        "image": [
            "https://mozillazg.com/static/avatar.jpeg"
         ],
        "keywords": "docker, ACR, en-version",
        "description": "Preface Normally, if we want to do docker pull or docker push on private images on Alibaba Cloud Container Registry (ACR), we need to configure the corresponding access credentials via docker login command in advance. The method of configuring a username and password via the docker login command has several problems, as follows: Requires users to record and maintain an additional set of docker-specific passwords, and password management is a bit of a pain. ACR only supports the configuration of a fixed password with no expiration time. The cost of password change and revocation is high, and users are easily afraid to operate. It is not possible to finely configure the permissions for fixed passwords, and it is not possible to achieve the permission control requirements like only allowing pull operations but not push operations. Although it is possible to obtain an unlimited number of temporary passwords through the Open API, docker login does not support the automatic refresh of temporary passwords. If you use a temporary password for docker login, you will need to get the temporary password frequently and then update it with docker login, which is also a hassle. Fortunately, Docker provides a mechanism called Credential helper, through which Credential helper can be plugged in in a way that The Credential helper extends the way docker can get access credentials, and is no longer limited to configuring access credentials via docker login. The docker-credential-acr-helper developed for ACR is a project to help docker get access credentials to ACR image repositories project. Introduction As mentioned earlier, docker-credential-acr-helper is a project developed specifically for ACR to help docker get access credentials to ACR image repositories. docker-credential-acr-helper solves the aforementioned problems. Based on Aliyun&#39;s existing authentication system, you can directly use the user&#39;s familiar Aliyun access credentials, no need to record and maintain additional docker-specific username and password. Automatically obtain temporary passwords for docker operations, not relying on fixed passwords, and no need to manually refresh temporary passwords frequently. Users can configure AliCloud RAM access control policies to achieve the need for granular permission control for temporary passwords, as described in the ACR documentation. Usage You can experience the features provided by this project by following these steps. Go to the github releases page and download the latest version of the compiled binary archive Use the checksums.txt file on the page to verify the archive, and extract the archive to get the corresponding binaries docker-credential-acr-helper. chmod +x docker-credential-acr-helper cp docker-credential-acr-helper /usr/local/bin Configure alibaba cloud access credentials, for example, use the configuration file to specify the access credentials: $ cat ~/.alibabacloud/credentials [default] # Default client type = access_key # The authentication method is access_key access_key_id = foo # Key access_key_secret = bar # Secret 6. Exit the ACR registry domain you want to test with docker logout &lt;acr_registry_domain&gt; and clean up the corresponding saved docker credentials. Confirm that you do not have access to the corresponding ACR private image by docker pull &lt;acr_image&gt;. 8. Modify the credHelpers configuration item in the docker configuration file ~/.docker/config.json to specify to use docker-credential-acr-helper to get access credentials when accessing an ACR registry domain (See the Official Docker Documentation or the project README for more details on this configuration) . Example configuration: { &#34;credHelpers&#34; : { &#34;registry.cn-beijing.aliyuncs.com&#34; : &#34;acr-helper&#34; } } Verify that the configuration is complete with docker pull &lt;acr_image&gt; and you can access the corresponding ACR private image again. Integrated into third-party projects as a golang package It is also possible to use this project as a golang package, integrating the project&#39;s capabilities into third-party projects. For example, when using github.com/google/go-containerregistry/pkg/crane to operate the docker registry, you can integrate docker-credential-acr-helper in your project using the following method: import ( &#34;github.com/google/go-containerregistry/pkg/authn&#34; &#34;github.com/google/go-containerregistry/pkg/crane&#34; &#34;github.com/mozillazg/docker-credential-acr-helper/pkg/credhelper&#34; ) func main() { kc := authn.NewMultiKeychain( authn.DefaultKeychain, authn.NewKeychainFromHelper(credhelper.NewACRHelper()), // &lt;- here ) ref := os.Getenv(&#34;REPO_URL&#34;) digest, err := crane.Digest(ref, crane.WithAuthFromKeychain(kc)) if err != nil { panic(err) } fmt.Printf(&#34;got digest for %q:\\n%s\\n&#34;, ref, digest) } The full sample code is here： examples/go-containerregistry-auth FAQ Whether to support ACR Enterprise Edition? Yes. How to implement different Alibaba Cloud access credentials for different ACR domains? this can be achieved by writing separate shell scripts for different access credentials. For example: $ cat /usr/local/bin/docker-credential-acr-helper-user-1 #!/usr/bin/env bash # export ALIBABA_CLOUD_ACCESS_KEY_ID=foo # export ALIBABA_CLOUD_ACCESS_KEY_SECRET=bar export ALIBABA_CLOUD_CREDENTIALS_FILE=/path/to/user-1-credentials exec /usr/local/bin/docker-credential-acr-helper &#34;$@&#34; $ chmod +x /usr/local/bin/docker-credential-acr-helper-user-1 Then configure ~/.docker/config.json to implement different ACR domains using shell scripts configured with different access credentials: { &#34;credHelpers&#34; : { &#34;registry.cn-beijing.aliyuncs.com&#34; : &#34;acr-helper&#34;, &#34;registry.cn-hangzhou.aliyuncs.com&#34; : &#34;acr-helper-user-1&#34;, &#34;registry.cn-shenzhen.aliyuncs.com&#34; : &#34;acr-helper-user-2&#34; } } References docker login | Docker Documentation docker/docker-credential-helpers: Programs to keep Docker login credentials safe by storing in platform keystores mozillazg/docker-credential-acr-helper: A credential helper for the Docker daemon that makes it easier to use Alibaba Cloud Container Registry(ACR). GetAuthorizationToken - ACR Documentation",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://mozillazg.com/2022/06/use-docker-credential-acr-helper-help-auth-alibaba-cloud-container-registry-with-temporary-password-without-docker-login-en.html"
        },
        "datePublished": "2022-06-20"
    }
    </script>

</head>
<body>

<div class="navbar" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://mozillazg.com/" class="navbar-brand">
mozillazg's blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="https://mozillazg.com/feeds/all.atom.xml">Feed</a></li>
                    <li><a href="/2014/10/pages/about-me.html">About</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://mozillazg.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content" class="yue">
        <article>
            <header class="text-center">
                <h1>
                    <a href="https://mozillazg.com/2022/06/use-docker-credential-acr-helper-help-auth-alibaba-cloud-container-registry-with-temporary-password-without-docker-login-en.html"
                       rel="bookmark"
                       title="Permalink to docker-credential-acr-helper: A docker credential helper for Alibaba Cloud Container Registry (ACR)">
                        docker-credential-acr-helper: A docker credential helper for Alibaba Cloud Container Registry (ACR)
                    </a>
                </h1>
                <p class="published">
                    <time datetime="2022-06-20T00:00:00+00:00">
                    2022-06-20
                    </time>
                </p>
            </header>
            <div class="entry-content">
                <div class="well-sm article-info">
<footer class="post-info">
        <a href="https://mozillazg.com/category/docker.html">docker</a>


<span class="label label-default hide">Tags</span>
	<a href="https://mozillazg.com/tag/acr.html">ACR</a>
        /
	<a href="https://mozillazg.com/tag/en-version.html">en-version</a>
    <span class="label label-default">Lang</span>
	<a href="https://mozillazg.com/2022/06/use-docker-credential-acr-helper-help-auth-alibaba-cloud-container-registry-with-temporary-password-without-docker-login.html">zh</a>

</footer><!-- /.post-info -->                </div>
                <div class="js-toc"></div>
                <div>
                <div class="section" id="preface">
<h2 id="hidpreface">Preface<a class="headerlink" href="#hidpreface" title="Permalink to this headline">¶</a></h2>
<p>Normally, if we want to do <tt class="docutils literal">docker pull</tt> or <tt class="docutils literal">docker push</tt> on private images on
Alibaba Cloud Container Registry (ACR),
we need to configure the corresponding access credentials via
<tt class="docutils literal">docker login</tt> command in advance.</p>
<p>The method of configuring a username and password via the <tt class="docutils literal">docker login</tt>
command has several problems, as follows:</p>
<ul class="simple">
<li>Requires users to record and maintain an additional set of docker-specific passwords,
and password management is a bit of a pain.</li>
<li>ACR only supports the configuration of a fixed password with no expiration time.
The cost of password change and revocation is high, and users are easily afraid to operate.</li>
<li>It is not possible to finely configure the permissions for fixed passwords,
and it is not possible to achieve the permission control requirements like only
allowing pull operations but not push operations.</li>
<li>Although it is possible to obtain an unlimited number of temporary passwords through the Open API,
<tt class="docutils literal">docker login</tt> does not support the automatic refresh of temporary passwords.
If you use a temporary password for <tt class="docutils literal">docker login</tt>, you will need to get
the temporary password frequently and then update it with <tt class="docutils literal">docker login</tt>, which is also a hassle.</li>
</ul>
<p>Fortunately, Docker provides a mechanism called <a class="reference external" href="https://docs.docker.com/engine/reference/commandline/login/#credential-helpers">Credential helper</a>, through which Credential helper can be plugged in in a way that The Credential helper extends the way docker can get access credentials, and is no longer limited to configuring access credentials via <tt class="docutils literal">docker login</tt>.</p>
<p>The <a class="reference external" href="https://github.com/mozillazg/docker-credential-acr-helper">docker-credential-acr-helper</a>
developed for ACR is a project to help docker get access credentials to ACR image repositories project.</p>
</div>
<div class="section" id="introduction">
<h2 id="hidintroduction">Introduction<a class="headerlink" href="#hidintroduction" title="Permalink to this headline">¶</a></h2>
<p>As mentioned earlier, <a class="reference external" href="https://github.com/mozillazg/docker-credential-acr-helper">docker-credential-acr-helper</a> is a project developed specifically for ACR to help docker get access credentials to ACR image repositories.</p>
<p>docker-credential-acr-helper solves the aforementioned problems.</p>
<ul class="simple">
<li>Based on Aliyun's existing authentication system, you can directly use the user's familiar Aliyun access credentials, no need to record and maintain additional docker-specific username and password.</li>
<li>Automatically obtain temporary passwords for docker operations, not relying on fixed passwords, and no need to manually refresh temporary passwords frequently.</li>
<li>Users can configure AliCloud RAM access control policies to achieve the need for granular permission control for temporary passwords, as described in the <a class="reference external" href="https://www.alibabacloud.com/help/doc-detail/72334.html">ACR documentation</a>.</li>
</ul>
</div>
<div class="section" id="usage">
<h2 id="hidusage">Usage<a class="headerlink" href="#hidusage" title="Permalink to this headline">¶</a></h2>
<p>You can experience the features provided by this project by following these steps.</p>
<ol class="arabic">
<li><p class="first">Go to the <a class="reference external" href="https://github.com/mozillazg/docker-credential-acr-helper/releases">github releases</a> page and download the latest version of the compiled binary archive</p>
</li>
<li><p class="first">Use the checksums.txt file on the page to verify the archive, and extract the archive to get the corresponding binaries <tt class="docutils literal"><span class="pre">docker-credential-acr-helper</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal">chmod +x <span class="pre">docker-credential-acr-helper</span></tt></p>
</li>
<li><p class="first"><tt class="docutils literal">cp <span class="pre">docker-credential-acr-helper</span> /usr/local/bin</tt></p>
</li>
<li><p class="first">Configure alibaba cloud access credentials, for example, use the configuration file to specify the access credentials:</p>
<pre class="literal-block">
$ cat ~/.alibabacloud/credentials
[default] # Default client
type = access_key # The authentication method is access_key
access_key_id = foo # Key
access_key_secret = bar # Secret
</pre>
</li>
</ol>
<p>6. Exit the ACR registry domain you want to test with <tt class="docutils literal">docker logout &lt;acr_registry_domain&gt;</tt> and clean up the corresponding saved docker credentials.
Confirm that you do not have access to the corresponding ACR private image by <tt class="docutils literal">docker pull &lt;acr_image&gt;</tt>.
8. Modify the <tt class="docutils literal">credHelpers</tt> configuration item in the docker configuration file <tt class="docutils literal"><span class="pre">~/.docker/config.json</span></tt> to specify to use docker-credential-acr-helper to get access credentials when accessing an ACR registry domain (See the <a class="reference external" href="https://docs.docker.com/engine/reference/commandline/login/#configure-credential-helpers">Official Docker Documentation</a> or the project README for more details on this configuration) . Example configuration:</p>
<pre class="literal-block">
{
  &quot;credHelpers&quot; : {
    &quot;registry.cn-beijing.aliyuncs.com&quot; : &quot;acr-helper&quot;
  }
}
</pre>
<ol class="arabic simple" start="9">
<li>Verify that the configuration is complete with <tt class="docutils literal">docker pull &lt;acr_image&gt;</tt> and you can access the corresponding ACR private image again.</li>
</ol>
</div>
<div class="section" id="integrated-into-third-party-projects-as-a-golang-package">
<h2 id="hidintegrated-into-third-party-projects-as-a-golang-package">Integrated into third-party projects as a golang package<a class="headerlink" href="#hidintegrated-into-third-party-projects-as-a-golang-package" title="Permalink to this headline">¶</a></h2>
<p>It is also possible to use this project as a golang package, integrating the project's capabilities into third-party projects.</p>
<p>For example, when using <tt class="docutils literal"><span class="pre">github.com/google/go-containerregistry/pkg/crane</span></tt> to operate the
docker registry, you can integrate docker-credential-acr-helper in your project using the following method:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;github.com/google/go-containerregistry/pkg/authn&quot;</span>
    <span class="s">&quot;github.com/google/go-containerregistry/pkg/crane&quot;</span>
    <span class="s">&quot;github.com/mozillazg/docker-credential-acr-helper/pkg/credhelper&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">kc</span> <span class="o">:=</span> <span class="nx">authn</span><span class="p">.</span><span class="nx">NewMultiKeychain</span><span class="p">(</span>
            <span class="nx">authn</span><span class="p">.</span><span class="nx">DefaultKeychain</span><span class="p">,</span>
            <span class="nx">authn</span><span class="p">.</span><span class="nx">NewKeychainFromHelper</span><span class="p">(</span><span class="nx">credhelper</span><span class="p">.</span><span class="nx">NewACRHelper</span><span class="p">()),</span>  <span class="c1">// &lt;- here</span>
    <span class="p">)</span>
    <span class="nx">ref</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;REPO_URL&quot;</span><span class="p">)</span>
    <span class="nx">digest</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">crane</span><span class="p">.</span><span class="nx">Digest</span><span class="p">(</span><span class="nx">ref</span><span class="p">,</span> <span class="nx">crane</span><span class="p">.</span><span class="nx">WithAuthFromKeychain</span><span class="p">(</span><span class="nx">kc</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;got digest for %q:\n%s\n&quot;</span><span class="p">,</span> <span class="nx">ref</span><span class="p">,</span> <span class="nx">digest</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>The full sample code is here： <a class="reference external" href="https://github.com/mozillazg/docker-credential-acr-helper/blob/master/examples/go-containerregistry-auth/main.go">examples/go-containerregistry-auth</a></p>
</div>
<div class="section" id="faq">
<h2 id="hidfaq">FAQ<a class="headerlink" href="#hidfaq" title="Permalink to this headline">¶</a></h2>
<div class="section" id="whether-to-support-acr-enterprise-edition">
<h3 id="hidwhether-to-support-acr-enterprise-edition">Whether to support ACR Enterprise Edition?<a class="headerlink" href="#hidwhether-to-support-acr-enterprise-edition" title="Permalink to this headline">¶</a></h3>
<p>Yes.</p>
</div>
<div class="section" id="how-to-implement-different-alibaba-cloud-access-credentials-for-different-acr-domains">
<h3 id="hidhow-to-implement-different-alibaba-cloud-access-credentials-for-different-acr-domains">How to implement different Alibaba Cloud access credentials for different ACR domains?<a class="headerlink" href="#hidhow-to-implement-different-alibaba-cloud-access-credentials-for-different-acr-domains" title="Permalink to this headline">¶</a></h3>
<p>this can be achieved by writing separate shell scripts for different access credentials.</p>
<p>For example:</p>
<pre class="literal-block">
$ cat /usr/local/bin/docker-credential-acr-helper-user-1
#!/usr/bin/env bash

# export ALIBABA_CLOUD_ACCESS_KEY_ID=foo
# export ALIBABA_CLOUD_ACCESS_KEY_SECRET=bar
export ALIBABA_CLOUD_CREDENTIALS_FILE=/path/to/user-1-credentials

exec /usr/local/bin/docker-credential-acr-helper &quot;$&#64;&quot;

$ chmod +x /usr/local/bin/docker-credential-acr-helper-user-1
</pre>
<p>Then configure <tt class="docutils literal"><span class="pre">~/.docker/config.json</span></tt> to implement different ACR domains using shell scripts configured with different access credentials:</p>
<pre class="literal-block">
{
  &quot;credHelpers&quot; : {
    &quot;registry.cn-beijing.aliyuncs.com&quot; : &quot;acr-helper&quot;,
    &quot;registry.cn-hangzhou.aliyuncs.com&quot; : &quot;acr-helper-user-1&quot;,
    &quot;registry.cn-shenzhen.aliyuncs.com&quot; : &quot;acr-helper-user-2&quot;
  }
}
</pre>
</div>
</div>
<div class="section" id="references">
<h2 id="hidreferences">References<a class="headerlink" href="#hidreferences" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/login/">docker login | Docker Documentation</a></li>
<li><a class="reference external" href="https://github.com/docker/docker-credential-helpers">docker/docker-credential-helpers: Programs to keep Docker login credentials safe by storing in platform keystores</a></li>
<li><a class="reference external" href="https://github.com/mozillazg/docker-credential-acr-helper">mozillazg/docker-credential-acr-helper: A credential helper for the Docker daemon that makes it easier to use Alibaba Cloud Container Registry(ACR).</a></li>
<li><a class="reference external" href="https://help.aliyun.com/document_detail/72334.html">GetAuthorizationToken - ACR Documentation</a></li>
</ul>
</div>

                </div>
            </div>
            <!-- /.entry-content -->
<section class="text-center">
  
<div id="donate"></div>

<div class="social-share"></div>
<div class="social-comment-note">
<p>有任何建议和想法欢迎在下方评论区留言或者加我<a href="/static/wechat.png">微信</a>交流</p>
</div>

</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'my-github-blog'; // required: replace example with your forum shortname

                    var disqus_identifier = 'use-docker-credential-acr-helper-help-auth-alibaba-cloud-container-registry-with-temporary-password-without-docker-login';
                var disqus_url = 'https://mozillazg.com/2022/06/use-docker-credential-acr-helper-help-auth-alibaba-cloud-container-registry-with-temporary-password-without-docker-login-en.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2022 mozillazg
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
            &middot; <a href="/privacy-policy.html" target="_blank">Privacy</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/static/images/by-sa-80x15.png" /></a>
    &quot;<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">mozillazg's blog</span>&quot; by <a xmlns:cc="http://creativecommons.org/ns#" href="https://mozillazg.com" property="cc:attributionName" rel="cc:attributionURL">mozillazg</a> is
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/jquery@2.1.1/dist/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'my-github-blog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics Universal -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-77172981-1', 'auto');
        ga('send', 'pageview');
    </script>
    <!-- End Google Analytics Universal Code -->

<!-- share.js -->
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>



<script src="https://cdn.jsdelivr.net/npm/tocbot@3.0.2/dist/tocbot.min.js"></script>
<script>
$(document).ready(function(){
  tocbot.init({
    // Where to render the table of contents.
    tocSelector: '.js-toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: '.entry-content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h2, h3, h4,h5',
    // Headings that match the ignoreSelector will be skipped.
    ignoreSelector: '.js-toc-ignore',
    // Main class to add to links.
    linkClass: 'toc-link',
    // Extra classes to add to links.
    extraLinkClasses: '',
    // Class to add to active links,
    // the link corresponding to the top most heading on the page.
    activeLinkClass: 'is-active-link',
    // Main class to add to lists.
    listClass: 'toc-list',
    // Extra classes to add to lists.
    extraListClasses: '',
    // Class that gets added when a list should be collapsed.
    isCollapsedClass: 'is-collapsed',
    // Class that gets added when a list should be able
    // to be collapsed but isn't necessarily collpased.
    collapsibleClass: 'is-collapsible',
    // Class to add to list items.
    listItemClass: 'toc-list-item',
    // How many heading levels should not be collpased.
    // For example, number 6 will show everything since
    // there are only 6 heading levels and number 0 will collpase them all.
    // The sections that are hidden will open
    // and close as you scroll to headings within them.
    collapseDepth: 6,
    // Smooth scrolling enabled.
    smoothScroll: true,
    // Smooth scroll duration.
    smoothScrollDuration: 420,
    // Callback for scroll end (requires: smoothScroll).
    scrollEndCallback: function (e) {},
    // Headings offset between the headings and the top of the document (this is meant for minor adjustments).
    headingsOffset: 0,
    // Timeout between events firing to make sure it's
    // not too rapid (for performance reasons).
    throttleTimeout: 50,
    // Element to add the positionFixedClass to.
    positionFixedSelector: null,
    // Fixed position class to add to make sidebar fixed after scrolling
    // down past the fixedSidebarOffset.
    positionFixedClass: 'is-position-fixed',
    // fixedSidebarOffset can be any number but by default is set
    // to auto which sets the fixedSidebarOffset to the sidebar
    // element's offsetTop from the top of the document on init.
    fixedSidebarOffset: 'auto',
    // includeHtml can be set to true to include the HTML markup from the
    // heading node instead of just including the textContent.
    includeHtml: false
  });
});
</script>
</body>
</html>