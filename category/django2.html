<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Mozillazg's Blog</title>
  <meta name="author" content="mozillazg">



  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://mozillazg.com/favicon.png" rel="icon">
  <link href="https://mozillazg.com/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="https://mozillazg.com/theme/js/modernizr-2.0.js"></script>
  <script src="https://mozillazg.com/theme/js/ender.js"></script>
  <script src="https://mozillazg.com/theme/js/octopress.js" type="text/javascript"></script>

</head>

<body class="collapse-sidebar">
  <header role="banner"><hgroup>
  <h1><a href="https://mozillazg.com/">Mozillazg's Blog</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mozillazg.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
    <li><a href="/index.html">Home</a></li>
      <li><a href="https://mozillazg.com/2014/10/pages/about-me.html">About me</a></li>
</ul></nav>
  <div id="main">
    <div id="content">
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/03/django-merge-queryset-then-sort.html">[django]合并多个查询结果集(queryset)并按字段排序</a>
      </h1>
      <p class="meta"><time datetime="2013-03-28T00:00:00+00:00" pubdate>周四 28 三月 2013</time></p>
</header>

  <div class="entry-content"><h2 id="_1">需求</h2>
<p>合并博文的喜爱及转发信息，并按时间排序。</p>
<p>相关 models :</p>
<div class="codehilite"><pre><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c">#...</span>

    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">reblog_from</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c">#...</span>


<span class="k">class</span> <span class="nc">Like</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c">#...</span>

    <span class="n">post</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c">#...</span>
</pre></div>


<h2 id="_2">解决方案</h2>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>

<span class="c">#...</span>

<span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">post_id ...</span></pre></div></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/03/django-merge-queryset-then-sort.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/02/django-add-extra-error-messages.html">[django]添加额外的 form 错误信息</a>
      </h1>
      <p class="meta"><time datetime="2013-02-27T00:00:00+00:00" pubdate>周三 27 二月 2013</time></p>
</header>

  <div class="entry-content"><p>通过两种方法给 Django 表单添加额外的错误信息。</p>
<p>第一种方法，使用 form 自定义校验（更详细的请查看 <a href="https://docs.djangoproject.com/en/dev/ref/forms/validation/">django 官方文档</a>）：</p>
<p>定义 <code>clean</code> 方法：</p>
<div class="codehilite"><pre><span class="k">class</span> <span class="nc">RegisterForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">RegisterForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="n">re_username</span> <span class="o">=</span> <span class="s">r&#39;^[a-zA-Z\d][-a-zA-Z\d]*$&#39;</span>

        <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;This email address ...</span></pre></div></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/02/django-add-extra-error-messages.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/02/django-bad-character-range.html">[django]修复 bad character range 异常</a>
      </h1>
      <p class="meta"><time datetime="2013-02-26T00:00:00+00:00" pubdate>周二 26 二月 2013</time></p>
</header>

  <div class="entry-content"><p>出现 bad character range 异常， 是因为程序某个地方的正则表达式写错了，
不是一个有效的正则表达式。</p>
<p>比如正则 <code>[_-\d]</code> 就是一个无效的正则，会报 <code>bad character range</code> 异常。
将正则修改为 <code>[-_\d]</code> 使之成为一个有效的正则，就可以修复该异常。</p>
<h2 id="_1">参考</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/1526137/bad-character-range-exception">django - "bad character range" exception? - Stack Overflow</a></li>
</ul></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/02/django-bad-character-range.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/02/django-variable-subtraction-in-django-templates.html">[django]在模板中对变量作减法操作</a>
      </h1>
      <p class="meta"><time datetime="2013-02-25T00:00:00+00:00" pubdate>周一 25 二月 2013</time></p>
</header>

  <div class="entry-content"><p>我们知道可以使用内置过滤器 <code>add</code> 对变量做加法操作：</p>
<div class="codehilite"><pre><span class="cp">{{</span> <span class="m">3</span><span class="o">|</span><span class="nf">add</span><span class="s2">:&quot;1&quot;</span> <span class="cp">}}</span><span class="x">   # 4</span>
</pre></div>


<p>其实，<code>add</code> 也可以做减法操作：</p>
<div class="codehilite"><pre><span class="cp">{{</span> <span class="m">3</span><span class="o">|</span><span class="nf">add</span><span class="s2">:&quot;-1&quot;</span> <span class="cp">}}</span><span class="x">  # 2</span>
</pre></div>


<h2 id="_1">参考</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/9948095/variable-subtraction-in-django-templates">Variable subtraction in django templates - Stack Overflow</a></li>
</ul></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/02/django-variable-subtraction-in-django-templates.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/02/django-copy-or-clone-a-query-result-and-insert-it-into-database.html">[django]复制/克隆一条查询结果</a>
      </h1>
      <p class="meta"><time datetime="2013-02-24T00:00:00+00:00" pubdate>周日 24 二月 2013</time></p>
</header>

  <div class="entry-content"><p>复制/克隆一条查询结果，并将它插入到数据库中：</p>
<p>将 pk 值设为 None 即可：</p>
<div class="codehilite"><pre><span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;My blog&#39;</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s">&#39;Blogging is easy&#39;</span><span class="p">)</span>
<span class="n">blog</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c"># post.pk == 1</span>

<span class="n">blog</span><span class="o">.</span><span class="n">pk</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">blog</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c"># post.pk == 2</span>
</pre></div>


<p>如果该 model 继承于另一个 model 的话，必须将 <code>pk</code> 和 <code>id</code> 的值都设为 None:</p>
<div class="codehilite"><pre><span class="k">class</span> <span class="nc">ThemeBlog</span><span class="p">(</span><span class="n">Blog</span><span class="p">):</span>
    <span class="n">theme</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">django_blog ...</span></pre></div></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/02/django-copy-or-clone-a-query-result-and-insert-it-into-database.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/02/django-custom-decorators-optional-keyword-arguments-for-views.html">[django]编写作用于视图（view）的装饰器（Decorator）</a>
      </h1>
      <p class="meta"><time datetime="2013-02-23T00:00:00+00:00" pubdate>周六 23 二月 2013</time></p>
</header>

  <div class="entry-content"><p>本文假设读者已经知道如何编写基本的装饰器代码，否则请自行 google：“python 装饰器”and/or “python decorator”。</p>
<h2 id="_1">不带参数的装饰器</h2>
<!--分两种情况：-->

<!--* 视图函数只有一个 request 参数-->

<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">object_does_not_exist</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">returned_wrapper</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Http404</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">returned_wrapper</span>
</pre></div>


<p>用法：</p>
<div class="codehilite"><pre><span class="nd">@object_does_not_exist</span>
<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>


<h2 id="_2">带参数的装饰器</h2>
<ul>
<li>
<p>第一种写法：</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">object_does_not_exist</span><span class="p">(</span><span class="n">redirect</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator ...</span></pre></div></li></ul></!--*></!--分两种情况：--></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/02/django-custom-decorators-optional-keyword-arguments-for-views.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/02/django-online-server-admin-doesnotexist-at-admin.html">[django]线上部署后，访问 admin 时出现“DoesNotExist at /admin/ Site matching query does not exist.”错误</a>
      </h1>
      <p class="meta"><time datetime="2013-02-19T00:00:00+00:00" pubdate>周二 19 二月 2013</time></p>
</header>

  <div class="entry-content"><p>将 django 项目部署到服务器后，访问 admin 时出现如下错误：</p>
<div class="codehilite"><pre>DoesNotExist at /admin/
Site matching query does not exist.
</pre></div>


<p>上网搜索后，参考 <a href="http://stackoverflow.com/questions/9736975/django-admin-doesnotexist-at-admin">http://stackoverflow.com/questions/9736975/django-admin-doesnotexist-at-admin</a> 修复了该问题，下面记录一下解决过程。</p>
<p>两种解决办法：</p>
<ul>
<li>
<p>第一种办法是：编辑 settings.py 文件，从 <code>INSTALLED_APPS</code> 配置项中移除 <code>'django.contrib.sites',</code>。</p>
</li>
<li>
<p>第二种办法：通过 <code>python manage.py shell</code> 为 Site model 添加一条记录（将网站的域名添加进去）：</p>
<div class="codehilite"><pre><span class="gp">$</span> python manage ...</pre></div></li></ul></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/02/django-online-server-admin-doesnotexist-at-admin.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/02/django-typeerror-decod-argument-1-must-be-string-not-none.html">[django] 创建后台超级用户时出现 TypeError: decode() argument 1 must be string, not None 错误</a>
      </h1>
      <p class="meta"><time datetime="2013-02-19T00:00:00+00:00" pubdate>周二 19 二月 2013</time></p>
</header>

  <div class="entry-content"><p>错误信息如下：</p>
<div class="codehilite"><pre><span class="go">You just installed Django&#39;s auth system, which means you don&#39;t have any superusers defined.</span>
<span class="go">Would you like to create one now? (yes/no): yes</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">  File &quot;manage.py&quot;, line 10, in &lt;module&gt;</span>
<span class="go">    execute_from_command_line(sys.argv)</span>
<span class="go">  File &quot;/usr/local/lib/python2.7/dist-packages/django ...</span></pre></div></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/02/django-typeerror-decod-argument-1-must-be-string-not-none.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/02/django-offical-coding-style.html">[django]官方编码规范</a>
      </h1>
      <p class="meta"><time datetime="2013-02-01T00:00:00+00:00" pubdate>周五 01 二月 2013</time></p>
</header>

  <div class="entry-content"><p>请以最新的官方英文版为准：<a href="https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/">https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/</a></p>
<h2 id="_1">编码风格</h2>
<p>当编写 Django 代码时，请遵循下列编码规范。</p>
<h3 id="python">Python 风格</h3>
<ul>
<li>
<p>除非另有规定，否则请遵循 <a href="http://www.python.org/dev/peps/pep-0008">PEP 8</a> 风格指南。    <br />
  你可以使用类似 <a href="http://pypi.python.org/pypi/pep8">pep8</a> 的工具检查你的代码，
  但是，请记住 <a href="http://www.python.org/dev/peps/pep-0008">PEP 8</a> 只是个指南，并非强制约束，因此应当以你所处项目/团队的风格为主。    <br />
  一个比较大的例外就是，<a href="http://www.python.org/dev/peps/pep-0008">PEP 8</a> 规定代码行长最长不能超过 79 个字符。问题是现在是 21 世纪了，我们有高分辨率的显示器可以显示超过 79 个字符的代码行。如果这这个约定让代码看起来很丑或难以阅读的话，那么就没必要限制行长不超过 79 个字符 ...</p></li></ul></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/02/django-offical-coding-style.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/01/django-deploying-with-apache-mode-wsgi.html">[django]使用 apache + mod_wsgi 部署 django</a>
      </h1>
      <p class="meta"><time datetime="2013-01-31T00:00:00+00:00" pubdate>周四 31 一月 2013</time></p>
</header>

  <div class="entry-content"><p>本文测试环境：linux mint，python 2.7，django 1.4</p>
<h2 id="_1">安装依赖</h2>
<div class="codehilite"><pre><span class="gp">$</span> sudo apt-get install apache2
<span class="gp">$</span> sudo apt-get install libapache2-mod-wsgi
</pre></div>


<h2 id="django">设置 django</h2>
<p>本例中项目名为 bbs:</p>
<div class="codehilite"><pre><span class="gp">$</span> <span class="nb">pwd</span>
<span class="go">/var/www/bbs</span>

<span class="gp">$</span> tree . -d
<span class="go">.</span>
<span class="go">|-- bb  # 应用</span>
<span class="go">|-- bbs  # settings.py wsgi.py</span>
<span class="go">|-- static  # 静态文件</span>
<span class="go">|   `-- css</span>
<span class="go">`-- templates  # TEMPLATE_DIRS</span>
</pre></div>


<p>配置 settings：</p>
<div class="codehilite"><pre><span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;/var/www/bbs/templates&#39;</span><span class="p">,</span>  <span class="c"># 这里要是绝对路径</span>
<span class="p">)</span>

<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="s">&#39;/var ...</span></pre></div></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/01/django-deploying-with-apache-mode-wsgi.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/01/django-deploying-with-fastcgi-nginx.html">[django]使用 nginx + fastcgi 部署 django</a>
      </h1>
      <p class="meta"><time datetime="2013-01-31T00:00:00+00:00" pubdate>周四 31 一月 2013</time></p>
</header>

  <div class="entry-content"><p>本文测试环境：linux mint，python 2.7，django 1.4</p>
<h2 id="_1">安装依赖</h2>
<p>安装 flup:</p>
<div class="codehilite"><pre><span class="gp">$</span> sudo pip install flup
</pre></div>


<p>安装 nginx</p>
<div class="codehilite"><pre><span class="gp">$</span> sudo apt-get install nginx
</pre></div>


<h2 id="django">设置 django</h2>
<p>本例中项目名为 bbs:</p>
<div class="codehilite"><pre><span class="gp">$</span> <span class="nb">pwd</span>
<span class="go">/var/www/bbs</span>

<span class="gp">$</span> tree . -d
<span class="go">.</span>
<span class="go">|-- bb  # 应用</span>
<span class="go">|-- bbs  # settings.py wsgi.py</span>
<span class="go">|-- static  # 静态文件</span>
<span class="go">|   `-- css</span>
<span class="go">`-- templates  # TEMPLATE_DIRS</span>
</pre></div>


<p>配置 settings：</p>
<div class="codehilite"><pre><span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;/var/www/bbs ...</span></pre></div></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/01/django-deploying-with-fastcgi-nginx.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/01/django-built-in-comments-framework.html">[django]使用内置的 comments 实现评论功能</a>
      </h1>
      <p class="meta"><time datetime="2013-01-27T00:00:00+00:00" pubdate>周日 27 一月 2013</time></p>
</header>

  <div class="entry-content"><h2 id="comments">安装 comments 应用</h2>
<ol>
<li>
<p>编辑 settings 文件，<code>INSTALLED_APPS</code> 项添加 <code>'django.contrib.comments',</code>：</p>
<div class="codehilite"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c"># ...</span>
    <span class="s">&#39;django.contrib.comments&#39;</span><span class="p">,</span>
    <span class="c"># ...</span>
<span class="p">)</span>
</pre></div>


</li>
<li>
<p>执行 <code>python manage.py syncdb</code> 创建评论表。</p>
</li>
<li>
<p>编辑 urls.py 文件，添加评论相关的 url：</p>
<div class="codehilite"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^comments/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;django.contrib.comments.urls&#39;</span><span class="p">)),</span>
    <span class="c"># ...</span>
<span class="p">)</span>
</pre></div>


</li>
</ol>
<h2 id="views">示例 views</h2>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">display_topic</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">topic_id</span><span class="p">):</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">Topic</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">topic_id</span><span class="p">)</span>
    <span class="k">return ...</span></pre></div></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/01/django-built-in-comments-framework.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/01/django-pagination-by-use-paginator.html">[django]使用 Paginator 实现分页功能</a>
      </h1>
      <p class="meta"><time datetime="2013-01-26T00:00:00+00:00" pubdate>周六 26 一月 2013</time></p>
</header>

  <div class="entry-content"><p>在 django 中使用 Paginator 可以很方便的实现分页功能，下面就通过一个具体的例子来讲讲如何使用 Paginator。</p>
<h2 id="view-paginator">在 view 中使用 Paginator</h2>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">EmptyPage</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">PageNotAnInteger</span>
<span class="kn">from</span> <span class="nn">hello.models</span> <span class="kn">import</span> <span class="n">Topic</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># 每页显示的记录数</span>
    <span class="n">topics</span> <span class="o">=</span> <span class="n">Topic</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>  <span class="c"># 实例化一个分页对象</span>

    <span class="n">page ...</span></pre></div></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/01/django-pagination-by-use-paginator.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/01/django-global-template-variable-by-use-custom-context-processor.html">[django]使用自定义 context processor 实现模板全局变量</a>
      </h1>
      <p class="meta"><time datetime="2013-01-23T00:00:00+00:00" pubdate>周三 23 一月 2013</time></p>
</header>

  <div class="entry-content"><p>本文使用的是 django 1.4.3。</p>
<h2 id="context-processor">写一个 context processor 函数</h2>
<p>可以把这个函数放在项目的任何地方，本文是放在应用目录下的 context_processors.py 文件中：</p>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">hello.models</span> <span class="kn">import</span> <span class="n">Category</span>


<span class="k">def</span> <span class="nf">categories</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>  <span class="c"># 只有一个参数（HttpRequeset 对象）</span>
    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;categories&#39;</span><span class="p">:</span> <span class="n">all_categories</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">context</span>  <span class="c"># 返回值必须是个字典</span>
</pre></div>


<p>注意：context processor 函数只有一个参数，即 HttpRequest 对象，并且函数的返回值必须是个字典。</p>
<h2 id="settings">修改 settings 文件</h2>
<p>修改 TEMPLATE_CONTEXT_PROCESSORS 选项值，添加新建的 ...</p></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/01/django-global-template-variable-by-use-custom-context-processor.html">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://mozillazg.com/2013/01/django-variables-and-attributes-may-not-begin-with-underscores.html">[django] Variables and attributes may not begin with underscores</a>
      </h1>
      <p class="meta"><time datetime="2013-01-17T00:00:00+00:00" pubdate>周四 17 一月 2013</time></p>
</header>

  <div class="entry-content"><p>当尝试在模板中<strong>调用以下划线开头的对象时</strong>，会报如下类似错误：</p>
<blockquote>
<p>TemplateSyntaxError at /</p>
<p>Variables and attributes may not begin with underscores: 'user._meta.get_field('name').help_text'</p>
</blockquote>
<p>解决方法就是，将调用以下划线开头的对象的操作封装到模板过滤器中。</p>
<h2 id="_1">如何创建自定义模板过滤器</h2>
<p>在 models.py 文件所在目录新建一个 templatetags 目录:</p>
<div class="codehilite"><pre><span class="n">hello</span><span class="o">/</span>
    <span class="n">models</span><span class="p">.</span><span class="n">py</span>
    <span class="n">templatetags</span><span class="o">/</span>
        <span class="n">hello_extras</span><span class="p">.</span><span class="n">py</span>
        <span class="n">__init__</span><span class="p">.</span><span class="n">py</span>
    <span class="n">views</span><span class="p">.</span><span class="n">py</span>
</pre></div>


<p>hello_extras.py 中保存着我们自定义的模板过滤器。</p>
<p>在 hello_extras.py 文件的开头需要包含如下代码：</p>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template ...</span></pre></div></div>
  <footer>
    <a rel="full-article" href="https://mozillazg.com/2013/01/django-variables-and-attributes-may-not-begin-with-underscores.html">Read On &crarr;</a>
  </footer>
  		</article>
<div class="pagination">

      <a class="next" href="https://mozillazg.com/category/django.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="https://mozillazg.com/2015/11/django-fix-operationalerror-1093-you-cant-specify-target-table-wedding-plan-for-update-in-from-clause.html">[django] 解决 OperationalError: (1093, "You can't specify target table 'xxx' for update in FROM clause")</a>
      </li>
      <li class="post">
          <a href="https://mozillazg.com/2015/11/django-the-power-of-q-objects-and-how-to-use-q-object.html">[django] 使用 Q 对象构建复杂的查询语句</a>
      </li>
      <li class="post">
          <a href="https://mozillazg.com/2015/11/django-check-user-permission-for-class-generic-view.html">怎么给 django class view 增加权限判断</a>
      </li>
      <li class="post">
          <a href="https://mozillazg.com/2015/11/django-use-queue-maybe-raise-object-not-exist-error.html">解决在 Django 中使用 rq 或 celery 任务队列有时会出现 DoesNotExist 的问题</a>
      </li>
      <li class="post">
          <a href="https://mozillazg.com/2015/09/how-to-configure-for-show-django-rq-admin.html">配置 django-rq 在 admin 后台显示队列管理页面</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="https://mozillazg.com/category/comics.html">comics</a></li>
        <li><a href="https://mozillazg.com/category/database.html">database</a></li>
        <li><a href="https://mozillazg.com/category/django.html">django</a></li>
        <li><a href="https://mozillazg.com/category/docker.html">docker</a></li>
        <li><a href="https://mozillazg.com/category/english.html">english</a></li>
        <li><a href="https://mozillazg.com/category/firefox.html">firefox</a></li>
        <li><a href="https://mozillazg.com/category/flask.html">flask</a></li>
        <li><a href="https://mozillazg.com/category/git.html">git</a></li>
        <li><a href="https://mozillazg.com/category/go.html">go</a></li>
        <li><a href="https://mozillazg.com/category/javascript.html">javascript</a></li>
        <li><a href="https://mozillazg.com/category/linux.html">linux</a></li>
        <li><a href="https://mozillazg.com/category/mongodb.html">mongodb</a></li>
        <li><a href="https://mozillazg.com/category/others.html">others</a></li>
        <li><a href="https://mozillazg.com/category/peewee.html">peewee</a></li>
        <li><a href="https://mozillazg.com/category/python.html">python</a></li>
        <li><a href="https://mozillazg.com/category/reading.html">reading</a></li>
        <li><a href="https://mozillazg.com/category/tornado.html">tornado</a></li>
        <li><a href="https://mozillazg.com/category/web.html">web</a></li>
        <li><a href="https://mozillazg.com/category/windows.html">windows</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="https://mozillazg.com/tag/wsgi.html">wsgi</a>,    <a href="https://mozillazg.com/tag/zope2.html">zope2</a>,    <a href="https://mozillazg.com/tag/python-third-party-model.html">python-third-party-model</a>,    <a href="https://mozillazg.com/tag/pelican.html">pelican</a>,    <a href="https://mozillazg.com/tag/commitstrip.html">CommitStrip</a>,    <a href="https://mozillazg.com/tag/tiao-ban-ji.html">跳板机</a>,    <a href="https://mozillazg.com/tag/python-markdown.html">python-markdown</a>,    <a href="https://mozillazg.com/tag/datetime.html">datetime</a>,    <a href="https://mozillazg.com/tag/sanbox.html">sanbox</a>,    <a href="https://mozillazg.com/tag/vsftp.html">vsftp</a>,    <a href="https://mozillazg.com/tag/unicode.html">unicode</a>,    <a href="https://mozillazg.com/tag/mysql.html">mysql</a>,    <a href="https://mozillazg.com/tag/flask-restful.html">Flask-RESTful</a>,    <a href="https://mozillazg.com/tag/web.html">web</a>,    <a href="https://mozillazg.com/tag/generator.html">generator</a>,    <a href="https://mozillazg.com/tag/flask.html">flask</a>,    <a href="https://mozillazg.com/tag/psycopg2.html">psycopg2</a>,    <a href="https://mozillazg.com/tag/celery.html">celery</a>,    <a href="https://mozillazg.com/tag/sqldeveloper.html">sqldeveloper</a>,    <a href="https://mozillazg.com/tag/iptables.html">iptables</a>,    <a href="https://mozillazg.com/tag/python.html">python</a>,    <a href="https://mozillazg.com/tag/useradmin.html">UserAdmin</a>,    <a href="https://mozillazg.com/tag/framework.html">framework</a>,    <a href="https://mozillazg.com/tag/ssh.html">ssh</a>,    <a href="https://mozillazg.com/tag/fab.html">fab</a>,    <a href="https://mozillazg.com/tag/sorted.html">sorted</a>,    <a href="https://mozillazg.com/tag/zope.html">zope</a>,    <a href="https://mozillazg.com/tag/decorator.html">decorator</a>,    <a href="https://mozillazg.com/tag/sorting.html">sorting</a>,    <a href="https://mozillazg.com/tag/summernote.html">Summernote</a>,    <a href="https://mozillazg.com/tag/gitlab.html">gitlab</a>,    <a href="https://mozillazg.com/tag/list.html">list</a>,    <a href="https://mozillazg.com/tag/server.html">server</a>,    <a href="https://mozillazg.com/tag/mitmproxy.html">mitmproxy</a>,    <a href="https://mozillazg.com/tag/merge.html">merge</a>,    <a href="https://mozillazg.com/tag/rang-wo-men-qi-lai-gou-jian-ge-mo-ban-yin-qing.html">让我们一起来构建一个模板引擎</a>,    <a href="https://mozillazg.com/tag/lsbaws.html">lsbaws</a>,    <a href="https://mozillazg.com/tag/pdfjs.html">pdf.js</a>,    <a href="https://mozillazg.com/tag/multiprocessing.html">multiprocessing</a>,    <a href="https://mozillazg.com/tag/list_display.html">list_display</a>,    <a href="https://mozillazg.com/tag/postpresql.html">postpresql</a>,    <a href="https://mozillazg.com/tag/centos.html">centos</a>,    <a href="https://mozillazg.com/tag/zhong-wen-fan-yi.html">中文翻译</a>,    <a href="https://mozillazg.com/tag/yi-dong-duan-kai-fa.html">移动端开发</a>,    <a href="https://mozillazg.com/tag/auto-increment.html">auto-increment</a>,    <a href="https://mozillazg.com/tag/vmware.html">VMware</a>,    <a href="https://mozillazg.com/tag/dateutil.html">dateutil</a>,    <a href="https://mozillazg.com/tag/querydict.html">querydict</a>,    <a href="https://mozillazg.com/tag/replication.html">replication</a>,    <a href="https://mozillazg.com/tag/python-3.html">python 3</a>,    <a href="https://mozillazg.com/tag/template.html">template</a>,    <a href="https://mozillazg.com/tag/foreign-key.html">foreign-key</a>,    <a href="https://mozillazg.com/tag/memcached.html">memcached</a>,    <a href="https://mozillazg.com/tag/email.html">email</a>,    <a href="https://mozillazg.com/tag/wireshark.html">wireshark</a>,    <a href="https://mozillazg.com/tag/weinre.html">weinre</a>,    <a href="https://mozillazg.com/tag/gunicorn.html">gunicorn</a>,    <a href="https://mozillazg.com/tag/sendmail.html">sendmail</a>,    <a href="https://mozillazg.com/tag/web-quan-zhan-gong-cheng-shi-de-zi-wo-xiu-yang.html">Web 全栈工程师的自我修养</a>,    <a href="https://mozillazg.com/tag/screen.html">screen</a>,    <a href="https://mozillazg.com/tag/javascript.html">javascript</a>,    <a href="https://mozillazg.com/tag/orm.html">orm</a>,    <a href="https://mozillazg.com/tag/ubuntu.html">ubuntu</a>,    <a href="https://mozillazg.com/tag/apache.html">apache</a>,    <a href="https://mozillazg.com/tag/bash.html">bash</a>,    <a href="https://mozillazg.com/tag/postgresql.html">postgresql</a>,    <a href="https://mozillazg.com/tag/socket.html">socket</a>,    <a href="https://mozillazg.com/tag/cyanide-and-happiness.html">Cyanide and Happiness</a>,    <a href="https://mozillazg.com/tag/admin.html">admin</a>,    <a href="https://mozillazg.com/tag/rang-wo-men-qi-lai-gou-jian-ge-web-fu-wu-qi.html">让我们一起来构建一个 Web 服务器</a>,    <a href="https://mozillazg.com/tag/jwt.html">jwt</a>,    <a href="https://mozillazg.com/tag/django-rq.html">django-rq</a>,    <a href="https://mozillazg.com/tag/yum.html">yum</a>,    <a href="https://mozillazg.com/tag/thread-locals.html">Thread-Locals</a>,    <a href="https://mozillazg.com/tag/router.html">router</a>,    <a href="https://mozillazg.com/tag/wei-xin.html">微信</a>,    <a href="https://mozillazg.com/tag/pillow.html">pillow</a>,    <a href="https://mozillazg.com/tag/south.html">south</a>,    <a href="https://mozillazg.com/tag/phpmyadmin.html">phpmyadmin</a>,    <a href="https://mozillazg.com/tag/markdown.html">markdown</a>,    <a href="https://mozillazg.com/tag/firefox.html">firefox</a>,    <a href="https://mozillazg.com/tag/color.html">color</a>,    <a href="https://mozillazg.com/tag/gitlab-git-http-server.html">gitlab-git-http-server</a>,    <a href="https://mozillazg.com/tag/search_fields.html">search_fields</a>,    <a href="https://mozillazg.com/tag/pygments.html">pygments</a>,    <a href="https://mozillazg.com/tag/linux.html">linux</a>,    <a href="https://mozillazg.com/tag/gateway.html">gateway</a>,    <a href="https://mozillazg.com/tag/terminal.html">terminal</a>,    <a href="https://mozillazg.com/tag/git.html">git</a>,    <a href="https://mozillazg.com/tag/fabric.html">fabric</a>,    <a href="https://mozillazg.com/tag/flask-sqlalchemy.html">flask-sqlalchemy</a>,    <a href="https://mozillazg.com/tag/buttersafe.html">buttersafe</a>,    <a href="https://mozillazg.com/tag/rpmforge.html">rpmforge</a>,    <a href="https://mozillazg.com/tag/redmine.html">redmine</a>,    <a href="https://mozillazg.com/tag/mongodbshu-ju-ku.html">MongoDB，数据库</a>,    <a href="https://mozillazg.com/tag/tcpdump.html">tcpdump</a>,    <a href="https://mozillazg.com/tag/valueerror.html">ValueError</a>,    <a href="https://mozillazg.com/tag/fastcgi.html">fastcgi</a>,    <a href="https://mozillazg.com/tag/sort.html">sort</a>,    <a href="https://mozillazg.com/tag/shell.html">shell</a>,    <a href="https://mozillazg.com/tag/form.html">form</a>,    <a href="https://mozillazg.com/tag/pinyin.html">pinyin</a>,    <a href="https://mozillazg.com/tag/goroutine.html">goroutine</a>,    <a href="https://mozillazg.com/tag/man-hua.html">漫画</a>,    <a href="https://mozillazg.com/tag/explosmnet.html">Explosm.net</a>,    <a href="https://mozillazg.com/tag/python-dateutil.html">python-dateutil</a>,    <a href="https://mozillazg.com/tag/lsbate.html">lsbate</a>,    <a href="https://mozillazg.com/tag/psql.html">psql</a>,    <a href="https://mozillazg.com/tag/thread.html">thread</a>,    <a href="https://mozillazg.com/tag/x-priority.html">X-Priority</a>,    <a href="https://mozillazg.com/tag/comics.html">comics</a>,    <a href="https://mozillazg.com/tag/verbose_name_plural.html">verbose_name_plural</a>,    <a href="https://mozillazg.com/tag/function-annotations.html">Function Annotations</a>,    <a href="https://mozillazg.com/tag/tu-jie-http.html">图解 HTTP</a>,    <a href="https://mozillazg.com/tag/berkeley-mews.html">Berkeley Mews</a>,    <a href="https://mozillazg.com/tag/fork.html">fork</a>,    <a href="https://mozillazg.com/tag/pil.html">pil</a>,    <a href="https://mozillazg.com/tag/ying-yu.html">英语</a>,    <a href="https://mozillazg.com/tag/queryset.html">queryset</a>,    <a href="https://mozillazg.com/tag/libxml.html">libxml</a>,    <a href="https://mozillazg.com/tag/sqlalchemy.html">sqlalchemy</a>,    <a href="https://mozillazg.com/tag/libxslt.html">libxslt</a>,    <a href="https://mozillazg.com/tag/bigintegerfield.html">BigIntegerField</a>,    <a href="https://mozillazg.com/tag/vps.html">vps</a>,    <a href="https://mozillazg.com/tag/threading.html">threading</a>,    <a href="https://mozillazg.com/tag/excel.html">excel</a>,    <a href="https://mozillazg.com/tag/flotr2.html">flotr2</a>,    <a href="https://mozillazg.com/tag/tubeytoons.html">Tubeytoons</a>,    <a href="https://mozillazg.com/tag/csv.html">csv</a>,    <a href="https://mozillazg.com/tag/verbose_name.html">verbose_name</a>,    <a href="https://mozillazg.com/tag/mod_wsgi.html">mod_wsgi</a>,    <a href="https://mozillazg.com/tag/http.html">http</a>,    <a href="https://mozillazg.com/tag/exec.html">exec</a>,    <a href="https://mozillazg.com/tag/yi-hua.html">汉化</a>,    <a href="https://mozillazg.com/tag/victims-of-circumsolar.html">Victims of Circumsolar</a>,    <a href="https://mozillazg.com/tag/ansi.html">ansi</a>,    <a href="https://mozillazg.com/tag/lxml.html">lxml</a>,    <a href="https://mozillazg.com/tag/wechat.html">wechat</a>,    <a href="https://mozillazg.com/tag/cygwin.html">Cygwin</a>,    <a href="https://mozillazg.com/tag/zhuang-shi-qi.html">装饰器</a>,    <a href="https://mozillazg.com/tag/loading-artist.html">Loading Artist</a>,    <a href="https://mozillazg.com/tag/rq.html">rq</a>,    <a href="https://mozillazg.com/tag/argparse.html">argparse</a>,    <a href="https://mozillazg.com/tag/github.html">github</a>,    <a href="https://mozillazg.com/tag/high-performance-django.html">High Performance Django</a>,    <a href="https://mozillazg.com/tag/nginx.html">nginx</a>,    <a href="https://mozillazg.com/tag/windows.html">windows</a>,    <a href="https://mozillazg.com/tag/django.html">django</a>,    <a href="https://mozillazg.com/tag/alembic.html">alembic</a>,    <a href="https://mozillazg.com/tag/english.html">english</a>,    <a href="https://mozillazg.com/tag/send_mail.html">send_mail</a>  </section>


    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="https://github.com/mozillazg" target="_blank">Fork me on GitHub</a></li>
            <li><a href="https://comic.mozillazg.com" target="_blank">Comics</a></li>
            <li><a href="https://mozillazg.com/feeds/all.atom.xml" target="_blank">Atom Feed</a></li>
            <li><a href="https://mozillazg.com/feeds/all.rss.xml" target="_blank">RSS Feed</a></li>
        </ul>
    </section>
    <section>
        <h1>Blogroll</h1>
        <ul>
            <li><a href="http://docs.notmyidea.org/alexis/pelican/" target="_blank">Pelican</a></li>
            <li><a href="http://python.org" target="_blank">Python.org</a></li>
            <li><a href="http://jinja.pocoo.org" target="_blank">Jinja2</a></li>
        </ul>
    </section>

<section>
    <p>Follow <a href="http://twitter.com/mozillazg">@mozillazg</a></p>
</section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013-2015  - mozillazg -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
	<script type="text/javascript">
	  var disqus_shortname = 'my-github-blog';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
</body>
</html>